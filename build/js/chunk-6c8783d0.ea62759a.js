(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6c8783d0","chunk-1b7dea6e","chunk-2d225296"],{"003f":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("f2e0");class a{constructor(){this.id=Object(r["a"])()}unload(){}}},"0278":function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var r=i("b2b2"),a=i("b7c2"),n=i("8a44"),s=i("e431"),o=i("0b2d"),c=i("1153");class l{constructor(e,t,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.indices=i,this.position=r,this.center=Object(o["f"])(),Object(c["a"])(e.length>=1),Object(c["a"])(i.length%this._numIndexPerPrimitive==0),Object(c["a"])(i.length>=e.length*this._numIndexPerPrimitive),Object(c["a"])(3===r.size||4===r.size);const{data:a,size:n}=r,l=e.length;let h=n*i[this._numIndexPerPrimitive*e[0]];d.clear(),d.push(h),this.bbMin=Object(o["h"])(a[h],a[h+1],a[h+2]),this.bbMax=Object(o["d"])(this.bbMin);for(let s=0;s<l;++s){const t=this._numIndexPerPrimitive*e[s];for(let e=0;e<this._numIndexPerPrimitive;++e){h=n*i[t+e],d.push(h);let r=a[h];this.bbMin[0]=Math.min(r,this.bbMin[0]),this.bbMax[0]=Math.max(r,this.bbMax[0]),r=a[h+1],this.bbMin[1]=Math.min(r,this.bbMin[1]),this.bbMax[1]=Math.max(r,this.bbMax[1]),r=a[h+2],this.bbMin[2]=Math.min(r,this.bbMin[2]),this.bbMax[2]=Math.max(r,this.bbMax[2])}}Object(s["l"])(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let u=this.radius*this.radius;for(let s=0;s<d.length;++s){h=d.getItemAt(s);const e=a[h]-this.center[0],t=a[h+1]-this.center[1],i=a[h+2]-this.center[2],r=e*e+t*t+i*i;if(r<=u)continue;const n=Math.sqrt(r),o=.5*(n-this.radius);this.radius=this.radius+o,u=this.radius*this.radius;const c=o/n;this.center[0]+=e*c,this.center[1]+=t*c,this.center[2]+=i*c}d.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(Object(s["h"])(this.bbMin,this.bbMax)>1){const e=Object(s["l"])(Object(o["f"])(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,i=new Uint8Array(t),r=new Array(8);for(let s=0;s<8;++s)r[s]=0;const{data:a,size:n}=this.position;for(let s=0;s<t;++s){let t=0;const o=this._numIndexPerPrimitive*this.primitiveIndices[s];let c=n*this.indices[o],l=a[c],d=a[c+1],h=a[c+2];for(let e=1;e<this._numIndexPerPrimitive;++e){c=n*this.indices[o+e];const t=a[c],i=a[c+1],r=a[c+2];t<l&&(l=t),i<d&&(d=i),r<h&&(h=r)}l<e[0]&&(t|=1),d<e[1]&&(t|=2),h<e[2]&&(t|=4),i[s]=t,++r[t]}let c=0;for(let s=0;s<8;++s)r[s]>0&&++c;if(c<2)return;const d=new Array(8);for(let s=0;s<8;++s)d[s]=r[s]>0?new Uint32Array(r[s]):void 0;for(let s=0;s<8;++s)r[s]=0;for(let s=0;s<t;++s){const e=i[s];d[e][r[e]++]=this.primitiveIndices[s]}this._children=new Array(8);for(let s=0;s<8;++s)void 0!==d[s]&&(this._children[s]=new l(d[s],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){d.prune()}}const d=new n["a"]({deallocator:null});var h=i("003f"),u=i("2765"),p=i("1038"),b=i("b7bd");class f extends h["a"]{constructor(e,t=[],i=a["f"].Triangle,r=-1){super(),this._primitiveType=i,this.edgeIndicesLength=r,this.type=u["a"].Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[a,n]of e)n&&this._vertexAttributes.set(a,{...n});if(null==t||0===t.length){const e=m(this._vertexAttributes),t=Object(p["d"])(e);this.edgeIndicesLength=this.edgeIndicesLength<0?e:this.edgeIndicesLength;for(const i of this._vertexAttributes.keys())this._indices.set(i,t)}else for(const[a,n]of t)n&&(this._indices.set(a,g(n)),a===b["a"].POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(a).length:this.edgeIndicesLength))}cloneShallow(){const e=new f([],void 0,this._primitiveType,void 0),{_vertexAttributes:t,_indices:i}=e;return this._vertexAttributes.forEach((e,i)=>{t.set(i,e)}),this._indices.forEach((e,t)=>{i.set(t,e)}),e.screenToWorldRatio=this.screenToWorldRatio,e._boundingInfo=this._boundingInfo,e}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){const t=this._vertexAttributes.get(e);return t&&!t.exclusive&&(t.data=Array.from(t.data),t.exclusive=!0),t}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return Object(r["j"])(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return this.primitiveType===a["f"].Triangle?this._computeAttachmentOriginTriangles(e):this._computeAttachmentOriginPoints(e)}_computeAttachmentOriginTriangles(e){const t=this.indices.get(b["a"].POSITION),i=this.vertexAttributes.get(b["a"].POSITION);return Object(p["c"])(i,t,e)}_computeAttachmentOriginPoints(e){const t=this.indices.get(b["a"].POSITION),i=this.vertexAttributes.get(b["a"].POSITION);return Object(p["b"])(i,t,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(b["a"].POSITION);if(0===e.length)return null;const t=this.primitiveType===a["f"].Triangle?3:1;Object(c["a"])(e.length%t==0,"Indexing error: "+e.length+" not divisible by "+t);const i=Object(p["d"])(e.length/t),r=this.vertexAttributes.get(b["a"].POSITION);return new l(i,t,e,r)}}function m(e){const t=e.values().next().value;return null==t?0:t.data.length/t.size}function g(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}},"02a0":function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o}));var r=i("dae5"),a=i("0b2d"),n=i("35b3");class s extends n["b"]{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=Object(a["h"])(1,1,1),this.vvSizeMaxSize=Object(a["h"])(100,100,100),this.vvSizeOffset=Object(a["h"])(0,0,0),this.vvSizeFactor=Object(a["h"])(1,1,1),this.vvSizeValue=Object(a["h"])(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Object(r["b"])()}}const o=8},"0310":function(e,t,i){"use strict";i.d(t,"a",(function(){return H})),i.d(t,"b",(function(){return k}));var r=i("b2b2"),a=i("afe1"),n=i("bd75"),s=i("17ca"),o=i("a05b"),c=i("d272"),l=i("4db9"),d=i("d539"),h=i("c332"),u=i("b09a"),p=i("6cb2"),b=i("dfaf"),f=i("6d5b"),m=i("7d11"),g=i("17b0"),O=i("7e21"),v=i("0d7a"),y=i("7088"),_=i("ea4b"),j=i("c6d7"),x=i("aab5"),S=i("5d5f"),T=i("a7d7"),w=i("d017"),C=i("be24"),A=i("3976"),P=i("ebd5"),R=i("d56e"),E=i("3626"),I=i("8e97"),M=i("ea32"),D=i("fd48"),L=i("1fe9"),N=i("3886"),F=i("85b3"),z=i("690a"),G=i("6a3c"),V=i("b7c2"),U=i("b7bd"),B=i("2245");function k(e){const t=new z["a"],i=t.vertex.code,k=t.fragment.code;t.include(R["a"],{name:"Default Material Shader",output:e.output});const H=Object(I["b"])(t,e);return t.include(u["a"]),t.varyings.add("vpos","vec3"),t.include(C["a"],e),t.include(d["a"],e),t.include(g["a"],e),e.output!==o["a"].Color&&e.output!==o["a"].Alpha||(Object(I["a"])(t.vertex,e),t.include(h["a"],e),t.include(l["a"],{linearDepth:!1,hasModelTransformation:e.hasModelTransformation}),e.normalType===h["b"].Attribute&&e.offsetBackfaces&&t.include(s["a"]),t.include(v["a"],e),t.include(m["a"],e),e.instancedColor&&t.attributes.add(U["a"].INSTANCECOLOR,"vec4"),t.varyings.add("localvpos","vec3"),t.include(b["a"],e),t.include(n["a"],e),t.include(p["a"],e),t.include(f["a"],e),t.vertex.uniforms.add(new D["a"]("externalColor",e=>e.externalColor)),t.varyings.add("vcolorExt","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),e.hasModelTransformation&&t.vertex.uniforms.add(new F["a"]("model",e=>Object(r["k"])(e.modelTransformation)?e.modelTransformation:a["a"])),i.add(N["b"]`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${N["b"].float(A["b"])}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${e.normalType===h["b"].Attribute?N["b"]`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${e.hasModelTransformation?"model,":""} vpos);
          ${e.normalType===h["b"].Attribute&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `)),e.output===o["a"].Alpha&&(t.include(c["a"],e),t.include(P["a"],e),t.include(j["b"],e),t.fragment.uniforms.add([new L["a"]("opacity",e=>e.opacity),new L["a"]("layerOpacity",e=>e.layerOpacity)]),e.hasColorTexture&&t.fragment.uniforms.add(new G["a"]("tex",e=>e.texture)),t.fragment.include(E["a"]),k.add(N["b"]`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?N["b"]`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:N["b"]`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?N["b"]`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:N["b"]`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===o["a"].Color&&(t.include(c["a"],e),t.include(_["a"],e),t.include(y["a"],e),t.include(P["a"],e),t.include(e.instancedDoublePrecision?w["b"]:w["a"],e),t.include(j["b"],e),Object(I["a"])(t.fragment,e),t.fragment.uniforms.add([H,new M["a"]("ambient",e=>e.ambient),new M["a"]("diffuse",e=>e.diffuse),new L["a"]("opacity",e=>e.opacity),new L["a"]("layerOpacity",e=>e.layerOpacity),new L["a"]("lightingGlobalFactor",(e,t)=>t.lighting.globalFactor),new M["a"]("lightingMainIntensity",(e,t)=>t.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",B["b"]),e.hasColorTexture&&t.fragment.uniforms.add(new G["a"]("tex",e=>e.texture)),t.include(T["b"],e),t.include(S["a"],e),t.fragment.include(E["a"]),t.include(x["a"],e),k.add(N["b"]`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?N["b"]`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:N["b"]`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===h["b"].ScreenDerivative?N["b"]`
                vec3 normal = screenDerivativeNormal(localvpos);`:N["b"]`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===T["a"].Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?N["b"]`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:N["b"]`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.hasNormalTexture?N["b"]`
                mat3 tangentSpace = ${e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:N["b"]`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${e.spherical?N["b"]`normalize(vpos + localOrigin);`:N["b"]`vec3(0.0, 0.0, 1.0);`}

        ${e.snowCover?N["b"]`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${e.pbrMode===T["a"].Normal||e.pbrMode===T["a"].Schematic?N["b"]`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?N["b"]`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:N["b"]`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===V["i"].Color?N["b"]`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),t.include(O["a"],e),t}const H=Object.freeze(Object.defineProperty({__proto__:null,build:k},Symbol.toStringTag,{value:"Module"}))},"037a":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae"),a=i("52b2");class n extends r["a"]{constructor(e,t){super(e,"mat3",a["a"].Draw,(i,r,a)=>i.setUniformMatrix3fv(e,t(r,a)))}}},"040b":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("3886");function a(e,t){t.spherical?e.vertex.code.add(r["b"]`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(r["b"]`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(r["b"]`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(r["b"]`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},"04f0":function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return v})),i.d(t,"d",(function(){return N})),i.d(t,"e",(function(){return j})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return z})),i.d(t,"h",(function(){return d}));var r=i("dae5"),a=i("b139"),n=i("0b2d"),s=i("4212"),o=i("e431"),c=i("7577");function l(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function d(e,t,i){i*=.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function h(e,t){const i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>s["a"]?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i}function u(e,t,i){const r=t[0],a=t[1],n=t[2],s=t[3],o=i[0],c=i[1],l=i[2],d=i[3];return e[0]=r*d+s*o+a*l-n*c,e[1]=a*d+s*c+n*o-r*l,e[2]=n*d+s*l+r*c-a*o,e[3]=s*d-r*o-a*c-n*l,e}function p(e,t,i){i*=.5;const r=t[0],a=t[1],n=t[2],s=t[3],o=Math.sin(i),c=Math.cos(i);return e[0]=r*c+s*o,e[1]=a*c+n*o,e[2]=n*c-a*o,e[3]=s*c-r*o,e}function b(e,t,i){i*=.5;const r=t[0],a=t[1],n=t[2],s=t[3],o=Math.sin(i),c=Math.cos(i);return e[0]=r*c-n*o,e[1]=a*c+s*o,e[2]=n*c+r*o,e[3]=s*c-a*o,e}function f(e,t,i){i*=.5;const r=t[0],a=t[1],n=t[2],s=t[3],o=Math.sin(i),c=Math.cos(i);return e[0]=r*c+a*o,e[1]=a*c-r*o,e[2]=n*c+s*o,e[3]=s*c-n*o,e}function m(e,t){const i=t[0],r=t[1],a=t[2];return e[0]=i,e[1]=r,e[2]=a,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-a*a)),e}function g(e,t,i,r){const a=t[0],n=t[1],o=t[2],c=t[3];let l,d,h,u,p,b=i[0],f=i[1],m=i[2],g=i[3];return d=a*b+n*f+o*m+c*g,d<0&&(d=-d,b=-b,f=-f,m=-m,g=-g),1-d>s["a"]?(l=Math.acos(d),h=Math.sin(l),u=Math.sin((1-r)*l)/h,p=Math.sin(r*l)/h):(u=1-r,p=r),e[0]=u*a+p*b,e[1]=u*n+p*f,e[2]=u*o+p*m,e[3]=u*c+p*g,e}function O(e){const t=Object(s["b"])(),i=Object(s["b"])(),r=Object(s["b"])(),a=Math.sqrt(1-t),n=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*i),e[1]=a*Math.cos(2*Math.PI*i),e[2]=n*Math.sin(2*Math.PI*r),e[3]=n*Math.cos(2*Math.PI*r),e}function v(e,t){const i=t[0],r=t[1],a=t[2],n=t[3],s=i*i+r*r+a*a+n*n,o=s?1/s:0;return e[0]=-i*o,e[1]=-r*o,e[2]=-a*o,e[3]=n*o,e}function y(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function _(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);const a=(i+1)%3,n=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*a+a]-t[3*n+n]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*a+n]-t[3*n+a])*r,e[a]=(t[3*a+i]+t[3*i+a])*r,e[n]=(t[3*n+i]+t[3*i+n])*r}return e}function j(e,t,i,r){const a=.5*Math.PI/180;t*=a,i*=a,r*=a;const n=Math.sin(t),s=Math.cos(t),o=Math.sin(i),c=Math.cos(i),l=Math.sin(r),d=Math.cos(r);return e[0]=n*c*d-s*o*l,e[1]=s*o*d+n*c*l,e[2]=s*c*l-n*o*d,e[3]=s*c*d+n*o*l,e}function x(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const S=c["c"],T=c["l"],w=c["a"],C=u,A=c["b"],P=c["d"],R=c["j"],E=c["e"],I=E,M=c["f"],D=M,L=c["k"],N=c["g"],F=c["h"];function z(e,t,i){const r=Object(o["i"])(t,i);return r<-.999999?(Object(o["j"])(G,V,t),Object(o["y"])(G)<1e-6&&Object(o["j"])(G,U,t),Object(o["r"])(G,G),d(e,G,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Object(o["j"])(G,t,i),e[0]=G[0],e[1]=G[1],e[2]=G[2],e[3]=1+r,L(e,e))}const G=Object(n["f"])(),V=Object(n["h"])(1,0,0),U=Object(n["h"])(0,1,0);function B(e,t,i,r,a,n){return g(k,t,a,n),g(H,i,r,n),g(e,k,H,2*n*(1-n)),e}const k=Object(a["b"])(),H=Object(a["b"])();function W(e,t,i,r){const a=q;return a[0]=i[0],a[3]=i[1],a[6]=i[2],a[1]=r[0],a[4]=r[1],a[7]=r[2],a[2]=-t[0],a[5]=-t[1],a[8]=-t[2],L(e,_(e,a))}const q=Object(r["b"])();Object.freeze(Object.defineProperty({__proto__:null,identity:l,setAxisAngle:d,getAxisAngle:h,multiply:u,rotateX:p,rotateY:b,rotateZ:f,calculateW:m,slerp:g,random:O,invert:v,conjugate:y,fromMat3:_,fromEuler:j,str:x,copy:S,set:T,add:w,mul:C,scale:A,dot:P,lerp:R,length:E,len:I,squaredLength:M,sqrLen:D,normalize:L,exactEquals:N,equals:F,rotationTo:z,sqlerp:B,setAxes:W},Symbol.toStringTag,{value:"Module"}))},"0a9e":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return c}));var r=i("b2b2"),a=i("a6c9");const n=64,s=n/2,o=s/5;function c(e,t){return Object(r["k"])(t)?l(e,d(t.style)):null}function l(e,t){return e.fromData(t,()=>Object(a["c"])(t,n,s,o))}function d(e){return"diamond"===e?"kite":e}},"0bde":function(e,t,i){"use strict";i.d(t,"a",(function(){return G}));var r=i("b2b2"),a=i("ecd7"),n=i("8a44"),s=i("e431"),o=i("0b2d"),c=i("d359"),l=i("d18f"),d=i("f895"),h=i("1153");class u{constructor(e,t){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new p,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),p.clearPool(),T[0]=null,E.prune(),F.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const i=p.acquire();for(let r=0;r<t;r++){const t=e[r];this._isDegenerate(t)?this._degenerateObjects.add(t):(i.init(this._root),this._add(t,i))}p.release(i)}remove(e,t=null){this._objectCount-=e.length;const i=p.acquire();for(const a of e){const e=Object(r["k"])(t)?t:Object(d["b"])(this._objectToBoundingSphere(a),I);_(e[3])?(i.init(this._root),this._remove(a,e,i)):this._degenerateObjects.delete(a)}p.release(i),this._shrink()}update(e,t){if(!_(t[3])&&this._isDegenerate(e))return;const i=w(e);this.remove(i,t),this.add(i)}forEachAlongRay(e,t,i){const r=Object(l["g"])(e,t);this._forEachNode(this._root,e=>{if(!this._intersectsNode(r,e))return!1;const t=e.node;return t.terminals.forAll(e=>{this._intersectsObject(r,e)&&i(e)}),null!==t.residents&&t.residents.forAll(e=>{this._intersectsObject(r,e)&&i(e)}),!0})}forEachAlongRayWithVerticalOffset(e,t,i,r){const a=Object(l["g"])(e,t);this._forEachNode(this._root,e=>{if(!this._intersectsNodeWithOffset(a,e,r))return!1;const t=e.node;return t.terminals.forAll(e=>{this._intersectsObjectWithOffset(a,e,r)&&i(e)}),null!==t.residents&&t.residents.forAll(e=>{this._intersectsObjectWithOffset(a,e,r)&&i(e)}),!0})}forEach(e){this._forEachNode(this._root,t=>{const i=t.node;return i.terminals.forAll(e),null!==i.residents&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,i,r=(()=>!0),a=1/0){let n=1/0,o=1/0,l=null;const h=v(e,t),u=s=>{if(--a,!r(s))return;const h=this._objectToBoundingSphere(s);if(!Object(c["f"])(i,h))return;const u=y(e,t,Object(d["f"])(h)),p=u-h[3],b=u+h[3];p<n&&(n=p,o=b,l=s)};return this._forEachNodeDepthOrdered(this._root,r=>{if(a<=0||!Object(c["f"])(i,r.bounds))return!1;if(Object(s["k"])(A,h,r.halfSize),Object(s["e"])(A,A,r.bounds),y(e,t,A)>o)return!1;const n=r.node;return n.terminals.forAll(e=>u(e)),null!==n.residents&&n.residents.forAll(e=>u(e)),!0},e,t),l}forEachInDepthRange(e,t,i,r,a,n,o){let l=-1/0,h=1/0;const p={setRange:e=>{i===u.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,e.near),h=Math.min(h,e.far)):(l=Math.max(l,-e.far),h=Math.min(h,-e.near))}};p.setRange(r);const b=y(t,i,e),f=v(t,i),m=v(t,-i),g=e=>{if(!o(e))return;const r=this._objectToBoundingSphere(e),s=Object(d["f"])(r),u=y(t,i,s)-b,f=u-r[3],m=u+r[3];f>h||m<l||!Object(c["f"])(n,r)||a(e,p)};this._forEachNodeDepthOrdered(this._root,e=>{if(!Object(c["f"])(n,e.bounds))return!1;if(Object(s["k"])(A,f,e.halfSize),Object(s["e"])(A,A,e.bounds),y(t,i,A)-b>h)return!1;if(Object(s["k"])(A,m,e.halfSize),Object(s["e"])(A,A,e.bounds),y(t,i,A)-b<l)return!1;const r=e.node;return r.terminals.forAll(e=>g(e)),null!==r.residents&&r.residents.forAll(e=>g(e)),!0},t,i)}forEachNode(e){this._forEachNode(this._root,t=>e(t.node,t.bounds,t.halfSize))}forEachNeighbor(e,t){const i=Object(d["d"])(t),r=Object(d["f"])(t),a=t=>{const a=this._objectToBoundingSphere(t),n=Object(d["d"])(a),o=i+n;Object(s["h"])(Object(d["f"])(a),r)-o*o<=0&&e(t)};this._forEachNode(this._root,e=>{const t=Object(d["d"])(e.bounds),n=i+t;if(Object(s["h"])(Object(d["f"])(e.bounds),r)-n*n>0)return!1;const o=e.node;return o.terminals.forAll(e=>a(e)),null!==o.residents&&o.residents.forAll(e=>a(e)),!0}),this.forEachDegenerateObject(a)}_intersectsNode(e,t){return m(t.bounds,2*-t.halfSize,P),m(t.bounds,2*t.halfSize,R),Object(h["h"])(e.origin,e.direction,P,R)}_intersectsNodeWithOffset(e,t,i){return m(t.bounds,2*-t.halfSize,P),m(t.bounds,2*t.halfSize,R),i.applyToMinMax(P,R),Object(h["h"])(e.origin,e.direction,P,R)}_intersectsObject(e,t){const i=this._objectToBoundingSphere(t);return!(i[3]>0)||Object(d["g"])(i,e)}_intersectsObjectWithOffset(e,t,i){const r=this._objectToBoundingSphere(t);return!(r[3]>0)||Object(d["g"])(i.applyToBoundingSphere(r),e)}_forEachNode(e,t){let i=p.acquire().init(e);const r=[i];for(;0!==r.length;){if(i=r.pop(),t(i)&&!i.isLeaf())for(let e=0;e<i.node.children.length;e++)i.node.children[e]&&r.push(p.acquire().init(i).advance(e));p.release(i)}}_forEachNodeDepthOrdered(e,t,i,r=u.DepthOrder.FRONT_TO_BACK){let a=p.acquire().init(e);const n=[a];for(O(i,r,z);0!==n.length;){if(a=n.pop(),t(a)&&!a.isLeaf())for(let e=7;e>=0;--e){const t=z[e];a.node.children[t]&&n.push(p.acquire().init(a).advance(t))}p.release(a)}}_remove(e,t,i){E.clear();const r=i.advanceTo(t,(e,t)=>{E.push(e.node),E.push(t)})?i.node.terminals:i.node.residents;if(r.removeUnordered(e),0===r.length)for(let a=E.length-2;a>=0;a-=2){const e=E.data[a],t=E.data[a+1];if(!this._purge(e,t))break}}_nodeIsEmpty(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}_purge(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new n["a"]({shrink:!0})),!0)}_add(e,t){t.advanceTo(this._objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let i=0;i<t.length;i++){const r=p.acquire().init(e);this._add(t.getItemAt(i),r),p.release(r)}}_grow(e,t){if(0!==t&&(g(e,t,e=>this._objectToBoundingSphere(e),M),_(M[3])&&!this._fitsInsideTree(M)))if(this._nodeIsEmpty(this._root.node))Object(d["b"])(M,this._root.bounds),this._root.halfSize=1.25*M[3];else{const e=this._rootBoundsForRootAsSubNode(M);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(M,e):this._growRootAsSubNode(e),p.release(e)}}_rebuildTree(e,t){Object(s["g"])(D,t.bounds),D[3]=t.halfSize,g([e,D],2,e=>e,L);const i=p.acquire().init(this._root);this._root.initFrom(null,L,1.25*L[3]),this._forEachNode(i,e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0)),p.release(i)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,e=>(i=Math.max(i,e.depth),i+t<=this._maximumDepth)),i+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],i=e;let r=-1/0;const a=this._root.bounds,n=this._root.halfSize;for(let s=0;s<3;s++){const e=a[s]-n-(i[s]-t),o=i[s]+t-(a[s]+n),c=Math.max(0,Math.ceil(e/(2*n))),l=Math.max(0,Math.ceil(o/(2*n)))+1,d=2**Math.ceil(Math.log(c+l)*Math.LOG2E);r=Math.max(r,d),N[s].min=c,N[s].max=l}for(let s=0;s<3;s++){let e=N[s].min,t=N[s].max;const i=(r-(e+t))/2;e+=Math.ceil(i),t+=Math.floor(i);const o=a[s]-n-e*n*2;C[s]=o+(t+e)*n}return C[3]=r*n*S,p.acquire().initFrom(null,C,r*n,0)}_growRootAsSubNode(e){const t=this._root.node;Object(s["g"])(M,this._root.bounds),M[3]=this._root.halfSize,this._root.init(e),e.advanceTo(M,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let i=0,r=0;for(;r<t.length&&null==e;)i=r++,e=t[i];for(;r<t.length;)if(t[r++])return-1;return i}_isDegenerate(e){return!_(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=t[0]-i&&e[0]<=t[0]+i&&e[1]>=t[1]-i&&e[1]<=t[1]+i&&e[2]>=t[2]-i&&e[2]<=t[2]+i}}class p{constructor(){this.bounds=Object(d["c"])(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,i,a=this.depth){return this.node=Object(r["k"])(e)?e:p.createEmptyNode(),Object(r["k"])(t)&&Object(d["b"])(t,this.bounds),this.halfSize=i,this.depth=a,this}advance(e){let t=this.node.children[e];t||(t=p.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const i=j[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.bounds[3]=this.halfSize*S,this}advanceTo(e,t,i=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!i)return t&&t(this,-1),!1;this.node.residents=null}const r=this._childIndex(e);t&&t(this,r),this.advance(r)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new n["a"]({shrink:!0}),residents:new n["a"]({shrink:!0})}}static acquire(){return p._pool.acquire()}static release(e){p._pool.release(e)}static clearPool(){p._pool.prune()}}function b(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function f(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function m(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function g(e,t,i,r){if(1===t){const t=i(e[0]);Object(d["b"])(t,r)}else{P[0]=1/0,P[1]=1/0,P[2]=1/0,R[0]=-1/0,R[1]=-1/0,R[2]=-1/0;for(let r=0;r<t;r++){const t=i(e[r]);_(t[3])&&(b(P,t),f(R,t))}Object(s["l"])(r,P,R,.5),r[3]=Math.max(R[0]-P[0],R[1]-P[1],R[2]-P[2])/2}}function O(e,t,i){if(!F.length)for(let r=0;r<8;++r)F.push({index:0,distance:0});for(let r=0;r<8;++r){const i=j[r];F.data[r].index=r,F.data[r].distance=y(e,t,i)}F.sort((e,t)=>e.distance-t.distance);for(let r=0;r<8;++r)i[r]=F.data[r].index}function v(e,t){let i=1/0,r=null;for(let a=0;a<8;++a){const n=y(e,t,x[a]);n<i&&(i=n,r=x[a])}return r}function y(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function _(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}p._pool=new a["a"](p),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(u||(u={}));const j=[Object(o["h"])(-1,-1,-1),Object(o["h"])(1,-1,-1),Object(o["h"])(-1,1,-1),Object(o["h"])(1,1,-1),Object(o["h"])(-1,-1,1),Object(o["h"])(1,-1,1),Object(o["h"])(-1,1,1),Object(o["h"])(1,1,1)],x=[Object(o["h"])(-1,-1,-1),Object(o["h"])(-1,-1,1),Object(o["h"])(-1,1,-1),Object(o["h"])(-1,1,1),Object(o["h"])(1,-1,-1),Object(o["h"])(1,-1,1),Object(o["h"])(1,1,-1),Object(o["h"])(1,1,1)],S=Math.sqrt(3),T=[null];function w(e){return T[0]=e,T}const C=Object(d["c"])(),A=Object(o["f"])(),P=Object(o["f"])(),R=Object(o["f"])(),E=new n["a"],I=Object(d["c"])(),M=Object(d["c"])(),D=Object(d["c"])(),L=Object(d["c"])(),N=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],F=new n["a"],z=[0,0,0,0,0,0,0,0],G=u},"0cb9":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s}));var r=i("b2b2"),a=i("84f4");class n{constructor(e,t=null,i=0){this.array=e,this.spatialReference=t,this.offset=i}}function s(e){return"array"in e}function o(e,t,i="ground"){if(Object(a["a"])(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(s(t)){let a=t.offset;return e.getElevation(t.array[a++],t.array[a++],t.array[a]||0,Object(r["s"])(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}},"0d7a":function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var r=i("dfaf"),a=i("7cb4"),n=i("aab5"),s=i("3886"),o=i("a222"),c=i("6a3c"),l=i("52b2"),d=i("b7bd");function h(e,t){const i=e.fragment;if(t.hasVertexTangents?(e.attributes.add(d["a"].TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===n["b"].WindingOrder?i.code.add(s["b"]`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(s["b"]`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),i.code.add(s["b"]`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),t.textureCoordinateType!==r["b"].None){e.include(a["a"],t);const r=t.supportsTextureAtlas;i.uniforms.add(t.pbrTextureBindType===l["a"].Pass?Object(c["b"])("normalTexture",e=>e.textureNormal,r):Object(o["a"])("normalTexture",e=>e.textureNormal,r)),i.code.add(s["b"]`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?"vtc.size = normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}},"0d96":function(e,t,i){"use strict";i.d(t,"a",(function(){return L})),i.d(t,"b",(function(){return R})),i.d(t,"c",(function(){return I}));var r=i("b2b2"),a=i("3349"),n=i("02f1"),s=i("0fc4"),o=i("a6c9"),c=i("a05b"),l=i("d272"),d=i("7c1d"),h=i("d0cb"),u=i("7079"),p=i("6a07"),b=i("be24"),f=i("3976"),m=i("4377"),g=i("501b"),O=i("2f98"),v=i("d8a4"),y=i("fd48"),_=i("76a8"),j=i("1fe9"),x=i("955a"),S=i("3886"),T=i("690a"),w=i("6a3c"),C=i("b7c2"),A=i("b7bd"),P=i("02a0");function R(e){const t=new T["a"],i=e.signedDistanceFieldEnabled;if(t.include(d["a"]),t.include(h["a"],e),t.include(l["a"],e),e.output===c["a"].Occlusion)return t.include(u["a"],e),t;const{vertex:R,fragment:M}=t;t.include(O["a"]),M.include(g["a"]),M.include(m["a"]),t.include(b["a"],e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),R.uniforms.add([new y["a"]("viewport",(e,t)=>t.camera.fullViewport),new v["a"]("screenOffset",(e,t)=>Object(a["a"])(D,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio)),new v["a"]("anchorPosition",e=>I(e)),new y["a"]("materialColor",e=>e.color),new j["a"]("pixelRatio",(e,t)=>t.camera.pixelRatio)]),i&&(R.uniforms.add(new y["a"]("outlineColor",e=>e.outlineColor)),M.uniforms.add([new y["a"]("outlineColor",e=>E(e)?e.outlineColor:s["b"]),new j["a"]("outlineSize",e=>E(e)?e.outlineSize:0)])),e.hasScreenSizePerspective&&(Object(O["b"])(R),Object(O["c"])(R)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(A["a"].UV0,"vec2"),t.attributes.add(A["a"].COLOR,"vec4"),t.attributes.add(A["a"].SIZE,"vec2"),t.attributes.add(A["a"].AUXPOS2,"vec4"),R.code.add(S["b"]`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?S["b"]`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:S["b"]`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const L=S["b"]`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,N=e.pixelSnappingEnabled?i?S["b"]`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:S["b"]`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:S["b"]`posProj += quadOffset;`;e.vvColor&&R.uniforms.add([new _["a"]("vvColorColors",e=>e.vvColorColors,P["b"]),new x["a"]("vvColorValues",e=>e.vvColorValues,P["b"])]),R.uniforms.add(new v["a"]("textureCoordinateScaleFactor",e=>Object(r["k"])(e.texture)&&Object(r["k"])(e.texture.descriptor.textureCoordinateScaleFactor)?e.texture.descriptor.textureCoordinateScaleFactor:n["a"])),R.code.add(S["b"]`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${L}
    ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${S["b"].float(f["b"])};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${S["b"].float(f["b"])};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${N}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?S["b"]`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),M.uniforms.add(new w["a"]("tex",e=>e.texture));const F=e.debugDrawLabelBorder?S["b"]`(isBorder > 0.0 ? 0.0 : ${S["b"].float(f["a"])})`:S["b"].float(f["a"]),z=S["b"]`
    ${e.debugDrawLabelBorder?S["b"]`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?S["b"]`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${S["b"].float(o["b"])};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${F} ||
          fillPixelColor.a + outlinePixelColor.a < ${S["b"].float(f["b"])}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${F}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:S["b"]`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${F}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?S["b"]`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===c["a"].Alpha&&M.code.add(S["b"]`
      void main() {
        ${z}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===c["a"].Color&&M.code.add(S["b"]`
    void main() {
      ${z}
      ${e.transparencyPassType===C["i"].FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===c["a"].Highlight&&(t.include(p["a"]),M.code.add(S["b"]`
    void main() {
      ${z}
      ${e.binaryHighlightOcclusionEnabled?S["b"]`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function E(e){return e.outlineColor[3]>0&&e.outlineSize>0}function I(e,t=D){return e.textureIsSignedDistanceField?M(e.anchorPosition,e.distanceFieldBoundingBox,t):Object(a["c"])(t,e.anchorPosition),t}function M(e,t,i){Object(r["k"])(t)?Object(a["a"])(i,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):Object(a["a"])(i,0,0)}const D=Object(n["c"])(),L=Object.freeze(Object.defineProperty({__proto__:null,build:R,calculateAnchorPosForRendering:I},Symbol.toStringTag,{value:"Module"}))},"0d9f":function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return ae})),i.d(t,"c",(function(){return O})),i.d(t,"d",(function(){return N})),i.d(t,"e",(function(){return j})),i.d(t,"f",(function(){return w})),i.d(t,"g",(function(){return D})),i.d(t,"h",(function(){return C})),i.d(t,"i",(function(){return k})),i.d(t,"j",(function(){return B})),i.d(t,"k",(function(){return x}));i("c120");var r=i("e92d"),a=i("38a4"),n=i("2119"),s=i("d791"),o=i("afe1"),c=i("e431"),l=i("0b2d"),d=i("3a35"),h=i("bd7e"),u=i("7289"),p=i("d18f"),b=i("a1b1"),f=i("7361");const m=r["a"].getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class g{constructor(){this.plane=Object(u["d"])(),this.origin=Object(l["f"])(),this.basis1=Object(l["f"])(),this.basis2=Object(l["f"])()}}function O(e=Z){return{plane:Object(u["d"])(e.plane),origin:Object(l["d"])(e.origin),basis1:Object(l["d"])(e.basis1),basis2:Object(l["d"])(e.basis2)}}function v(e,t,i){const r=ee.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=Object(u["v"])(0,0,0,0),x(r),r}function y(e,t=O()){return j(e.origin,e.basis1,e.basis2,t)}function _(e,t){Object(c["g"])(t.origin,e.origin),Object(c["g"])(t.basis1,e.basis1),Object(c["g"])(t.basis2,e.basis2),Object(u["c"])(t.plane,e.plane)}function j(e,t,i,r=O()){return Object(c["g"])(r.origin,e),Object(c["g"])(r.basis1,t),Object(c["g"])(r.basis2,i),x(r),X(r,"fromValues()"),r}function x(e){Object(u["i"])(e.basis2,e.basis1,e.origin,e.plane)}function S(e,t,i){e!==i&&y(e,i);const r=Object(c["k"])(f["d"].get(),k(e),t);return Object(c["e"])(i.origin,i.origin,r),i.plane[3]-=t,i}function T(e,t,i){return w(t,i),S(i,z(e,e.origin),i),i}function w(e,t=O()){const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return Object(c["w"])(t.origin,e[0]+i,e[1]+r,0),Object(c["w"])(t.basis1,i,0,0),Object(c["w"])(t.basis2,0,r,0),Object(u["h"])(0,0,1,0,t.plane),t}function C(e,t,i){return!!Object(u["m"])(e.plane,t,i)&&W(e,i)}function A(e,t,i){if(C(e,t,i))return i;const r=P(e,t,f["d"].get());return Object(c["e"])(i,t.origin,Object(c["k"])(f["d"].get(),t.direction,Object(c["m"])(t.origin,r)/Object(c["p"])(t.direction))),i}function P(e,t,i){const r=J.get();Y(e,t,r,J.get());let n=Number.POSITIVE_INFINITY;for(const s of te){const o=$(e,s,Q.get()),l=f["d"].get();if(Object(u["k"])(r,o,l)){const e=Object(c["v"])(f["d"].get(),t.origin,l),r=Math.abs(Object(a["b"])(Object(c["i"])(t.direction,e)));r<n&&(n=r,Object(c["g"])(i,l))}}return n===Number.POSITIVE_INFINITY?R(e,t,i):i}function R(e,t,i){if(C(e,t,i))return i;const r=J.get(),a=J.get();Y(e,t,r,a);let n=Number.POSITIVE_INFINITY;for(const s of te){const o=$(e,s,Q.get()),l=f["d"].get();if(Object(u["l"])(r,o,l)){const e=Object(p["d"])(t,l);if(!Object(u["o"])(a,l))continue;e<n&&(n=e,Object(c["g"])(i,l))}}return M(e,t.origin)<n&&E(e,t.origin,i),i}function E(e,t,i){const r=Object(u["r"])(e.plane,t,f["d"].get()),a=Object(h["j"])(q(e,e.basis1),r,-1,1,f["d"].get()),n=Object(h["j"])(q(e,e.basis2),r,-1,1,f["d"].get());return Object(c["f"])(i,Object(c["e"])(f["d"].get(),a,n),e.origin),i}function I(e,t,i){const{origin:r,basis1:a,basis2:n}=e,s=Object(c["f"])(f["d"].get(),t,r),o=Object(b["d"])(a,s),l=Object(b["d"])(n,s),d=Object(b["d"])(k(e),s);return Object(c["w"])(i,o,l,d)}function M(e,t){const i=I(e,t,f["d"].get()),{basis1:r,basis2:a}=e,n=Object(c["p"])(r),s=Object(c["p"])(a),o=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-s,0),d=i[2];return o*o+l*l+d*d}function D(e,t){return Math.sqrt(M(e,t))}function L(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of te){const a=$(e,r,Q.get()),n=Object(h["e"])(a,t);n>i&&(i=n)}return Math.sqrt(i)}function N(e,t){return Object(u["o"])(e.plane,t)&&W(e,t)}function F(e,t,i,r){return H(e,i,r)}function z(e,t){const i=-e.plane[3];return Object(b["d"])(k(e),t)-i}function G(e,t,i,r){const a=z(e,t),n=Object(c["k"])(K,k(e),i-a);return Object(c["e"])(r,t,n),r}function V(e,t){return Object(c["o"])(e.basis1,t.basis1)&&Object(c["o"])(e.basis2,t.basis2)&&Object(c["o"])(e.origin,t.origin)}function U(e,t,i){return e!==i&&y(e,i),Object(s["a"])(ie,t),Object(s["t"])(ie,ie),Object(c["q"])(i.basis1,e.basis1,ie),Object(c["q"])(i.basis2,e.basis2,ie),Object(c["q"])(Object(u["q"])(i.plane),Object(u["q"])(e.plane),ie),Object(c["q"])(i.origin,e.origin,t),Object(u["t"])(i.plane,i.plane,i.origin),i}function B(e,t,i,r){return e!==r&&y(e,r),Object(s["d"])(re,t,i),Object(c["q"])(r.basis1,e.basis1,re),Object(c["q"])(r.basis2,e.basis2,re),x(r),r}function k(e){return Object(u["q"])(e.plane)}function H(e,t,i){switch(t){case d["a"].X:Object(c["g"])(i,e.basis1),Object(c["r"])(i,i);break;case d["a"].Y:Object(c["g"])(i,e.basis2),Object(c["r"])(i,i);break;case d["a"].Z:Object(c["g"])(i,k(e))}return i}function W(e,t){const i=Object(c["f"])(f["d"].get(),t,e.origin),r=Object(c["t"])(e.basis1),a=Object(c["t"])(e.basis2),n=Object(c["i"])(e.basis1,i),s=Object(c["i"])(e.basis2,i);return-n-r<0&&n-r<0&&-s-a<0&&s-a<0}function q(e,t){const i=Q.get();return Object(c["g"])(i.origin,e.origin),Object(c["g"])(i.vector,t),i}function $(e,t,i){const{basis1:r,basis2:a,origin:n}=e,s=Object(c["k"])(f["d"].get(),r,t.origin[0]),o=Object(c["k"])(f["d"].get(),a,t.origin[1]);Object(c["e"])(i.origin,s,o),Object(c["e"])(i.origin,i.origin,n);const l=Object(c["k"])(f["d"].get(),r,t.direction[0]),d=Object(c["k"])(f["d"].get(),a,t.direction[1]);return Object(c["k"])(i.vector,Object(c["e"])(l,l,d),2),i}function X(e,t){Math.abs(Object(c["i"])(e.basis1,e.basis2)/(Object(c["p"])(e.basis1)*Object(c["p"])(e.basis2)))>1e-6&&m.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Object(c["i"])(e.basis1,k(e)))>1e-6&&m.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Object(c["i"])(k(e),e.origin)-e.plane[3])>1e-6&&m.warn(t,"Plane offset is not consistent with plane origin")}function Y(e,t,i,r){const a=k(e);Object(u["i"])(a,t.direction,t.origin,i),Object(u["i"])(Object(u["q"])(i),a,t.origin,r)}const Z={plane:Object(u["d"])(),origin:Object(l["h"])(0,0,0),basis1:Object(l["h"])(1,0,0),basis2:Object(l["h"])(0,1,0)},J=new n["a"](u["d"]),Q=new n["a"](h["d"]),K=Object(l["f"])(),ee=new n["a"](()=>({origin:null,basis1:null,basis2:null,plane:null})),te=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],ie=Object(o["d"])(),re=Object(o["d"])(),ae=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:g,create:O,wrap:v,copy:y,copyWithoutVerify:_,fromValues:j,updateUnboundedPlane:x,elevate:S,setExtent:T,fromAABoundingRect:w,intersectRay:C,intersectRayClosestSilhouette:A,closestPointOnSilhouette:P,closestPoint:R,projectPoint:E,projectPointLocal:I,distance2:M,distance:D,distanceToSilhouette:L,extrusionContainsPoint:N,axisAt:F,altitudeAt:z,setAltitudeAt:G,equals:V,transform:U,rotate:B,normal:k,UP:Z},Symbol.toStringTag,{value:"Module"}))},"0eb9":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("b2b2"),a=i("8076"),n=i("e9d6");class s{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=Object(a["a"])(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const i=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?i:e+i}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return null!=i&&(t+=Object(n["d"])(i)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=Object(a["c"])(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=Object(r["s"])(e.offset,0)}updateFeatureExpressionInfoContext(e,t,i){if(Object(r["j"])(e))return void(this._featureExpressionInfoContext=null);const a=e&&e.arcade;a&&Object(r["k"])(t)&&Object(r["k"])(i)?(this._featureExpressionInfoContext=Object(n["a"])(e),Object(n["f"])(this._featureExpressionInfoContext,Object(n["c"])(a.modules,t,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new s;return Object(r["k"])(e)&&t.setFromElevationInfo(e),t}}},1666:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return o}));var r,a=i("9812"),n=i("32ed"),s=i("8c4b");function o(e){const t=l(e.rings,e.hasZ,r.CCW_IS_HOLE),i=[];let n=0,o=0;for(const r of t.polygons){const e=r.count,s=r.index,c=new Float64Array(t.position.buffer,3*s*t.position.BYTES_PER_ELEMENT,3*e),l=r.holeIndices.map(e=>e-s),d=new Uint32Array(Object(a["a"])(c,l,3));i.push({position:c,faces:d}),n+=c.length,o+=d.length}const d=c(i,n,o),h=Object(s["a"])(d.position.buffer,6,{originalIndices:d.faces});return d.position=new Float64Array(h.buffer),d.faces=h.indices,d}function c(e,t,i){if(1===e.length)return e[0];const r=new Float64Array(t),a=new Uint32Array(i);let n=0,s=0,o=0;for(const c of e){for(let e=0;e<c.position.length;e++)r[n++]=c.position[e];for(let e=0;e<c.faces.length;e++)a[s++]=c.faces[e]+o;o=n/3}return{position:r,faces:a}}function l(e,t,i){const a=e.length,n=new Array(a),s=new Array(a),o=new Array(a);let c=0,l=0,u=0,p=0;for(let r=0;r<a;++r)p+=e[r].length;const b=new Float64Array(3*p);let f=0;for(let m=a-1;m>=0;m--){const p=e[m],g=i===r.CCW_IS_HOLE&&h(p);if(g&&1!==a)n[c++]=p;else{let e=p.length;for(let t=0;t<c;++t)e+=n[t].length;const i={index:f,pathLengths:new Array(c+1),count:e,holeIndices:new Array(c)};i.pathLengths[0]=p.length,p.length>0&&(o[u++]={index:f,count:p.length}),f=g?d(p,p.length-1,-1,b,f,p.length,t):d(p,0,1,b,f,p.length,t);for(let r=0;r<c;++r){const e=n[r];i.holeIndices[r]=f,i.pathLengths[r+1]=e.length,e.length>0&&(o[u++]={index:f,count:e.length}),f=d(e,0,1,b,f,e.length,t)}c=0,i.count>0&&(s[l++]=i)}}for(let r=0;r<c;++r){const e=n[r];e.length>0&&(o[u++]={index:f,count:e.length}),f=d(e,0,1,b,f,e.length,t)}return l<a&&(s.length=l),u<a&&(o.length=u),{position:b,polygons:s,outlines:o}}function d(e,t,i,r,a,n,s){a*=3;for(let o=0;o<n;++o){const n=e[t];r[a++]=n[0],r[a++]=n[1],r[a++]=s?n[2]:0,t+=i}return a/3}function h(e){return!Object(n["h"])(e,!1,!1)}!function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"}(r||(r={}))},"171c":function(e,t,i){"use strict";i.d(t,"a",(function(){return _}));var r=i("e92d"),a=i("38a4"),n=i("b2b2"),s=i("a915"),o=i("d791"),c=i("afe1"),l=i("3349"),d=i("02f1"),h=i("e431"),u=i("0b2d"),p=i("7577"),b=i("0fc4"),f=i("d359"),m=i("d18f"),g=i("a1b1"),O=i("3c9c"),v=i("1153");const y=r["a"].getLogger("esri.views.3d.webgl-engine.lib.Camera");class _{constructor(e=null,t=null,i=null){this._viewUp=Object(u["f"])(),this._viewForward=Object(u["f"])(),this._viewRight=Object(u["f"])(),this._ray=Object(m["c"])(),this._viewport=Object(b["g"])(0,0,1,1),this._padding=Object(b["g"])(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Object(d["g"])(1,1e3),this._viewDirty=!0,this._viewMatrix=Object(c["d"])(),this._projectionDirty=!0,this._projectionMatrix=Object(c["d"])(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Object(c["d"])(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Object(c["d"])(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=Object(f["c"])(),this._fullViewport=Object(b["e"])(),this._pixelRatio=1,this.relativeElevation=0,Object(n["k"])(e)&&Object(h["g"])(this._ray.origin,e),this._center=Object(n["k"])(t)?Object(u["d"])(t):Object(u["f"])(),this._up=Object(n["k"])(i)?Object(u["d"])(i):Object(u["h"])(0,0,1)}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center)}get ray(){return Object(h["f"])(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){Object(o["c"])(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get x(){return this._viewport[0]}set x(e){e+=this._padding[C.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(e){e+=this._padding[C.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[C.RIGHT]+this._padding[C.LEFT]}set fullWidth(e){this.width=e-(this._padding[C.RIGHT]+this._padding[C.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[C.TOP]+this._padding[C.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[C.TOP]+this._padding[C.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[C.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[C.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){this._padding[C.TOP]===e[C.TOP]&&this._padding[C.RIGHT]===e[C.RIGHT]&&this._padding[C.BOTTOM]===e[C.BOTTOM]&&this._padding[C.LEFT]===e[C.LEFT]||(this._viewport[0]+=e[C.LEFT]-this._padding[C.LEFT],this._viewport[1]+=e[C.BOTTOM]-this._padding[C.BOTTOM],this._viewport[2]-=e[C.RIGHT]+e[C.LEFT]-(this._padding[C.RIGHT]+this._padding[C.LEFT]),this._viewport[3]-=e[C.TOP]+e[C.BOTTOM]-(this._padding[C.TOP]+this._padding[C.BOTTOM]),Object(p["c"])(this._padding,e),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Object(o["m"])(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this.aspect;Object(o["l"])(this._projectionMatrix,-r*(1+2*this._padding[C.LEFT]/e),r*(1+2*this._padding[C.RIGHT]/e),-i*(1+2*this._padding[C.BOTTOM]/t),i*(1+2*this._padding[C.TOP]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}get inverseProjectionMatrix(){return Object(n["j"])(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=Object(c["d"])()),this._inverseProjectionDirty&&Object(o["a"])(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(e){Object(o["c"])(this._projectionMatrix,e),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(e){this._fov=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Object(v["b"])(this._fov,this.width,this.height)}set fovX(e){this._fov=Object(v["d"])(e,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Object(v["c"])(this._fov,this.width,this.height)}set fovY(e){this._fov=Object(v["e"])(e,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Object(h["m"])(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Object(o["a"])(this._viewInverseTransposeMatrix,this.viewMatrix),Object(o["t"])(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this._pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(e){Object(h["g"])(this._ray.origin,e.eye),Object(h["g"])(this._center,e.center),Object(h["g"])(this._up,e.up),Object(p["c"])(this._viewport,e.viewport),Object(p["c"])(this._padding,e.padding),Object(l["c"])(this._nearFar,e.nearFar),this._fov=e.fov,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||(Object(o["c"])(this._viewMatrix,e.viewMatrix),Object(h["g"])(this._viewRight,e.viewRight),Object(h["g"])(this._viewUp,e.viewUp),Object(h["g"])(this._viewForward,e.viewForward)),t._projectionDirty?this._projectionDirty=!0:(Object(o["c"])(this._projectionMatrix,e.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(Object(f["b"])(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Object(o["c"])(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Object(p["c"])(this._fullViewport,e.fullViewport),this._pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new _).copyFrom(this)}equals(e){return Object(h["o"])(this.eye,e.eye)&&Object(h["o"])(this._center,e.center)&&Object(h["o"])(this._up,e.up)&&Object(p["g"])(this._viewport,e.viewport)&&Object(p["g"])(this._padding,e.padding)&&Object(l["e"])(this._nearFar,e.nearFar)&&this._fov===e.fov&&this._pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){if(this._pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;const t=5e-4,i=1-1e-10;Object(h["z"])(S,e.eye,e.center),Object(h["z"])(T,this.eye,this._center);const r=Object(h["i"])(S,T),a=Object(h["A"])(S),n=Object(h["A"])(T);return r*r>=i*a*n&&Object(h["B"])(e.eye,this.eye)<Math.max(a,n)*t*t&&Object(p["i"])(e.padding,this._padding)<.5&&Object(p["i"])(e.viewport,this._viewport)<.5}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs(Object(g["d"])(this.viewForward,Object(h["f"])(S,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=Object(s["f"])()){return e[0]=(this.padding[C.LEFT]+this.width/2)/this._pixelRatio,e[1]=(this.padding[C.TOP]+this.height/2)/this._pixelRatio,e}getRenderCenter(e,t=.5,i=.5){return e[0]=this.padding[C.LEFT]+this.width*t,e[1]=this.padding[C.BOTTOM]+this.height*i,e[2]=.5,e}setGLViewport(e){const t=this.viewport,i=this.padding;e.setViewport(t[0]-i[3],t[1]-i[2],t[2]+i[1]+i[3],t[3]+i[0]+i[2])}applyProjection(e,t){e!==j&&Object(h["g"])(j,e),j[3]=1,Object(p["m"])(j,j,this.projectionMatrix);const i=Math.abs(j[3]);Object(h["k"])(j,j,1/i);const r=this.fullViewport;t[0]=Object(a["l"])(0,r[0]+r[2],.5+.5*j[0]),t[1]=Object(a["l"])(0,r[1]+r[3],.5+.5*j[1]),t[2]=.5*(j[2]+1),t[3]=i}unapplyProjection(e,t){const i=this.fullViewport;j[0]=(e[0]/(i[0]+i[2])*2-1)*e[3],j[1]=(e[1]/(i[1]+i[3])*2-1)*e[3],j[2]=(2*e[2]-1)*e[3],j[3]=e[3],Object(p["m"])(j,j,this.inverseProjectionMatrix),t[0]=j[0],t[1]=j[1],t[2]=j[2]}projectToScreen(e,t){this.projectToRenderScreen(e,w),this.renderToScreen(w,t)}projectToRenderScreen(e,t){if(j[0]=e[0],j[1]=e[1],j[2]=e[2],j[3]=1,Object(p["m"])(j,j,this.viewProjectionMatrix),0===j[3])return null;Object(h["k"])(j,j,1/Math.abs(j[3]));const i=this.fullViewport;return"x"in t?(t.x=Object(a["l"])(0,i[0]+i[2],.5+.5*j[0]),t.y=Object(a["l"])(0,i[1]+i[3],.5+.5*j[1])):(t[0]=Object(a["l"])(0,i[0]+i[2],.5+.5*j[0]),t[1]=Object(a["l"])(0,i[1]+i[3],.5+.5*j[1]),t.length>2&&(t[2]=.5*(j[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,w),t)}unprojectFromRenderScreen(e,t){if(Object(o["m"])(x,this.projectionMatrix,this.viewMatrix),!Object(o["a"])(x,x))return null;const i=this.fullViewport;return j[0]=2*(e[0]-i[0])/i[2]-1,j[1]=2*(e[1]-i[1])/i[3]-1,j[2]=2*e[2]-1,j[3]=1,Object(p["m"])(j,j,x),0===j[3]?null:(t[0]=j[0]/j[3],t[1]=j[1]/j[3],t[2]=j[2]/j[3],t)}constrainWindowSize(e,t,i,r=i){const a=e*this._pixelRatio,n=t*this._pixelRatio,s=Math.max(a-i/2,0),o=Math.max(this.fullHeight-n-r/2,0),c=-Math.min(a-i/2,0),l=-Math.min(this.fullHeight-n-r/2,0);return[s,o,i-c- -Math.min(this.fullWidth-a-i/2,0),r-l- -Math.min(n-r/2,0)]}computeUp(e){e===O["a"].Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const i=e[0]*this._pixelRatio,r=this.fullHeight-e[1]*this._pixelRatio;return t[0]=i,t[1]=r,t}renderToScreen(e,t){const i=e[0]/this._pixelRatio,r=(this.fullHeight-e[1])/this._pixelRatio;t[0]=i,t[1]=r}_computeUpGlobal(){Object(h["f"])(S,this.center,this.eye);const e=Object(h["p"])(this.center);e<1?(Object(h["w"])(this._up,0,0,1),this._markViewDirty()):Math.abs(Object(h["i"])(S,this.center))>.9999*Object(h["p"])(S)*e||(Object(h["j"])(this._up,S,this.center),Object(h["j"])(this._up,this._up,S),Object(h["r"])(this._up,this._up),this._markViewDirty())}_computeUpLocal(){Object(h["v"])(S,this.eye,this.center),Math.abs(S[2])<=.9999&&(Object(h["k"])(S,S,S[2]),Object(h["w"])(this._up,-S[0],-S[1],1-S[2]),Object(h["r"])(this._up,this._up),this._markViewDirty())}_compareAndSetView(e,t){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?Object(h["o"])(e,t)||(Object(h["g"])(t,e),this._markViewDirty()):y.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Object(f["d"])(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(Object(o["n"])(this._viewMatrix,this.eye,this._center,this._up),Object(h["w"])(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),Object(h["w"])(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),Object(h["w"])(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const j=Object(b["e"])(),x=Object(c["d"])(),S=Object(u["f"])(),T=Object(u["f"])(),w=Object(s["d"])();var C;!function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(C||(C={}))},"17b0":function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return h}));var r=i("7577"),a=i("0fc4"),n=i("2f98"),s=i("8e97"),o=i("fd48"),c=i("3886");function l(e,t){const i=e.vertex;t.hasVerticalOffset?(h(i),t.hasScreenSizePerspective&&(e.include(n["a"]),Object(n["c"])(i),Object(s["a"])(e.vertex,t)),i.code.add(c["b"]`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?c["b"]`vec3 worldNormal = normalize(worldPos + localOrigin);`:c["b"]`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?c["b"]`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:c["b"]`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(c["b"]`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const d=Object(a["e"])();function h(e){e.uniforms.add(new o["a"]("verticalOffset",(e,t)=>{const{minWorldLength:i,maxWorldLength:a,screenLength:n}=e.verticalOffset,s=Math.tan(.5*t.camera.fovY)/(.5*t.camera.fullViewport[3]),o=t.camera.pixelRatio||1;return Object(r["l"])(d,n*o,s,i,a)}))}},"17ca":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("3886");function a(e){e.vertex.code.add(r["b"]`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}},"189c":function(e,t,i){"use strict";i.d(t,"a",(function(){return U})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return c})),i.d(t,"f",(function(){return y})),i.d(t,"g",(function(){return s})),i.d(t,"h",(function(){return n}));var r=i("b7c2"),a=i("d17d");function n(e,t,i=a["c"].ADD,r=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function s(e,t,i,r,n=a["c"].ADD,s=a["c"].ADD,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:r,opRgb:n,opAlpha:s,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const o={face:a["n"].BACK,mode:a["j"].CCW},c={face:a["n"].FRONT,mode:a["j"].CCW},l=e=>e===r["b"].Back?o:e===r["b"].Front?c:null,d={zNear:0,zFar:1},h={r:!0,g:!0,b:!0,a:!0};function u(e){return x.intern(e)}function p(e){return T.intern(e)}function b(e){return C.intern(e)}function f(e){return P.intern(e)}function m(e){return E.intern(e)}function g(e){return M.intern(e)}function O(e){return L.intern(e)}function v(e){return F.intern(e)}function y(e){return G.intern(e)}class _{constructor(e,t){this.makeKey=e,this.makeRef=t,this.interns=new Map}intern(e){if(!e)return null;const t=this.makeKey(e),i=this.interns;return i.has(t)||i.set(t,this.makeRef(e)),i.get(t)}}function j(e){return"["+e.join(",")+"]"}const x=new _(S,e=>({__tag:"Blending",...e}));function S(e){return e?j([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const T=new _(w,e=>({__tag:"Culling",...e}));function w(e){return e?j([e.face,e.mode]):null}const C=new _(A,e=>({__tag:"PolygonOffset",...e}));function A(e){return e?j([e.factor,e.units]):null}const P=new _(R,e=>({__tag:"DepthTest",...e}));function R(e){return e?j([e.func]):null}const E=new _(I,e=>({__tag:"StencilTest",...e}));function I(e){return e?j([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const M=new _(D,e=>({__tag:"DepthWrite",...e}));function D(e){return e?j([e.zNear,e.zFar]):null}const L=new _(N,e=>({__tag:"ColorWrite",...e}));function N(e){return e?j([e.r,e.g,e.b,e.a]):null}const F=new _(z,e=>({__tag:"StencilWrite",...e}));function z(e){return e?j([e.mask]):null}const G=new _(V,e=>({blending:u(e.blending),culling:p(e.culling),polygonOffset:b(e.polygonOffset),depthTest:f(e.depthTest),stencilTest:m(e.stencilTest),depthWrite:g(e.depthWrite),colorWrite:O(e.colorWrite),stencilWrite:v(e.stencilWrite)}));function V(e){return e?j([S(e.blending),w(e.culling),A(e.polygonOffset),R(e.depthTest),I(e.stencilTest),D(e.depthWrite),N(e.colorWrite),z(e.stencilWrite)]):null}class U{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,t,i,r){return(i||e!==t)&&(r(e),this._pipelineInvalid=!0),e}}},1942:function(e,t,i){"use strict";var r,a;i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return a})),function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"}(r||(r={}));class n{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=a.ALL}}!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(a||(a={}))},1962:function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return v}));var r=i("a05b"),a=i("d272"),n=i("4db9"),s=i("6d5b"),o=i("c2d1"),c=i("6a07"),l=i("c6d7"),d=i("3976"),h=i("4377"),u=i("8e97"),p=i("d8a4"),b=i("fd48"),f=i("3886"),m=i("690a"),g=i("b7c2"),O=i("b7bd");function v(e){const t=new m["a"],i=e.output===r["a"].Depth,v=e.hasMultipassTerrain&&(e.output===r["a"].Color||e.output===r["a"].Alpha);Object(u["b"])(t,e),t.include(n["a"],{hasModelTransformation:!1,linearDepth:i}),t.include(s["a"],e),t.attributes.add(O["a"].POSITION,"vec3"),t.varyings.add("vpos","vec3"),v&&t.varyings.add("depth","float");const{vertex:y,fragment:_}=t;return i&&(t.include(o["a"],e),y.uniforms.add(new p["a"]("nearFar",(e,t)=>t.camera.nearFar)),t.varyings.add("linearDepth","float")),y.code.add(f["b"]`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${v?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?f["b"]`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:f["b"]`transformPosition(proj, view, vpos);`}
    }
  `),t.include(a["a"],e),v&&t.include(l["b"],e),_.include(h["a"]),_.uniforms.add(new b["a"]("eColor",e=>e.color)),e.output===r["a"].Highlight&&t.include(c["a"]),_.code.add(f["b"]`
  void main() {
    discardBySlice(vpos);
    ${v?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${f["b"].float(d["b"])}) {
      discard;
    }

    ${e.output===r["a"].Alpha?f["b"]`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===r["a"].Color?f["b"]`gl_FragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===g["i"].Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===r["a"].Highlight?f["b"]`outputHighlight();`:""};
    ${e.output===r["a"].Depth?f["b"]`outputDepth(linearDepth);`:""};
  }
  `),t}const y=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},"1a54":function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return o})),i.d(t,"g",(function(){return l})),i.d(t,"h",(function(){return d}));i("f0b9"),i("c120");var r=i("b2b2"),a=(i("a21b"),i("f2e0"),i("5996"),i("4261")),n=i("9180");i("008c"),i("74e2"),i("a1f3"),i("3563");class s{constructor(e,t,i){this.uid=e,this.geometry=t,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}}function o(e){return Object(r["k"])(e.geometry)}class c{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function l(e,t,i,r){return{x:e,y:t,z:i,hasZ:null!=i,hasM:!1,spatialReference:r,type:"point"}}function d(e){if(Object(r["j"])(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function h(e,t){switch(Object(a["h"])(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)Object(a["l"])(t,e.paths[i],e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)Object(a["l"])(t,e.rings[i],e.hasZ);break;case"multipoint":Object(a["l"])(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function u(e,t){switch(Object(n["l"])(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)Object(n["o"])(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)Object(n["o"])(t,e.rings[i]);break;case"multipoint":Object(n["o"])(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function p(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}Object(a["f"])(),Object(n["k"])()},"1e2c":function(e,t,i){"use strict";i.d(t,"a",(function(){return se}));var r=i("6c97"),a=i("ce50"),n=i("ce6d"),s=i("38a4"),o=i("b2b2"),c=i("f4cc"),l=i("a21b"),d=i("e041"),h=i("2db0"),u=i("228a"),p=i("b7c2"),b=i("b2cd");function f(){if(Object(o["j"])(m)){const e=e=>Object(b["a"])("esri/libs/basisu/"+e);m=i.e("chunk-5ba1e7e0").then(i.bind(null,"a58f")).then(e=>e.b).then(({default:t})=>t({locateFile:e}).then(e=>(e.initializeBasis(),delete e.then,e)))}return m}let m;var g;!function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"}(g||(g={}));var O=i("d17d"),v=i("a1ff"),y=i("8539");let _=null,j=null;async function x(){return Object(o["j"])(j)&&(j=f(),_=await j),j}function S(e,t){if(Object(o["j"])(_))return e.byteLength;const i=new _.BasisFile(new Uint8Array(e)),r=C(i)?w(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),r}function T(e,t){if(Object(o["j"])(_))return e.byteLength;const i=new _.KTX2File(new Uint8Array(e)),r=A(i)?w(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),r}function w(e,t,i,r,a){const n=Object(y["b"])(t?O["i"].COMPRESSED_RGBA8_ETC2_EAC:O["i"].COMPRESSED_RGB8_ETC2),s=a&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*r*n*s)}function C(e){return e.getNumImages()>=1&&!e.isUASTC()}function A(e){return e.getFaces()>=1&&e.isETC1S()}async function P(e,t,i){Object(o["j"])(_)&&(_=await x());const r=new _.BasisFile(new Uint8Array(i));if(!C(r))return null;r.startTranscoding();const a=E(e,t,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(e,t)=>r.getImageTranscodedSizeInBytes(0,e,t),(e,t,i)=>r.transcodeImage(i,0,e,t,0,0));return r.close(),r.delete(),a}async function R(e,t,i){Object(o["j"])(_)&&(_=await x());const r=new _.KTX2File(new Uint8Array(i));if(!A(r))return null;r.startTranscoding();const a=E(e,t,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(e,t)=>r.getImageTranscodedSizeInBytes(e,0,0,t),(e,t,i)=>r.transcodeImage(i,e,0,0,t,0,-1,-1));return r.close(),r.delete(),a}function E(e,t,i,r,a,n,s,o){const{compressedTextureETC:c,compressedTextureS3TC:l}=e.capabilities,[d,h]=c?r?[g.ETC2_RGBA,O["i"].COMPRESSED_RGBA8_ETC2_EAC]:[g.ETC1_RGB,O["i"].COMPRESSED_RGB8_ETC2]:l?r?[g.BC3_RGBA,O["i"].COMPRESSED_RGBA_S3TC_DXT5_EXT]:[g.BC1_RGB,O["i"].COMPRESSED_RGB_S3TC_DXT1_EXT]:[g.RGBA32,O["p"].RGBA],u=t.hasMipmap?i:Math.min(1,i),p=[];for(let g=0;g<u;g++)p.push(new Uint8Array(s(g,d))),o(g,d,p[g]);const b=p.length>1,f=b?O["z"].LINEAR_MIPMAP_LINEAR:O["z"].LINEAR,m={...t,samplingMode:f,hasMipmap:b,internalFormat:h,width:a,height:n};return new v["a"](e,m,{type:"compressed",levels:p})}var I=i("003f"),M=i("2765"),D=i("e92d");const L=D["a"].getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),N=542327876,F=131072,z=4;function G(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function V(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const U=G("DXT1"),B=G("DXT3"),k=G("DXT5"),H=31,W=0,q=1,$=2,X=3,Y=4,Z=7,J=20,Q=21;function K(e,t,i){const{textureData:r,internalFormat:a,width:n,height:s}=ee(i,t.hasMipmap);return t.samplingMode=r.levels.length>1?O["z"].LINEAR_MIPMAP_LINEAR:O["z"].LINEAR,t.hasMipmap=r.levels.length>1,t.internalFormat=a,t.width=n,t.height=s,new v["a"](e,t,r)}function ee(e,t){const i=new Int32Array(e,0,H);if(i[W]!==N)return L.error("Invalid magic number in DDS header"),null;if(!(i[J]&z))return L.error("Unsupported format, must contain a FourCC code"),null;const r=i[Q];let a,n;switch(r){case U:a=8,n=O["i"].COMPRESSED_RGB_S3TC_DXT1_EXT;break;case B:a=16,n=O["i"].COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case k:a=16,n=O["i"].COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return L.error("Unsupported FourCC code:",V(r)),null}let o=1,c=i[Y],l=i[X];0==(3&c)&&0==(3&l)||(L.warn("Rounding up compressed texture size to nearest multiple of 4."),c=c+3&-4,l=l+3&-4);const d=c,h=l;let u,p;i[$]&F&&!1!==t&&(o=Math.max(1,i[Z])),1===o||Object(s["k"])(c)&&Object(s["k"])(l)||(L.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let b=i[q]+4;const f=[];for(let s=0;s<o;++s)p=(c+3>>2)*(l+3>>2)*a,u=new Uint8Array(e,b,p),f.push(u),b+=p,c=Math.max(1,c>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:f},internalFormat:n,width:d,height:h}}var te,ie=i("d5f7"),re=i("1153"),ae=i("d267"),ne=i("c514");class se extends I["a"]{constructor(e,t){super(),this.data=e,this.type=M["a"].Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new n["a"],this.params=t||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:O["B"].REPEAT,t:O["B"].REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||p["e"].STRETCH,this.estimatedTexMemRequired=se._estimateTexMemRequired(this.data,this.params),this._startPreload()}_startPreload(){const e=this.data;Object(o["j"])(e)||(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(Object(d["v"])(e.src)||"auto"===e.preload&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const t=!e.paused;if(e.src=e.src,t&&e.autoplay){const t=()=>{e.removeEventListener("canplay",t),e.play()};e.addEventListener("canplay",t)}}}_startPreloadImageElement(e){Object(d["w"])(e.src)||Object(d["v"])(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static _getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static _estimateTexMemRequired(e,t){if(Object(o["j"])(e))return 0;if(Object(l["c"])(e)||Object(l["k"])(e))return t.encoding===se.KTX2_ENCODING?T(e,t.mipmap):t.encoding===se.BASIS_ENCODING?S(e,t.mipmap):e.byteLength;const{width:i,height:r}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?se._getDataDimensions(e):t;return(t.mipmap?4/3:1)*i*r*(t.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(e){var t;return{target:O["A"].TEXTURE_2D,pixelFormat:O["p"].RGBA,dataType:O["q"].UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?O["z"].LINEAR_MIPMAP_LINEAR:O["z"].LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(t=this.params.maxAnisotropy)?t:this.params.mipmap?e.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(e,t){if(Object(o["k"])(this._glTexture))return this._glTexture;if(Object(o["k"])(this._loadingPromise))return this._loadingPromise;const i=this.data;return Object(o["j"])(i)?(this._glTexture=new v["a"](e,this._createDescriptor(e),null),this._glTexture):"string"==typeof i?this._loadFromURL(e,t,i):i instanceof Image?this._loadFromImageElement(e,t,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,t,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i,t):(Object(l["c"])(i)||Object(l["k"])(i))&&this.params.encoding===se.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(e,i)):(Object(l["c"])(i)||Object(l["k"])(i))&&this.params.encoding===se.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(e,i)):(Object(l["c"])(i)||Object(l["k"])(i))&&this.params.encoding===se.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(e,i)):Object(l["k"])(i)?this._loadFromPixelData(e,i):Object(l["c"])(i)?this._loadFromPixelData(e,new Uint8Array(i)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(e,t,i){if(!(this.data instanceof HTMLVideoElement)||Object(o["j"])(this._glTexture))return i;if(this.data.readyState<te.HAVE_CURRENT_DATA||i===this.data.currentTime)return i;if(Object(o["k"])(this._powerOfTwoStretchInfo)){const{framebuffer:i,vao:r,sourceTexture:a}=this._powerOfTwoStretchInfo;a.setData(this.data),this._drawStretchedTexture(e,t,i,r,a,this._glTexture)}else{const{videoWidth:e,videoHeight:t}=this.data,{width:i,height:r}=this._glTexture.descriptor;e!==i||t!==r?this._glTexture.updateData(0,0,0,Math.min(e,i),Math.min(t,r),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this.data.currentTime}_loadFromDDSData(e,t){return this._glTexture=K(e,this._createDescriptor(e),t),this._glTexture}_loadFromKTX2(e,t){return this._loadAsync(()=>R(e,this._createDescriptor(e),t).then(e=>(this._glTexture=e,e)))}_loadFromBasis(e,t){return this._loadAsync(()=>P(e,this._createDescriptor(e),t).then(e=>(this._glTexture=e,e)))}_loadFromPixelData(e,t){Object(re["a"])(this.params.width>0&&this.params.height>0);const i=this._createDescriptor(e);return i.pixelFormat=1===this.params.components?O["p"].LUMINANCE:3===this.params.components?O["p"].RGB:O["p"].RGBA,i.width=this.params.width,i.height=this.params.height,this._glTexture=new v["a"](e,i,t),this._glTexture}_loadFromURL(e,t,i){return this._loadAsync(async r=>{const a=await Object(h["a"])(i,{signal:r});return Object(c["p"])(r),this._loadFromImage(e,a,t)})}_loadFromImageElement(e,t,i){return i.complete?this._loadFromImage(e,i,t):this._loadAsync(async r=>{const a=await Object(u["b"])(i,i.src,!1,r);return Object(c["p"])(r),this._loadFromImage(e,a,t)})}_loadFromVideoElement(e,t,i){return i.readyState>=te.HAVE_CURRENT_DATA?this._loadFromImage(e,i,t):this._loadFromVideoElementAsync(e,t,i)}_loadFromVideoElementAsync(e,t,i){return this._loadAsync(r=>new Promise((n,s)=>{const l=()=>{i.removeEventListener("loadeddata",d),i.removeEventListener("error",h),Object(o["q"])(u)},d=()=>{i.readyState>=te.HAVE_CURRENT_DATA&&(l(),n(this._loadFromImage(e,i,t)))},h=e=>{l(),s(e||new a["a"]("Failed to load video"))};i.addEventListener("loadeddata",d),i.addEventListener("error",h);const u=Object(c["m"])(r,()=>h(Object(c["b"])()))}))}_loadFromImage(e,t,i){const r=se._getDataDimensions(t);this.params.width=r.width,this.params.height=r.height;const a=this._createDescriptor(e);return a.pixelFormat=3===this.params.components?O["p"].RGB:O["p"].RGBA,!this._requiresPowerOfTwo(e,a)||Object(s["k"])(r.width)&&Object(s["k"])(r.height)?(a.width=r.width,a.height=r.height,this._glTexture=new v["a"](e,a,t),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(e,t,r,a,i),this._glTexture)}_loadAsync(e){const t=new AbortController;this._loadingController=t;const i=e(t.signal);this._loadingPromise=i;const r=()=>{this._loadingController===t&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(r,r),i}_requiresPowerOfTwo(e,t){const i=O["B"].CLAMP_TO_EDGE,r="number"==typeof t.wrapMode?t.wrapMode===i:t.wrapMode.s===i&&t.wrapMode.t===i;return!Object(ne["a"])(e.gl)&&(t.hasMipmap||!r)}_makePowerOfTwoTexture(e,t,i,a,n){const{width:o,height:c}=i,l=Object(s["m"])(o),d=Object(s["m"])(c);let h;switch(a.width=l,a.height=d,this.params.powerOfTwoResizeMode){case p["e"].PAD:a.textureCoordinateScaleFactor=[o/l,c/d],h=new v["a"](e,a),h.updateData(0,0,0,o,c,t);break;case p["e"].STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(e,t,a,n());break;default:Object(r["a"])(this.params.powerOfTwoResizeMode)}return a.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(e,t,i,r){const a=new v["a"](e,i),n=new ae["a"](e,{colorTarget:O["y"].TEXTURE,depthStencilTarget:O["m"].NONE},a),s=new v["a"](e,{target:O["A"].TEXTURE_2D,pixelFormat:i.pixelFormat,dataType:O["q"].UNSIGNED_BYTE,wrapMode:O["B"].CLAMP_TO_EDGE,samplingMode:O["z"].LINEAR,flipped:!!i.flipped,maxAnisotropy:8,preMultiplyAlpha:i.preMultiplyAlpha},t),o=Object(ie["b"])(e),c=e.getBoundFramebufferObject();return this._drawStretchedTexture(e,r,n,o,s,a),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:o,sourceTexture:s,framebuffer:n}:(o.dispose(!0),s.dispose(),n.detachColorTexture(),n.dispose()),e.bindFramebuffer(c),a}_drawStretchedTexture(e,t,i,r,a,n){e.bindFramebuffer(i);const s=e.getViewport();e.setViewport(0,0,n.descriptor.width,n.descriptor.height);const o=e.bindTechnique(t);o.setUniform4f("uColor",1,1,1,1),o.bindTexture("tex",a),e.bindVAO(r),e.drawArrays(O["r"].TRIANGLE_STRIP,0,Object(y["f"])(r,"geometry")),e.bindFramebuffer(null),e.setViewport(s.x,s.y,s.width,s.height)}unload(){if(Object(o["k"])(this._powerOfTwoStretchInfo)){const{framebuffer:e,vao:t,sourceTexture:i}=this._powerOfTwoStretchInfo;t.dispose(!0),i.dispose(),e.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(Object(o["k"])(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),Object(o["k"])(this._loadingController)){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}}se.DDS_ENCODING="image/vnd-ms.dds",se.KTX2_ENCODING="image/ktx2",se.BASIS_ENCODING="image/x.basis",function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(te||(te={}))},"1f93":function(e,t,i){"use strict";i.d(t,"a",(function(){return I})),i.d(t,"b",(function(){return M}));var r=i("b0ea"),a=i("02f1"),n=i("0fc4"),s=i("a05b"),o=i("b2b2");class c{constructor(){this.enabled=!0,this._time=0}get time(){return Object(r["a"])(this._time)}advance(e){return Object(o["k"])(e.forcedTime)?this._time!==e.forcedTime&&(this._time=e.forcedTime,!0):!(!this.enabled||0===e.dt)&&(this._time+=e.dt,!0)}}var l=i("b061"),d=i("35b3"),h=i("7438"),u=i("badc"),p=i("b7c2"),b=i("d7f7"),f=i("a4ee"),m=i("3c9c"),g=i("a7d7"),O=i("6a21"),v=i("c3a4"),y=i("ca98"),_=i("da35"),j=i("fa1e"),x=i("c829"),S=i("6d35"),T=i("ea44"),w=i("189c");class C extends y["a"]{constructor(e,t,i){super(e,t,i),this._textureRepository=e.waterTextureRepository}initializeConfiguration(e,t){t.spherical=e.viewingMode===m["a"].Global,t.doublePrecisionRequiresObfuscation=Object(O["b"])(e.rctx)}initializeProgram(e){const t=C.shader.get().build(this.configuration);return new x["a"](e.rctx,t,j["a"])}bindPass(e,t){this.program.bindPass(e,t),this.configuration.output!==s["a"].Color&&this.configuration.output!==s["a"].Normal||this._textureRepository.bind(this.program)}_setPipelineState(e){const t=this.configuration,i=e===p["i"].NONE,r=e===p["i"].FrontFace;return Object(w["f"])({blending:t.output!==s["a"].Normal&&t.output!==s["a"].Highlight&&t.transparent?i?h["d"]:Object(h["f"])(e):null,depthTest:{func:Object(h["g"])(e)},depthWrite:i?t.writeDepth&&w["d"]:Object(h["h"])(e),colorWrite:w["c"],polygonOffset:i||r?null:Object(h["e"])(t.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}C.shader=new v["a"](T["a"],()=>i.e("chunk-2d0a5169").then(i.bind(null,"08e0")));class A extends S["a"]{constructor(){super(...arguments),this.output=s["a"].Color,this.transparencyPassType=p["i"].NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}Object(f["a"])([Object(_["b"])({count:s["a"].COUNT})],A.prototype,"output",void 0),Object(f["a"])([Object(_["b"])({count:p["i"].COUNT})],A.prototype,"transparencyPassType",void 0),Object(f["a"])([Object(_["b"])()],A.prototype,"spherical",void 0),Object(f["a"])([Object(_["b"])()],A.prototype,"receiveShadows",void 0),Object(f["a"])([Object(_["b"])()],A.prototype,"hasSlicePlane",void 0),Object(f["a"])([Object(_["b"])()],A.prototype,"transparent",void 0),Object(f["a"])([Object(_["b"])()],A.prototype,"enableOffset",void 0),Object(f["a"])([Object(_["b"])()],A.prototype,"writeDepth",void 0),Object(f["a"])([Object(_["b"])()],A.prototype,"hasScreenSpaceReflections",void 0),Object(f["a"])([Object(_["b"])()],A.prototype,"doublePrecisionRequiresObfuscation",void 0),Object(f["a"])([Object(_["b"])()],A.prototype,"hasCloudsReflections",void 0),Object(f["a"])([Object(_["b"])()],A.prototype,"isDraped",void 0),Object(f["a"])([Object(_["b"])()],A.prototype,"hasMultipassTerrain",void 0),Object(f["a"])([Object(_["b"])()],A.prototype,"cullAboveGround",void 0),Object(f["a"])([Object(_["b"])({constValue:g["a"].Water})],A.prototype,"pbrMode",void 0),Object(f["a"])([Object(_["b"])({constValue:!0})],A.prototype,"useCustomDTRExponentForWater",void 0),Object(f["a"])([Object(_["b"])({constValue:!0})],A.prototype,"highStepCount",void 0),Object(f["a"])([Object(_["b"])({constValue:!1})],A.prototype,"useFillLights",void 0);class P extends b["a"]{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const t=Object(o["k"])(e.clouds.data);t!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:t})}ensureResources(e){const t=this._techniqueRepository.constructionContext.waterTextureRepository;return t.resourceState===p["g"].NOT_LOADED&&t.loadTextures(e),t.resourceState}beginSlot(e){return this._output===s["a"].Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this.ensureTechnique(C,e)}}var R=i("8675"),E=i("7c51");class I extends d["a"]{constructor(e){super(e,new M),this._techniqueConfig=new A,this.animation=new c}getConfiguration(e,t){return this._techniqueConfig.output=e,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._techniqueConfig.hasCloudsReflections=this.parameters.hasCloudsReflections,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=t.transparencyPassType,this._techniqueConfig.enableOffset=t.camera.relativeElevation<h["b"],this._techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this._techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this._techniqueConfig}update(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<D;const i=this.animation.advance(e);return this.setParameters({timeElapsed:Object(r["b"])(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}intersect(e,t,i,r,a,n,s){Object(E["e"])(e,t,r,a,n,void 0,s)}requiresSlot(e,t){switch(Object(l["b"])(t)){case s["a"].Normal:return e===u["a"].DRAPED_WATER;case s["a"].Color:if(this.parameters.isDraped)return e===u["a"].DRAPED_MATERIAL;break;case s["a"].Highlight:return e===u["a"].OPAQUE_MATERIAL||e===u["a"].DRAPED_MATERIAL}let i=u["a"].OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?u["a"].TRANSPARENT_MATERIAL:u["a"].TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){if(e.output===s["a"].Color&&this.parameters.isDraped)return e.output=s["a"].Draped,new P(e);switch(e.output){case s["a"].Color:case s["a"].Normal:case s["a"].Highlight:case s["a"].Alpha:return new P(e)}return null}createBufferWriter(){return new R["a"](R["d"])}}class M extends d["b"]{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Object(a["g"])(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Object(n["g"])(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}}const D=35e3},"1fe9":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae"),a=i("52b2");class n extends r["a"]{constructor(e,t){super(e,"float",a["a"].Pass,(i,r,a)=>i.setUniform1f(e,t(r,a)))}}},2245:function(e,t,i){"use strict";i.d(t,"a",(function(){return T})),i.d(t,"b",(function(){return S}));var r=i("e431"),a=i("0b2d"),n=i("2bc9"),s=i("38a4");function o(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t[r];return i}function c(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t;return i}function l(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]+t[r];return i}function d(e){return(e+1)*(e+1)}function h(e){return Object(s["e"])(Math.floor(Math.sqrt(e)-1),0,2)}function u(e,t,i){const r=e[0],a=e[1],n=e[2],s=i||[];return s.length=d(t),t>=0&&(s[0]=.28209479177),t>=1&&(s[1]=.4886025119*r,s[2]=.4886025119*n,s[3]=.4886025119*a),t>=2&&(s[4]=1.09254843059*r*a,s[5]=1.09254843059*a*n,s[6]=.31539156525*(3*n*n-1),s[7]=1.09254843059*r*n,s[8]=.54627421529*(r*r-a*a)),s}function p(e,t){const i=d(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let a=0;a<i;a++)r.r[a]=r.g[a]=r.b[a]=0;return r}function b(e,t){const i=h(t.r.length);for(const a of e)Object(r["s"])(j,a.direction),u(j,i,y),o(y,x),c(y,a.intensity[0],_),l(t.r,_),c(y,a.intensity[1],_),l(t.g,_),c(y,a.intensity[2],_),l(t.b,_);return t}function f(e,t){u(j,0,y);for(const i of e)t.r[0]+=y[0]*x[0]*i.intensity[0]*4*Math.PI,t.g[0]+=y[0]*x[0]*i.intensity[1]*4*Math.PI,t.b[0]+=y[0]*x[0]*i.intensity[2]*4*Math.PI;return t}function m(e,t,i,a){p(t,a),Object(r["w"])(i.intensity,0,0,0);let s=!1;const o=g,c=O,d=v;o.length=0,c.length=0,d.length=0;for(const l of e)l instanceof n["c"]&&!s?(Object(r["g"])(i.direction,l.direction),Object(r["g"])(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof n["c"]||l instanceof n["b"]?o.push(l):l instanceof n["a"]?c.push(l):l instanceof n["d"]&&d.push(l);b(o,a),f(c,a);for(const r of d)l(a.r,r.r),l(a.g,r.g),l(a.b,r.b)}const g=[],O=[],v=[],y=[0],_=[0],j=Object(a["f"])(),x=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],S=.4;class T{constructor(){this._shOrder=2,this._oldSunlight={direction:Object(a["f"])(),ambient:{color:Object(a["f"])(),intensity:1},diffuse:{color:Object(a["f"])(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new n["d"],this._mainLight={intensity:Object(a["f"])(),direction:Object(a["h"])(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}get lightingMainDirection(){return this._mainLight.direction}set(e){m(e,this._shOrder,this._mainLight,this._sphericalHarmonics),Object(r["g"])(this._oldSunlight.direction,this._mainLight.direction);const t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,Object(r["k"])(this._oldSunlight.diffuse.color,this._mainLight.intensity,t),Object(r["g"])(w,this._oldSunlight.diffuse.color),Object(r["k"])(w,w,S*this.globalFactor),Object(r["e"])(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,w)}get old(){return this._oldSunlight}}const w=Object(a["f"])()},2765:function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Geometry=2]="Geometry",e[e.Material=3]="Material",e[e.Texture=4]="Texture",e[e.COUNT=5]="COUNT"}(r||(r={}))},2906:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var r=i("e431"),a=i("0b2d"),n=i("7577"),s=i("0fc4"),o=i("a7d7"),c=i("ea32"),l=i("fd48"),d=i("3886");function h(e,t){const i=e.fragment,a=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===a?(i.uniforms.add(new c["a"]("lightingAmbientSH0",(e,t)=>Object(r["w"])(u,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0]))),i.code.add(d["b"]`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===a?(i.uniforms.add([new l["a"]("lightingAmbientSH_R",(e,t)=>Object(n["l"])(p,t.lighting.sh.r[0],t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3])),new l["a"]("lightingAmbientSH_G",(e,t)=>Object(n["l"])(p,t.lighting.sh.g[0],t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3])),new l["a"]("lightingAmbientSH_B",(e,t)=>Object(n["l"])(p,t.lighting.sh.b[0],t.lighting.sh.b[1],t.lighting.sh.b[2],t.lighting.sh.b[3]))]),i.code.add(d["b"]`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===a&&(i.uniforms.add([new c["a"]("lightingAmbientSH0",(e,t)=>Object(r["w"])(u,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0])),new l["a"]("lightingAmbientSH_R1",(e,t)=>Object(n["l"])(p,t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3],t.lighting.sh.r[4])),new l["a"]("lightingAmbientSH_G1",(e,t)=>Object(n["l"])(p,t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3],t.lighting.sh.g[4])),new l["a"]("lightingAmbientSH_B1",(e,t)=>Object(n["l"])(p,t.lighting.sh.b[1],t.lighting.sh.b[2],t.lighting.sh.b[3],t.lighting.sh.b[4])),new l["a"]("lightingAmbientSH_R2",(e,t)=>Object(n["l"])(p,t.lighting.sh.r[5],t.lighting.sh.r[6],t.lighting.sh.r[7],t.lighting.sh.r[8])),new l["a"]("lightingAmbientSH_G2",(e,t)=>Object(n["l"])(p,t.lighting.sh.g[5],t.lighting.sh.g[6],t.lighting.sh.g[7],t.lighting.sh.g[8])),new l["a"]("lightingAmbientSH_B2",(e,t)=>Object(n["l"])(p,t.lighting.sh.b[5],t.lighting.sh.b[6],t.lighting.sh.b[7],t.lighting.sh.b[8]))]),i.code.add(d["b"]`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==o["a"].Normal&&t.pbrMode!==o["a"].Schematic||i.code.add(d["b"]`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const u=Object(a["f"])(),p=Object(s["e"])()},"2aad":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886"),a=i("b7bd");function n(e,t=!0){e.attributes.add(a["a"].POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(r["b"]`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?r["b"]`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}},"2bc9":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return o}));var r=i("0b2d");class a{constructor(e=Object(r["f"])()){this.intensity=e}}class n{constructor(e=Object(r["f"])(),t=Object(r["h"])(.57735,.57735,.57735)){this.intensity=e,this.direction=t}}class s{constructor(e=Object(r["f"])(),t=Object(r["h"])(.57735,.57735,.57735),i=!0,a=1,n=1){this.intensity=e,this.direction=t,this.castShadows=i,this.specularStrength=a,this.environmentStrength=n}}class o{constructor(){this.r=[0],this.g=[0],this.b=[0]}}},"2ca8":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae"),a=i("52b2");class n extends r["a"]{constructor(e,t){super(e,"bool",a["a"].Pass,(i,r,a)=>i.setUniform1b(e,t(r,a)))}}},"2db0":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("2eab");async function a(e,t){const{data:i}=await Object(r["default"])(e,{responseType:"image",...t});return i}},"2df1":function(e,t,i){"use strict";i.d(t,"a",(function(){return X}));var r=i("38a4"),a=i("b2b2"),n=i("1c92"),s=i("dae5"),o=i("d791"),c=i("afe1"),l=i("3349"),d=i("02f1"),h=i("e431"),u=i("0b2d"),p=i("0fc4");function b(e){return e instanceof Float32Array&&e.length>=16}function f(e){return Array.isArray(e)&&e.length>=16}function m(e){return b(e)||f(e)}var g=i("9180"),O=i("fc00"),v=i("a05b"),y=i("d0cb"),_=i("1038"),j=i("e93d"),x=i("35b3"),S=i("badc"),T=i("da1c"),w=i("1153"),C=i("b7bd"),A=i("5957"),P=i("7c51"),R=i("b623"),E=i("0d96"),I=i("3c9c"),M=i("c3a4"),D=i("ca98"),L=i("b7c2"),N=i("fa1e"),F=i("7438"),z=i("c829"),G=i("d17d"),V=i("189c");class U extends D["a"]{initializeConfiguration(e,t){t.spherical=e.viewingMode===I["a"].Global}initializeProgram(e){const t=U.shader.get().build(this.configuration);return new z["a"](e.rctx,t,N["a"])}_setPipelineState(e){const t=this.configuration,i=e===L["i"].NONE,r=e===L["i"].FrontFace,a=this.configuration.hasPolygonOffset&&B,n=(i||r)&&t.output!==v["a"].Highlight?(t.depthEnabled||t.output===v["a"].Occlusion)&&V["d"]:null;return Object(V["f"])({blending:t.output===v["a"].Color||t.output===v["a"].Alpha||t.output===v["a"].Highlight?i?k:Object(F["f"])(e):null,depthTest:{func:G["h"].LEQUAL},depthWrite:n,colorWrite:V["c"],polygonOffset:a})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.output===v["a"].Occlusion?G["r"].POINTS:G["r"].TRIANGLES}}U.shader=new M["a"](E["a"],()=>i.e("chunk-2d0db7d8").then(i.bind(null,"6fa3")));const B={factor:0,units:-4},k=Object(V["h"])(G["b"].ONE,G["b"].ONE_MINUS_SRC_ALPHA);var H=i("a4ee"),W=i("da35"),q=i("6d35");class $ extends q["a"]{constructor(){super(...arguments),this.output=v["a"].Color,this.screenCenterOffsetUnitsEnabled=y["b"].World,this.transparencyPassType=L["i"].NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}Object(H["a"])([Object(W["b"])({count:v["a"].COUNT})],$.prototype,"output",void 0),Object(H["a"])([Object(W["b"])({count:y["b"].COUNT})],$.prototype,"screenCenterOffsetUnitsEnabled",void 0),Object(H["a"])([Object(W["b"])({count:L["i"].COUNT})],$.prototype,"transparencyPassType",void 0),Object(H["a"])([Object(W["b"])()],$.prototype,"spherical",void 0),Object(H["a"])([Object(W["b"])()],$.prototype,"occlusionTestEnabled",void 0),Object(H["a"])([Object(W["b"])()],$.prototype,"signedDistanceFieldEnabled",void 0),Object(H["a"])([Object(W["b"])()],$.prototype,"vvSize",void 0),Object(H["a"])([Object(W["b"])()],$.prototype,"vvColor",void 0),Object(H["a"])([Object(W["b"])()],$.prototype,"hasVerticalOffset",void 0),Object(H["a"])([Object(W["b"])()],$.prototype,"hasScreenSizePerspective",void 0),Object(H["a"])([Object(W["b"])()],$.prototype,"debugDrawLabelBorder",void 0),Object(H["a"])([Object(W["b"])()],$.prototype,"binaryHighlightOcclusionEnabled",void 0),Object(H["a"])([Object(W["b"])()],$.prototype,"hasSlicePlane",void 0),Object(H["a"])([Object(W["b"])()],$.prototype,"hasPolygonOffset",void 0),Object(H["a"])([Object(W["b"])()],$.prototype,"depthEnabled",void 0),Object(H["a"])([Object(W["b"])()],$.prototype,"pixelSnappingEnabled",void 0),Object(H["a"])([Object(W["b"])()],$.prototype,"isDraped",void 0),Object(H["a"])([Object(W["b"])()],$.prototype,"hasMultipassGeometry",void 0),Object(H["a"])([Object(W["b"])()],$.prototype,"hasMultipassTerrain",void 0),Object(H["a"])([Object(W["b"])()],$.prototype,"cullAboveGround",void 0),Object(H["a"])([Object(W["b"])({constValue:!0})],$.prototype,"hasSliceInVertexProgram",void 0),Object(H["a"])([Object(W["b"])({constValue:!1})],$.prototype,"hasVvInstancing",void 0);class X extends x["a"]{constructor(e){super(e,new ge),this.techniqueConfig=new $}getConfiguration(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasVerticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?y["b"].Screen:y["b"].World,this.techniqueConfig.hasPolygonOffset=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,e===v["a"].Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),e===v["a"].Highlight&&(this.techniqueConfig.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.hasMultipassGeometry=t.multipassGeometry.enabled,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,n,s,o,c,l){Object(a["k"])(l)?this._intersectDrapedHudGeometry(e,s,o,c,l):this._intersectHudGeometry(e,t,i,r,o,c)}_intersectDrapedHudGeometry(e,t,i,r,n){const s=e.vertexAttributes.get(C["a"].POSITION),o=e.vertexAttributes.get(C["a"].SIZE),c=this.parameters,l=Object(E["c"])(c);let d=1,h=1;if(Object(a["k"])(r)){const e=r(ue);d=e[0],h=e[5]}d*=e.screenToWorldRatio,h*=e.screenToWorldRatio;const u=be*e.screenToWorldRatio;for(let a=0;a<s.data.length/s.size;a++){const r=a*s.size,p=s.data[r],b=s.data[r+1],f=a*o.size;let m;fe[0]=o.data[f]*d,fe[1]=o.data[f+1]*h,c.textureIsSignedDistanceField&&(m=c.outlineSize*e.screenToWorldRatio/2),K(t,p,b,fe,u,m,c,l)&&i(n.dist,n.normal,-1,!1)}}_intersectHudGeometry(e,t,i,r,s,c){if(!r.options.selectionMode||!r.options.hud||Object(R["d"])(t))return;const l=this.parameters;let d=1,p=1;if(Object(n["f"])(oe,i),Object(a["k"])(c)){const e=c(ue);d=e[0],p=e[5],Q(oe)}const b=e.vertexAttributes.get(C["a"].POSITION),f=e.vertexAttributes.get(C["a"].SIZE),m=e.vertexAttributes.get(C["a"].NORMAL),g=e.vertexAttributes.get(C["a"].AUXPOS1);Object(w["a"])(b.size>=3);const O=r.point,v=r.camera,y=Object(E["c"])(l);d*=v.pixelRatio,p*=v.pixelRatio;const _="screen"===this.parameters.centerOffsetUnits;for(let a=0;a<b.data.length/b.size;a++){const e=a*b.size;Object(h["w"])(ie,b.data[e],b.data[e+1],b.data[e+2]),Object(h["q"])(ie,ie,i);const t=a*f.size;fe[0]=f.data[t]*d,fe[1]=f.data[t+1]*p,Object(h["q"])(ie,ie,v.viewMatrix);const n=a*g.size;if(Object(h["w"])(de,g.data[n+0],g.data[n+1],g.data[n+2]),!_&&(ie[0]+=de[0],ie[1]+=de[1],0!==de[2])){const e=de[2];Object(h["r"])(de,ie),Object(h["f"])(ie,ie,Object(h["k"])(de,de,e))}const c=a*m.size;if(Object(h["w"])(re,m.data[c],m.data[c+1],m.data[c+2]),this._normalAndViewAngle(re,oe,v,he),this._applyVerticalOffsetTransformationView(ie,he,v,ee),v.applyProjection(ie,ae),ae[0]>-1){ae[0]=Math.floor(ae[0]),ae[1]=Math.floor(ae[1]),_&&(de[0]||de[1])&&(ae[0]+=de[0],0!==de[1]&&(ae[1]+=Object(T["b"])(de[1],ee.factorAlignment)),v.unapplyProjection(ae,ie)),ae[0]+=this.parameters.screenOffset[0],ae[1]+=this.parameters.screenOffset[1],Object(T["a"])(fe,ee.factor,fe);const e=pe*v.pixelRatio;let t;if(l.textureIsSignedDistanceField&&(t=l.outlineSize*v.pixelRatio/2),K(O,ae[0],ae[1],fe,e,t,l,y)){const e=r.ray;if(Object(h["q"])(se,ie,Object(o["a"])(le,v.viewMatrix)),ae[0]=O[0],ae[1]=O[1],v.unprojectFromRenderScreen(ae,ie)){const t=Object(u["f"])();Object(h["g"])(t,e.direction);const i=1/Object(h["p"])(t);Object(h["k"])(t,t,i),s(Object(h["m"])(e.origin,ie)*i,t,-1,!0,1,se)}}}}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;const r=i.get(C["a"].POSITION),a=e.indices.get(C["a"].POSITION);return Object(_["b"])(r,a,t)}createBufferWriter(){return new ve(this)}_normalAndViewAngle(e,t,i,r){return m(t)&&(t=Object(n["f"])(ce,t)),Object(h["x"])(r.normal,e,t),Object(h["q"])(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=Object(h["i"])(ne,me),r}_updateScaleInfo(e,t,i){const r=this.parameters;Object(a["k"])(r.screenSizePerspective)?Object(T["c"])(i,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),Object(a["k"])(r.screenSizePerspectiveAlignment)?Object(T["c"])(i,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,t,i,r,a,n,s){const o=this._normalAndViewAngle(t,i,a,he);return this._applyVerticalGroundOffsetView(e,o,a,s),this._applyVerticalOffsetTransformationView(s,o,a,n),this._applyPolygonOffsetView(s,o,r[3],a,s),this._applyCenterOffsetView(s,r,s),s}applyShaderOffsetsNDC(e,t,i,r,n){return this._applyCenterOffsetNDC(e,t,i,r),Object(a["k"])(n)&&Object(h["g"])(n,r),this._applyPolygonOffsetNDC(r,t,i,r),r}_applyPolygonOffsetView(e,t,i,a,n){const s=a.aboveGround?1:-1;let o=Math.sign(i);0===o&&(o=s);const c=s*o;if(this.parameters.shaderPolygonOffset<=0)return Object(h["g"])(n,e);const l=Object(r["e"])(Math.abs(t.cosAngle),.01,1),d=1-Math.sqrt(1-l*l)/l/a.viewport[2];return Object(h["k"])(n,e,c>0?d:1/d),n}_applyVerticalGroundOffsetView(e,t,i,r){const a=Object(h["p"])(e),n=i.aboveGround?1:-1,s=.5*i.computeRenderPixelSizeAtDist(a),o=Object(h["k"])(ie,t.normal,n*s);return Object(h["e"])(r,e,o),r}_applyVerticalOffsetTransformationView(e,t,i,r){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const i=Object(h["p"])(e);this._updateScaleInfo(r,i,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}const s=Object(h["p"])(e),o=Object(a["s"])(n.screenSizePerspectiveAlignment,n.screenSizePerspective),c=Object(P["h"])(i,s,n.verticalOffset,t.cosAngle,o);return this._updateScaleInfo(r,s,t.cosAngle),Object(h["k"])(t.normal,t.normal,c),Object(h["e"])(e,e,t.normal)}_applyCenterOffsetView(e,t,i){const r="screen"!==this.parameters.centerOffsetUnits;return i!==e&&Object(h["g"])(i,e),r&&(i[0]+=t[0],i[1]+=t[1],t[2]&&(Object(h["r"])(re,i),Object(h["e"])(i,i,Object(h["k"])(re,re,t[2])))),i}_applyCenterOffsetNDC(e,t,i,r){const a="screen"!==this.parameters.centerOffsetUnits;return r!==e&&Object(h["g"])(r,e),a||(r[0]+=t[0]/i.fullWidth*2,r[1]+=t[1]/i.fullHeight*2),r}_applyPolygonOffsetNDC(e,t,i,r){const a=this.parameters.shaderPolygonOffset;if(e!==r&&Object(h["g"])(r,e),a){const e=i.aboveGround?1:-1,n=e*Math.sign(t[3]);r[2]-=(n||e)*a}return r}requiresSlot(e){if(e===S["a"].DRAPED_MATERIAL)return!0;const{drawInSecondSlot:t,occlusionTest:i}=this.parameters;return e===(t?S["a"].LABEL_MATERIAL:S["a"].HUD_MATERIAL)||i&&e===S["a"].OCCLUSION_PIXELS}createGLMaterial(e){return e.output===v["a"].Color||e.output===v["a"].Alpha?new Z(e):e.output===v["a"].Highlight?new Y(e):null}calculateRelativeScreenBounds(e,t,i=Object(g["k"])()){return J(this.parameters,e,t,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}}class Y extends j["a"]{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(U,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}}class Z extends Y{_isOcclusionSlot(e){return e.slot===S["a"].OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&(this._output===v["a"].Color||this._output===v["a"].Alpha)}selectProgram(e){return this.ensureTechnique(U,e,this._isOcclusionSlot(e)?v["a"].Occlusion:this._output)}}function J(e,t,i,r=te){return Object(l["c"])(r,e.anchorPosition),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i,r}function Q(e){const t=e[0],i=e[1],r=e[2],a=e[3],n=e[4],s=e[5],o=e[6],c=e[7],l=e[8],d=1/Math.sqrt(t*t+i*i+r*r),h=1/Math.sqrt(a*a+n*n+s*s),u=1/Math.sqrt(o*o+c*c+l*l);return e[0]=t*d,e[1]=i*d,e[2]=r*d,e[3]=a*h,e[4]=n*h,e[5]=s*h,e[6]=o*u,e[7]=c*u,e[8]=l*u,e}function K(e,t,i,r,n,s,o,c){let l=t-n-(c[0]>0?r[0]*c[0]:0),d=l+r[0]+2*n,h=i-n-(c[1]>0?r[1]*c[1]:0),u=h+r[1]+2*n;const p=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&Object(a["k"])(p)&&(l+=r[0]*p[0],h+=r[1]*p[1],d-=r[0]*(1-p[2]),u-=r[1]*(1-p[3]),l-=s,d+=s,h-=s,u+=s),e[0]>l&&e[0]<d&&e[1]>h&&e[1]<u}const ee={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},te=Object(d["c"])(),ie=Object(u["f"])(),re=Object(u["f"])(),ae=Object(p["e"])(),ne=Object(u["f"])(),se=Object(u["f"])(),oe=Object(s["b"])(),ce=Object(s["b"])(),le=Object(c["d"])(),de=Object(u["f"])(),he={normal:ne,cosAngle:0},ue=Object(c["d"])(),pe=1,be=2,fe=[0,0],me=Object(u["h"])(0,0,1);class ge extends j["b"]{constructor(){super(...arguments),this.renderOccluded=x["c"].Occlude,this.color=[1,1,1,1],this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Object(d["g"])(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=[1,1,1,1],this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.debugDrawLabelBorder=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const Oe=Object(O["a"])().vec3f(C["a"].POSITION).vec3f(C["a"].NORMAL).vec2f(C["a"].UV0).vec4u8(C["a"].COLOR).vec2f(C["a"].SIZE).vec4f(C["a"].AUXPOS1).vec4f(C["a"].AUXPOS2);class ve{constructor(e){this.material=e,this.vertexBufferLayout=Oe}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(C["a"].POSITION).length}write(e,t,i,r){Object(A["e"])(t.indices.get(C["a"].POSITION),t.vertexAttributes.get(C["a"].POSITION).data,e.transformation,i.position,r,6),Object(A["d"])(t.indices.get(C["a"].NORMAL),t.vertexAttributes.get(C["a"].NORMAL).data,e.invTranspTransformation,i.normal,r,6);{const e=t.vertexAttributes.get(C["a"].UV0).data;let a,n,s,o;if(null==e||e.length<4){const e=this.material.parameters;a=0,n=0,s=e.texCoordScale[0],o=e.texCoordScale[1]}else a=e[0],n=e[1],s=e[2],o=e[3];s=Math.min(1.99999,s+1),o=Math.min(1.99999,o+1);const c=t.indices.get(C["a"].POSITION).length,l=i.uv0;let d=r;for(let t=0;t<c;++t)l.set(d,0,a),l.set(d,1,n),d+=1,l.set(d,0,s),l.set(d,1,n),d+=1,l.set(d,0,s),l.set(d,1,o),d+=1,l.set(d,0,s),l.set(d,1,o),d+=1,l.set(d,0,a),l.set(d,1,o),d+=1,l.set(d,0,a),l.set(d,1,n),d+=1}Object(A["b"])(t.indices.get(C["a"].COLOR),t.vertexAttributes.get(C["a"].COLOR).data,4,i.color,r,6);{const e=t.indices.get(C["a"].SIZE),a=t.vertexAttributes.get(C["a"].SIZE).data,n=e.length,s=i.size;let o=r;for(let t=0;t<n;++t){const i=a[2*e[t]],r=a[2*e[t]+1];for(let e=0;e<6;++e)s.set(o,0,i),s.set(o,1,r),o+=1}}t.indices.get(C["a"].AUXPOS1)&&t.vertexAttributes.get(C["a"].AUXPOS1)&&Object(A["a"])(t.indices.get(C["a"].AUXPOS1),t.vertexAttributes.get(C["a"].AUXPOS1).data,i.auxpos1,r,6),t.indices.get(C["a"].AUXPOS2)&&t.vertexAttributes.get(C["a"].AUXPOS2)&&Object(A["a"])(t.indices.get(C["a"].AUXPOS2),t.vertexAttributes.get(C["a"].AUXPOS2).data,i.auxpos2,r,6)}}},"2e0f":function(e,t,i){"use strict";i.d(t,"a",(function(){return T})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return v})),i.d(t,"d",(function(){return p})),i.d(t,"e",(function(){return m})),i.d(t,"f",(function(){return f})),i.d(t,"g",(function(){return b})),i.d(t,"h",(function(){return g})),i.d(t,"i",(function(){return O}));var r,a=i("6c97"),n=i("b2b2"),s=i("d791"),o=i("afe1"),c=i("0b2d"),l=i("8188"),d=i("84f4"),h=i("ba58"),u=i("0cb9");function p(e,t,i,r,a,n,s,o,c,d,h){const u=w[h.mode];let p,b,f=0;if(Object(l["l"])(e,t,i,r,c.spatialReference,a,o))return u.requiresAlignment(h)?(f=u.applyElevationAlignmentBuffer(r,a,n,s,o,c,d,h),p=n,b=s):(p=r,b=a),Object(l["l"])(p,c.spatialReference,b,n,d.spatialReference,s,o)?f:void 0}function b(e,t,i,r,s){const o=(Object(d["a"])(e)?e.z:Object(u["c"])(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const i=Object(n["s"])(Object(u["b"])(t,e,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=i,void(s.z=i)}case"relative-to-ground":{const a=Object(n["s"])(Object(u["b"])(t,e,"ground"),0),c=i.geometryZWithOffset(o,r);return s.verticalDistanceToGround=c,s.sampledElevation=a,void(s.z=c+a)}case"relative-to-scene":{const a=Object(n["s"])(Object(u["b"])(t,e,"scene"),0),c=i.geometryZWithOffset(o,r);return s.verticalDistanceToGround=c,s.sampledElevation=a,void(s.z=c+a)}case"absolute-height":{const a=i.geometryZWithOffset(o,r),c=Object(n["s"])(Object(u["b"])(t,e,"ground"),0);return s.verticalDistanceToGround=a-c,s.sampledElevation=c,void(s.z=a)}default:return Object(a["a"])(i.mode),void(s.z=0)}}function f(e,t,i,r){return b(e,t,i,r,A),A.z}function m(e,t,i){return null==t||null==i?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===i?e.staysOnTheGround:t===i||"on-the-ground"!==t&&"on-the-ground"!==i?r.UPDATE:e.onTheGroundChanged}function g(e){return"relative-to-ground"===e||"relative-to-scene"===e}function O(e){return"absolute-height"!==e}function v(e,t,i,r,a){b(t,i,a,r,A),Object(h["h"])(e,A.verticalDistanceToGround);const n=A.sampledElevation,o=Object(s["c"])(C,e.transformation);return P[0]=t.x,P[1]=t.y,P[2]=A.z,Object(l["d"])(t.spatialReference,P,o,r.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function y(e,t,i,r,a,s){let o=0;const c=s.spatialReference;t*=3,r*=3;for(let l=0;l<a;++l){const a=e[t+0],l=e[t+1],d=e[t+2],h=Object(n["s"])(s.getElevation(a,l,d,c,"ground"),0);o+=h,i[r+0]=a,i[r+1]=l,i[r+2]=h,t+=3,r+=3}return o/a}function _(e,t,i,r,a,s,o,c){let l=0;const d=c.calculateOffsetRenderUnits(o),h=c.featureExpressionInfoContext,u=s.spatialReference;t*=3,r*=3;for(let p=0;p<a;++p){const a=e[t+0],o=e[t+1],c=e[t+2],p=Object(n["s"])(s.getElevation(a,o,c,u,"ground"),0);l+=p,i[r+0]=a,i[r+1]=o,i[r+2]=null==h?c+p+d:p+d,t+=3,r+=3}return l/a}function j(e,t,i,r,a,s,o,c){let l=0;const d=c.calculateOffsetRenderUnits(o),h=c.featureExpressionInfoContext,u=s.spatialReference;t*=3,r*=3;for(let p=0;p<a;++p){const a=e[t+0],o=e[t+1],c=e[t+2],p=Object(n["s"])(s.getElevation(a,o,c,u,"scene"),0);l+=p,i[r+0]=a,i[r+1]=o,i[r+2]=null==h?c+p+d:p+d,t+=3,r+=3}return l/a}function x(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return 0!==t||null!=i}function S(e,t,i,r,a,n,s,o){const c=o.calculateOffsetRenderUnits(s),l=o.featureExpressionInfoContext;t*=3,r*=3;for(let d=0;d<a;++d){const a=e[t+0],n=e[t+1],s=e[t+2];i[r+0]=a,i[r+1]=n,i[r+2]=null==l?s+c:c,t+=3,r+=3}return 0}class T{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(r||(r={}));const w={"absolute-height":{applyElevationAlignmentBuffer:S,requiresAlignment:x},"on-the-ground":{applyElevationAlignmentBuffer:y,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:_,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:j,requiresAlignment:()=>!0}},C=Object(o["d"])(),A=new T,P=Object(c["f"])()},"2ebb":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("d17d"),a=i("3f3e");function n(e,t=0){const i=e.stride;return e.fieldNames.filter(t=>{const i=e.fields.get(t).optional;return!(i&&i.glPadding)}).map(r=>{const n=e.fields.get(r),o=n.constructor.ElementCount,c=s(n.constructor.ElementType),l=n.offset,d=!(!n.optional||!n.optional.glNormalized);return new a["a"](r,o,c,l,i,d,t)})}function s(e){const t=o[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const o={u8:r["k"].UNSIGNED_BYTE,u16:r["k"].UNSIGNED_SHORT,u32:r["k"].UNSIGNED_INT,i8:r["k"].BYTE,i16:r["k"].SHORT,i32:r["k"].INT,f32:r["k"].FLOAT}},"2f98":function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return l}));var r=i("7577"),a=i("0fc4"),n=i("fd48"),s=i("3886");function o(e){e.vertex.code.add(s["b"]`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(s["b"]`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(s["b"]`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(s["b"]`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(s["b"]`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(s["b"]`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(s["b"]`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function c(e){e.uniforms.add(new n["a"]("screenSizePerspective",e=>d(e.screenSizePerspective)))}function l(e){e.uniforms.add(new n["a"]("screenSizePerspectiveAlignment",e=>d(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function d(e){return Object(r["l"])(h,e.parameters.divisor,e.parameters.offset,e.parameters.minPixelSize,e.paddingPixelsOverride)}const h=Object(a["e"])()},3205:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return s}));var r,a=i("a4ee"),n=i("da35");!function(e){e[e.SSAO=0]="SSAO",e[e.Blur=1]="Blur",e[e.COUNT=2]="COUNT"}(r||(r={}));class s extends n["a"]{constructor(){super(...arguments),this.output=r.SSAO}}Object(a["a"])([Object(n["b"])({count:r.COUNT})],s.prototype,"output",void 0)},"33e2":function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r=i("3349"),a=i("02f1"),n=i("7577"),s=i("0fc4"),o=i("d981"),c=i("d8a4"),l=i("fd48"),d=i("3886"),h=i("5d7f");function u(e){e.fragment.uniforms.add(new h["a"]("texWaveNormal")),e.fragment.uniforms.add(new h["a"]("texWavePerturbation")),e.fragment.uniforms.add([new l["a"]("waveParams",e=>Object(n["l"])(p,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new c["a"]("waveDirection",e=>Object(r["a"])(b,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))]),e.include(o["b"]),e.fragment.code.add(d["b"]`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const p=Object(s["e"])(),b=Object(a["c"])()},3544:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return l}));var r=i("b2b2");const a={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},n={dash:a.dash,"dash-dot":[...a.dash,...a.dot],dot:a.dot,"long-dash":a["long-dash"],"long-dash-dot":[...a["long-dash"],...a.dot],"long-dash-dot-dot":[...a["long-dash"],...a.dot,...a.dot],none:null,"short-dash":a["short-dash"],"short-dash-dot":[...a["short-dash"],...a["short-dot"]],"short-dash-dot-dot":[...a["short-dash"],...a["short-dot"],...a["short-dot"]],"short-dot":a["short-dot"],solid:null},s=8;function o(e,t=2){return Object(r["j"])(e)?e:{pattern:e.slice(),pixelRatio:t}}function c(e,t=2){return{pattern:[e,e],pixelRatio:t}}function l(e){return Object(r["k"])(e)&&"style"===e.type?d(e.style):null}function d(e){return Object(r["k"])(e)?o(n[e],s):null}},3563:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));i("c120"),i("b2b2");function r(e,t){return!!a(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function a(e,t){return e===t||e&&t&&e.equals(t)}},"35b3":function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return r}));var r,a=i("b2b2"),n=i("3886"),s=i("003f"),o=i("2765"),c=i("fa1e"),l=i("7c51");class d extends s["a"]{constructor(e,t){super(),this.type=o["a"].Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=c["a"],this._parameters=Object(l["b"])(e,t),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,t=!0){Object(l["g"])(this._parameters,e)&&(this.validateParameters(this._parameters),t&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleInPass(e.pass)&&0!=(this.renderOccluded&e.renderOccludedMask)}isVisibleInPass(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){Object(a["k"])(this.repository)&&this.repository.materialChanged(this)}}!function(e){e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"}(r||(r={}));class h extends n["a"]{constructor(){super(...arguments),this.renderOccluded=r.Occlude}}},"35f0":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae"),a=i("52b2");class n extends r["a"]{constructor(e,t){super(e,"vec3",a["a"].Draw,(i,r,a)=>i.setUniform3fv(e,t(r,a)))}}},3626:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("caf1e"),a=i("4377"),n=i("3886");function s(e){e.include(a["a"]),e.code.add(n["b"]`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${n["b"].int(r["a"].Multiply)}) {
        return allMixed;
      }
      if (mode == ${n["b"].int(r["a"].Ignore)}) {
        return internalMixed;
      }
      if (mode == ${n["b"].int(r["a"].Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${n["b"].int(r["a"].Ignore)}) {
        return internalMixed;
      }
      if (mode == ${n["b"].int(r["a"].Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}},"365a":function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var r=i("a4ee"),a=i("fc29"),n=i("ce6d"),s=i("9096"),o=i("a5d8"),c=i("e92d"),l=i("b2b2"),d=i("fab3"),h=i("59b2"),u=(i("b50f"),i("c120"),i("cea0"),i("d386"));let p=class extends(Object(s["b"])(Object(o["a"])(Object(d["b"])(n["a"].EventedMixin(a["a"]))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch(e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";c["a"].getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e)}})}get fullOpacity(){return Object(l["s"])(this.get("layer.opacity"),1)*Object(l["s"])(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var e;return!this.suspended&&!0===(null==(e=this.layer)?void 0:e.legendEnabled)}get updating(){var e;return!((null==(e=this.updatingHandles)||!e.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var e;return!0===(null==(e=this.layer)?void 0:e.visible)}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){var e,t,i;return this.visible&&(null==(e=this.layer)?void 0:e.loaded)&&!(null!=(t=this.parent)&&t.suspended)&&(null==(i=this.view)?void 0:i.ready)||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{},t=this;return t.view&&t.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};Object(r["a"])([Object(h["b"])()],p.prototype,"fullOpacity",null),Object(r["a"])([Object(h["b"])()],p.prototype,"layer",void 0),Object(r["a"])([Object(h["b"])()],p.prototype,"parent",void 0),Object(r["a"])([Object(h["b"])({readOnly:!0})],p.prototype,"suspended",null),Object(r["a"])([Object(h["b"])({readOnly:!0})],p.prototype,"suspendInfo",null),Object(r["a"])([Object(h["b"])({readOnly:!0})],p.prototype,"legendEnabled",null),Object(r["a"])([Object(h["b"])({type:Boolean,readOnly:!0})],p.prototype,"updating",null),Object(r["a"])([Object(h["b"])({readOnly:!0})],p.prototype,"updatingProgress",null),Object(r["a"])([Object(h["b"])()],p.prototype,"visible",null),Object(r["a"])([Object(h["b"])()],p.prototype,"view",void 0),p=Object(r["a"])([Object(u["a"])("esri.views.layers.LayerView")],p);const b=p},"36df":function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return b}));var r=i("2aad"),a=i("d047"),n=i("58c2"),s=i("d8a4"),o=i("4d2d"),c=i("8a80"),l=i("3886"),d=i("690a"),h=i("5d7f"),u=i("3205");const p={samples:16,filterRadius:4};function b(e){const t=new d["a"],i=t.fragment;if(t.include(r["a"]),e.output===u["a"].Blur){const e=(p.filterRadius+1)/2,t=1/(2*e*e);i.include(a["a"]),i.uniforms.add([new h["a"]("normalMap"),new h["a"]("depthMap"),new h["a"]("tex"),new o["a"]("blurSize"),new c["a"]("projScale"),new s["a"]("nearFar",(e,t)=>t.camera.nearFar)]),i.code.add(l["b"]`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${l["b"].float(t)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),i.code.add(l["b"]`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${l["b"].int(p.filterRadius)}; r <= ${l["b"].int(p.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `)}return e.output===u["a"].SSAO&&(i.include(a["a"]),t.include(n["a"]),i.uniforms.add(new h["a"]("normalMap")),i.uniforms.add(new h["a"]("depthMap")),i.uniforms.add(new h["a"]("rnm")),i.uniforms.add(new c["a"]("intensity")),i.uniforms.add(new c["a"]("projScale")),i.uniforms.add(new c["a"]("radius")),i.uniforms.add(new s["a"]("nearFar",(e,t)=>t.camera.nearFar)),i.uniforms.add(new o["a"]("screenSize")),i.uniforms.add(new o["a"]("rnmScale")),i.code.add(l["b"]`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),i.code.add(l["b"]`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.fragment.uniforms.add(new s["a"]("zScale",(e,t)=>Object(n["b"])(t))),i.code.add(l["b"]`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${l["b"].int(p.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
          vec2 tcTap = tc / screenSize;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${l["b"].int(p.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `)),t}const f=Object.freeze(Object.defineProperty({__proto__:null,build:b},Symbol.toStringTag,{value:"Module"}))},3748:function(e,t,i){"use strict";i.d(t,"a",(function(){return V}));var r=i("e92d"),a=i("b2b2"),n=i("a915"),s=i("3349"),o=i("e431"),c=i("0b2d"),l=i("0fc4"),d=i("d359"),h=i("bd7e"),u=i("7289"),p=i("8190"),b=i("a05b"),f=i("1038"),m=i("d7f7"),g=i("35b3"),O=i("badc"),v=i("1153"),y=i("b7bd"),_=i("5957"),j=i("8675"),x=i("7c51"),S=i("b623"),T=i("c3a4"),w=i("ca98"),C=i("fa1e"),A=i("c829"),P=i("87b7"),R=i("713b"),E=i("d17d"),I=i("189c");class M extends w["a"]{constructor(e,t,i){super(e,t,i),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=e.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==b["a"].Highlight}initializeProgram(e){const t=M.shader.get().build(this.configuration);return new A["a"](e.rctx,t,C["a"])}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(this.program.bindPass(e,t),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.stippleEnabled){const{pixelSize:e,sdfNormalizer:t,pixels:i}=Object(a["k"])(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",t),this.program.setUniform1f("stipplePatternTextureSize",i),this.program.setUniform1f("stipplePatternPixelSize",e),this.program.setUniform1f("stipplePatternPixelSizeInv",1/e)}}initializePipeline(){const e=this.configuration,t=Object(I["g"])(E["b"].SRC_ALPHA,E["b"].ONE,E["b"].ONE_MINUS_SRC_ALPHA,E["b"].ONE_MINUS_SRC_ALPHA),i=(t,i=null,r=null)=>Object(I["f"])({blending:i,depthTest:P["b"],depthWrite:r,colorWrite:I["c"],stencilWrite:e.hasOccludees?P["h"]:null,stencilTest:e.hasOccludees?t?P["d"]:P["c"]:null});return e.output===b["a"].Color?(this._occludeePipelineState=i(!0,e.transparent||this.stippleEnabled?t:null,I["d"]),i(!1,e.transparent||this.stippleEnabled?t:null,I["d"])):i(!1)}get primitiveType(){return E["r"].LINES}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}M.shader=new T["a"](R["a"],()=>i.e("chunk-2d20f1b1").then(i.bind(null,"b1e1")));var D=i("a4ee"),L=i("da35"),N=i("6d35");class F extends N["a"]{constructor(){super(...arguments),this.output=b["a"].Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}Object(D["a"])([Object(L["b"])({count:b["a"].COUNT})],F.prototype,"output",void 0),Object(D["a"])([Object(L["b"])()],F.prototype,"hasSlicePlane",void 0),Object(D["a"])([Object(L["b"])()],F.prototype,"hasVertexColors",void 0),Object(D["a"])([Object(L["b"])()],F.prototype,"transparent",void 0),Object(D["a"])([Object(L["b"])()],F.prototype,"draped",void 0),Object(D["a"])([Object(L["b"])()],F.prototype,"stippleEnabled",void 0),Object(D["a"])([Object(L["b"])()],F.prototype,"stippleOffColorEnabled",void 0),Object(D["a"])([Object(L["b"])()],F.prototype,"stipplePreferContinuous",void 0),Object(D["a"])([Object(L["b"])()],F.prototype,"hasOccludees",void 0),Object(D["a"])([Object(L["b"])({constValue:!1})],F.prototype,"stippleRequiresClamp",void 0),Object(D["a"])([Object(L["b"])({constValue:!1})],F.prototype,"stippleScaleWithLineWidth",void 0),Object(D["a"])([Object(L["b"])({constValue:!1})],F.prototype,"stippleRequiresStretchMeasure",void 0);const z=r["a"].getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var G;!function(e){e[e.START=0]="START",e[e.END=1]="END"}(G||(G={}));class V extends g["a"]{constructor(e){super(e,new k),this._techniqueConfig=new F}getConfiguration(e,t){this._techniqueConfig.output=e,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=t.slot===O["a"].DRAPED_MATERIAL;const i=Object(a["k"])(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=i,this._techniqueConfig.stippleOffColorEnabled=i&&Object(a["k"])(this.parameters.stippleOffColor),this._techniqueConfig.hasOccludees=this.parameters.hasOccludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}intersect(e,t,i,r,n,s,o,c,l){Object(a["k"])(l)?Object(x["d"])(e,r,l,s,1,o):this._intersectLineGeometry(e,t,i,r,o)}_intersectLineGeometry(e,t,i,r,a){if(!r.options.selectionMode||Object(S["d"])(t))return;if(!Object(v["f"])(i))return void z.error("intersection assumes a translation-only matrix");const n=e.vertexAttributes.get(y["a"].POSITION).data,c=r.camera,l=ee;Object(s["c"])(l,r.point);const p=2;Object(o["w"])(te[0],l[0]-p,l[1]+p,0),Object(o["w"])(te[1],l[0]+p,l[1]+p,0),Object(o["w"])(te[2],l[0]+p,l[1]-p,0),Object(o["w"])(te[3],l[0]-p,l[1]-p,0);for(let s=0;s<4;s++)if(!c.unprojectFromRenderScreen(te[s],ie[s]))return;Object(u["f"])(c.eye,ie[0],ie[1],re),Object(u["f"])(c.eye,ie[1],ie[2],ae),Object(u["f"])(c.eye,ie[2],ie[3],ne),Object(u["f"])(c.eye,ie[3],ie[0],se);let b=Number.MAX_VALUE,f=0;for(let s=0;s<n.length-5;s+=3){if(H[0]=n[s]+i[12],H[1]=n[s+1]+i[13],H[2]=n[s+2]+i[14],W[0]=n[s+3]+i[12],W[1]=n[s+4]+i[13],W[2]=n[s+5]+i[14],Object(u["u"])(re,H)<0&&Object(u["u"])(re,W)<0||Object(u["u"])(ae,H)<0&&Object(u["u"])(ae,W)<0||Object(u["u"])(ne,H)<0&&Object(u["u"])(ne,W)<0||Object(u["u"])(se,H)<0&&Object(u["u"])(se,W)<0)continue;if(c.projectToRenderScreen(H,X),c.projectToRenderScreen(W,Y),X[2]<0&&Y[2]>0){Object(o["f"])(q,H,W);const e=c.frustum,t=-Object(u["u"])(e[d["a"].NEAR],H)/Object(o["i"])(q,Object(u["q"])(e[d["a"].NEAR]));Object(o["k"])(q,q,t),Object(o["e"])(H,H,q),c.projectToRenderScreen(H,X)}else if(X[2]>0&&Y[2]<0){Object(o["f"])(q,W,H);const e=c.frustum,t=-Object(u["u"])(e[d["a"].NEAR],W)/Object(o["i"])(q,Object(u["q"])(e[d["a"].NEAR]));Object(o["k"])(q,q,t),Object(o["e"])(W,W,q),c.projectToRenderScreen(W,Y)}else if(X[2]<0&&Y[2]<0)continue;X[2]=0,Y[2]=0;const e=Object(h["e"])(Object(h["f"])(X,Y,Q),l);e<b&&(b=e,Object(o["g"])(Z,H),Object(o["g"])(J,W),f=s/3)}const m=r.rayBegin,g=r.rayEnd;if(b<p*p){let e=Number.MAX_VALUE;if(Object(h["a"])(Object(h["f"])(Z,J,Q),Object(h["f"])(m,g,K),$)){Object(o["f"])($,$,m);const t=Object(o["p"])($);Object(o["k"])($,$,1/t),e=t/Object(o["m"])(m,g)}a(e,$,f,!1)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;const r=i.get(y["a"].POSITION);return Object(f["a"])(r,null,!1,t)}requiresSlot(e){return e===O["a"].OPAQUE_MATERIAL||e===O["a"].DRAPED_MATERIAL}createGLMaterial(e){return e.output===b["a"].Color||e.output===b["a"].Highlight?new U(e):null}createBufferWriter(){const e=this.parameters.hasVertexColors?j["b"]:j["c"];return Object(a["j"])(this.parameters.stipplePattern)?new j["a"](e):new B(e.clone().vec3f(y["a"].AUXPOS1).vec2f(y["a"].UV0))}}class U extends m["a"]{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===b["a"].Color&&this._updateOccludeeState(e),this.ensureTechnique(M,e)}}class B{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(y["a"].POSITION).length}write(e,t,i,r){Object(_["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r),this._writeAuxpos1(e,t,i,r),this._writeUV0(e,t,i,r)}_writeAuxpos1(e,t,i,r){const a=i.getField(y["a"].AUXPOS1,p["u"]),n=t.indices.get(y["a"].POSITION),s=t.vertexAttributes.get(y["a"].POSITION).data,o=e.transformation,c=a.typedBufferStride,l=a.typedBuffer;r*=c;for(let d=0;d<n.length-1;d+=2)for(const e of[1,0]){const t=3*n[d+e],i=s[t],a=s[t+1],h=s[t+2],u=o[0]*i+o[4]*a+o[8]*h+o[12],p=o[1]*i+o[5]*a+o[9]*h+o[13],b=o[2]*i+o[6]*a+o[10]*h+o[14];l[r]=u,l[r+1]=p,l[r+2]=b,r+=c}}_writeUV0(e,t,i,r){var a;const n=i.getField(y["a"].UV0,p["m"]),s=t.indices.get(y["a"].POSITION),c=t.vertexAttributes.get(y["a"].POSITION).data,l=null==(a=t.vertexAttributes.get(y["a"].DISTANCETOSTART))?void 0:a.data,d=e.transformation,h=n.typedBufferStride,u=n.typedBuffer;let b=0;u[r*=h]=G.START,u[r+1]=b,r+=h;const f=3*s[0],m=Object(o["w"])(H,c[f],c[f+1],c[f+2]);d&&Object(o["q"])(m,m,d);const g=W,O=s.length-1;let v=1;const _=l?(e,t,i)=>b=l[i]:(e,t,i)=>b+=Object(o["m"])(e,t);for(let p=1;p<O;p+=2){const e=3*s[p];Object(o["w"])(g,c[e],c[e+1],c[e+2]),d&&Object(o["q"])(g,g,d),_(m,g,v++);for(let t=0;t<2;++t)u[r]=1-t,u[r+1]=b,r+=h;Object(o["g"])(m,g)}const j=3*s[O];Object(o["w"])(g,c[j],c[j+1],c[j+2]),d&&Object(o["q"])(g,g,d),_(m,g,v),u[r]=G.END,u[r+1]=b}}class k extends g["b"]{constructor(){super(...arguments),this.color=l["a"],this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}const H=Object(c["f"])(),W=Object(c["f"])(),q=Object(c["f"])(),$=Object(c["f"])(),X=Object(n["d"])(),Y=Object(n["d"])(),Z=Object(c["f"])(),J=Object(c["f"])(),Q=Object(h["d"])(),K=Object(h["d"])(),ee=Object(c["f"])(),te=[Object(n["d"])(),Object(n["d"])(),Object(n["d"])(),Object(n["d"])()],ie=[Object(c["f"])(),Object(c["f"])(),Object(c["f"])(),Object(c["f"])()],re=Object(u["d"])(),ae=Object(u["d"])(),ne=Object(u["d"])(),se=Object(u["d"])()},"37e4":function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"}(r||(r={}))},3853:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("62ae");class a extends r["a"]{constructor(e){super(e,"mat4")}}},3886:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return a}));class r{}function a(e,...t){let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i}!function(e){function t(e){return Math.round(e).toString()}function i(e){return e.toPrecision(8)}e.int=t,e.float=i}(a||(a={}))},3976:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return a}));const r=.1,a=.001},"3a35":function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(r||(r={}))},"3bd5":function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){var t,i;(t=e.Geometry||(e.Geometry={}))[t.ADD=1]="ADD",t[t.UPDATE=2]="UPDATE",t[t.REMOVE=4]="REMOVE",(i=e.State||(e.State={}))[i.VISIBILITIES=1]="VISIBILITIES",i[i.VERTEXATTRS=2]="VERTEXATTRS",i[i.TRANSFORMATION=4]="TRANSFORMATION",i[i.HIGHLIGHTS=8]="HIGHLIGHTS",i[i.OCCLUDEES=16]="OCCLUDEES"}(r||(r={}))},"3e44":function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c}));var r=i("2aad"),a=i("db7b"),n=i("3886"),s=i("690a"),o=i("5d7f");function c(){const e=new s["a"];return e.include(r["a"]),e.fragment.uniforms.add([new o["a"]("tex"),new a["a"]("uColor")]),e.fragment.code.add(n["b"]`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),e}const l=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}))},4377:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("3886");function a(e){e.code.add(r["b"]`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},4554:function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return O})),i.d(t,"c",(function(){return g})),i.d(t,"d",(function(){return T})),i.d(t,"e",(function(){return S})),i.d(t,"f",(function(){return v})),i.d(t,"g",(function(){return j})),i.d(t,"h",(function(){return _})),i.d(t,"i",(function(){return x}));var r=i("e92d"),a=i("b2b2"),n=i("1c92"),s=i("dae5"),o=i("afe1"),c=i("e431"),l=i("0b2d"),d=i("8188"),h=i("f694"),u=i("7f83"),p=i("9786"),b=i("8190"),f=i("668b");const m=r["a"].getLogger("esri.geometry.support.meshUtils.normalProjection");function g(e,t,i,r,a){return C(r)?(w(R.TO_PCPF,b["u"].fromTypedArray(e),b["v"].fromTypedArray(t),b["v"].fromTypedArray(i),r,b["u"].fromTypedArray(a)),a):(m.error("Cannot convert spatial reference to PCPF"),a)}function O(e,t,i,r,a){return C(r)?(w(R.FROM_PCPF,b["u"].fromTypedArray(e),b["v"].fromTypedArray(t),b["v"].fromTypedArray(i),r,b["u"].fromTypedArray(a)),a):(m.error("Cannot convert to spatial reference from PCPF"),a)}function v(e,t,i){return Object(d["l"])(e,t,0,i,Object(h["g"])(t),0,e.length/3),i}function y(e,t,i){return Object(d["l"])(e,Object(h["g"])(i),0,t,i,0,e.length/3),t}function _(e,t,i){if(Object(a["j"])(e))return t;const r=b["v"].fromTypedArray(e),n=b["v"].fromTypedArray(t);return Object(f["e"])(n,r,i),t}function j(e,t,i){if(Object(a["j"])(e))return t;Object(n["a"])(D,i);const r=b["u"].fromTypedArray(e),s=b["u"].fromTypedArray(t);return Object(f["a"])(s,r,D),Object(n["h"])(D)||Object(f["c"])(s,s),t}function x(e,t,i){if(Object(a["j"])(e))return t;Object(n["a"])(D,i);const r=b["u"].fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),s=b["u"].fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(Object(f["a"])(s,r,D),Object(n["h"])(D)||Object(f["c"])(s,s),e!==t)for(let a=3;a<e.length;a+=4)t[a]=e[a];return t}function S(e,t,i,r,a){if(!C(r))return m.error("Cannot convert spatial reference to PCPF"),a;w(R.TO_PCPF,b["u"].fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),b["v"].fromTypedArray(t),b["v"].fromTypedArray(i),r,b["u"].fromTypedArray(a,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<e.length;n+=4)a[n]=e[n];return a}function T(e,t,i,r,a){if(!C(r))return m.error("Cannot convert to spatial reference from PCPF"),a;w(R.FROM_PCPF,b["u"].fromTypedArray(e,16),b["v"].fromTypedArray(t),b["v"].fromTypedArray(i),r,b["u"].fromTypedArray(a,16));for(let n=3;n<e.length;n+=4)a[n]=e[n];return a}function w(e,t,i,r,a,s){if(!t)return;const o=i.count,l=Object(h["g"])(a);if(A(a))for(let h=0;h<o;h++)r.getVec(h,E),t.getVec(h,I),Object(d["d"])(l,E,M,l),Object(n["f"])(D,M),e===R.FROM_PCPF&&Object(n["n"])(D,D),Object(c["x"])(I,I,D),s.setVec(h,I);else for(let h=0;h<o;h++){r.getVec(h,E),t.getVec(h,I),Object(d["d"])(l,E,M,l),Object(n["f"])(D,M);const a=Object(p["h"])(i.get(h,1));let o=Math.cos(a);e===R.TO_PCPF&&(o=1/o),D[0]*=o,D[1]*=o,D[2]*=o,D[3]*=o,D[4]*=o,D[5]*=o,e===R.FROM_PCPF&&Object(n["n"])(D,D),Object(c["x"])(I,I,D),Object(c["r"])(I,I),s.setVec(h,I)}return s}function C(e){return A(e)||P(e)}function A(e){return e.isWGS84||Object(u["f"])(e)||Object(u["i"])(e)||Object(u["j"])(e)}function P(e){return e.isWebMercator}var R;!function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"}(R||(R={}));const E=Object(l["f"])(),I=Object(l["f"])(),M=Object(o["d"])(),D=Object(s["b"])()},"461f":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("b2b2"),a=i("d97e"),n=i("9392"),s=i("8152");const o={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,t)=>new n["a"](t,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>(Object(r["j"])(e.centroid)&&(e.centroid=Object(a["a"])(new s["a"],e.geometry,t.hasZ,t.hasM)),e.centroid)}},"47f8":function(e,t,i){"use strict";function r(){return new Float32Array(3)}function a(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function n(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function s(e,t){return new Float32Array(e,t,3)}function o(){return r()}function c(){return n(1,1,1)}function l(){return n(1,0,0)}function d(){return n(0,1,0)}function h(){return n(0,0,1)}i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return n}));const u=o(),p=c(),b=l(),f=d(),m=h();Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:a,fromValues:n,createView:s,zeros:o,ones:c,unitX:l,unitY:d,unitZ:h,ZEROS:u,ONES:p,UNIT_X:b,UNIT_Y:f,UNIT_Z:m},Symbol.toStringTag,{value:"Module"}))},"4c96":function(e,t,i){"use strict";function r(e,t,i){const r=e.typedBuffer,a=e.typedBufferStride,n=t.typedBuffer,s=t.typedBufferStride,o=i?i.count:t.count;let c=(i&&i.dstIndex?i.dstIndex:0)*a,l=(i&&i.srcIndex?i.srcIndex:0)*s;for(let d=0;d<o;++d)r[c]=n[l],r[c+1]=n[l+1],r[c+2]=n[l+2],c+=a,l+=s}function a(e,t,i,r,a){var n,s;const o=e.typedBuffer,c=e.typedBufferStride,l=null!=(n=null==a?void 0:a.count)?n:e.count;let d=(null!=(s=null==a?void 0:a.dstIndex)?s:0)*c;for(let h=0;h<l;++h)o[d]=t,o[d+1]=i,o[d+2]=r,d+=c}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return a}));Object.freeze(Object.defineProperty({__proto__:null,copy:r,fill:a},Symbol.toStringTag,{value:"Module"}))},"4d2d":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("62ae");class a extends r["a"]{constructor(e){super(e,"vec2")}}},"4db9":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("3886");function a(e,t={hasModelTransformation:!1,linearDepth:!1}){if(t.hasModelTransformation)return t.linearDepth?void e.vertex.code.add(r["b"]`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):void e.vertex.code.add(r["b"]`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.linearDepth?e.vertex.code.add(r["b"]`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(r["b"]`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},"4f8b":function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return l}));var r=i("2119"),a=i("e431"),n=i("d18f");i("7361");function s(e){return e?{ray:Object(n["c"])(e.ray),c0:e.c0,c1:e.c1}:{ray:Object(n["c"])(),c0:0,c1:Number.MAX_VALUE}}function o(e,t=s()){return Object(n["b"])(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function c(e,t,i=s()){const r=Object(a["p"])(e.vector);return Object(n["f"])(e.origin,t,i.ray),i.c0=0,i.c1=r,i}function l(e,t){return h(e,e.c0,t)}function d(e,t){return h(e,e.c1,t)}function h(e,t,i){return Object(a["e"])(i,e.ray.origin,Object(a["k"])(i,e.ray.direction,t))}new r["a"](()=>({c0:0,c1:0,ray:null}))},"501b":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("3886");function a(e){e.code.add(r["b"]`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}},5241:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return f})),i.d(t,"c",(function(){return g})),i.d(t,"d",(function(){return m}));var r=i("b2b2"),a=i("afe1"),n=i("0b2d"),s=i("8188"),o=i("4261"),c=i("32ed"),l=i("1a54"),d=i("2e0f"),h=i("ba58"),u=i("5a22");const p=Object(n["f"])();function b(e,t,i,n,c,l,h,b){const f=i?i.length:0,m=e.clippingExtent;if(Object(s["p"])(t,p,e.elevationProvider.spatialReference),Object(r["k"])(m)&&!Object(o["e"])(m,p))return null;Object(s["p"])(t,p,e.renderCoordsHelper.spatialReference);const g=e.localOriginFactory.getOrigin(p),O=new u["a"]({castShadow:!1,metadata:{layerUid:l,graphicUid:h,usesVerticalDistanceToGround:!0}});for(let r=0;r<f;r++){const e=a["a"];O.addGeometry(i[r],n[r],e,g,b)}return{object:O,sampledElevation:Object(d["c"])(O,t,e.elevationProvider,e.renderCoordsHelper,c)}}function f(e,t,i){const r=e.elevationContext,a=i.spatialReference;Object(s["p"])(t,p,a),r.centerPointInElevationSR=Object(l["g"])(p[0],p[1],t.hasZ?p[2]:0,a)}function m(e){switch(e.type){case"point":return e;case"polygon":case"extent":return Object(h["a"])(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const i=Object(c["g"])(t,Object(c["f"])(t)/2);return Object(l["g"])(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.origin}return null}function g(e,t,i,r,a){const n=new Float64Array(3*e.length),s=new Float64Array(n.length);e.forEach((e,t)=>{n[3*t+0]=e[0],n[3*t+1]=e[1],n[3*t+2]=e.length>2?e[2]:0});const o=Object(d["d"])(n,t,0,s,0,n,0,n.length/3,i,r,a),c=null!=o;return{numVertices:e.length,position:n,mapPosition:s,projectionSuccess:c,sampledElevation:o}}},"528f":function(e,t,i){"use strict";i.d(t,"a",(function(){return x})),i.d(t,"b",(function(){return j}));var r=i("0a9e"),a=i("a05b"),n=i("d272"),s=i("e6aa"),o=i("c2d1"),c=i("c6d7"),l=i("3976"),d=i("4377"),h=i("501b"),u=i("8e97"),p=i("d8a4"),b=i("fd48"),f=i("1fe9"),m=i("3886"),g=i("85b3"),O=i("690a"),v=i("6a3c"),y=i("b7c2"),_=i("b7bd");function j(e){const t=new O["a"],i=e.hasMultipassTerrain&&(e.output===a["a"].Color||e.output===a["a"].Alpha);t.include(s["a"],e),e.output===a["a"].Depth&&t.include(o["a"],e);const{vertex:j,fragment:x}=t;return x.include(h["a"]),Object(u["b"])(t,e),t.attributes.add(_["a"].POSITION,"vec3"),t.attributes.add(_["a"].UV0,"vec2"),t.attributes.add(_["a"].AUXPOS1,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),t.varyings.add("linearDepth","float"),i&&t.varyings.add("depth","float"),j.code.add(m["b"]`#define PERPENDICULAR(v) vec2(v.y, -v.x)
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`),j.uniforms.add([new p["a"]("nearFar",(e,t)=>t.camera.nearFar),new b["a"]("viewport",(e,t)=>t.camera.fullViewport)]),j.code.add(m["b"]`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),j.code.add(m["b"]`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
}`),e.draped||(j.uniforms.add(new g["a"]("inverseProjectionMatrix",(e,t)=>t.camera.inverseProjectionMatrix)),j.code.add(m["b"]`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),j.code.add(m["b"]`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),j.uniforms.add(new f["a"]("perScreenPixelRatio",(e,t)=>t.camera.perScreenPixelRatio)),j.code.add(m["b"]`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${e.hasCap?"\n                if(prev.z > posLeft.z) {\n                  vec2 diff = posLeft.xy - posRight.xy;\n                  planeOrigin.xy += PERPENDICULAR(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),j.uniforms.add(new f["a"]("pixelRatio",(e,t)=>t.camera.pixelRatio)),j.code.add(m["b"]`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clip(pos, prev);

        vec4 posScreen = projectAndScale(pos);
        vec4 prevScreen = projectAndScale(prev);

        vec2 segment = posScreen.xy - prevScreen.xy;

        // normalize vector along line segment
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = PERPENDICULAR(segment);
        vec2 displacementDirV = segment;

        float displacementLen = ${m["b"].float(r["a"]/r["b"])} * lineWidth;

        vec4 displacedPosScreen = posScreen;
        displacedPosScreen.xy += uv0.x * displacementDirU * displacementLen + uv0.y * displacementDirV * displacementLen;
  `),e.draped||j.code.add(m["b"]`vec3 posRight = inverseProject(posScreen + vec4(displacementDirU.xy, 0.0, 0.0) * lineWidth);
vec3 posLeft = pos.xyz + (pos.xyz - posRight);
pos = toFront(displacedPosScreen, posLeft, posRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`),j.code.add(m["b"]`
        ${i?"depth = pos.z;":""}
        linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1] and cancel out perspective correct interpolation
        vUV = (uv0 + 1.0) / 2.0;
        vUV *= displacedPosScreen.w;

        vSize = displacementLen;

        vColor = getColor();
        vColor.a *= coverage;

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&t.include(c["b"],e),t.include(n["a"],e),x.uniforms.add([new b["a"]("intrinsicColor",e=>e.color),new v["a"]("tex",e=>e.texture)]),x.include(d["a"]),x.code.add(m["b"]`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${m["b"].float(1/r["a"])};
    vec2 samplePos = vUV * gl_FragCoord.w + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${m["b"].float(l["b"])}) {
      discard;
    }

    ${e.output===a["a"].Alpha?m["b"]`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===a["a"].Color?m["b"]`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===a["a"].Color&&e.transparencyPassType===y["i"].Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===a["a"].Highlight?m["b"]`gl_FragColor = vec4(1.0);`:""}
    ${e.output===a["a"].Depth?m["b"]`outputDepth(linearDepth);`:""}
  }
  `),t}const x=Object.freeze(Object.defineProperty({__proto__:null,build:j},Symbol.toStringTag,{value:"Module"}))},"52b2":function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"}(r||(r={}))},"58c2":function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return p}));var r=i("3349"),a=i("02f1"),n=i("7577"),s=i("0fc4"),o=i("d8a4"),c=i("fd48"),l=i("3886");function d(e){e.fragment.uniforms.add(new c["a"]("projInfo",(e,t)=>h(t))),e.fragment.uniforms.add(new o["a"]("zScale",(e,t)=>p(t))),e.fragment.code.add(l["b"]`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function h(e){const t=e.camera.projectionMatrix;return 0===t[11]?Object(n["l"])(u,2/(e.camera.fullWidth*t[0]),2/(e.camera.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):Object(n["l"])(u,-2/(e.camera.fullWidth*t[0]),-2/(e.camera.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}const u=Object(s["e"])();function p(e){return 0===e.camera.projectionMatrix[11]?Object(r["a"])(b,0,1):Object(r["a"])(b,1,0)}const b=Object(a["c"])()},5957:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return p})),i.d(t,"c",(function(){return b})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return d}));var r=i("d791"),a=i("8190"),n=i("1153"),s=i("b7bd");function o(e,t,i,r){const a=i.typedBuffer,n=i.typedBufferStride,s=e.length;r*=n;for(let o=0;o<s;++o){const i=2*e[o];a[r]=t[i],a[r+1]=t[i+1],r+=n}}function c(e,t,i,r,a){const n=i.typedBuffer,s=i.typedBufferStride,o=e.length;if(r*=s,null==a||1===a)for(let c=0;c<o;++c){const i=3*e[c];n[r]=t[i],n[r+1]=t[i+1],n[r+2]=t[i+2],r+=s}else for(let c=0;c<o;++c){const i=3*e[c];for(let e=0;e<a;++e)n[r]=t[i],n[r+1]=t[i+1],n[r+2]=t[i+2],r+=s}}function l(e,t,i,r,a=1){const n=i.typedBuffer,s=i.typedBufferStride,o=e.length;if(r*=s,1===a)for(let c=0;c<o;++c){const i=4*e[c];n[r]=t[i],n[r+1]=t[i+1],n[r+2]=t[i+2],n[r+3]=t[i+3],r+=s}else for(let c=0;c<o;++c){const i=4*e[c];for(let e=0;e<a;++e)n[r]=t[i],n[r+1]=t[i+1],n[r+2]=t[i+2],n[r+3]=t[i+3],r+=s}}function d(e,t,i,r,a,n=1){if(!i)return void c(e,t,r,a,n);const s=r.typedBuffer,o=r.typedBufferStride,l=e.length,d=i[0],h=i[1],u=i[2],p=i[4],b=i[5],f=i[6],m=i[8],g=i[9],O=i[10],v=i[12],y=i[13],_=i[14];if(a*=o,1===n)for(let c=0;c<l;++c){const i=3*e[c],r=t[i],n=t[i+1],l=t[i+2];s[a]=d*r+p*n+m*l+v,s[a+1]=h*r+b*n+g*l+y,s[a+2]=u*r+f*n+O*l+_,a+=o}else for(let c=0;c<l;++c){const i=3*e[c],r=t[i],l=t[i+1],j=t[i+2],x=d*r+p*l+m*j+v,S=h*r+b*l+g*j+y,T=u*r+f*l+O*j+_;for(let e=0;e<n;++e)s[a]=x,s[a+1]=S,s[a+2]=T,a+=o}}function h(e,t,i,a,n,s=1){if(!i)return void c(e,t,a,n,s);const o=i,l=a.typedBuffer,d=a.typedBufferStride,h=e.length,u=o[0],p=o[1],b=o[2],f=o[4],m=o[5],g=o[6],O=o[8],v=o[9],y=o[10],_=!Object(r["p"])(o),j=1e-6,x=1-j;if(n*=d,1===s)for(let r=0;r<h;++r){const i=3*e[r],a=t[i],s=t[i+1],o=t[i+2];let c=u*a+f*s+O*o,h=p*a+m*s+v*o,S=b*a+g*s+y*o;if(_){const e=c*c+h*h+S*S;if(e<x&&e>j){const t=1/Math.sqrt(e);c*=t,h*=t,S*=t}}l[n+0]=c,l[n+1]=h,l[n+2]=S,n+=d}else for(let r=0;r<h;++r){const i=3*e[r],a=t[i],o=t[i+1],c=t[i+2];let h=u*a+f*o+O*c,S=p*a+m*o+v*c,T=b*a+g*o+y*c;if(_){const e=h*h+S*S+T*T;if(e<x&&e>j){const t=1/Math.sqrt(e);h*=t,S*=t,T*=t}}for(let e=0;e<s;++e)l[n+0]=h,l[n+1]=S,l[n+2]=T,n+=d}}function u(e,t,i,a,n,s=1){if(!i)return void l(e,t,a,n,s);const o=i,c=a.typedBuffer,d=a.typedBufferStride,h=e.length,u=o[0],p=o[1],b=o[2],f=o[4],m=o[5],g=o[6],O=o[8],v=o[9],y=o[10],_=!Object(r["p"])(o),j=1e-6,x=1-j;if(n*=d,1===s)for(let r=0;r<h;++r){const i=4*e[r],a=t[i],s=t[i+1],o=t[i+2],l=t[i+3];let h=u*a+f*s+O*o,S=p*a+m*s+v*o,T=b*a+g*s+y*o;if(_){const e=h*h+S*S+T*T;if(e<x&&e>j){const t=1/Math.sqrt(e);h*=t,S*=t,T*=t}}c[n+0]=h,c[n+1]=S,c[n+2]=T,c[n+3]=l,n+=d}else for(let r=0;r<h;++r){const i=4*e[r],a=t[i],o=t[i+1],l=t[i+2],h=t[i+3];let S=u*a+f*o+O*l,T=p*a+m*o+v*l,w=b*a+g*o+y*l;if(_){const e=S*S+T*T+w*w;if(e<x&&e>j){const t=1/Math.sqrt(e);S*=t,T*=t,w*=t}}for(let e=0;e<s;++e)c[n+0]=S,c[n+1]=T,c[n+2]=w,c[n+3]=h,n+=d}}function p(e,t,i,r,a,n=1){const s=r.typedBuffer,o=r.typedBufferStride,c=e.length;if(a*=o,1===n){if(4===i)for(let l=0;l<c;++l){const i=4*e[l];s[a]=t[i],s[a+1]=t[i+1],s[a+2]=t[i+2],s[a+3]=t[i+3],a+=o}else if(3===i)for(let l=0;l<c;++l){const i=3*e[l];s[a]=t[i],s[a+1]=t[i+1],s[a+2]=t[i+2],s[a+3]=255,a+=o}}else if(4===i)for(let l=0;l<c;++l){const i=4*e[l];for(let e=0;e<n;++e)s[a]=t[i],s[a+1]=t[i+1],s[a+2]=t[i+2],s[a+3]=t[i+3],a+=o}else if(3===i)for(let l=0;l<c;++l){const i=3*e[l];for(let e=0;e<n;++e)s[a]=t[i],s[a+1]=t[i+1],s[a+2]=t[i+2],s[a+3]=255,a+=o}}function b(e,t,i,r,c,l){for(const b of t.fieldNames){const t=e.vertexAttributes.get(b),f=e.indices.get(b);if(t&&f)switch(b){case s["a"].POSITION:{Object(n["a"])(3===t.size);const e=c.getField(b,a["u"]);e&&d(f,t.data,i,e,l);break}case s["a"].NORMAL:{Object(n["a"])(3===t.size);const e=c.getField(b,a["u"]);e&&h(f,t.data,r,e,l);break}case s["a"].UV0:{Object(n["a"])(2===t.size);const e=c.getField(b,a["m"]);e&&o(f,t.data,e,l);break}case s["a"].COLOR:{Object(n["a"])(3===t.size||4===t.size);const e=c.getField(b,a["J"]);e&&p(f,t.data,t.size,e,l);break}case s["a"].SYMBOLCOLOR:{Object(n["a"])(3===t.size||4===t.size);const e=c.getField(b,a["J"]);e&&p(f,t.data,t.size,e,l);break}case s["a"].TANGENT:{Object(n["a"])(4===t.size);const e=c.getField(b,a["C"]);e&&u(f,t.data,r,e,l);break}}}}},"5a22":function(e,t,i){"use strict";i.d(t,"a",(function(){return v}));var r=i("b2b2"),a=i("d791"),n=i("afe1"),s=i("e431"),o=i("0b2d"),c=i("f895"),l=i("680b"),d=i("b7c2"),h=i("003f"),u=i("2765"),p=i("ecd7"),b=i("f2e0");class f{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(e,t,i,r,a,n){this.id=Object(b["a"])(),this.geometry=e,this.material=t,this.transformation=i,this.instanceParameters=r,this.origin=a,this._shaderTransformation=n,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return Object(r["k"])(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&(Object(s["q"])(e,e,this.getStaticTransformation()),!0)}}f.pool=new p["a"](f);var m=i("bea9"),g=i("1153"),O=i("b623");class v extends h["a"]{constructor(e={}){super(),this.type=u["a"].Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Object(n["d"])(),this._bvObjectSpace=new _,this._bvWorldSpace=new _,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==e.castShadow||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new y),this.transformation=Object(n["d"])();const{geometries:t,materials:i,transformations:r,origins:a}=e;if(Array.isArray(t)){Object(g["a"])(i.length===t.length,"Object3D: materials don't match geometries"),Object(g["a"])(r.length===t.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=t.length,this._geometries.length=t.length;for(let e=0;e<t.length;e++)this._geometries[e]=t[e],this._geometryRecords[e]=f.pool.acquire(t[e],i[e],Object(n["c"])(r[e]),{highlights:null,occludees:null,visible:this._visible},a&&a[e])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(e){Object(a["c"])(this._objectTransformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){Object(g["a"])(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e,t,i,a,s){i=i||n["a"],this._geometries.push(e);const o=f.pool.acquire(e,t,i,{highlights:null,occludees:null,visible:this._visible},a,s);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||Object(r["k"])(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}removeGeometry(e){const t=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=Object(r["k"])(t.shaderTransformation)?this._geometryRecords.some(e=>Object(r["k"])(e.shaderTransformation)):this._hasVolatileTransformation,t.dispose(),this._geometries.splice(e,1),this._emit("objectGeometryRemoved",{object:this,record:t}),this._invalidateBoundingVolume(),t}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("vertexAttrsUpdated",{object:this,record:e}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometryRecords)e.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new m["a"](d["d"].MaskOccludee);for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(O["a"])(t.instanceParameters.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(O["e"])(t.instanceParameters.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new m["a"](d["d"].Highlight);for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(O["a"])(t.instanceParameters.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(O["e"])(t.instanceParameters.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return Object(a["m"])(Object(r["s"])(t,Object(n["d"])()),this.transformation,e.getStaticTransformation())}_getCombinedShaderTransformation(e,t){return t=t||Object(n["d"])(),Object(a["m"])(t,this.transformation,e.getShaderTransformation()),t}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let a=0;a<this._geometryRecords.length;++a){const e=this._geometries[a],t=this._geometryRecords[a],i=e.boundingInfo;Object(r["k"])(i)&&(this._calculateTransformedBoundingVolume(i,this._bvObjectSpace,t.getShaderTransformation()),this._calculateTransformedBoundingVolume(i,this._bvWorldSpace,this._getCombinedShaderTransformation(t)))}Object(s["l"])(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),Object(s["l"])(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=Object(o["f"])(),t=Object(o["f"])(),i=Object(l["a"])(this.transformation);for(let a=0;a<this._geometryRecords.length;++a){const n=this._geometries[a].boundingInfo;if(Object(r["j"])(n))continue;const o=this._geometryRecords[a].getShaderTransformation(),c=Object(l["a"])(o);Object(s["q"])(e,n.getCenter(),o);const d=Object(s["m"])(e,this._bvObjectSpace.bounds),h=n.getBSRadius()*c;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],d+h),Object(s["q"])(t,e,this.transformation);const u=Object(s["m"])(t,this._bvWorldSpace.bounds),p=h*i;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],u+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(e,t,i){const r=e.getBBMin(),a=e.getBBMax(),n=Object(o["d"])(r),c=Object(o["d"])(a);Object(s["q"])(n,n,i),Object(s["q"])(c,c,i);for(let s=0;s<3;++s)t.min[s]=Math.min(t.min[s],n[s],c[s]),t.max[s]=Math.max(t.max[s],n[s],c[s]);for(let o=0;o<3;++o){Object(s["g"])(n,r),Object(s["g"])(c,a),n[o]=a[o],c[o]=r[o],Object(s["q"])(n,n,i),Object(s["q"])(c,c,i);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],n[e],c[e]),t.max[e]=Math.max(t.max[e],n[e],c[e])}}_invalidateBoundingVolume(){this._bvDirty=!0,Object(r["k"])(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,t){Object(r["k"])(this._parentLayer)&&this._parentLayer.events.emit(e,t)}get test(){const e=this;return{hasGeometry:t=>e._geometries.includes(t),getGeometryIndex:t=>e._geometries.indexOf(t)}}}class y{constructor(){this.min=Object(o["h"])(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Object(o["h"])(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class _ extends y{constructor(){super(...arguments),this.bounds=Object(c["c"])()}init(){Object(s["w"])(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Object(s["w"])(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Object(c["a"])(this.bounds)}}},"5d5f":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("3886");function a(e){const t=e.fragment.code;t.add(r["b"]`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(r["b"]`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(r["b"]`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var n=i("a7d7"),s=i("c51b");function o(e,t){const i=e.fragment.code;e.include(s["a"]),t.pbrMode===n["a"].Water||t.pbrMode===n["a"].WaterOnIntegratedMesh?(i.add(r["b"]`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),i.add(r["b"]`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(r["b"]`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(r["b"]`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(r["b"]`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):t.pbrMode!==n["a"].Normal&&t.pbrMode!==n["a"].Schematic||(e.include(a),i.add(r["b"]`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(r["b"]`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(r["b"]`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),i.add(r["b"]`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(r["b"]`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(r["b"]`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}},"5d7f":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("62ae");class a extends r["a"]{constructor(e){super(e,"sampler2D")}}},6061:function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var r=i("b2b2"),a=i("f2e0"),n=i("d791"),s=i("afe1"),o=i("e431"),c=i("0fc4"),l=i("680b"),d=i("b7c2"),h=i("1038");class u{constructor(){this.visible=!0}}var p=i("bea9"),b=i("b7bd"),f=i("b623");class m{constructor(e,t,i={}){this.data=e,this.material=t,this.boundingSphere=Object(c["e"])(),this.instanceParameters=new u,this._transformation=Object(s["d"])(),this._shaderTransformationDirty=!0,this.layerUid=Object(r["s"])(i.layerUid,null),this.graphicUid=Object(r["s"])(i.graphicUid,null),this.id=i.id?i.id:Object(a["a"])(),this.boundingInfo=Object(r["s"])(i.boundingInfo,null),this.calculateShaderTransformation=Object(r["s"])(i.calculateShaderTransformation,null),this.castShadow=!!i.castShadow&&i.castShadow}get transformation(){return this._transformation}updateTransformation(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(e,t,i=Object(l["a"])(e)){Object(r["j"])(this.boundingInfo)||(Object(o["q"])(t,this.boundingInfo.getCenter(),e),t[3]=this.boundingInfo.getBSRadius()*i)}get hasShaderTransformation(){return Object(r["k"])(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return Object(r["j"])(this.calculateShaderTransformation)?Object(r["s"])(this.transformation,s["a"]):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Object(s["d"])()),Object(n["c"])(this._shaderTransformation,this.calculateShaderTransformation(Object(r["s"])(this.transformation,s["a"]))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(Object(r["k"])(this._transformation)&&Object(o["q"])(e,e,this._transformation),!0);const t=this.indices.get(b["a"].POSITION),i=this.vertexAttributes.get(b["a"].POSITION);return!!Object(h["c"])(i,t,e)&&(Object(r["k"])(this._transformation)&&Object(o["q"])(e,e,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const e=new p["a"](d["d"].Highlight),t=this.instanceParameters;return t.highlights=Object(f["a"])(t.highlights,e),e}removeHighlight(e){const t=this.instanceParameters;t.highlights=Object(f["e"])(t.highlights,e)}}},"614d":function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_ALPHA=1]="MATERIAL_ALPHA",e[e.MATERIAL_DEPTH=2]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=3]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL",e[e.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT",e[e.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT",e[e.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT"}(r||(r={}))},"62ae":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("b2b2"),a=i("52b2");class n{constructor(e,t,i,n,s=null){this.name=e,this.type=t,this.arraySize=s,this.bind={[a["a"].Pass]:null,[a["a"].Draw]:null},Object(r["k"])(i)&&Object(r["k"])(n)&&(this.bind[i]=n)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}}},6415:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("e92d");const a=r["a"].getLogger("esri.views.3d.support.buffer.math")},"648c":function(e,t,i){"use strict";var r,a;i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return a})),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(r||(r={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(a||(a={}))},6611:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("a4ee"),a=i("fc29"),n=i("59b2"),s=(i("b50f"),i("c120"),i("cea0"),i("d386"));let o=class extends a["a"]{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};Object(r["a"])([Object(n["b"])()],o.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"DECONFLICTOR_SHOW_GRID",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"LABELS_SHOW_BORDER",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"TEXT_SHOW_BASELINE",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"TEXT_SHOW_BORDER",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"OVERLAY_SHOW_CENTER",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"SHOW_POI",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"I3S_TREE_SHOW_TILES",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"I3S_SHOW_MODIFICATIONS",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),Object(r["a"])([Object(n["b"])()],o.prototype,"LINE_WIREFRAMES",void 0),o=Object(r["a"])([Object(s["a"])("esri.views.3d.support.DebugFlags")],o);const c=new o},"661c":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));var r=i("38a4");function a(e,t,i=0){const a=Object(r["e"])(e,0,c);for(let r=0;r<4;r++)t[i+r]=Math.floor(256*l(a*s[r]))}function n(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*o[r];return i}const s=[1,256,65536,16777216],o=[1/256,1/65536,1/16777216,1/4294967296],c=n(new Uint8ClampedArray([255,255,255,255]));function l(e){return e-Math.floor(e)}},"668b":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return s})),i.d(t,"e",(function(){return a}));var r=i("6415");function a(e,t,i){if(e.count!==t.count)return void r["a"].error("source and destination buffers need to have the same number of elements");const a=e.count,n=i[0],s=i[1],o=i[2],c=i[4],l=i[5],d=i[6],h=i[8],u=i[9],p=i[10],b=i[12],f=i[13],m=i[14],g=e.typedBuffer,O=e.typedBufferStride,v=t.typedBuffer,y=t.typedBufferStride;for(let r=0;r<a;r++){const e=r*O,t=r*y,i=v[t],a=v[t+1],_=v[t+2];g[e]=n*i+c*a+h*_+b,g[e+1]=s*i+l*a+u*_+f,g[e+2]=o*i+d*a+p*_+m}}function n(e,t,i){if(e.count!==t.count)return void r["a"].error("source and destination buffers need to have the same number of elements");const a=e.count,n=i[0],s=i[1],o=i[2],c=i[3],l=i[4],d=i[5],h=i[6],u=i[7],p=i[8],b=e.typedBuffer,f=e.typedBufferStride,m=t.typedBuffer,g=t.typedBufferStride;for(let r=0;r<a;r++){const e=r*f,t=r*g,i=m[t],a=m[t+1],O=m[t+2];b[e]=n*i+c*a+h*O,b[e+1]=s*i+l*a+u*O,b[e+2]=o*i+d*a+p*O}}function s(e,t,i){const r=Math.min(e.count,t.count),a=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,o=t.typedBufferStride;for(let c=0;c<r;c++){const e=c*n,t=c*o;a[e]=i*s[t],a[e+1]=i*s[t+1],a[e+2]=i*s[t+2]}}function o(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,a=e.typedBufferStride,n=t.typedBuffer,s=t.typedBufferStride;for(let o=0;o<i;o++){const e=o*a,t=o*s,i=n[t],c=n[t+1],l=n[t+2],d=i*i+c*c+l*l;if(d>0){const t=1/Math.sqrt(d);r[e]=t*i,r[e+1]=t*c,r[e+2]=t*l}}}function c(e,t,i){const r=Math.min(e.count,t.count),a=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,o=t.typedBufferStride;for(let c=0;c<r;c++){const e=c*n,t=c*o;a[e]=s[t]>>i,a[e+1]=s[t+1]>>i,a[e+2]=s[t+2]>>i}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:a,transformMat3:n,scale:s,normalize:o,shiftRight:c},Symbol.toStringTag,{value:"Module"}))},6750:function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var r=i("501b"),a=i("8e97"),n=i("fd48"),s=i("1fe9"),o=i("8a80"),c=i("3886"),l=i("5d7f"),d=i("b2b2"),h=i("7577"),u=i("0fc4");function p(e){return Object(d["j"])(e)?u["b"]:4===e.length?e:Object(h["l"])(b,e[0],e[1],e[2],1)}const b=Object(u["e"])();function f(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?m(e,t):g(e)}function m(e,t){const i=!(t.draped&&t.stipplePreferContinuous),{vertex:d,fragment:h}=e;h.include(r["a"]),d.uniforms.add(new o["a"]("stipplePatternPixelSize")),t.draped||(Object(a["a"])(d,t),d.uniforms.add(new s["a"]("worldToScreenPerDistanceRatio",(e,t)=>1/t.camera.perScreenPixelRatio)),d.code.add(c["b"]`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),d.code.add(c["b"]`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${O};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),d.code.add(c["b"]`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),d.code.add(c["b"]`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),d.uniforms.add(new s["a"]("pixelRatio",(e,t)=>t.camera.pixelRatio)),d.code.add(c["b"]`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?c["b"]`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),h.uniforms.add(new l["a"]("stipplePatternTexture")),h.uniforms.add(new o["a"]("stipplePatternSDFNormalizer")),h.uniforms.add(new o["a"]("stipplePatternTextureSize")),h.uniforms.add(new o["a"]("stipplePatternPixelSizeInv")),h.code.add(c["b"]`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),h.code.add(c["b"]`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?c["b"]`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:c["b"]`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?c["b"]`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?c["b"]`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:c["b"]`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?c["b"]`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:c["b"]`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(h.uniforms.add(new n["a"]("stippleOffColor",e=>p(e.stippleOffColor))),h.code.add(c["b"]`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):h.code.add(c["b"]`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function g(e){e.fragment.code.add(c["b"]`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}const O=c["b"].float(.4)},"680b":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return o}));i("38a4");var r=i("e431"),a=i("0b2d");function n(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],r=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}function s(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),a=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),n=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return Object(r["w"])(e,i,a,n),e}function o(e,t,i){Math.abs(e[0])>Math.abs(e[1])?Object(r["w"])(t,0,1,0):Object(r["w"])(t,1,0,0),Object(r["j"])(i,e,t),Object(r["r"])(t,t),Object(r["j"])(t,i,e),Object(r["r"])(i,i)}function c(e,t,i,a){Object(r["f"])(l,t,e),Object(r["f"])(d,i,e),Object(r["j"])(a,l,d),Object(r["r"])(a,a),a[3]=-Object(r["i"])(e,a)}const l=Object(a["f"])(),d=Object(a["f"])();Object(a["f"])(),Object(a["f"])(),Object(a["f"])()},"690a":function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("ce50"),a=i("e92d"),n=i("b2b2");const s=a["a"].getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class o{constructor(){this.includedModules=new Map}include(e,t){if(this.includedModules.has(e)){const i=this.includedModules.get(e);if(i!==t){s.error("Trying to include shader module multiple times with different sets of options.");const t=new Set;for(const r of Object.keys(i))i[r]!==e[r]&&t.add(r);for(const r of Object.keys(e))i[r]!==e[r]&&t.add(r);t.forEach(t=>console.error(`  ${t}: current ${i[t]} new ${e[t]}`))}}else this.includedModules.set(e,t),e(this.builder,t)}}class c extends o{constructor(){super(...arguments),this.vertex=new h,this.fragment=new h,this.attributes=new u,this.varyings=new p,this.extensions=new b,this.constants=new f}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const t=this.extensions.generateSource(e),i=this.attributes.generateSource(e),r=this.varyings.generateSource(),a="vertex"===e?this.vertex:this.fragment,n=a.uniforms.generateSource(),s=a.code.generateSource(),o="vertex"===e?g:m,c=this.constants.generateSource().concat(a.constants.generateSource());return`\n${t.join("\n")}\n\n${o}\n\n${c.join("\n")}\n\n${n.join("\n")}\n\n${i.join("\n")}\n\n${r.join("\n")}\n\n${s.join("\n")}`}generateBind(e,t){const i=new Map;this.vertex.uniforms.entries.forEach(t=>{const r=t.bind[e];Object(n["k"])(r)&&i.set(t.name,r)}),this.fragment.uniforms.entries.forEach(t=>{const r=t.bind[e];Object(n["k"])(r)&&i.set(t.name,r)});const r=Array.from(i.values()),a=r.length;return(e,i)=>{for(let n=0;n<a;++n)r[n](t,e,i)}}}class l{constructor(){this._entries=new Map}add(e){if(!Array.isArray(e))return this._add(e);for(const t of e)this._add(t)}_add(e){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new r["a"](`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}generateSource(){return Array.from(this._entries.values()).map(e=>Object(n["k"])(e.arraySize)?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}}class d{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}}class h extends o{constructor(){super(...arguments),this.uniforms=new l,this.code=new d,this.constants=new f}get builder(){return this}}class u{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map(e=>`attribute ${e[1]} ${e[0]};`)}}class p{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(){return this._entries.map(e=>`varying ${e[1]} ${e[0]};`)}}class b{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?b.ALLOWLIST_VERTEX:b.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(e=>t.includes(e)).map(e=>`#extension ${e} : enable`)}}b.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],b.ALLOWLIST_VERTEX=[];class f{constructor(){this._entries=new Set}add(e,t,i){let r="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":r=f._numberToFloatStr(i);break;case"int":r=f._numberToIntStr(i);break;case"bool":r=i.toString();break;case"vec2":r=`vec2(${f._numberToFloatStr(i[0])},                            ${f._numberToFloatStr(i[1])})`;break;case"vec3":r=`vec3(${f._numberToFloatStr(i[0])},                            ${f._numberToFloatStr(i[1])},                            ${f._numberToFloatStr(i[2])})`;break;case"vec4":r=`vec4(${f._numberToFloatStr(i[0])},                            ${f._numberToFloatStr(i[1])},                            ${f._numberToFloatStr(i[2])},                            ${f._numberToFloatStr(i[3])})`;break;case"ivec2":r=`ivec2(${f._numberToIntStr(i[0])},                             ${f._numberToIntStr(i[1])})`;break;case"ivec3":r=`ivec3(${f._numberToIntStr(i[0])},                             ${f._numberToIntStr(i[1])},                             ${f._numberToIntStr(i[2])})`;break;case"ivec4":r=`ivec4(${f._numberToIntStr(i[0])},                             ${f._numberToIntStr(i[1])},                             ${f._numberToIntStr(i[2])},                             ${f._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":r=`${t}(${Array.prototype.map.call(i,e=>f._numberToFloatStr(e)).join(", ")})`}return this._entries.add(`const ${t} ${e} = ${r};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const m="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",g="precision highp float;\nprecision highp sampler2D;"},"6a07":function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));i("02f1");var r=i("0fc4"),a=i("d8a4"),n=i("3886"),s=i("6a3c");const o=Object(r["g"])(1,1,0,1),c=Object(r["g"])(1,0,1,1);function l(e){e.fragment.uniforms.add(new s["a"]("depthTex",(e,t)=>t.highlightDepthTexture)),e.fragment.uniforms.add(new a["a"]("highlightViewportPixelSz",(e,t)=>t.inverseViewport)),e.fragment.constants.add("occludedHighlightFlag","vec4",o).add("unoccludedHighlightFlag","vec4",c),e.fragment.code.add(n["b"]`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, fragCoord.xy * highlightViewportPixelSz.xy).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}n["a"]},"6a21":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s}));var r=i("c120"),a=i("3886");function n({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(a["b"]`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(a["b"]`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function s(e){return!!Object(r["a"])("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}},"6a3c":function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return d}));var r=i("b2b2"),a=i("3349"),n=i("02f1"),s=i("d8a4"),o=i("62ae"),c=i("52b2");class l extends o["a"]{constructor(e,t){super(e,"sampler2D",c["a"].Pass,(i,r,a)=>i.bindTexture(e,t(r,a)))}}function d(e,t,i){const o=[new l(e,t)];if(i){const i=e+"Size";o.push(new s["a"](i,(e,i)=>{const s=t(e,i);return Object(r["k"])(s)?Object(a["a"])(h,s.descriptor.width,s.descriptor.height):n["b"]}))}return o}const h=Object(n["c"])()},"6cb2":function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i("caf1e"),a=i("3886");function n(e){e.vertex.code.add(a["b"]`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${a["b"].int(r["a"].Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${a["b"].int(r["a"].Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${a["b"].int(r["a"].Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${a["b"].int(r["a"].Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}var s=i("79a1"),o=i("b7bd"),c=i("7c51");function l(e,t){t.hasSymbolColors?(e.include(n),e.attributes.add(o["a"].SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(a["b"]`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new s["a"]("colorMixMode",e=>c["a"][e.colorMixMode])),e.vertex.code.add(a["b"]`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}},"6d35":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("a4ee"),a=i("52b2"),n=i("da35");class s extends n["a"]{}Object(r["a"])([Object(n["b"])({constValue:!0})],s.prototype,"hasSliceHighlight",void 0),Object(r["a"])([Object(n["b"])({constValue:!1})],s.prototype,"hasSliceInVertexProgram",void 0),Object(r["a"])([Object(n["b"])({constValue:!1})],s.prototype,"instancedDoublePrecision",void 0),Object(r["a"])([Object(n["b"])({constValue:!1})],s.prototype,"isGround",void 0),Object(r["a"])([Object(n["b"])({constValue:a["a"].Pass})],s.prototype,"pbrTextureBindType",void 0)},"6d5b":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886"),a=i("b7bd");function n(e,t){t.hasVertexColors?(e.attributes.add(a["a"].COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(r["b"]`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(r["b"]`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(r["b"]`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},7079:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i("d047"),a=i("9617"),n=i("501b"),s=i("d8a4"),o=i("3886"),c=i("6a3c");function l(e,t){const{vertex:i,fragment:l}=e;t.hasMultipassGeometry&&i.include(a["b"]),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.code.add(o["b"]`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.hasMultipassGeometry?o["b"]`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.hasMultipassTerrain&&l.include(r["a"]),t.hasMultipassTerrain&&l.uniforms.add([new c["a"]("terrainDepthTexture",(e,t)=>t.multipassTerrain.linearDepthTexture),new s["a"]("nearFar",(e,t)=>t.camera.nearFar),new s["a"]("inverseViewport",(e,t)=>t.inverseViewport)]),l.include(n["a"]),l.code.add(o["b"]`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.hasMultipassTerrain?o["b"]`
          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}},7088:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("7577"),a=i("0fc4"),n=i("fd48"),s=i("3886"),o=i("6a3c");function c(e,t){const i=e.fragment;t.receiveAmbientOcclusion?(i.uniforms.add([new o["a"]("ssaoTex",(e,t)=>t.ssaoHelper.colorTexture),new n["a"]("viewportPixelSz",(e,t)=>Object(r["l"])(l,t.camera.fullViewport[0],t.camera.fullViewport[1],1/t.ssaoHelper.width,1/t.ssaoHelper.height))]),i.code.add(s["b"]`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
return texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}`)):i.code.add(s["b"]`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)}const l=Object(a["e"])()},"713b":function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return m}));var r=i("a05b"),a=i("d272"),n=i("4db9"),s=i("6d5b"),o=i("6a07"),c=i("6750"),l=i("3976"),d=i("8e97"),h=i("fd48"),u=i("1fe9"),p=i("3886"),b=i("690a"),f=i("b7bd");function m(e){const t=new b["a"];t.include(n["a"]),t.include(s["a"],e),t.include(c["a"],e),Object(d["b"])(t,e);const{vertex:i,fragment:m}=t;return e.stippleEnabled&&(t.attributes.add(f["a"].UV0,"vec2"),t.attributes.add(f["a"].AUXPOS1,"vec3"),i.uniforms.add(new h["a"]("viewport",(e,t)=>t.camera.fullViewport))),t.attributes.add(f["a"].POSITION,"vec3"),t.varyings.add("vpos","vec3"),i.code.add(p["b"]`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(i.code.add(p["b"]`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped?i.uniforms.add(new u["a"]("worldToScreenRatio",(e,t)=>1/t.screenToPCSRatio)):i.code.add(p["b"]`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(p["b"]`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?i.code.add(p["b"]`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):i.code.add(p["b"]`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.code.add(p["b"]`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),i.code.add(p["b"]`}`),e.output===r["a"].Highlight&&t.include(o["a"]),t.include(a["a"],e),m.uniforms.add(new u["a"]("alphaCoverage",(e,t)=>Math.min(1,e.width*t.camera.pixelRatio))),e.hasVertexColors||m.uniforms.add(new h["a"]("constantColor",e=>e.color)),m.code.add(p["b"]`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${p["b"].float(l["b"])}) {
      discard;
    }

    ${e.output===r["a"].Color?p["b"]`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===r["a"].Highlight?p["b"]`outputHighlight();`:""}
  }
  `),t}const g=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}))},7289:function(e,t,i){"use strict";i.d(t,"a",(function(){return I})),i.d(t,"b",(function(){return M})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return m})),i.d(t,"f",(function(){return f})),i.d(t,"g",(function(){return b})),i.d(t,"h",(function(){return p})),i.d(t,"i",(function(){return T})),i.d(t,"j",(function(){return w})),i.d(t,"k",(function(){return A})),i.d(t,"l",(function(){return P})),i.d(t,"m",(function(){return C})),i.d(t,"n",(function(){return E})),i.d(t,"o",(function(){return R})),i.d(t,"p",(function(){return S})),i.d(t,"q",(function(){return G})),i.d(t,"r",(function(){return D})),i.d(t,"s",(function(){return L})),i.d(t,"t",(function(){return x})),i.d(t,"u",(function(){return F})),i.d(t,"v",(function(){return h}));var r=i("38a4"),a=i("b2b2"),n=i("e431"),s=i("0b2d"),o=(i("f895"),i("a1b1")),c=i("7361"),l=i("680b");function d(e=V){return[e[0],e[1],e[2],e[3]]}function h(e=V[0],t=V[1],i=V[2],r=V[3]){return p(e,t,i,r,c["e"].get())}function u(e,t){return p(t[0],t[1],t[2],t[3],e)}function p(e,t,i,r,a=d()){return a[0]=e,a[1]=t,a[2]=i,a[3]=r,a}function b(e,t,i){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],a=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=t[0]*a,i[1]=t[1]*a,i[2]=t[2]*a,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function f(e,t,i,r=d()){const a=i[0]-t[0],n=i[1]-t[1],s=i[2]-t[2],o=e[0]-t[0],c=e[1]-t[1],l=e[2]-t[2],h=n*l-s*c,u=s*o-a*l,p=a*c-n*o,b=h*h+u*u+p*p,f=Math.abs(b-1)>1e-5&&b>1e-12?1/Math.sqrt(b):1;return r[0]=h*f,r[1]=u*f,r[2]=p*f,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function m(e,t,i,r,a){if(e.count<3)return!1;e.getVec(i,O);let s=r,o=!1;for(;s<e.count-1&&!o;)e.getVec(s,v),s++,o=!Object(n["o"])(O,v);if(!o)return!1;for(s=Math.max(s,a),o=!1;s<e.count&&!o;)e.getVec(s,y),s++,Object(n["f"])(_,O,v),Object(n["r"])(_,_),Object(n["f"])(j,v,y),Object(n["r"])(j,j),o=!Object(n["o"])(O,y)&&!Object(n["o"])(v,y)&&Math.abs(Object(n["i"])(_,j))<g;return o?(f(O,v,y,t),!0):(0!==i||1!==r||2!==a)&&m(e,t,0,1,2)}const g=.99619469809,O=Object(s["f"])(),v=Object(s["f"])(),y=Object(s["f"])(),_=Object(s["f"])(),j=Object(s["f"])();function x(e,t,i){return t!==e&&u(e,t),e[3]=-Object(n["i"])(G(e),i),e}function S(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function T(e,t,i,r){return Object(n["j"])(y,t,e),b(i,y,r)}function w(e,t,i,r){return z(e,t,Object(n["f"])(c["d"].get(),i,t),B,r)}function C(e,t,i){return!!Object(a["k"])(t)&&z(e,t.origin,t.direction,k,i)}function A(e,t,i){return z(e,t.origin,t.vector,U.NONE,i)}function P(e,t,i){return z(e,t.origin,t.vector,U.CLAMP,i)}function R(e,t){return F(e,t)>=0}function E(e,t){const i=t[0],r=t[1],a=t[2],n=t[3],s=t[4],o=t[5];return e[0]*(e[0]>0?i:n)+e[1]*(e[1]>0?r:s)+e[2]*(e[2]>0?a:o)+e[3]>=0}function I(e,t){const i=Object(n["i"])(G(e),t.ray.direction),r=-F(e,t.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const a=r/i;return i>0?a<t.c1&&(t.c1=a):a>t.c0&&(t.c0=a),t.c0<=t.c1}function M(e,t){const i=Object(n["i"])(G(e),t.ray.direction),r=-F(e,t.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const a=r/i;return i>0?a<t.c1&&(t.c1=a):a>t.c0&&(t.c0=a),t.c0<=t.c1}function D(e,t,i){const r=Object(n["k"])(c["d"].get(),G(e),-e[3]),a=N(e,Object(n["f"])(c["d"].get(),t,r),c["d"].get());return Object(n["e"])(i,a,r),i}function L(e,t,i,r){const a=G(e),s=c["d"].get(),d=c["d"].get();Object(l["d"])(a,s,d);const h=Object(n["f"])(c["d"].get(),i,t),u=Object(o["d"])(s,h),p=Object(o["d"])(d,h),b=Object(o["d"])(a,h);return Object(n["w"])(r,u,p,b)}function N(e,t,i){const r=Object(n["k"])(c["d"].get(),G(e),Object(n["i"])(G(e),t));return Object(n["f"])(i,t,r),i}function F(e,t){return Object(n["i"])(G(e),t)+e[3]}function z(e,t,i,a,s){const o=Object(n["i"])(G(e),i);if(0===o)return!1;let c=-(Object(n["i"])(G(e),t)+e[3])/o;return a&U.CLAMP&&(c=Object(r["e"])(c,0,1)),!(!(a&U.INFINITE_MIN)&&c<0||!(a&U.INFINITE_MAX)&&c>1)&&(Object(n["e"])(s,t,Object(n["k"])(s,i,c)),!0)}function G(e){return e}const V=[0,0,1,0];var U;!function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"}(U||(U={}));const B=U.INFINITE_MIN|U.INFINITE_MAX,k=U.INFINITE_MAX},7438:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return s})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return l})),i.d(t,"g",(function(){return b})),i.d(t,"h",(function(){return d}));var r=i("b7c2"),a=i("d17d"),n=i("189c");const s=Object(n["g"])(a["b"].SRC_ALPHA,a["b"].ONE,a["b"].ONE_MINUS_SRC_ALPHA,a["b"].ONE_MINUS_SRC_ALPHA),o=Object(n["h"])(a["b"].ONE,a["b"].ONE),c=Object(n["h"])(a["b"].ZERO,a["b"].ONE_MINUS_SRC_ALPHA);function l(e){return e===r["i"].FrontFace?null:e===r["i"].Alpha?c:o}function d(e){return e===r["i"].FrontFace?n["d"]:null}const h=5e5,u={factor:-1,units:-2};function p(e){return e?u:null}function b(e,t=a["h"].LESS){return e===r["i"].NONE||e===r["i"].FrontFace?t:a["h"].LEQUAL}},"748f":function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r=i("ce6d"),a=i("af40"),n=i("b2b2"),s=i("8a44"),o=i("b7c2"),c=i("003f"),l=i("2765");const d=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];var h=i("0bde");class u extends c["a"]{constructor(e,t=""){var i,n,c;super(),this.apiLayerUid=t,this.type=l["a"].Layer,this.events=new r["a"],this.isSliceable=!1,this._objects=new s["a"],this._stageHandles=new a["a"],this.apiLayerUid=t,this.isVisible=null==(i=null==e?void 0:e.isVisible)||i,this.isPickable=null==(n=null==e?void 0:e.isPickable)||n,this.updatePolicy=null!=(c=null==e?void 0:e.updatePolicy)?c:o["j"].ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const t of d)this._stageHandles.add(this.events.on(t,i=>e.handleEvent(t,i)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),Object(n["k"])(this._octree)&&this._octree.add([e])}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),Object(n["k"])(this._octree)&&this._octree.remove([e]))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),Object(n["k"])(this._octree)&&this._octree.add(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),Object(n["k"])(this._octree)&&this._octree.remove(t)}}sync(){Object(n["k"])(this._stage)&&this.updatePolicy!==o["j"].SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){Object(n["k"])(this._octree)&&this._octree.update(e,t)}getSpatialQueryAccelerator(){return Object(n["j"])(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Object(n["d"])(this._octree)}_createOctree(){this._octree=new h["a"](e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}},7585:function(e,t,i){"use strict";i.d(t,"a",(function(){return ji}));var r,a=i("a4ee"),n=i("fc29"),s=i("ce6d"),o=i("af40"),c=i("28eb"),l=i("b2b2"),d=i("8a44"),h=i("477c"),u=i("c47a"),p=i("59b2"),b=(i("b50f"),i("c120"),i("cea0"),i("d386")),f=i("d791"),m=i("0b2d"),g=i("3c9c"),O=i("648c"),v=i("6611"),y=i("9b8b"),_=i("38a4"),j=i("9180"),x=i("b7c2"),S=i("f643");!function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded"}(r||(r={}));class T{constructor(e,t){this.index=e,this.renderTargets=t,this._extent=Object(j["k"])(),this.resolution=0,this.renderLocalOrigin=Object(S["a"])(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new w,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(t.renderTargets.length).fill(!1)}get extent(){return this._extent}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const t=e===r.ColorAndWater?this.renderTargets.getTarget(y["c"].Color):e===r.Highlight?this.renderTargets.getTarget(y["c"].Highlight):this.renderTargets.getTarget(y["c"].Occluded);return t?t.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(y["c"].ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(y["c"].Color):null}getNormalTexture(e){const t=e===r.ColorAndWater?this.renderTargets.getTarget(y["c"].Water):null;return t?t.getTexture():null}draw(e,t){const i=this.computeRenderTargetValidityBitfield();for(const r of this.renderTargets.renderTargets)r.type!==y["c"].ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[r.type]=e.drawTarget(this,r,t):this.validTargets[r.type]=!1;return i^this.computeRenderTargetValidityBitfield()?x["k"].CHANGED:x["k"].UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[y["c"].Color]|+e[y["c"].ColorNoRasterImage]<<1|+e[y["c"].Highlight]<<2|+e[y["c"].Water]<<3|+e[y["c"].Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(j["t"])(this._extent,e.range,0,t)}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(j["t"])(this._extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Object(j["j"])(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===y["b"].INNER?0:this.resolution,0,this.resolution,this.resolution)}}class w{constructor(){this.extents=[Object(j["k"])(),Object(j["k"])(),Object(j["k"])()],this.numViews=0}}var C=i("738e"),A=i("d17d"),P=i("d267");class R{constructor(e,t){this.size=Object(C["a"])(),this._fbo=null,this._fbo=new P["a"](e,{colorTarget:A["y"].TEXTURE,depthStencilTarget:A["m"].NONE},{target:A["A"].TEXTURE_2D,pixelFormat:A["p"].RGBA,dataType:A["q"].UNSIGNED_BYTE,wrapMode:A["B"].CLAMP_TO_EDGE,samplingMode:A["z"].LINEAR_MIPMAP_LINEAR,hasMipmap:t,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=Object(l["e"])(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return null!==this._fbo}resize(e,t){this.size[0]=e,this.size[1]=t,this._fbo.resize(this.size[0],this.size[1])}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var e;null==(e=this._fbo)||e.resize(0,0)}get gpuMemoryUsage(){var e,t;return null!=(e=null==(t=this._fbo)?void 0:t.gpuMemoryUsage)?e:0}}var E=i("614d");class I{constructor(e){const t=(t,i,r=!0)=>({type:i,fbo:new R(e,r),renderPass:t,valid:!1,lastUsed:1/0});this.renderTargets=[t(E["a"].MATERIAL,y["c"].Color),t(E["a"].MATERIAL,y["c"].ColorNoRasterImage),t(E["a"].MATERIAL_HIGHLIGHT,y["c"].Highlight,!1),t(E["a"].MATERIAL_NORMAL,y["c"].Water),t(E["a"].MATERIAL,y["c"].Occluded)]}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,t,i){if(e)t.lastUsed=i;else if(i-t.lastUsed>M)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((e,t)=>e+t.fbo.gpuMemoryUsage,0)}}const M=1e3;var D=i("f9d0");class L{constructor(e){this._context=e,this._perConstructorInstances=new D["a"],this._frameCounter=0,this._keepAliveFrameCount=F}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(e=>e.forEach(e=>e.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,t){const i=t.key;let r=this._perConstructorInstances.get(e,i);if(Object(l["j"])(r)){const a=new e(this._context,t,()=>this.release(a));r=new N(a),this._perConstructorInstances.set(e,i,r)}return++r.refCount,r.technique}releaseAndAcquire(e,t,i){if(Object(l["k"])(i)){if(t.key===i.key)return i;this.release(i)}return this.acquire(e,t)}release(e){if(Object(l["j"])(e)||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);Object(l["j"])(t)||(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==F&&this._perConstructorInstances.forEach((e,t)=>{e.forEach((e,i)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,i))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((t,i)=>{const r=async(e,t)=>{const i=t.shader;i&&(await i.reload(),e.forEach(e=>{e.technique.reload(this._context)}))};e.push(r(t,i))}),await Promise.all(e)}}class N{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}const F=-1,z=e=>{class t extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){for(const t of null!=(e=this._managedDisposables)?e:[]){var e;const i=this[t];this[t]=null,i&&"function"==typeof i.dispose&&i.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}}return t};z(class{});function G(){return(e,t)=>{var i,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=null!=(i=null==(r=e._managedDisposables)?void 0:r.slice())?i:[]),e._managedDisposables.unshift(t)}}var V=i("171c"),U=i("e92d"),B=i("1153");const k=U["a"].getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class H{constructor(e,t,i,r){this._textureRepository=e,this._techniqueRepository=t,this.materialChanged=i,this.requestRender=r,this._id2glMaterialRef=new D["a"]}dispose(){this._textureRepository.dispose()}acquire(e,t){this._ownMaterial(e);let i=this._id2glMaterialRef.get(t,e.id);if(Object(l["j"])(i)){const r=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:t});i=new W(r),this._id2glMaterialRef.set(t,e.id,i)}return i.ref(),i.glMaterial}release(e,t){const i=this._id2glMaterialRef.get(t,e.id);Object(l["k"])(i)&&(i.unref(),i.referenced||(Object(l["e"])(i.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){Object(l["k"])(e.repository)&&e.repository!==this&&k.error("Material is already owned by a different material repository"),e.repository=this}}class W{constructor(e){this.glMaterial=e,this.refCnt=0}ref(){++this.refCnt}unref(){--this.refCnt,Object(B["a"])(this.refCnt>=0)}get referenced(){return this.refCnt>0}}var q=i("d5f7"),$=i("adf1"),X=i("35b3"),Y=i("02f1"),Z=i("7bf3"),J=i("9617"),Q=i("c6d7"),K=i("df77"),ee=i("badc"),te=i("2245");class ie{constructor(e,t,i){this.shadowMap=e,this.ssaoHelper=t,this.slicePlane=i,this.slot=ee["a"].OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this._inverseViewport=Object(Y["c"])(),this.lighting=new te["a"],this.ssr=new K["a"],this.multipassTerrain=new Q["a"],this.multipassGeometry=new J["a"],this.clouds=new Z["a"],this.overlays=[]}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}}class re{constructor(e,t,i,r=null){this.rctx=e,this.sliceHelper=r,this.lastFrameCamera=new V["a"],this.pass=E["a"].MATERIAL,this.renderOccludedMask=ae,this.bindParameters=new ie(t,i,Object(l["k"])(r)?r.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=ae}get isHighlightPass(){return this.pass===E["a"].MATERIAL_HIGHLIGHT}}const ae=X["c"].Occlude|X["c"].OccludeAndTransparent|X["c"].OccludeAndTransparentStencil;var ne,se=i("dae5"),oe=i("afe1"),ce=i("3349"),le=i("e431"),de=i("7577"),he=i("0fc4"),ue=i("a1ff"),pe=i("8539");!function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"}(ne||(ne={}));class be{constructor(){this.camera=new V["a"],this.lightMat=Object(oe["d"])()}}class fe{constructor(e,t,i=0){this.rctx=e,this.viewingMode=t,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Object(he["e"])(),this._cascades=[new be,new be,new be,new be],this.maxTextureSize=this.rctx.parameters.maxTextureSize,this.snapshotCount=i}get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get cascadeDistances(){return Object(de["l"])(this._usedCascadeDistances,this._cascadeDistances[0],this.numCascades>1?this._cascadeDistances[1]:1/0,this.numCascades>2?this._cascadeDistances[2]:1/0,this.numCascades>3?this._cascadeDistances[3]:1/0)}dispose(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(e){this.maxNumCascades=Object(_["e"])(Math.floor(e),1,4)}get maxCascades(){return this.maxNumCascades}set enabled(e){this._enabled=e,e||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&Object(l["k"])(this._depthTexture)}get snapshotCount(){return this._snapshots.length}set snapshotCount(e){const t=this._snapshots.length;if(e>t){const i=e-t;this._snapshots.length=e;for(let e=0;e<i;++e)this._snapshots[t+e]=null}else if(e<this.snapshotCount){const i=t-e;for(let t=0;t<i;++t)this._discardSnapshot(e+t);this._snapshots.length=e}}getSnapshot(e){return this.enabled?this._snapshots[e]:null}getCascades(){for(let e=0;e<this.numCascades;++e)Re[e]=this._cascades[e];return Re.length=this.numCascades,Re}start(e,t,i){Object(B["a"])(this.enabled),this._textureSize=this._computeTextureSize(e.fullWidth,e.fullHeight),this._ensureDepthTexture();const{near:r,far:a}=this._clampNearFar(i);this._computeCascadeDistances(a,r),this._setupMatrices(e,t);const n=e.viewMatrix,s=e.projectionMatrix;for(let o=0;o<this.numCascades;++o)this._constructCascade(o,s,n,t);this.lastOrigin=null,this.clear()}finish(e){Object(B["a"])(this.enabled),this.rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this.lastOrigin||!Object(le["o"])(e,this.lastOrigin)){this.lastOrigin=this.lastOrigin||Object(m["f"])(),Object(le["g"])(this.lastOrigin,e);for(let t=0;t<this.numCascades;++t){Object(f["j"])(Ee,this._cascades[t].lightMat,e);for(let e=0;e<16;++e)Ie[16*t+e]=Ee[e]}}return Ie}takeCascadeSnapshotTo(e,t){Object(B["a"])(this.enabled);const i=this._ensureSnapshot(t);this._bindFbo();const r=this.rctx,a=r.bindTexture(i,ue["a"].TEXTURE_UNIT_FOR_UPDATES);r.gl.copyTexSubImage2D(A["A"].TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),r.bindTexture(a,ue["a"].TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this.rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(A["e"].COLOR_BUFFER_BIT|A["e"].DEPTH_BUFFER_BIT)}_computeTextureSize(e,t){const i=.5*Math.log(e*e+t*t)*Math.LOG2E,r=.35,a=2**Math.round(i+r);return Math.min(this.maxTextureSize,2*a)}_ensureDepthTexture(){if(Object(l["k"])(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const e={target:A["A"].TEXTURE_2D,pixelFormat:A["p"].RGBA,dataType:A["q"].UNSIGNED_BYTE,wrapMode:A["B"].CLAMP_TO_EDGE,samplingMode:A["z"].NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new ue["a"](this.rctx,e),this._fbo=new P["a"](this.rctx,{colorTarget:A["y"].TEXTURE,depthStencilTarget:A["m"].DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(e){let t=this._snapshots[e];if(Object(l["k"])(t)&&t.descriptor.width===this._textureSize)return t;this._discardSnapshot(e);const i={target:A["A"].TEXTURE_2D,pixelFormat:A["p"].RGBA,dataType:A["q"].UNSIGNED_BYTE,wrapMode:A["B"].CLAMP_TO_EDGE,samplingMode:A["z"].NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return t=new ue["a"](this.rctx,i),this._snapshots[e]=t,t}_discardDepthTexture(){this._fbo=Object(l["e"])(this._fbo),this._depthTexture=Object(l["e"])(this._depthTexture)}_discardSnapshot(e){this._snapshots[e]=Object(l["e"])(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this.snapshotCount;++e)this._discardSnapshot(e)}_bindFbo(){const e=this.rctx;e.unbindTexture(this._depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,t,i,r){const a=this._cascades[e],n=-this._cascadeDistances[e],s=-this._cascadeDistances[e+1],o=(t[10]*n+t[14])/Math.abs(t[11]*n+t[15]),c=(t[10]*s+t[14])/Math.abs(t[11]*s+t[15]);Object(B["a"])(o<c);for(let d=0;d<8;++d){Object(de["l"])(ve,d%4==0||d%4==3?-1:1,d%4==0||d%4==1?-1:1,d<4?o:c,1),Object(de["m"])(ye[d],ve,Oe);for(let e=0;e<3;++e)ye[d][e]/=ye[d][3]}Object(le["s"])(Pe,ye[0]),Object(f["j"])(me,Ae,Pe),a.camera.viewMatrix=me;for(let d=0;d<8;++d)Object(le["q"])(ye[d],ye[d],a.camera.viewMatrix);Object(le["g"])(_e,ye[0]),Object(le["g"])(je,ye[0]);for(let d=1;d<8;++d)for(let e=0;e<3;++e)_e[e]=Math.min(_e[e],ye[d][e]),je[e]=Math.max(je[e],ye[d][e]);_e[2]-=200,je[2]+=200,a.camera.near=-je[2],a.camera.far=-_e[2],this.warp?this._constructTrapezoidalProjection(i,r,a):this._constructOrthogonalProjection(a),Object(f["m"])(a.lightMat,a.camera.projectionMatrix,a.camera.viewMatrix);const l=this._textureSize/2;a.camera.viewport[0]=e%2==0?0:l,a.camera.viewport[1]=0===Math.floor(e/2)?0:l,a.camera.viewport[2]=l,a.camera.viewport[3]=l}_constructOrthogonalProjection(e){Object(f["q"])(e.camera.projectionMatrix,_e[0],je[0],_e[1],je[1],e.camera.near,e.camera.far)}_constructTrapezoidalProjection(e,t,i){const r=1/ye[0][3],a=1/ye[4][3];Object(B["a"])(r<a);let n=r+Math.sqrt(r*a);const s=Math.sin(Object(_["b"])(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));n/=s,ke(ye,n,s,xe,Se,Te,we,Ce),Ye(xe,Se,we,Ce,i.camera.projectionMatrix),i.camera.projectionMatrix[10]=2/(_e[2]-je[2]),i.camera.projectionMatrix[14]=-(_e[2]+je[2])/(_e[2]-je[2])}_setupMatrices(e,t){Object(f["m"])(ge,e.projectionMatrix,e.viewMatrix),Object(f["a"])(Oe,ge);const i=this.viewingMode===g["a"].Global?e.eye:Object(le["w"])(Pe,0,0,1);Object(f["n"])(Ae,[0,0,0],[-t[0],-t[1],-t[2]],i)}_clampNearFar(e){let{near:t,far:i}=e;return t<2&&(t=2),i<2&&(i=2),t>=i&&(t=2,i=4),{near:t,far:i}}_computeCascadeDistances(e,t){this.numCascades=Math.min(1+Math.floor(Object(B["g"])(e/t,4)),this.maxNumCascades);const i=(e-t)/this.numCascades,r=(e/t)**(1/this.numCascades);let a=t,n=t;for(let s=0;s<this.numCascades+1;++s)this._cascadeDistances[s]=Object(_["l"])(a,n,this.splitSchemeLambda),a*=r,n+=i}get gpuMemoryUsage(){var e,t;return this._snapshots.reduce((e,t)=>e+Object(pe["d"])(t),null!=(e=null==(t=this._fbo)?void 0:t.gpuMemoryUsage)?e:0)}get test(){const e=this;return{maxNumCascades:this.maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(t){e.splitSchemeLambda=t},get splitSchemeLambda(){return e.splitSchemeLambda},set warp(t){e.warp=t},get warp(){return e.warp}}}}const me=Object(oe["d"])(),ge=Object(oe["d"])(),Oe=Object(oe["d"])(),ve=Object(he["e"])(),ye=[];for(let Si=0;Si<8;++Si)ye.push(Object(he["e"])());const _e=Object(m["f"])(),je=Object(m["f"])(),xe=Object(Y["c"])(),Se=Object(Y["c"])(),Te=Object(Y["c"])(),we=Object(Y["c"])(),Ce=Object(Y["c"])(),Ae=Object(oe["d"])(),Pe=Object(m["f"])(),Re=[],Ee=Object(oe["d"])(),Ie=new Float32Array(64),Me=Object(Y["c"])(),De=Object(Y["c"])(),Le=[Object(Y["c"])(),Object(Y["c"])(),Object(Y["c"])(),Object(Y["c"])()],Ne=Object(Y["c"])(),Fe=Object(Y["c"])(),ze=Object(Y["c"])(),Ge=Object(Y["c"])(),Ve=Object(Y["c"])(),Ue=Object(Y["c"])(),Be=Object(Y["c"])();function ke(e,t,i,r,a,n,s,o){Object(ce["a"])(Me,0,0);for(let _=0;_<4;++_)Object(ce["b"])(Me,Me,e[_]);Object(ce["f"])(Me,Me,.25),Object(ce["a"])(De,0,0);for(let _=4;_<8;++_)Object(ce["b"])(De,De,e[_]);Object(ce["f"])(De,De,.25),Object(ce["l"])(Le[0],e[4],e[5],.5),Object(ce["l"])(Le[1],e[5],e[6],.5),Object(ce["l"])(Le[2],e[6],e[7],.5),Object(ce["l"])(Le[3],e[7],e[4],.5);let c=0,l=Object(ce["s"])(Le[0],Me);for(let _=1;_<4;++_){const e=Object(ce["s"])(Le[_],Me);e<l&&(l=e,c=_)}Object(ce["g"])(Ne,Le[c],e[c+4]);const d=Ne[0];let h,u;Ne[0]=-Ne[1],Ne[1]=d,Object(ce["g"])(Fe,De,Me),Object(ce["h"])(Fe,Ne)<0&&Object(ce["n"])(Ne,Ne),Object(ce["l"])(Ne,Ne,Fe,i),Object(ce["i"])(Ne,Ne),h=u=Object(ce["h"])(Object(ce["g"])(ze,e[0],Me),Ne);for(let _=1;_<8;++_){const t=Object(ce["h"])(Object(ce["g"])(ze,e[_],Me),Ne);t<h?h=t:t>u&&(u=t)}Object(ce["c"])(r,Me),Object(ce["f"])(ze,Ne,h-t),Object(ce["b"])(r,r,ze);let p=-1,b=1,f=0,m=0;for(let _=0;_<8;++_){Object(ce["g"])(Ge,e[_],r),Object(ce["i"])(Ge,Ge);const t=Ne[0]*Ge[1]-Ne[1]*Ge[0];t>0?t>p&&(p=t,f=_):t<b&&(b=t,m=_)}Object(B["k"])(p>0,"leftArea"),Object(B["k"])(b<0,"rightArea"),Object(ce["f"])(Ve,Ne,h),Object(ce["b"])(Ve,Ve,Me),Object(ce["f"])(Ue,Ne,u),Object(ce["b"])(Ue,Ue,Me),Be[0]=-Ne[1],Be[1]=Ne[0];const g=Object(B["i"])(r,e[m],Ue,Object(ce["b"])(ze,Ue,Be),1,a),O=Object(B["i"])(r,e[f],Ue,ze,1,n),v=Object(B["i"])(r,e[f],Ve,Object(ce["b"])(ze,Ve,Be),1,s),y=Object(B["i"])(r,e[m],Ve,ze,1,o);Object(B["k"])(g,"rayRay"),Object(B["k"])(O,"rayRay"),Object(B["k"])(v,"rayRay"),Object(B["k"])(y,"rayRay")}function He(e,t){return 3*t+e}const We=Object(Y["c"])();function qe(e,t){return Object(ce["a"])(We,e[t],e[t+3]),We}const $e=Object(Y["c"])(),Xe=Object(se["b"])();function Ye(e,t,i,r,a){Object(ce["g"])($e,i,r),Object(ce["f"])($e,$e,.5),Xe[0]=$e[0],Xe[1]=$e[1],Xe[2]=0,Xe[3]=$e[1],Xe[4]=-$e[0],Xe[5]=0,Xe[6]=$e[0]*$e[0]+$e[1]*$e[1],Xe[7]=$e[0]*$e[1]-$e[1]*$e[0],Xe[8]=1,Xe[He(0,2)]=-Object(ce["h"])(qe(Xe,0),e),Xe[He(1,2)]=-Object(ce["h"])(qe(Xe,1),e);let n=Object(ce["h"])(qe(Xe,0),i)+Xe[He(0,2)],s=Object(ce["h"])(qe(Xe,1),i)+Xe[He(1,2)],o=Object(ce["h"])(qe(Xe,0),r)+Xe[He(0,2)],c=Object(ce["h"])(qe(Xe,1),r)+Xe[He(1,2)];n=-(n+o)/(s+c),Xe[He(0,0)]+=Xe[He(1,0)]*n,Xe[He(0,1)]+=Xe[He(1,1)]*n,Xe[He(0,2)]+=Xe[He(1,2)]*n,n=1/(Object(ce["h"])(qe(Xe,0),i)+Xe[He(0,2)]),s=1/(Object(ce["h"])(qe(Xe,1),i)+Xe[He(1,2)]),Xe[He(0,0)]*=n,Xe[He(0,1)]*=n,Xe[He(0,2)]*=n,Xe[He(1,0)]*=s,Xe[He(1,1)]*=s,Xe[He(1,2)]*=s,Xe[He(2,0)]=Xe[He(1,0)],Xe[He(2,1)]=Xe[He(1,1)],Xe[He(2,2)]=Xe[He(1,2)],Xe[He(1,2)]+=1,n=Object(ce["h"])(qe(Xe,1),t)+Xe[He(1,2)],s=Object(ce["h"])(qe(Xe,2),t)+Xe[He(2,2)],o=Object(ce["h"])(qe(Xe,1),i)+Xe[He(1,2)],c=Object(ce["h"])(qe(Xe,2),i)+Xe[He(2,2)],n=-.5*(n/s+o/c),Xe[He(1,0)]+=Xe[He(2,0)]*n,Xe[He(1,1)]+=Xe[He(2,1)]*n,Xe[He(1,2)]+=Xe[He(2,2)]*n,n=Object(ce["h"])(qe(Xe,1),t)+Xe[He(1,2)],s=Object(ce["h"])(qe(Xe,2),t)+Xe[He(2,2)],o=-s/n,Xe[He(1,0)]*=o,Xe[He(1,1)]*=o,Xe[He(1,2)]*=o,a[0]=Xe[0],a[1]=Xe[1],a[2]=0,a[3]=Xe[2],a[4]=Xe[3],a[5]=Xe[4],a[6]=0,a[7]=Xe[5],a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=Xe[6],a[13]=Xe[7],a[14]=0,a[15]=Xe[8]}class Ze{constructor(){this.adds=new d["a"],this.removes=new d["a"],this.updates=new d["a"]({allocator:e=>e||new Je,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class Je{}class Qe{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var Ke=i("9250"),et=i("1942"),tt=i("3bd5");function it(e){const t=new Map,i=e=>{let i=t.get(e);return i||(i=new Qe,t.set(e,i)),i};return e.removes.forAll(e=>{rt(e)&&i(e.material).removes.push(e)}),e.adds.forAll(e=>{rt(e)&&i(e.material).adds.push(e)}),e.updates.forAll(e=>{rt(e.renderGeometry)&&i(e.renderGeometry.material).updates.push(e)}),t}function rt(e){return e.data.indexCount>=1}var at=i("2ebb"),nt=i("b061"),st=i("7d11");class ot extends st["b"]{constructor(e=Object(m["f"])()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}}var ct=i("1f93");class lt{constructor(e){this.first=e.from,this.count=e.to-e.from}}class dt{constructor(e=0,t=0){this.from=e,this.to=t}}class ht extends dt{constructor(e,t,i,r,a,n){super(t,i),this.id=e,this.isVisible=r,this.hasHighlights=a,this.hasOccludees=n}}function ut(e){return Array.from(e.values()).sort(pt)}function pt(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function bt(e,t){if(0===e.length)return void e.push(new lt(t));const i=e[e.length-1];if(ft(i,t)){const e=t.from-i.first+t.to-t.from;i.count=e}else e.push(new lt(t))}function ft(e,t){return e.first+e.count>=t.from}class mt{constructor(e,t){this._pool=e,this._size=0,this._buffer=e.newBuffer(Ot(t))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(e){this._resize(this._size+e,!0).dispose()}alloc(e){return this._resize(e,!1)}_resize(e,t){let i;const r=vt(this._buffer.length,this._size,e);if(this._buffer.length!==r){const e=this._pool.newBuffer(r);t&&(e.array.set(this._buffer.array.subarray(0,Math.min(this._size,r))),e.vao.vertexBuffers.geometry.setSubData(e.array,0,0,e.array.byteLength)),i=this._buffer,this._buffer=e}const a=this._size;return this._size=e,i?{dispose:()=>{i.array.fill(0,0,a),this._pool.deleteBuffer(i)},copy:(e,t,r)=>this._buffer.array.set(i.array.subarray(t,r),e),hasNewBuffer:!0}:{dispose:()=>{},copy:(e,t,i)=>{e!==t&&this._buffer.array.copyWithin(e,t,i)},hasNewBuffer:!1}}erase(e,t){this._buffer.array.fill(0,e,t)}}const gt=65536;function Ot(e){return Math.ceil(e/gt)*gt}function vt(e,t,i){return t<=i?e>=i?e:Ot(Math.max(2*e,i)):e<=2*i?e:Ot(i)}var yt=i("aefa"),_t=i("f2e0"),jt=i("7ce4"),xt=i("0fa6");class St{constructor(e,t,i,r){this.vao=new xt["a"](e,t,{geometry:i},{geometry:jt["a"].createVertex(e,A["D"].STATIC_DRAW)}),this.array=new Float32Array(r),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const Tt=yt["a"]+1;class wt{constructor(e,t,i){this._rctx=e,this._locations=t,this._layout=i,this._cache=e.newCache("MergedRenderer pool "+Object(_t["a"])(),Ct)}dispose(){this._cache.destroy()}newBuffer(e){const t=e.toString(),i=this._cache.pop(t);if(Object(l["k"])(i)){const e=i.pop();return i.length>0&&this._cache.put(t,i,e.array.byteLength*i.length,Tt),e}return new St(this._rctx,this._locations,this._layout,e)}deleteBuffer(e){const t=e.array.byteLength,i=e.array.length.toString(),r=this._cache.pop(i);return Object(l["k"])(r)?(r.push(e),this._cache.put(i,r,t*r.length,-1)):this._cache.put(i,[e],t,-1),null}}function Ct(e,t){if(t===yt["d"].ALL)return void e.forEach(e=>e.dispose());const i=e.pop(),r=e.length*i.array.byteLength;return i.dispose(),r}var At=i("b623");class Pt{constructor(e,t,i){this._rctx=e,this._materialRepository=t,this._material=i,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new d["a"],this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new nt["a"](this._material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._bufferPool=new wt(e,i.vertexAttributeLocations,Object(at["a"])(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(e=>e.buffer.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof ct["a"]}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==X["c"].Occlude}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateRenderCommands()}_addAndRemoveGeometries(e,t){const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4,a=this._dataByOrigin,n=Et(e,t);n.forEach((e,t)=>{n.delete(t);const s=e.toAdd.reduce((e,t)=>e+i.elementCount(t.data),0);let o=a.get(t);if(null==o)Object(B["a"])(0===e.toRemove.length),o=new Nt(e.origin,new mt(this._bufferPool,s*r)),a.set(t,o);else if(0===e.toAdd.length&&o.instances.size===e.toRemove.length)return o.buffer.dispose(),void a.delete(t);let c=0;o.instances.forEach(e=>c+=e.to-e.from);const l=e.toRemove.reduce((e,t)=>e+i.elementCount(t.data),0),d=o.buffer.size,h=(c+s-l)*r,u=zt;if(h<d/2?this._removeAndRebuild(o,e.toRemove,r,h,u):e.toRemove.length>0&&this._remove(o,e.toRemove,r,u),e.toAdd.length>0){const t=Gt;Object(B["j"])(t,-e.origin[0],-e.origin[1],-e.origin[2]),this._add(o,e.toAdd,r,t,u)}const p=o.buffer.vao.vertexBuffers.geometry;Lt(u),u.forAll(({from:e,to:t})=>{if(e<t){const i=o.buffer.array,r=4,a=e*r,n=t*r;p.setSubData(i,a,a,n)}}),u.clear(),o.drawCommandsDirty=!0})}_updateGeometries(e){const t=this._bufferWriter,i=t.vertexBufferLayout.stride/4;for(const r of e){const e=r.renderGeometry,a=this._dataByOrigin.get(e.origin.id),n=a&&a.instances.get(e.id);if(!n)return;const s=r.updateType;if(s&tt["a"].State.VISIBILITIES&&(n.isVisible=e.instanceParameters.visible),s&(tt["a"].State.HIGHLIGHTS|tt["a"].State.VISIBILITIES)){const t=e.instanceParameters.visible;n.hasHighlights=!!e.instanceParameters.highlights&&t}if(s&tt["a"].State.OCCLUDEES&&(n.hasOccludees=!!e.instanceParameters.occludees),s&(tt["a"].State.VERTEXATTRS|tt["a"].State.TRANSFORMATION)){const{array:r,vao:s}=a.buffer;Object(At["b"])(e,Vt,Ut),t.write({transformation:Vt,invTranspTransformation:Ut},e.data,t.vertexBufferLayout.createView(r.buffer),n.from),Object(B["a"])(n.from+t.elementCount(e.data)===n.to,"material VBO layout has changed"),s.vertexBuffers.geometry.setSubData(r,n.from*i*4,n.from*i*4,n.to*i*4)}a.drawCommandsDirty=!0}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,Object(c["c"])(e.instances,t=>(t.isVisible?(t.hasHighlights&&(this._hasHighlights=!0,e.hasHighlights=!0),t.hasOccludees&&(this._hasOccludees=!0,e.hasOccludees=!0)):e.hasHiddenInstances=!0,e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees))});const e=e=>{if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.drawCommandsShadowHighlightRest=null,0===e.instances.size)return;if(!Mt(e)){const t=this._bufferWriter.vertexBufferLayout.stride,i=4*e.buffer.size/t;return void(e.drawCommandsDefault=[{first:0,count:i}])}const t=ut(e.instances);e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[],e.drawCommandsShadowHighlightRest=[];for(const i of t)i.isVisible&&(i.hasOccludees?bt(e.drawCommandsOccludees,i):bt(e.drawCommandsDefault,i),i.hasHighlights?bt(e.drawCommandsHighlight,i):bt(e.drawCommandsShadowHighlightRest,i))};this._dataByOrigin.forEach(t=>{t.drawCommandsDirty&&(e(t),t.drawCommandsDirty=!1)})}updateAnimation(e){return this._material.update(e)}requiresSlot(e,t){return null==e||this._material.requiresSlot(e,t)}render(e,t){if(!this.requiresSlot(t.slot,e))return!1;const i=e===E["a"].MATERIAL_HIGHLIGHT||e===E["a"].MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(i&&!this._hasHighlights)return!1;const r=e===E["a"].MATERIAL_DEPTH_SHADOWMAP_DEFAULT,a=!(i||r);if(this._dataByOrigin.forEach(e=>{if(i&&!e.hasHighlights)return;const t=(i?e.drawCommandsHighlight:r&&Mt(e)?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,n=a&&e.drawCommandsOccludees||null;(Object(l["k"])(t)||Object(l["k"])(n))&&this._renderCommandData.push(new Ft(e.origin,e.buffer,t,n))}),0===this._renderCommandData.length)return!1;const n=this._rctx,s=this._glMaterials.load(n,e);if(Object(l["j"])(s))return this._renderCommandData.clear(),!1;const o=s.beginSlot(t);return n.bindTechnique(o,this._material.parameters,t,!1),this._renderCommandData.forAll(e=>{o.bindDraw(e,t);const{buffer:i,renderCommands:r,occludeeCommands:a}=e;o.ensureAttributeLocations(i.vao),n.bindVAO(i.vao);const s=o.primitiveType;Object(l["k"])(r)&&this._renderCommands(n,s,r),Object(l["k"])(a)&&(o.bindPipelineState(n,t.slot,!0),this._renderCommands(n,s,a),o.bindPipelineState(n,t.slot,!1))}),this._renderCommandData.clear(),!0}_renderCommands(e,t,i){for(let r=0;r<i.length;r++)e.drawArrays(t,i[r].first,i[r].count)}_removeAndRebuild(e,t,i,r,a){for(const l of t)e.instances.delete(l.id);const n=ut(e.instances);e.instances.clear();const s=e.buffer.size,o=e.buffer.alloc(r);let c=0;for(const l of n){const t=l.from*i,r=l.to*i;o.copy(c,t,r),l.from=c/i,c+=r-t,l.to=c/i,e.instances.set(l.id,l)}a.push(new dt(0,o.hasNewBuffer?e.buffer.array.length:s)),o.dispose(),e.buffer.erase(c,a.back().to),e.holes.clear()}_remove(e,t,i,r){for(const a of t){const t=a.id,n=e.instances.get(t),s=n.from*i,o=n.to*i;e.buffer.erase(s,o),e.holes.push(new dt(n.from,n.to)),e.instances.delete(t),r.push(new dt(s,o))}Lt(e.holes)}_add(e,t,i,r,a){if(0===t.length)return;const n=this._bufferWriter;let s=n.vertexBufferLayout.createView(e.buffer.array.buffer);const o=e.holes.length>0;let c=Number.MAX_SAFE_INTEGER,d=Number.MIN_SAFE_INTEGER;for(const h of t){const t=Object(l["k"])(h.transformation)?Object(f["m"])(Vt,r,h.transformation):r;Object(f["a"])(Ut,t);const u=Object(f["t"])(Ut,Ut),p=n.elementCount(h.data),b=p*i;let m=Dt(e.holes,p);Object(l["j"])(m)&&(m=e.buffer.size/i,e.buffer.grow(b),s=n.vertexBufferLayout.createView(e.buffer.array.buffer)),n.write({transformation:t,invTranspTransformation:u},h.data,s,m);const g=h.instanceParameters.visible,O=!!h.instanceParameters.highlights&&g,v=!!h.instanceParameters.occludees,y=new ht(h.id,m,m+p,g,O,v);Object(B["a"])(null==e.instances.get(h.id)),e.instances.set(h.id,y),o?a.push(new dt(y.from*i,y.to*i)):(c=Math.min(y.from,c),d=Math.max(y.to,d))}o||a.push(new dt(c*i,d*i))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class Rt{constructor(e){this.origin=e,this.toAdd=new Array,this.toRemove=new Array}}function Et(e,t){const i=new Map;for(const r of e)It(i,r,!0);for(const r of t)It(i,r,!1);return i}function It(e,t,i){const r=t.origin;if(Object(l["j"])(r))return;let a=e.get(r.id);null==a&&(a=new Rt(r.vec3),e.set(r.id,a)),i?a.toAdd.push(t):a.toRemove.push(t)}function Mt(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function Dt(e,t){let i;if(!e.some(e=>!(e.to-e.from<t)&&(i=e,!0)))return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}function Lt(e){const t=new Map;e.forAll(e=>t.set(e.from,e));let i=!0;for(;i;)i=!1,e.forEach(r=>{const a=t.get(r.to);a&&(r.to=a.to,t.delete(a.from),e.removeUnordered(a),i=!0)})}class Nt{constructor(e,t){this.origin=e,this.buffer=t,this.instances=new Map,this.holes=new d["a"]({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class Ft extends ot{constructor(e,t,i,r){super(e),this.buffer=t,this.renderCommands=i,this.occludeeCommands=r}}const zt=new d["a"]({deallocator:null}),Gt=Object(oe["d"])(),Vt=Object(oe["d"])(),Ut=Object(oe["d"])();let Bt=class extends n["a"]{constructor(e){super(e),this._pending=new kt,this._changes=new Ze,this._materialRenderers=new Map,this._sortedMaterialRenderers=new d["a"],this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Object(c["c"])(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=it(this._changes);let t=!1,i=!1,r=!1;return e.forEach((e,a)=>{let n=this._materialRenderers.get(a);if(!n&&e.adds.length>0&&(n=new Pt(this.rctx,this._materialRepository,a),this._materialRenderers.set(a,n),t=!0,i=!0,r=!0),!n)return;const s=i||n.hasHighlights,o=r||n.hasWater;n.modify(e),i=i||s!==n.hasHighlights,r=r||o!==n.hasWater,n.isEmpty&&(this._materialRenderers.delete(a),n.dispose(),t=!0)}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=Object(c["c"])(this._materialRenderers,e=>e.hasHighlights)),r&&(this._hasWater=Object(c["c"])(this._materialRenderers,e=>e.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,t){if(0===e.length)return;const i=this._validateRenderGeometries(e);for(const a of i)this._geometries.set(a.id,a);const r=this._pending.empty;for(const a of i)this._pending.adds.add(a);r&&this.notifyChange("updating"),t===tt["a"].Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const i=this._pending.empty,r=this._pending.adds;for(const a of e)r.has(a)?(this._pending.removed.add(a),r.delete(a)):this._pending.removed.has(a)||this._pending.removes.add(a),this._geometries.delete(Object(l["r"])(a.id));i&&!this._pending.empty&&this.notifyChange("updating"),t===tt["a"].Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const i=0===this._changes.updates.length;for(const r of e){const e=this._changes.updates.pushNew();e.renderGeometry=this._validateRenderGeometry(r),e.updateType=t}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case tt["a"].State.TRANSFORMATION:case tt["a"].State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e);case tt["a"].State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:i})=>t=i.updateAnimation(e)||t),t}render(e,t){for(let i=0;i<this._sortedMaterialRenderers.length;i++){const r=this._sortedMaterialRenderers.data[i];r.material.shouldRender(e)&&r.materialRenderer.render(e.pass,t)}}intersect(e,t,i,r,a){return this._geometries.forEach(n=>{if(r&&!r(n))return;this._intersectRenderGeometry(n,i,t,0,e,a);const s=this.rendererContext.longitudeCyclical;s&&(n.boundingSphere[0]-n.boundingSphere[3]<s.min&&this._intersectRenderGeometry(n,i,t,s.range,e,a),n.boundingSphere[0]+n.boundingSphere[3]>s.max&&this._intersectRenderGeometry(n,i,t,-s.range,e,a)),a++}),a}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push({material:i,materialRenderer:t})}),this._sortedMaterialRenderers.sort((e,t)=>{const i=t.material.renderPriority-e.material.renderPriority;return 0!==i?i:e.material.insertOrder-t.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,i,r,a,n){if(!e.instanceParameters.visible)return;let s=0;Object(l["k"])(e.transformation)&&(r+=e.transformation[12],s=e.transformation[13]),Wt[0]=i[0]-r,Wt[1]=i[1]-s,Wt[2]=1,qt[0]=i[0]-r,qt[1]=i[1]-s,qt[2]=0,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),a,Wt,qt,(i,r,s)=>{Ht(t,s,e.material.renderPriority,n,a,e.layerUid,e.graphicUid)},e.calculateShaderTransformation,t)}_notifyGraphicGeometryChanged(e){if(Object(l["j"])(this.drapeSource.notifyGraphicGeometryChanged))return;let t;for(const i of e){const e=i.graphicUid;Object(l["k"])(e)&&e!==t&&(this.drapeSource.notifyGraphicGeometryChanged(e),t=e)}}_notifyGraphicVisibilityChanged(e){if(Object(l["j"])(this.drapeSource.notifyGraphicVisibilityChanged))return;let t;for(const i of e){const e=i.graphicUid;Object(l["k"])(e)&&e!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(e),t=e)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return Object(l["j"])(e.origin)&&(e.origin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};Object(a["a"])([Object(p["b"])()],Bt.prototype,"drapeSource",void 0),Object(a["a"])([Object(p["b"])()],Bt.prototype,"updating",null),Object(a["a"])([Object(p["b"])()],Bt.prototype,"rctx",null),Object(a["a"])([Object(p["b"])()],Bt.prototype,"rendererContext",void 0),Object(a["a"])([Object(p["b"])()],Bt.prototype,"_materialRepository",null),Object(a["a"])([Object(p["b"])()],Bt.prototype,"_localOriginFactory",null),Bt=Object(a["a"])([Object(b["a"])("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Bt);class kt{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}function Ht(e,t,i,r,a,n,s){const o={layerUid:n,graphicUid:s,triangleNr:t},c=t=>{t.set(et["b"].OVERLAY,o,e.dist,e.normal,e.transformation,i,r)};if((null==a.results.min.drapedLayerOrder||i>=a.results.min.drapedLayerOrder)&&(null==a.results.min.dist||a.results.ground.dist<=a.results.min.dist)&&c(a.results.min),a.options.store!==et["c"].MIN&&(null==a.results.max.drapedLayerOrder||i<a.results.max.drapedLayerOrder)&&(null==a.results.max.dist||a.results.ground.dist>a.results.max.dist)&&c(a.results.max),a.options.store===et["c"].ALL){const e=Object(Ke["b"])(a.ray);c(e),a.results.all.push(e)}}const Wt=Object(m["f"])(),qt=Object(m["f"])();var $t=i("2db0"),Xt=i("3886"),Yt=i("c3a4"),Zt=i("ca98"),Jt=i("fa1e"),Qt=i("c829"),Kt=i("36df"),ei=i("189c");class ti extends Zt["a"]{initializeProgram(e){const t=ti.shader.get().build(this.configuration);return new Qt["a"](e.rctx,t,Jt["a"])}initializePipeline(){return Object(ei["f"])({colorWrite:ei["c"]})}}ti.shader=new Yt["a"](Kt["a"],()=>i.e("chunk-2d0ab6a6").then(i.bind(null,"14d1")));var ii=i("3205");class ri{constructor(e,t,i){this._techniqueRep=e,this._rctx=t,this._requestRender=i,this._enabled=!1,this._ssaoTechniqueConfig=new ii["b"],this.quadVAO=null,this._blurSizePx=2,this._attenuation=.5}dispose(){this.quadVAO=Object(l["e"])(this.quadVAO)}disposeOffscreenBuffers(){Object(l["b"])(this._ssaoFBO,e=>e.resize(0,0)),Object(l["b"])(this._blur0FBO,e=>e.resize(0,0)),Object(l["b"])(this._blur1FBO,e=>e.resize(0,0))}set enabled(e){e?this._enable():this._disable()}get enabled(){return this._enabled}get ready(){return this.enabled&&Object(l["k"])(this._noiseTexture)&&Object(l["k"])(this._ssaoFBO)&&Object(l["k"])(this._blur0FBO)&&Object(l["k"])(this._blur1FBO)}get colorTexture(){return Object(l["k"])(this._blur1FBO)?this._blur1FBO.colorTexture:null}get width(){return Object(l["k"])(this._ssaoFBO)?this._ssaoFBO.width:-1}get height(){return Object(l["k"])(this._ssaoFBO)?this._ssaoFBO.height:-1}computeSSAO(e,t,i){if(!this.enabled||Object(l["j"])(t)||Object(l["j"])(i)||Object(l["j"])(this._noiseTexture)||Object(l["j"])(this._ssaoFBO)||Object(l["j"])(this._blur0FBO)||Object(l["j"])(this._blur1FBO))return;const r=this._rctx,a=e.camera,n=a.fullViewport,s=n[2],o=n[3],c=s/this._blurSizePx,d=o/this._blurSizePx;this._ssaoFBO.resize(s,o),this._blur0FBO.resize(c,d),this._blur1FBO.resize(c,d);const h=1,u=1,p=s*h,b=o*u;r.bindFramebuffer(this._ssaoFBO),r.setViewport(0,0,s,o);const f=r.bindTechnique(this._ssaoTechnique,ai,e);f.setUniform2f("rnmScale",s/this._noiseTexture.descriptor.width,o/this._noiseTexture.descriptor.height);let m=1/a.computeRenderPixelSizeAtDist(1);f.setUniform1f("projScale",m*h),f.setUniform2f("screenSize",p,b);const g=Object(le["m"])(a.eye,a.center);let O=20*a.computeRenderPixelSizeAtDist(g);O=Math.max(.1,O),f.setUniform1f("radius",O),f.setUniform1f("intensity",4*this._attenuation/O**6),f.bindTexture("rnm",this._noiseTexture),f.bindTexture("normalMap",i),f.bindTexture("depthMap",t),Object(l["j"])(this.quadVAO)&&(this.quadVAO=Object(q["b"])(this._rctx)),r.bindVAO(this.quadVAO),r.drawArrays(A["r"].TRIANGLE_STRIP,0,Object(pe["f"])(this.quadVAO,"geometry"));const v=r.bindTechnique(this._blurTechnique,ai,e);v.bindTexture("tex",this._ssaoFBO.colorTexture),v.bindTexture("normalMap",i),v.bindTexture("depthMap",t),r.setViewport(0,0,p/this._blurSizePx,b/this._blurSizePx),r.bindFramebuffer(this._blur0FBO),v.setUniform2f("screenSize",p,b),v.setUniform2f("blurSize",0,this._blurSizePx*h/b),g>5e4&&(m=Math.max(0,m-(g-5e4))),v.setUniform1f("projScale",m),r.drawArrays(A["r"].TRIANGLE_STRIP,0,Object(pe["f"])(this.quadVAO,"geometry")),v.setUniform2f("blurSize",this._blurSizePx*u/p,0),r.bindFramebuffer(this._blur1FBO),v.bindTexture("tex",this._blur0FBO.colorTexture),r.drawArrays(A["r"].TRIANGLE_STRIP,0,Object(pe["f"])(this.quadVAO,"geometry")),r.setViewport(n[0],n[1],n[2],n[3])}_selectPrograms(){this._ssaoTechniqueConfig.output=ii["a"].SSAO,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(ti,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=ii["a"].Blur,this._blurTechnique=this._techniqueRep.releaseAndAcquire(ti,this._ssaoTechniqueConfig,this._blurTechnique)}_enable(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))}_loadResources(e){this._data?e():i.e("chunk-2d0be660").then(i.bind(null,"2fa7")).then(t=>{this._data=t,e()})}_initialize(){const e={target:A["A"].TEXTURE_2D,pixelFormat:A["p"].RGBA,dataType:A["q"].UNSIGNED_BYTE,samplingMode:A["z"].LINEAR,wrapMode:A["B"].CLAMP_TO_EDGE,width:0,height:0},t={colorTarget:A["y"].TEXTURE,depthStencilTarget:A["m"].NONE};Object($t["a"])(this._data.noiseTexture).then(i=>{this._enabled&&(this._ssaoFBO=new P["a"](this._rctx,t,e),this._blur0FBO=new P["a"](this._rctx,t,e),this._blur1FBO=new P["a"](this._rctx,t,e),this._noiseTexture=new ue["a"](this._rctx,{target:A["A"].TEXTURE_2D,pixelFormat:A["p"].RGBA,dataType:A["q"].UNSIGNED_BYTE,hasMipmap:!0,width:i.width,height:i.height},i),this._requestRender())}),this._selectPrograms()}_disable(){this._enabled=!1,this._noiseTexture=Object(l["e"])(this._noiseTexture),this._blur1FBO=Object(l["e"])(this._blur1FBO),this._blur0FBO=Object(l["e"])(this._blur0FBO),this._ssaoFBO=Object(l["e"])(this._ssaoFBO)}get gpuMemoryUsage(){return(Object(l["k"])(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(Object(l["k"])(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(Object(l["k"])(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}const ai=new Xt["a"];var ni=i("3e44");class si extends Zt["a"]{initializeProgram(e){const t=si.shader.get().build();return new Qt["a"](e.rctx,t,Jt["a"])}initializePipeline(){return this.configuration.hasAlpha?Object(ei["f"])({blending:Object(ei["g"])(A["b"].SRC_ALPHA,A["b"].ONE,A["b"].ONE_MINUS_SRC_ALPHA,A["b"].ONE_MINUS_SRC_ALPHA),colorWrite:ei["c"]}):Object(ei["f"])({colorWrite:ei["c"]})}}si.shader=new Yt["a"](ni["a"],()=>i.e("chunk-2d0b3143").then(i.bind(null,"279a")));var oi=i("da35");class ci extends oi["a"]{constructor(){super(...arguments),this.hasAlpha=!1}}Object(a["a"])([Object(oi["b"])()],ci.prototype,"hasAlpha",void 0);var li,di,hi=i("2bc9"),ui=i("661c");class pi{constructor(e){this._rctx=e,this.cache=new Map}dispose(){this.cache.forEach(e=>e.texture=Object(l["e"])(e.texture)),this.cache.clear()}_acquire(e){if(Object(l["j"])(e))return null;const t=this._patternId(e),i=this.cache.get(t);if(i)return i.refCount++,i.bind;const r=e.pixelRatio,{encodedData:a,sdfNormalizer:n,pixels:s,paddedPixels:o}=bi(e.pattern,r),c=s/r,d={refCount:1,texture:null,bind:e=>(Object(l["j"])(d.texture)&&(d.texture=new ue["a"](this._rctx,{width:o,height:1,internalFormat:A["p"].RGBA,pixelFormat:A["p"].RGBA,dataType:A["q"].UNSIGNED_BYTE,wrapMode:A["B"].CLAMP_TO_EDGE},a)),e.bindTexture("stipplePatternTexture",d.texture),{pixelSize:c,sdfNormalizer:n,pixels:s})};return this.cache.set(t,d),d.bind}release(e){if(Object(l["j"])(e))return;const t=this._patternId(e),i=this.cache.get(t);i&&(i.refCount--,0===i.refCount&&(Object(l["k"])(i.texture)&&i.texture.dispose(),this.cache.delete(t)))}swap(e,t){const i=this._acquire(t);return this.release(e),i}_patternId(e){return`${e.pattern.join(",")}-r${e.pixelRatio}`}}function bi(e,t){const i=e.map(e=>Math.round(e*t)),r=1/t,a=Math.floor(i.reduce((e,t)=>e+t)),n=i.reduce((e,t)=>Math.max(e,t)),s=(Math.floor(.5*(n-1))+.5)*r,o=[];let c=1;for(const b of i){for(let e=0;e<b;e++){const t=c*(Math.min(e,b-1-e)+.5)*r/s*.5+.5;o.push(t)}c=-c}const l=Math.round(i[0]/2),d=[...o.slice(l),...o.slice(0,l)],h=a+2,u=new Uint8Array(4*h);let p=4;for(const b of d)Object(ui["a"])(b,u,p),p+=4;return u.copyWithin(0,p-4,p),u.copyWithin(p,4,8),{encodedData:u,sdfNormalizer:s,paddedPixels:h,pixels:a}}!function(e){e[e.Standard=0]="Standard",e[e.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",e[e.Transparency=2]="Transparency",e[e.OverlayWithTransparency=3]="OverlayWithTransparency",e[e.COUNT=4]="COUNT"}(li||(li={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"}(di||(di={}));class fi extends oi["a"]{constructor(){super(...arguments),this.function=li.Standard,this.alphaMode=di.None,this.hasOpacityFactor=!1}}Object(a["a"])([Object(oi["b"])({count:li.COUNT})],fi.prototype,"function",void 0),Object(a["a"])([Object(oi["b"])({count:di.COUNT})],fi.prototype,"alphaMode",void 0),Object(a["a"])([Object(oi["b"])()],fi.prototype,"hasOpacityFactor",void 0);var mi=i("9305");let gi=class extends(z(n["a"])){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new o["a"],this._frameTask=mi["a"],this._drapeSourceRenderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers=new d["a"],this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.worldToPCSRatio=1,this.events=new s["a"],this.longitudeCyclical=null}get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const t=e.waterTextureRepository;this._stippleTextureRepository=new pi(e.renderingContext),this._shaderTechniqueRepository=new L({rctx:this._rctx,viewingMode:g["a"].Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._renderContext=new re(this._rctx,new fe(this._rctx,this.view.state.viewingMode),new ri(this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([Object(h["f"])(()=>t.updating,()=>this.events.emit("content-changed"),h["e"]),Object(h["f"])(()=>this.spatialReference,e=>this._localOriginFactory=new $["a"](e),h["e"]),Object(h["b"])(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new H(e.textureRepository,this._shaderTechniqueRepository,e=>{(e.renderOccluded&xi)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._bindParameters.slot=ee["a"].DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=Object(q["a"])(this._rctx),this._bindParameters.camera=_i,this._bindParameters.transparencyPassType=x["i"].NONE,this._bindParameters.lighting.groundLightingFactor=1,this._bindParameters.lighting.globalFactor=0,this._bindParameters.lighting.set([new hi["a"](Object(m["h"])(1,1,1))]),this._frameTask=this.view.resourceController.scheduler.registerTask(mi["b"].STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._drapeSourceRenderers.forEach(e=>e.destroy()),this._drapeSourceRenderers.clear(),this._debugTextureTechnique=Object(l["p"])(this._debugTextureTechnique),this._debugPatternTexture=Object(l["e"])(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Object(l["e"])(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Object(l["e"])(this._shaderTechniqueRepository),this._temporaryFBO=Object(l["e"])(this._temporaryFBO),this._quadVAO=Object(l["e"])(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||this._frameTask.updating||Object(c["c"])(this._drapeSourceRenderers,e=>e.updating)}get hasOverlays(){return Object(l["k"])(this._overlays)&&Object(l["k"])(this._overlayRenderTarget)}get gpuMemoryUsage(){return Object(l["k"])(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Bt)}createDrapeSourceRenderer(e,t,i){const r=this._drapeSourceRenderers.get(e);Object(l["k"])(r)&&r.destroy();const a=new t({...i,rendererContext:this,drapeSource:e});return this._drapeSourceRenderers.set(e,a),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(Object(h["f"])(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),a}removeDrapeSourceRenderer(e){if(Object(l["j"])(e))return;const t=this._drapeSourceRenderers.get(e);Object(l["j"])(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._drapeSourceRenderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(e){let t=!1;if(Object(l["k"])(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const r=this.overlays[0].validTargets[i.type]||!this.overlays[1].validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(r,i,e)||t}return t}get overlays(){return Object(l["s"])(this._overlays,[])}ensureDrapeTargets(e){Object(l["k"])(this._overlays)&&this._overlays.forEach(t=>{t.hasTargetWithoutRasterImage=Object(u["a"])(e,e=>e.drapeTargetType===O["b"].WithoutRasterImage)})}ensureDrapeSources(e){Object(l["k"])(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=Object(u["a"])(e,e=>e.drapeSourceType===O["a"].Features),t.hasDrapedRasterSource=Object(u["a"])(e,e=>e.drapeSourceType===O["a"].RasterImage)})}ensureOverlays(e,t){Object(l["j"])(this._overlays)&&(this._overlayRenderTarget=new I(this._rctx),this._overlays=[new T(y["b"].INNER,this._overlayRenderTarget),new T(y["b"].OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Object(l["e"])(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=(()=>!0)){this._frameTask.processQueue(e),e.done||this._processDrapeSources(e,t)}_processDrapeSources(e,t){let i=!1;for(const[r,a]of this._drapeSourceRenderers){if(e.done)break;(r.destroyed||t(r))&&a.commitChanges()&&(i=!0,e.madeProgress())}this._updateSortedDrapeSourceRenderers(),i&&(Object(l["k"])(this._overlays)&&0===this._drapeSourceRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(mi["c"],e=>e.updatePolicy===x["j"].SYNC)}isEmpty(){if(v["a"].OVERLAY_DRAW_DEBUG_TEXTURE)return!1;for(const e of this._drapeSourceRenderers.values())if(!e.isEmpty)return!1;return!0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._drapeSourceRenderers.forEach(i=>t=i.updateAnimation(e)||t),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,i){const r=e.canvasGeometries;if(0===r.numViews)return!1;this._screenToWorldRatio=i*e.mapUnitsPerPixel;const a=t.renderPass;if(this.isEmpty()||a===E["a"].MATERIAL_HIGHLIGHT&&!this.hasHighlights||a===E["a"].MATERIAL_NORMAL&&!this.hasWater||!e.hasSomeSizedView())return!1;const n=t.fbo;if(!n.isValid())return!1;const s=2*e.resolution,o=e.resolution;n.resize(s,o);const c=this._rctx;_i.pixelRatio=e.pixelRatio*i,this._renderContext.pass=a,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=a===E["a"].MATERIAL_NORMAL?ee["a"].DRAPED_WATER:ee["a"].DRAPED_MATERIAL,e.applyViewport(this._rctx),n.bind(c),e.index===y["b"].INNER&&(c.setClearColor(0,0,0,0),c.clearSafe(A["e"].COLOR_BUFFER_BIT));const d=t.type===y["c"].ColorNoRasterImage?Oi.ExcludeRasterImage:t.type===y["c"].Occluded?Oi.OccludedOnly:Oi.Normal;if(d===Oi.OccludedOnly&&(this._renderContext.renderOccludedMask=xi),v["a"].OVERLAY_DRAW_DEBUG_TEXTURE&&d!==Oi.OccludedOnly)for(let l=0;l<r.numViews;l++)this._setViewParameters(r.extents[l],e,_i),this._drawDebugTexture(e.resolution,yi[e.index]);return this._drapeSourceRenderers.size>0&&this._sortedDrapeSourceRenderers.forAll(({drapeSource:t,renderer:i})=>{if(d===Oi.ExcludeRasterImage&&t.drapeSourceType===O["a"].RasterImage)return;const{fullOpacity:h}=t,u=Object(l["k"])(h)&&h<1&&a===E["a"].MATERIAL;u&&(this.bindTemporaryFramebuffer(this._rctx,s,o),c.clearSafe(A["e"].COLOR_BUFFER_BIT));for(let a=0;a<r.numViews;a++)this._setViewParameters(r.extents[a],e,_i),i.render(this._renderContext,this._bindParameters);u&&Object(l["k"])(this._temporaryFBO)&&(n.bind(c),this.view._stage.renderView.compositingHelper.composite(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),di.PremultipliedAlpha,h,li.OverlayWithTransparency,e.index))}),c.bindFramebuffer(null),n.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,i){Object(l["j"])(this._temporaryFBO)&&(this._temporaryFBO=new R(e,!1)),this._temporaryFBO.resize(t,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,i,r){let a=0;for(const s of this._drapeSourceRenderers.values()){var n;a=null!=(n=null==s.intersect?void 0:s.intersect(e,t,i,r,a))?n:a}}_updateSortedDrapeSourceRenderers(){if(!this._sortedDrapeSourceRenderersDirty)return;if(this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers.clear(),0===this._drapeSourceRenderers.size)return;const e=this.view.map.allLayers;this._drapeSourceRenderers.forEach((t,i)=>{const r=e.indexOf(i.layer);this._sortedDrapeSourceRenderers.push(new vi(i,t,r<0?1/0:r))}),this._sortedDrapeSourceRenderers.sort((e,t)=>e.index-t.index)}_setViewParameters(e,t,i){i.viewport[0]=i.viewport[1]=0,i.viewport[2]=i.viewport[3]=t.resolution,Object(f["q"])(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),Object(f["f"])(i.viewMatrix,[-e[0],-e[1],0]),this._bindParameters.camera=i}_updateHasWater(){const e=Object(c["c"])(this._drapeSourceRenderers,e=>e.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=Object(c["c"])(this._drapeSourceRenderers,e=>e.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=Object(c["c"])(this._drapeSourceRenderers,e=>e.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e);const i=this._rctx,r=i.bindTechnique(this._debugTextureTechnique);r.setUniform4f("uColor",t[0],t[1],t[2],1),r.bindTexture("tex",this._debugPatternTexture),i.bindVAO(this._quadVAO),i.drawArrays(A["r"].TRIANGLE_STRIP,0,Object(pe["f"])(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const i=new Uint8Array(e*t*4);let r=0;for(let n=0;n<t;n++)for(let a=0;a<e;a++){const s=Math.floor(a/10),o=Math.floor(n/10);s<2||o<2||10*s>e-20||10*o>t-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&s&&1&o?1&a^1&n?0:255:1&s^1&o?0:128)}this._debugPatternTexture=new ue["a"](this._rctx,{target:A["A"].TEXTURE_2D,pixelFormat:A["p"].RGBA,dataType:A["q"].UNSIGNED_BYTE,samplingMode:A["z"].NEAREST,width:e,height:t},i);const a=new ci;a.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(si,a),this._quadVAO=Object(q["b"])(this._rctx)}get test(){return{drapeSourceRenderers:this._drapeSourceRenderers,getDrapeSourceRenderer:e=>this._drapeSourceRenderers.get(e)}}};var Oi;Object(a["a"])([Object(p["b"])()],gi.prototype,"_frameTask",void 0),Object(a["a"])([Object(p["b"])()],gi.prototype,"_sortedDrapeSourceRenderersDirty",void 0),Object(a["a"])([G()],gi.prototype,"_shaderTechniqueRepository",void 0),Object(a["a"])([G()],gi.prototype,"_stippleTextureRepository",void 0),Object(a["a"])([Object(p["b"])({constructOnly:!0})],gi.prototype,"view",void 0),Object(a["a"])([Object(p["b"])()],gi.prototype,"worldToPCSRatio",void 0),Object(a["a"])([Object(p["b"])()],gi.prototype,"spatialReference",void 0),Object(a["a"])([Object(p["b"])({type:Boolean,readOnly:!0})],gi.prototype,"updating",null),gi=Object(a["a"])([Object(b["a"])("esri.views.3d.terrain.OverlayRenderer")],gi),function(e){e[e.Normal=0]="Normal",e[e.OccludedOnly=1]="OccludedOnly",e[e.ExcludeRasterImage=2]="ExcludeRasterImage"}(Oi||(Oi={}));class vi{constructor(e,t,i){this.drapeSource=e,this.renderer=t,this.index=i}}const yi=[[1,.5,.5],[.5,.5,1]],_i=new V["a"];_i.near=1,_i.far=1e4,_i.relativeElevation=null;const ji=-2,xi=X["c"].OccludeAndTransparent},"76a8":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae"),a=i("52b2");class n extends r["a"]{constructor(e,t,i){super(e,"vec4",a["a"].Pass,(i,r,a)=>i.setUniform4fv(e,t(r,a)),i)}}},"79a1":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae"),a=i("52b2");class n extends r["a"]{constructor(e,t){super(e,"int",a["a"].Pass,(i,r,a)=>i.setUniform1i(e,t(r,a)))}}},"7bf3":function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return a}));var r,a,n,s=i("afe1"),o=i("0b2d");class c{constructor(){this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=Object(o["f"])(),this.parallax={anchorPointClouds:Object(o["f"])(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Object(s["d"])()},this.parallaxNew={anchorPointClouds:Object(o["f"])(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Object(s["d"])()},this.crossFade={enabled:!1,factor:0,distanceThresholdFactor:.3},this.fadeInOut={stage:a.FINISHED,factor:0,distanceThresholdFactor:.6},this.fadeIn={stage:r.FINISHED,factor:0,distanceThresholdFactor:2},this.fadeInOutHeight={stage:n.FINISHED,factor:-1}}}!function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"}(r||(r={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}(a||(a={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(n||(n={}))},"7c1d":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("3886");function a(e){const t=r["b"]`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=r["b"]`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}},"7c51":function(e,t,i){"use strict";i.d(t,"a",(function(){return I})),i.d(t,"b",(function(){return A})),i.d(t,"c",(function(){return T})),i.d(t,"d",(function(){return R})),i.d(t,"e",(function(){return f})),i.d(t,"f",(function(){return v})),i.d(t,"g",(function(){return P})),i.d(t,"h",(function(){return C}));var r=i("b50f"),a=i("38a4"),n=i("b2b2"),s=i("e431"),o=i("0b2d"),c=i("4261"),l=i("b7c2"),d=i("da1c"),h=i("1153"),u=i("b7bd"),p=i("b623");const b=Object(c["f"])();function f(e,t,i,r,a,n,s){if(!Object(p["d"])(t))if(e.boundingInfo){Object(h["a"])(e.primitiveType===l["f"].Triangle);const t=i.tolerance;g(e.boundingInfo,r,a,t,n,s)}else{const t=e.indices.get(u["a"].POSITION),i=e.vertexAttributes.get(u["a"].POSITION);v(r,a,0,t.length/3,t,i,void 0,n,s)}}const m=Object(o["f"])();function g(e,t,i,r,a,s){if(Object(n["j"])(e))return;const o=S(t,i,m);if(Object(c["y"])(b,e.getBBMin()),Object(c["x"])(b,e.getBBMax()),Object(n["k"])(a)&&a.applyToAabb(b),T(b,t,o,r)){const{primitiveIndices:n,indices:o,position:c}=e,l=n?n.length:o.length/3;if(l>M){const n=e.getChildren();if(void 0!==n){for(let e=0;e<8;++e)void 0!==n[e]&&g(n[e],t,i,r,a,s);return}}v(t,i,0,l,o,c,n,a,s)}}const O=Object(o["f"])();function v(e,t,i,r,a,s,o,c,l){if(o)return y(e,t,i,r,a,s,o,c,l);const d=s.data,h=s.stride||s.size,u=e[0],p=e[1],b=e[2],f=t[0]-u,m=t[1]-p,g=t[2]-b;for(let v=i,y=3*i;v<r;++v){let e=h*a[y++],t=d[e++],i=d[e++],r=d[e];e=h*a[y++];let s=d[e++],o=d[e++],_=d[e];e=h*a[y++];let j=d[e++],S=d[e++],T=d[e];Object(n["k"])(c)&&([t,i,r]=c.applyToVertex(t,i,r,v),[s,o,_]=c.applyToVertex(s,o,_,v),[j,S,T]=c.applyToVertex(j,S,T,v));const w=s-t,C=o-i,A=_-r,P=j-t,R=S-i,E=T-r,I=m*E-R*g,M=g*P-E*f,D=f*R-P*m,L=w*I+C*M+A*D;if(Math.abs(L)<=Number.EPSILON)continue;const N=u-t,F=p-i,z=b-r,G=N*I+F*M+z*D;if(L>0){if(G<0||G>L)continue}else if(G>0||G<L)continue;const V=F*A-C*z,U=z*w-A*N,B=N*C-w*F,k=f*V+m*U+g*B;if(L>0){if(k<0||G+k>L)continue}else if(k>0||G+k<L)continue;const H=(P*V+R*U+E*B)/L;H>=0&&l(H,x(w,C,A,P,R,E,O),v,!1)}}function y(e,t,i,r,a,s,o,c,l){const d=s.data,h=s.stride||s.size,u=e[0],p=e[1],b=e[2],f=t[0]-u,m=t[1]-p,g=t[2]-b;for(let v=i;v<r;++v){const e=o[v];let t=3*e,i=h*a[t++],r=d[i++],s=d[i++],y=d[i];i=h*a[t++];let _=d[i++],j=d[i++],S=d[i];i=h*a[t];let T=d[i++],w=d[i++],C=d[i];Object(n["k"])(c)&&([r,s,y]=c.applyToVertex(r,s,y,v),[_,j,S]=c.applyToVertex(_,j,S,v),[T,w,C]=c.applyToVertex(T,w,C,v));const A=_-r,P=j-s,R=S-y,E=T-r,I=w-s,M=C-y,D=m*M-I*g,L=g*E-M*f,N=f*I-E*m,F=A*D+P*L+R*N;if(Math.abs(F)<=Number.EPSILON)continue;const z=u-r,G=p-s,V=b-y,U=z*D+G*L+V*N;if(F>0){if(U<0||U>F)continue}else if(U>0||U<F)continue;const B=G*R-P*V,k=V*A-R*z,H=z*P-A*G,W=f*B+m*k+g*H;if(F>0){if(W<0||U+W>F)continue}else if(W>0||U+W<F)continue;const q=(E*B+I*k+M*H)/F;q>=0&&l(q,x(A,P,R,E,I,M,O),e,!1)}}const _=Object(o["f"])(),j=Object(o["f"])();function x(e,t,i,r,a,n,o){return Object(s["w"])(_,e,t,i),Object(s["w"])(j,r,a,n),Object(s["j"])(o,_,j),Object(s["r"])(o,o),o}function S(e,t,i){return Object(s["w"])(i,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function T(e,t,i,r){return w(e,t,i,r,1/0)}function w(e,t,i,r,a){const n=(e[0]-r-t[0])*i[0],s=(e[3]+r-t[0])*i[0];let o=Math.min(n,s),c=Math.max(n,s);const l=(e[1]-r-t[1])*i[1],d=(e[4]+r-t[1])*i[1];if(c=Math.min(c,Math.max(l,d)),c<0)return!1;if(o=Math.max(o,Math.min(l,d)),o>c)return!1;const h=(e[2]-r-t[2])*i[2],u=(e[5]+r-t[2])*i[2];return c=Math.min(c,Math.max(h,u)),!(c<0)&&(o=Math.max(o,Math.min(h,u)),!(o>c)&&o<a)}function C(e,t,i,r,s){let o=(i.screenLength||0)*e.pixelRatio;Object(n["k"])(s)&&(o=Object(d["d"])(o,r,t,s));const c=o*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return Object(a["e"])(c*t,i.minWorldLength||0,null!=i.maxWorldLength?i.maxWorldLength:1/0)}function A(e,t){const i=t?A(t):{};for(const r in e){let t=e[r];t&&t.forEach&&(t=E(t)),null==t&&r in i||(i[r]=t)}return i}function P(e,t){let i=!1;for(const a in t){const n=t[a];void 0!==n&&(Array.isArray(n)?null===e[a]?(e[a]=n.slice(),i=!0):Object(r["l"])(e[a],n)&&(i=!0):e[a]!==n&&(i=!0,e[a]=n))}return i}function R(e,t,i,r,n,s){if(!t.options.selectionMode)return;const o=e.vertexAttributes.get(u["a"].POSITION).data,c=e.vertexAttributes.get(u["a"].SIZE),l=c&&c.data[0],d=r[0],h=r[1],p=((l+n)/2+4)*e.screenToWorldRatio;let b=Number.MAX_VALUE,f=0;for(let u=0;u<o.length-5;u+=3){const e=o[u],t=o[u+1],i=d-e,r=h-t,n=o[u+3]-e,s=o[u+4]-t,c=Object(a["e"])((n*i+s*r)/(n*n+s*s),0,1),l=n*c-i,p=s*c-r,m=l*l+p*p;m<b&&(b=m,f=u/3)}b<p*p&&s(i.dist,i.normal,f,!1)}function E(e){const t=[];return e.forEach(e=>t.push(e)),t}const I={multiply:1,ignore:2,replace:3,tint:4},M=1e3},"7cb4":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("6c97"),a=i("dfaf"),n=i("3886");function s(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(n["b"]`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function o(e,t){switch(e.include(a["a"],t),e.fragment.code.add(n["b"]`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),t.textureCoordinateType){case a["b"].Default:return void e.fragment.code.add(n["b"]`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case a["b"].Atlas:return e.include(s),void e.fragment.code.add(n["b"]`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:Object(r["a"])(t.textureCoordinateType);case a["b"].None:case a["b"].COUNT:return}}},"7d11":function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return h}));var r=i("dae5"),a=i("0fc4"),n=i("c332"),s=i("bc40"),o=i("3886"),c=i("037a"),l=i("aa1e");function d(e,t){t.normalType===n["b"].Attribute||t.normalType===n["b"].CompressedAttribute?(e.include(n["a"],t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add([new c["a"]("transformNormalGlobalFromModel",e=>e.transformNormalGlobalFromModel),new l["a"]("transformNormalViewFromGlobal",e=>e.transformNormalViewFromGlobal)]),e.vertex.code.add(o["b"]`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):t.normalType===n["b"].Ground?(e.include(s["a"],t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(o["b"]`
    void forwardNormal() {
      vNormalWorld = ${t.spherical?o["b"]`normalize(vPositionWorldCameraRelative);`:o["b"]`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(o["b"]`void forwardNormal() {}`)}class h extends s["c"]{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Object(r["b"])()}}class u extends s["b"]{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Object(r["b"])(),this.toMapSpace=Object(a["e"])()}}},"7e21":function(e,t,i){"use strict";i.d(t,"a",(function(){return g}));var r=i("a05b"),a=i("d272"),n=i("4db9"),s=i("c332"),o=i("dfaf"),c=i("7d11"),l=i("c2d1"),d=i("6a07"),h=i("be24"),u=i("ebd5"),p=i("8e97"),b=i("d8a4"),f=i("3886"),m=i("6a3c");function g(e,t){const i=e.vertex.code,g=e.fragment.code,O=t.hasModelTransformation;t.output!==r["a"].Depth&&t.output!==r["a"].Shadow||(Object(p["b"])(e,t),e.include(n["a"],{linearDepth:!0,hasModelTransformation:O}),e.include(o["a"],t),e.include(h["a"],t),e.include(l["a"],t),e.include(a["a"],t),e.vertex.uniforms.add(new b["a"]("nearFar",(e,t)=>t.camera.nearFar)),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add(new m["a"]("tex",e=>e.texture)),i.add(f["b"]`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, ${O?"model,":""} vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),e.include(u["a"],t),g.add(f["b"]`
      void main(void) {
        discardBySlice(vpos);
        ${t.hasColorTexture?f["b"]`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `)),t.output===r["a"].Normal&&(Object(p["b"])(e,t),e.include(n["a"],{linearDepth:!1,hasModelTransformation:O}),e.include(s["a"],t),e.include(c["a"],t),e.include(o["a"],t),e.include(h["a"],t),t.hasColorTexture&&e.fragment.uniforms.add(new m["a"]("tex",e=>e.texture)),e.varyings.add("vPositionView","vec3"),i.add(f["b"]`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${t.normalType===s["b"].Attribute?f["b"]`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${O?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(a["a"],t),e.include(u["a"],t),g.add(f["b"]`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?f["b"]`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${t.normalType===s["b"].ScreenDerivative?f["b"]`
            vec3 normal = screenDerivativeNormal(vPositionView);`:f["b"]`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `)),t.output===r["a"].Highlight&&(Object(p["b"])(e,t),e.include(n["a"],{linearDepth:!1,hasModelTransformation:O}),e.include(o["a"],t),e.include(h["a"],t),t.hasColorTexture&&e.fragment.uniforms.add(new m["a"]("tex",e=>e.texture)),i.add(f["b"]`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${O?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(a["a"],t),e.include(u["a"],t),e.include(d["a"]),g.add(f["b"]`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?f["b"]`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))}},"83fa":function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r,a=i("a4ee"),n=i("9ef0"),s=i("b2b2"),o=i("59b2"),c=(i("b50f"),i("c120"),i("cea0"),i("d386")),l=i("dee7"),d=i("88da");let h=r=class extends l["a"]{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=Object(s["k"])(e)?e.get(this):null;if(i)return i;const a=new r(this.clonePropertiesWithDeduplication(t));return Object(s["k"])(e)&&e.set(this,a),a}clonePropertiesWithDeduplication(e){return{...super.clonePropertiesWithDeduplication(e),emissiveColor:Object(s["k"])(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:Object(s["k"])(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:Object(s["k"])(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:Object(s["k"])(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null}}};Object(a["a"])([Object(o["b"])({type:n["a"],json:{write:!0}})],h.prototype,"emissiveColor",void 0),Object(a["a"])([Object(o["b"])({type:d["a"],json:{write:!0}})],h.prototype,"emissiveTexture",void 0),Object(a["a"])([Object(o["b"])({type:d["a"],json:{write:!0}})],h.prototype,"occlusionTexture",void 0),Object(a["a"])([Object(o["b"])({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],h.prototype,"metallic",void 0),Object(a["a"])([Object(o["b"])({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],h.prototype,"roughness",void 0),Object(a["a"])([Object(o["b"])({type:d["a"],json:{write:!0}})],h.prototype,"metallicRoughnessTexture",void 0),h=r=Object(a["a"])([Object(c["a"])("esri.geometry.support.MeshMaterialMetallicRoughness")],h);const u=h},"84f4":function(e,t,i){"use strict";function r(e){return"point"===e.type}i.d(t,"a",(function(){return r}))},"85b3":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae"),a=i("52b2");class n extends r["a"]{constructor(e,t){super(e,"mat4",a["a"].Pass,(i,r,a)=>i.setUniformMatrix4fv(e,t(r,a)))}}},8675:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return o}));var r=i("fc00"),a=i("b7bd"),n=i("5957");const s=Object(r["a"])().vec3f(a["a"].POSITION),o=Object(r["a"])().vec3f(a["a"].POSITION).vec2f(a["a"].UV0),c=Object(r["a"])().vec3f(a["a"].POSITION).vec4u8(a["a"].COLOR);class l{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(a["a"].POSITION).length}write(e,t,i,r){Object(n["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r)}}},"86ba":function(e,t,i){"use strict";i.d(t,"a",(function(){return V}));var r=i("e92d"),a=i("38a4"),n=i("b2b2"),s=i("a915"),o=i("3349"),c=i("e431"),l=i("0b2d"),d=i("0fc4"),h=i("d359"),u=i("bd7e"),p=i("7289"),b=i("fc00"),f=i("a05b"),m=i("1038"),g=i("d7f7"),O=i("b061"),v=i("35b3"),y=i("badc"),_=i("1153"),j=i("b7bd"),x=i("02a0"),S=i("b623"),T=i("9a68"),w=i("c3a4"),C=i("ca98"),A=i("b7c2"),P=i("7438"),R=i("c829"),E=i("87b7"),I=i("d17d"),M=i("189c");const D=new Map([[j["a"].POSITION,0],[j["a"].SUBDIVISIONFACTOR,1],[j["a"].UV0,2],[j["a"].AUXPOS1,3],[j["a"].AUXPOS2,4],[j["a"].COLOR,5],[j["a"].COLORFEATUREATTRIBUTE,5],[j["a"].SIZE,6],[j["a"].SIZEFEATUREATTRIBUTE,6],[j["a"].OPACITYFEATUREATTRIBUTE,7]]);class L extends C["a"]{constructor(e,t,i){super(e,t,i),this.stippleTextureRepository=e.stippleTextureRepository}initializeProgram(e){const t=L.shader.get().build(this.configuration);return new R["a"](e.rctx,t,D)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(this.program.bindPass(e,t),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.configuration.stippleEnabled){const{pixelSize:e,sdfNormalizer:t,pixels:i}=Object(n["k"])(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",t),this.program.setUniform1f("stipplePatternTextureSize",i),this.program.setUniform1f("stipplePatternPixelSize",e),this.program.setUniform1f("stipplePatternPixelSizeInv",1/e)}}_makePipelineState(e,t){const i=this.configuration,r=e===A["i"].NONE,a=e===A["i"].FrontFace;return Object(M["f"])({blending:i.output===f["a"].Color||i.output===f["a"].Alpha?r?P["d"]:Object(P["f"])(e):null,depthTest:{func:Object(P["g"])(e)},depthWrite:r?i.writeDepth&&M["d"]:Object(P["h"])(e),colorWrite:M["c"],stencilWrite:i.hasOccludees?E["h"]:null,stencilTest:i.hasOccludees?t?E["d"]:E["c"]:null,polygonOffset:r||a?i.hasPolygonOffset&&N:P["a"]})}initializePipeline(){const e=this.configuration;if(e.occluder){const t=e.hasPolygonOffset&&N;this._occluderPipelineTransparent=Object(M["f"])({blending:P["d"],polygonOffset:t,depthTest:E["a"],depthWrite:null,colorWrite:M["c"],stencilWrite:null,stencilTest:E["f"]}),this._occluderPipelineOpaque=Object(M["f"])({blending:P["d"],polygonOffset:t,depthTest:E["a"],depthWrite:null,colorWrite:M["c"],stencilWrite:E["g"],stencilTest:E["e"]}),this._occluderPipelineMaskWrite=Object(M["f"])({blending:null,polygonOffset:t,depthTest:E["b"],depthWrite:null,colorWrite:null,stencilWrite:E["h"],stencilTest:E["d"]})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?I["r"].LINES:I["r"].TRIANGLE_STRIP}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?e===y["a"].TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===y["a"].OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,t)}}L.shader=new w["a"](T["b"],()=>i.e("chunk-2d213386").then(i.bind(null,"ac6d")));const N={factor:0,units:-4};var F=i("a6b6");const z=r["a"].getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var G;!function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"}(G||(G={}));class V extends v["a"]{constructor(e){super(e,new B),this._vertexAttributeLocations=D,this.techniqueConfig=new F["b"],this.layout=this.createLayout()}isClosed(e,t){return q(this.parameters,e,t)}getConfiguration(e,t){this.techniqueConfig.output=e,this.techniqueConfig.draped=t.slot===y["a"].DRAPED_MATERIAL;const i=Object(n["k"])(this.parameters.stipplePattern)&&e!==f["a"].Highlight;return this.techniqueConfig.stippleEnabled=i,this.techniqueConfig.stippleOffColorEnabled=i&&Object(n["k"])(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.roundJoins="round"===this.parameters.join,this.techniqueConfig.capType=this.parameters.cap,this.techniqueConfig.hasPolygonOffset=this.parameters.hasPolygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&Object(n["k"])(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=this.parameters.renderOccluded===v["c"].OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig.wireframe=this.parameters.wireframe,this.techniqueConfig}intersect(e,t,i,r,a,s,o,c,l){Object(n["k"])(l)?this._intersectDrapedLineGeometry(e,r,l,s,o):this._intersectLineGeometry(e,t,i,r,o)}_intersectDrapedLineGeometry(e,t,i,r,n){if(!t.options.selectionMode)return;const s=e.vertexAttributes.get(j["a"].POSITION).data,o=e.vertexAttributes.get(j["a"].SIZE);let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const t=e.vertexAttributes.get(j["a"].SIZEFEATUREATTRIBUTE).data[0];c*=Object(a["e"])(this.parameters.vvSizeOffset[0]+t*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o&&(c*=o.data[0]);const l=r[0],d=r[1],h=(c/2+4)*e.screenToWorldRatio;let u=Number.MAX_VALUE,p=0;for(let b=0;b<s.length-5;b+=3){const e=s[b],t=s[b+1],i=l-e,r=d-t,n=s[b+3]-e,o=s[b+4]-t,c=Object(a["e"])((n*i+o*r)/(n*n+o*o),0,1),h=n*c-i,f=o*c-r,m=h*h+f*f;m<u&&(u=m,p=b/3)}u<h*h&&n(i.dist,i.normal,p,!1)}_intersectLineGeometry(e,t,i,r,n){if(!r.options.selectionMode||Object(S["d"])(t))return;if(!Object(_["f"])(i))return void z.error("intersection assumes a translation-only matrix");const s=e.vertexAttributes,l=s.get(j["a"].POSITION).data;let d=this.parameters.width;if(this.parameters.vvSizeEnabled){const e=s.get(j["a"].SIZEFEATUREATTRIBUTE).data[0];d*=Object(a["e"])(this.parameters.vvSizeOffset[0]+e*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else s.has(j["a"].SIZE)&&(d*=s.get(j["a"].SIZE).data[0]);const b=r.camera,f=J;Object(o["c"])(f,r.point);const m=d*b.pixelRatio/2+4*b.pixelRatio;Object(c["w"])(oe[0],f[0]-m,f[1]+m,0),Object(c["w"])(oe[1],f[0]+m,f[1]+m,0),Object(c["w"])(oe[2],f[0]+m,f[1]-m,0),Object(c["w"])(oe[3],f[0]-m,f[1]-m,0);for(let a=0;a<4;a++)if(!b.unprojectFromRenderScreen(oe[a],ce[a]))return;Object(p["f"])(b.eye,ce[0],ce[1],le),Object(p["f"])(b.eye,ce[1],ce[2],de),Object(p["f"])(b.eye,ce[2],ce[3],he),Object(p["f"])(b.eye,ce[3],ce[0],ue);let g=Number.MAX_VALUE,O=0;const v=W(this.parameters,s,e.indices)?l.length-2:l.length-5;for(let a=0;a<v;a+=3){$[0]=l[a]+i[12],$[1]=l[a+1]+i[13],$[2]=l[a+2]+i[14];const e=(a+3)%l.length;if(X[0]=l[e]+i[12],X[1]=l[e+1]+i[13],X[2]=l[e+2]+i[14],Object(p["u"])(le,$)<0&&Object(p["u"])(le,X)<0||Object(p["u"])(de,$)<0&&Object(p["u"])(de,X)<0||Object(p["u"])(he,$)<0&&Object(p["u"])(he,X)<0||Object(p["u"])(ue,$)<0&&Object(p["u"])(ue,X)<0)continue;if(b.projectToRenderScreen($,Q),b.projectToRenderScreen(X,K),Q[2]<0&&K[2]>0){Object(c["f"])(Y,$,X);const e=b.frustum,t=-Object(p["u"])(e[h["a"].NEAR],$)/Object(c["i"])(Y,Object(p["q"])(e[h["a"].NEAR]));Object(c["k"])(Y,Y,t),Object(c["e"])($,$,Y),b.projectToRenderScreen($,Q)}else if(Q[2]>0&&K[2]<0){Object(c["f"])(Y,X,$);const e=b.frustum,t=-Object(p["u"])(e[h["a"].NEAR],X)/Object(c["i"])(Y,Object(p["q"])(e[h["a"].NEAR]));Object(c["k"])(Y,Y,t),Object(c["e"])(X,X,Y),b.projectToRenderScreen(X,K)}else if(Q[2]<0&&K[2]<0)continue;Q[2]=0,K[2]=0;const t=Object(u["e"])(Object(u["f"])(Q,K,ie),f);t<g&&(g=t,Object(c["g"])(ee,$),Object(c["g"])(te,X),O=a/3)}const y=r.rayBegin,x=r.rayEnd;if(g<m*m){let e=Number.MAX_VALUE;if(Object(u["a"])(Object(u["f"])(ee,te,ie),Object(u["f"])(y,x,re),Z)){Object(c["f"])(Z,Z,y);const t=Object(c["p"])(Z);Object(c["k"])(Z,Z,1/t),e=t/Object(c["m"])(y,x)}n(e,Z,O,!1)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return null;const r=e.indices,a=i.get(j["a"].POSITION);return Object(m["a"])(a,r?r.get(j["a"].POSITION):null,r&&W(this.parameters,i,r),t)}createLayout(){const e=Object(b["a"])().vec3f(j["a"].POSITION).f32(j["a"].SUBDIVISIONFACTOR).vec2f(j["a"].UV0).vec3f(j["a"].AUXPOS1).vec3f(j["a"].AUXPOS2);return this.parameters.vvSizeEnabled?e.f32(j["a"].SIZEFEATUREATTRIBUTE):e.f32(j["a"].SIZE),this.parameters.vvColorEnabled?e.f32(j["a"].COLORFEATUREATTRIBUTE):e.vec4f(j["a"].COLOR),this.parameters.vvOpacityEnabled&&e.f32(j["a"].OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new k(this.layout,this.parameters)}requiresSlot(e,t){if(e===y["a"].DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===v["c"].OccludeAndTransparentStencil)return e===y["a"].OPAQUE_MATERIAL||e===y["a"].OCCLUDER_MATERIAL||e===y["a"].TRANSPARENT_OCCLUDER_MATERIAL;const i=Object(O["b"])(t);return i===f["a"].Color||i===f["a"].Alpha?e===(this.parameters.writeDepth?y["a"].TRANSPARENT_MATERIAL:y["a"].TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===y["a"].OPAQUE_MATERIAL}createGLMaterial(e){return e.output===f["a"].Color||e.output===f["a"].Alpha||e.output===f["a"].Highlight||e.output===f["a"].Depth?new U(e):null}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0)}}class U extends g["a"]{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==f["a"].Color&&this._output!==f["a"].Alpha||this._updateOccludeeState(e),this.ensureTechnique(L,e)}}class B extends x["a"]{constructor(){super(...arguments),this.width=0,this.color=d["a"],this.join="miter",this.cap=F["a"].BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class k{constructor(e,t){this.parameters=t,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const i=t.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=T["a"]+i}}_isClosed(e){return W(this.parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=2,i=e.indices.get(j["a"].POSITION).length/2+1,r=this._isClosed(e);let a=r?2:2*t;return a+=((r?i:i-1)-(r?0:1))*(2*this.numJoinSubdivisions+4),a+=2,this.parameters.wireframe&&(a=2+4*(a-2)),a}write(e,t,i,r){var a;const n=ae,s=ne,o=se,l=t.vertexAttributes.get(j["a"].POSITION).data,d=t.indices&&t.indices.get(j["a"].POSITION),h=null==(a=t.vertexAttributes.get(j["a"].DISTANCETOSTART))?void 0:a.data;d&&d.length!==2*(l.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let u=1,p=0;this.parameters.vvSizeEnabled?p=t.vertexAttributes.get(j["a"].SIZEFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(j["a"].SIZE)&&(u=t.vertexAttributes.get(j["a"].SIZE).data[0]);let b=[1,1,1,1],f=0;this.parameters.vvColorEnabled?f=t.vertexAttributes.get(j["a"].COLORFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(j["a"].COLOR)&&(b=t.vertexAttributes.get(j["a"].COLOR).data);let m=0;this.parameters.vvOpacityEnabled&&(m=t.vertexAttributes.get(j["a"].OPACITYFEATUREATTRIBUTE).data[0]);const g=l.length/3,O=e.transformation,v=new Float32Array(i.buffer),y=this.vertexBufferLayout.stride/4;let _=r*y;const x=_;let S=0;const T=h?(e,t,i)=>S=h[i]:(e,t,i)=>S+=Object(c["m"])(e,t),w=(e,t,i,r,a,n,s)=>{if(v[_++]=t[0],v[_++]=t[1],v[_++]=t[2],v[_++]=r,v[_++]=s,v[_++]=a,v[_++]=e[0],v[_++]=e[1],v[_++]=e[2],v[_++]=i[0],v[_++]=i[1],v[_++]=i[2],this.parameters.vvSizeEnabled?v[_++]=p:v[_++]=u,this.parameters.vvColorEnabled)v[_++]=f;else{const e=Math.min(4*n,b.length-4);v[_++]=b[e+0],v[_++]=b[e+1],v[_++]=b[e+2],v[_++]=b[e+3]}this.parameters.vvOpacityEnabled&&(v[_++]=m)};_+=y,Object(c["w"])(s,l[0],l[1],l[2]),O&&Object(c["q"])(s,s,O);const C=this._isClosed(t);if(C){const e=l.length-3;Object(c["w"])(n,l[e],l[e+1],l[e+2]),O&&Object(c["q"])(n,n,O)}else Object(c["w"])(o,l[3],l[4],l[5]),O&&Object(c["q"])(o,o,O),w(s,s,o,1,G.LEFT_CAP_START,0,0),w(s,s,o,1,G.RIGHT_CAP_START,0,0),Object(c["g"])(n,s),Object(c["g"])(s,o);const A=C?0:1,P=C?g:g-1;for(let j=A;j<P;j++){const e=(j+1)%g*3;Object(c["w"])(o,l[e+0],l[e+1],l[e+2]),O&&Object(c["q"])(o,o,O),T(n,s,j),w(n,s,o,0,G.LEFT_JOIN_END,j,S),w(n,s,o,0,G.RIGHT_JOIN_END,j,S);const t=this.numJoinSubdivisions;for(let i=0;i<t;++i){const e=(i+1)/(t+1);w(n,s,o,e,G.LEFT_JOIN_END,j,S),w(n,s,o,e,G.RIGHT_JOIN_END,j,S)}w(n,s,o,1,G.LEFT_JOIN_START,j,S),w(n,s,o,1,G.RIGHT_JOIN_START,j,S),Object(c["g"])(n,s),Object(c["g"])(s,o)}C?(Object(c["w"])(o,l[3],l[4],l[5]),O&&Object(c["q"])(o,o,O),S=T(n,s,P),w(n,s,o,0,G.LEFT_JOIN_END,A,S),w(n,s,o,0,G.RIGHT_JOIN_END,A,S)):(S=T(n,s,P),w(n,s,s,0,G.LEFT_CAP_END,P,S),w(n,s,s,0,G.RIGHT_CAP_END,P,S)),H(v,x+y,v,x,y),_=H(v,_-y,v,_,y),this.parameters.wireframe&&this._addWireframeVertices(i,x,_,y)}_addWireframeVertices(e,t,i,r){const a=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),n=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,i-t);let s=0;const o=e=>s=H(n,e,a,s,r);for(let c=0;c<n.length-1;c+=2*r)o(c),o(c+2*r),o(c+1*r),o(c+2*r),o(c+1*r),o(c+3*r)}}function H(e,t,i,r,a){for(let n=0;n<a;n++)i[r++]=e[t++];return r}function W(e,t,i){return q(e,t.get(j["a"].POSITION).data,i?i.get(j["a"].POSITION):null)}function q(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}const $=Object(l["f"])(),X=Object(l["f"])(),Y=Object(l["f"])(),Z=Object(l["f"])(),J=Object(l["f"])(),Q=Object(s["d"])(),K=Object(s["d"])(),ee=Object(l["f"])(),te=Object(l["f"])(),ie=Object(u["d"])(),re=Object(u["d"])(),ae=Object(l["f"])(),ne=Object(l["f"])(),se=Object(l["f"])(),oe=[Object(s["d"])(),Object(s["d"])(),Object(s["d"])(),Object(s["d"])()],ce=[Object(l["f"])(),Object(l["f"])(),Object(l["f"])(),Object(l["f"])()],le=Object(p["d"])(),de=Object(p["d"])(),he=Object(p["d"])(),ue=Object(p["d"])()},"87b7":function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return h})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return c})),i.d(t,"h",(function(){return o}));var r=i("b7c2"),a=i("d17d");const n={func:a["h"].LESS},s={func:a["h"].ALWAYS},o={mask:255},c={mask:0},l={function:{func:a["h"].ALWAYS,ref:r["h"].OutlineVisualElementMask,mask:r["h"].OutlineVisualElementMask},operation:{fail:a["w"].KEEP,zFail:a["w"].KEEP,zPass:a["w"].ZERO}},d={function:{func:a["h"].ALWAYS,ref:r["h"].OutlineVisualElementMask,mask:r["h"].OutlineVisualElementMask},operation:{fail:a["w"].KEEP,zFail:a["w"].KEEP,zPass:a["w"].REPLACE}},h={function:{func:a["h"].EQUAL,ref:r["h"].OutlineVisualElementMask,mask:r["h"].OutlineVisualElementMask},operation:{fail:a["w"].KEEP,zFail:a["w"].KEEP,zPass:a["w"].KEEP}},u={function:{func:a["h"].NOTEQUAL,ref:r["h"].OutlineVisualElementMask,mask:r["h"].OutlineVisualElementMask},operation:{fail:a["w"].KEEP,zFail:a["w"].KEEP,zPass:a["w"].KEEP}}},"88da":function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var r,a=i("a4ee"),n=(i("c120"),i("6a0e")),s=i("59b2"),o=(i("b50f"),i("cea0")),c=i("afcf"),l=i("d386"),d=i("09db"),h=i("fcf2"),u=i("4dc1");const p=new WeakMap;let b=0,f=r=class extends n["a"]{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,i,r){if(e instanceof HTMLImageElement){const a={type:"image-element",src:Object(h["g"])(e.src,r),crossOrigin:e.crossOrigin};t[i]=a}else if(e instanceof HTMLCanvasElement){const r=e.getContext("2d").getImageData(0,0,e.width,e.height),a={type:"canvas-element",imageData:this._encodeImageData(r)};t[i]=a}else if(e instanceof HTMLVideoElement){const a={type:"video-element",src:Object(h["g"])(e.src,r),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[i]=a}else{const r={type:"image-data",imageData:this._encodeImageData(e)};t[i]=r}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),i=document.createElement("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").putImageData(t,0,0),i}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const e=t.substr(t.length-4,4).toLowerCase(),i=t.substr(0,15).toLocaleLowerCase();if(".png"===e||"data:image/png;"===i)return!0}return!1}set transparent(e){null!=e?this._override("transparent",e):this._clearOverride("transparent")}get contentHash(){const e="string"==typeof this.wrap?this.wrap:"object"==typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(t="")=>`d:${t},t:${this.transparent},w:${e}`;return null!=this.url?t(this.url):null!=this.data?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(p.has(this.data)||p.set(this.data,++b),t(p.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new r(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const i=this.clone();return e.set(this,i),i}_cloneWrap(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let i=0;i<e.data.length;i++)t+=String.fromCharCode(e.data[i]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),i=new Uint8ClampedArray(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return Object(u["g"])(i,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(255!==e.data[t])return!0;return!1}static from(e){return"string"==typeof e?new r({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new r({data:e}):Object(o["d"])(r,e)}};Object(a["a"])([Object(s["b"])({type:String,json:{write:h["h"]}})],f.prototype,"url",null),Object(a["a"])([Object(s["b"])({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),Object(s["b"])()],f.prototype,"data",null),Object(a["a"])([Object(d["a"])("data")],f.prototype,"writeData",null),Object(a["a"])([Object(c["a"])("data")],f.prototype,"readData",null),Object(a["a"])([Object(s["b"])({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],f.prototype,"transparent",null),Object(a["a"])([Object(s["b"])({json:{write:!0}})],f.prototype,"wrap",void 0),Object(a["a"])([Object(s["b"])({readOnly:!0})],f.prototype,"contentHash",null),f=r=Object(a["a"])([Object(l["a"])("esri.geometry.support.MeshTexture")],f);const m=f},"89bf":function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return S})),i.d(t,"c",(function(){return x}));var r=i("b2b2"),a=i("1c92"),n=i("dae5"),s=i("d791"),o=i("afe1"),c=i("04f0"),l=i("b139"),d=i("e431"),h=i("47f8"),u=i("0b2d"),p=i("f895");class b{constructor(){this._transform=Object(o["d"])(),this._transformInverse=new f({value:this._transform},s["a"],o["d"]),this._transformInverseTranspose=new f(this._transformInverse,s["t"],o["d"]),this._transformTranspose=new f({value:this._transform},s["t"],o["d"]),this._transformInverseRotation=new f({value:this._transform},a["k"],n["b"])}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Object(s["c"])(this._transform,e)}multiplyTransform(e){Object(s["m"])(this._transform,this._transform,e)}set(e){Object(s["c"])(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this._invalidateLazyTransforms()}}class f{constructor(e,t,i){this.original=e,this.update=t,this.dirty=!0,this.transform=i()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class m{constructor(e=0){this.offset=e,this.tmpVertex=Object(u["f"])()}applyToVertex(e,t,i){const r=e+this.localOrigin[0],a=t+this.localOrigin[1],n=i+this.localOrigin[2],s=this.offset/Math.sqrt(r*r+a*a+n*n);return this.tmpVertex[0]=e+r*s,this.tmpVertex[1]=t+a*s,this.tmpVertex[2]=i+n*s,this.tmpVertex}applyToAabb(e){for(let a=0;a<3;++a)g[a]=e[0+a]+this.localOrigin[a],O[a]=e[3+a]+this.localOrigin[a],v[a]=g[a];const t=this.applyToVertex(g[0],g[1],g[2]);for(let a=0;a<3;++a)e[a]=t[a],e[a+3]=t[a];const i=t=>{const i=this.applyToVertex(t[0],t[1],t[2]);for(let r=0;r<3;++r)e[r+0]=Math.min(e[r+0],i[r]),e[r+3]=Math.max(e[r+3],i[r])};for(let a=1;a<8;++a){for(let e=0;e<3;++e)v[e]=0==(a&1<<e)?g[e]:O[e];i(v)}let r=0;for(let a=0;a<3;++a)g[a]*O[a]<0&&(r|=1<<a);if(0!==r&&7!==r)for(let a=0;a<8;++a)if(0==(r&a)){for(let e=0;e<3;++e)r[e]?v[e]=0:v[e]=0!=(a&1<<e)?g[e]:O[e];i(v)}for(let a=0;a<3;++a)e[a+0]-=this.localOrigin[a],e[a+3]-=this.localOrigin[a];return e}}const g=Object(u["f"])(),O=Object(u["f"])(),v=Object(u["f"])();class y{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=Object(u["f"])(),this._mbs=Object(p["c"])(),this._obb={center:Object(u["f"])(),halfSize:Object(h["b"])(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,t,i){const r=e,a=t,n=i+this.componentLocalOriginLength,s=this._totalOffset/Math.sqrt(r*r+a*a+n*n);return this._tmpVertex[0]=e+r*s,this._tmpVertex[1]=t+a*s,this._tmpVertex[2]=i+n*s,this._tmpVertex}applyToAabb(e){const t=e[0],i=e[1],r=e[2]+this.componentLocalOriginLength,a=e[3],n=e[4],s=e[5]+this.componentLocalOriginLength,o=t*a<0?0:Math.min(Math.abs(t),Math.abs(a)),c=i*n<0?0:Math.min(Math.abs(i),Math.abs(n)),l=r*s<0?0:Math.min(Math.abs(r),Math.abs(s)),d=Math.sqrt(o*o+c*c+l*l);if(d<this._totalOffset)return e[0]-=t<0?this._totalOffset:0,e[1]-=i<0?this._totalOffset:0,e[2]-=r<0?this._totalOffset:0,e[3]+=a>0?this._totalOffset:0,e[4]+=n>0?this._totalOffset:0,e[5]+=s>0?this._totalOffset:0,e;const h=Math.max(Math.abs(t),Math.abs(a)),u=Math.max(Math.abs(i),Math.abs(n)),p=Math.max(Math.abs(r),Math.abs(s)),b=Math.sqrt(h*h+u*u+p*p),f=this._totalOffset/b,m=this._totalOffset/d;return e[0]+=t*(t>0?f:m),e[1]+=i*(i>0?f:m),e[2]+=r*(r>0?f:m),e[3]+=a*(a<0?f:m),e[4]+=n*(n<0?f:m),e[5]+=s*(s<0?f:m),e}applyToMbs(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this._totalOffset/t;return this._mbs[0]=e[0]+e[0]*i,this._mbs[1]=e[1]+e[1]*i,this._mbs[2]=e[2]+e[2]*i,this._mbs[3]=e[3]+e[3]*this._totalOffset/t,this._mbs}applyToObb(e){const t=e.center,i=this._totalOffset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this._obb.center[0]=t[0]+t[0]*i,this._obb.center[1]=t[1]+t[1]*i,this._obb.center[2]=t[2]+t[2]*i,Object(d["u"])(this._obb.halfSize,e.halfSize,e.quaternion),Object(d["e"])(this._obb.halfSize,this._obb.halfSize,e.center);const r=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*r,this._obb.halfSize[1]+=this._obb.halfSize[1]*r,this._obb.halfSize[2]+=this._obb.halfSize[2]*r,Object(d["f"])(this._obb.halfSize,this._obb.halfSize,e.center),Object(c["a"])(T,e.quaternion),Object(d["u"])(this._obb.halfSize,this._obb.halfSize,T),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}}class _{constructor(e=0){this.offset=e,this.sphere=Object(p["c"])(),this.tmpVertex=Object(u["f"])()}applyToVertex(e,t,i){const r=this.objectTransform.transform;let a=r[0]*e+r[4]*t+r[8]*i+r[12],n=r[1]*e+r[5]*t+r[9]*i+r[13],s=r[2]*e+r[6]*t+r[10]*i+r[14];const o=this.offset/Math.sqrt(a*a+n*n+s*s);a+=a*o,n+=n*o,s+=s*o;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*a+c[4]*n+c[8]*s+c[12],this.tmpVertex[1]=c[1]*a+c[5]*n+c[9]*s+c[13],this.tmpVertex[2]=c[2]*a+c[6]*n+c[10]*s+c[14],this.tmpVertex}applyToMinMax(e,t){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/t;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}}const j=new _;function x(e){return Object(r["k"])(e)?(j.offset=e,j):null}new y;new m;const S="terrain",T=Object(l["b"])()},"89cb":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("ce50"),a=i("e92d"),n=i("008c");function s(e,t,i,r,n){const s=e.referencesGeometry()&&n?c(t,r,n):t,o=e.repurposeFeature(s);try{return e.evaluate({...i,$feature:o})}catch(l){return a["a"].getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",l),null}}const o=new Map;function c(e,t,i){const{transform:r,hasZ:a,hasM:n}=i;o.has(t)||o.set(t,l(t));const s=o.get(t)(e.geometry,r,a,n);return{...e,geometry:s}}function l(e){const t={};switch(e){case"esriGeometryPoint":return(e,i,r,a)=>Object(n["e"])(i,t,e,r,a);case"esriGeometryPolygon":return(e,i,r,a)=>Object(n["f"])(i,t,e,r,a);case"esriGeometryPolyline":return(e,i,r,a)=>Object(n["g"])(i,t,e,r,a);case"esriGeometryMultipoint":return(e,i,r,a)=>Object(n["d"])(i,t,e,r,a);default:return a["a"].getLogger("esri.views.2d.support.arcadeOnDemand").error(new r["a"]("mapview-arcade","Unable to handle geometryType: "+e)),e=>e}}},"8a80":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("62ae");class a extends r["a"]{constructor(e){super(e,"float")}}},"8c4b":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("38a4");function a(e,t,i){var a;const l=e.byteLength/(4*t),d=new Uint32Array(e,0,l*t);let h=new Uint32Array(l);const u=null!=(a=null==i?void 0:i.minReduction)?a:0,p=(null==i?void 0:i.originalIndices)||null,b=p?p.length:0,f=(null==i?void 0:i.componentOffsets)||null;let m=0;if(f)for(let r=0;r<f.length-1;r++){const e=f[r+1]-f[r];e>m&&(m=e)}else m=l;const g=Math.floor(1.1*m)+1;(null==c||c.length<2*g)&&(c=new Uint32Array(Object(r["m"])(2*g)));for(let r=0;r<2*g;r++)c[r]=0;let O=0;const v=!!f&&!!p,y=v?b:l,_=v?new Uint32Array(b):null,j=1.96;let x=0!==u?Math.ceil(4*j*j/(u*u)*u*(1-u)):y,S=1,T=f?f[1]:y;for(let r=0;r<y;r++){if(r===x){const e=1-O/r;if(e+j*Math.sqrt(e*(1-e)/r)<u)return null;x*=2}if(r===T){for(let e=0;e<2*g;e++)c[e]=0;if(p)for(let e=f[S-1];e<f[S];e++)_[e]=h[p[e]];T=f[++S]}const e=v?p[r]:r,i=e*t,a=o(d,i,t);let s=a%g,l=O;for(;0!==c[2*s+1];){if(c[2*s]===a){const e=c[2*s+1]-1;if(n(d,i,e*t,t)){l=h[e];break}}s++,s>=g&&(s-=g)}l===O&&(c[2*s]=a,c[2*s+1]=e+1,O++),h[e]=l}if(0!==u&&1-O/l<u)return null;if(v){for(let e=f[S-1];e<_.length;e++)_[e]=h[p[e]];h=_}const w=new Uint32Array(t*O);O=0;for(let r=0;r<y;r++)h[r]===O&&(s(d,(v?p[r]:r)*t,w,O*t,t),O++);if(p&&!v){const e=new Uint32Array(b);for(let t=0;t<e.length;t++)e[t]=h[p[t]];h=e}return{buffer:w.buffer,indices:h,uniqueCount:O}}function n(e,t,i,r){for(let a=0;a<r;a++)if(e[t+a]!==e[i+a])return!1;return!0}function s(e,t,i,r,a){for(let n=0;n<a;n++)i[r+n]=e[t+n]}function o(e,t,i){let r=0;for(let a=0;a<i;a++)r=e[t+a]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let c=null},"8e97":function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return b}));var r=i("d791"),a=i("970c"),n=i("e431"),s=i("0b2d"),o=i("35f0"),c=i("ea32"),l=i("62ae"),d=i("52b2");class h extends l["a"]{constructor(e,t){super(e,"mat4",d["a"].Draw,(i,r,a)=>i.setUniformMatrix4fv(e,t(r,a)))}}var u=i("85b3");function p(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",s["c"]):e.uniforms.add(new o["a"]("cameraPosition",(e,t)=>Object(n["w"])(m,t.camera.viewInverseTransposeMatrix[3]-e.origin[0],t.camera.viewInverseTransposeMatrix[7]-e.origin[1],t.camera.viewInverseTransposeMatrix[11]-e.origin[2])))}function b(e,t){if(e.vertex.uniforms.add(new u["a"]("proj",(e,t)=>t.camera.projectionMatrix)),t.instancedDoublePrecision){const t=(e,t)=>Object(n["w"])(m,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]);e.vertex.uniforms.add(new u["a"]("view",(e,i)=>Object(r["j"])(f,i.camera.viewMatrix,t(e,i))));const i=new c["a"]("localOrigin",t);return e.vertex.uniforms.add(i),i}e.vertex.uniforms.add(new h("view",(e,t)=>Object(r["j"])(f,t.camera.viewMatrix,e.origin)));const i=new o["a"]("localOrigin",e=>e.origin);return e.vertex.uniforms.add(i),i}const f=Object(a["a"])(),m=Object(s["f"])()},9250:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return j}));var r=i("b2b2"),a=i("d791"),n=i("afe1"),s=i("e431"),o=i("0b2d"),c=i("7577"),l=i("0fc4"),d=i("d18f"),h=i("3c9c"),u=i("1942");i("0d9f");function p(e){return Object(r["k"])(e)&&Object(r["k"])(e.dist)}Object(o["f"])();var b=i("89bf"),f=i("b623");const m=1e-5;class g{constructor(e){this.options=new u["a"],this._results=new v,this.transform=new b["a"],this.tolerance=m,this.verticalOffset=null,this._ray=Object(d["c"])(),this._rayEnd=Object(o["f"])(),this._rayBeginTransformed=Object(o["f"])(),this._rayEndTransformed=Object(o["f"])(),this.viewingMode=null==e?h["a"].Global:e}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,i){this.resetWithRay(Object(d["e"])(e,t,this._ray),i)}resetWithRay(e,t){this.camera=t,e!==this._ray&&Object(d["b"])(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===h["a"].Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Object(s["e"])(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,t,i,a,n){this.point=t,this.filterPredicate=a,this.tolerance=null==i?m:i;const s=Object(b["c"])(this.verticalOffset);if(Object(r["k"])(e)&&e.length>0){const t=n?e=>{n(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const i of e){const e=i.getSpatialQueryAccelerator&&i.getSpatialQueryAccelerator();Object(r["k"])(e)?(Object(r["k"])(s)?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,s):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):i.objects.forAll(e=>t(e))}}this.sortResults()}intersectObject(e){const t=e.geometryRecords;if(!t)return;const i=e.transformation,a=Object(b["c"])(this.verticalOffset);for(const o of t){const{geometry:t,material:c,instanceParameters:l}=o;if(Object(f["d"])(l))continue;const d=t.id;this.transform.setAndInvalidateLazyTransforms(i,o.getShaderTransformation()),Object(s["q"])(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Object(s["q"])(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const h=this.transform.transform;Object(r["k"])(a)&&(a.objectTransform=this.transform),c.intersect(t,l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(t,i,a,s,o,c)=>{if(t>=0){if(Object(r["k"])(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;const l=s?this._results.hud:this._results,p=s?s=>{const l={object:e,geometryId:d,triangleNr:a,center:Object(r["k"])(c)?[c[0],c[1],c[2]]:null};s.set(u["b"].HUD,l,t,i,n["a"],o)}:r=>r.set(u["b"].OBJECT,{object:e,geometryId:d,triangleNr:a},t,i,h,o);if((null==l.min.drapedLayerOrder||o>=l.min.drapedLayerOrder)&&(null==l.min.dist||t<l.min.dist)&&p(l.min),this.options.store!==u["c"].MIN&&(null==l.max.drapedLayerOrder||o<l.max.drapedLayerOrder)&&(null==l.max.dist||t>l.max.dist)&&p(l.max),this.options.store===u["c"].ALL)if(s){const e=new _(this._ray);p(e),this._results.hud.all.push(e)}else{const e=new y(this._ray);p(e),this._results.all.push(e)}}},o.shaderTransformation)}}sortResults(e=this._results.all){e.sort((e,t)=>e.dist!==t.dist?Object(r["s"])(e.dist,0)-Object(r["s"])(t.dist,0):e.drapedLayerOrder!==t.drapedLayerOrder?Object(r["s"])(e.drapedLayerOrder,Number.MAX_VALUE)-Object(r["s"])(t.drapedLayerOrder,Number.MAX_VALUE):Object(r["s"])(t.drapedLayerGraphicOrder,Number.MIN_VALUE)-Object(r["s"])(e.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function O(e){return new g(e)}class v{constructor(){this.min=new y(Object(d["c"])()),this.max=new y(Object(d["c"])()),this.hud={min:new _(Object(d["c"])()),max:new _(Object(d["c"])()),all:new Array},this.ground=new y(Object(d["c"])()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}class y{constructor(e){this.intersector=u["b"].OBJECT,this.normal=Object(o["f"])(),this.transformation=Object(n["d"])(),this._ray=Object(d["c"])(),this.init(e)}get ray(){return this._ray}get distanceInRenderSpace(){return Object(r["k"])(this.dist)?(Object(s["k"])(x,this.ray.direction,this.dist),Object(s["p"])(x)):null}getIntersectionPoint(e){return!!p(this)&&(Object(s["k"])(x,this.ray.direction,this.dist),Object(s["e"])(e,this.ray.origin,x),!0)}getTransformedNormal(e){return Object(s["g"])(S,this.normal),S[3]=0,Object(c["m"])(S,S,this.transformation),Object(s["g"])(e,S),Object(s["r"])(e,e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=u["b"].OBJECT,Object(d["b"])(e,this._ray)}set(e,t,i,c,l,d,h){this.intersector=e,this.dist=i,Object(s["g"])(this.normal,Object(r["s"])(c,o["b"])),Object(a["c"])(this.transformation,Object(r["s"])(l,n["a"])),this.target=t,this.drapedLayerOrder=d,this.drapedLayerGraphicOrder=h}copy(e){Object(d["b"])(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Object(s["g"])(this.normal,e.normal),Object(a["c"])(this.transformation,e.transformation)}}class _ extends y{constructor(){super(...arguments),this.intersector=u["b"].HUD}}function j(e){return new y(e)}const x=Object(o["f"])(),S=Object(l["e"])()},"94a6":function(e,t,i){"use strict";i.r(t),i.d(t,"fetch",(function(){return X})),i.d(t,"gltfToEngineResources",(function(){return Z})),i.d(t,"parseUrl",(function(){return Y}));var r=i("49b8"),a=i("b2b2"),n=i("1c92"),s=i("dae5"),o=i("d791"),c=i("afe1"),l=i("e431"),d=i("0b2d"),h=i("4261"),u=i("8190"),p=i("668b"),b=i("e4c1"),f=i("7e2d"),m=i("2b60"),g=i("3c3b"),O=i("087c"),v=i("2eab"),y=i("792b"),_=i("ce50"),j=i("e92d"),x=i("f4cc"),S=i("549a"),T=i("2db0"),w=i("b7c2"),C=i("0278"),A=i("1e2c"),P=i("dbad"),R=i("d17d");const E=j["a"].getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function I(e,t){const i=await M(e,t);return{resource:i,textures:await G(i.textureDefinitions,t)}}async function M(e,t){const i=Object(a["k"])(t)&&t.streamDataRequester;if(i)return D(e,i,t);const r=await Object(y["c"])(Object(v["default"])(e,Object(a["r"])(t)));if(!0===r.ok)return r.value.data;Object(x["o"])(r.error),L(r.error)}async function D(e,t,i){const r=await Object(y["c"])(t.request(e,"json",i));if(!0===r.ok)return r.value;Object(x["o"])(r.error),L(r.error.details.url)}function L(e){throw new _["a"]("","Request for object resource failed: "+e)}function N(e){const t=e.params,i=t.topology;let r=!0;switch(t.vertexAttributes||(E.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const e=t.faces;if(e){if(t.vertexAttributes)for(const i in t.vertexAttributes){const t=e[i];t&&t.values?(null!=t.valueType&&"UInt32"!==t.valueType&&(E.warn(`Unsupported indexed geometry indices type '${t.valueType}', only UInt32 is currently supported`),r=!1),null!=t.valuesPerElement&&1!==t.valuesPerElement&&(E.warn(`Unsupported indexed geometry values per element '${t.valuesPerElement}', only 1 is currently supported`),r=!1)):(E.warn(`Indexed geometry does not specify face indices for '${i}' attribute`),r=!1)}}else E.warn("Indexed geometries must specify faces"),r=!1;break}default:E.warn(`Unsupported topology '${i}'`),r=!1}e.params.material||(E.warn("Geometry requires material"),r=!1);const a=e.params.vertexAttributes;for(const n in a)a[n].values||(E.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function F(e,t){const i=[],r=[],n=[],s=[],o=e.resource,c=S["a"].parse(o.version||"1.0","wosr");B.validate(c);const l=o.model.name,h=o.model.geometries,u=o.materialDefinitions,p=e.textures;let b=0;const f=new Map;for(let m=0;m<h.length;m++){const e=h[m];if(!N(e))continue;const o=U(e),c=e.params.vertexAttributes,l=[];for(const t in c){const e=c[t],i=e.values;l.push([t,{data:i,size:e.valuesPerElement,exclusive:!0}])}const g=[];if("PerAttributeArray"!==e.params.topology){const t=e.params.faces;for(const e in t)g.push([e,new Uint32Array(t[e].values)])}const O=p&&p[o.texture];if(O&&!f.has(o.texture)){const{image:e,params:t}=O,i=new A["a"](e,t);s.push(i),f.set(o.texture,i)}const v=f.get(o.texture),y=v?v.id:void 0;let _=n[o.material]?n[o.material][o.texture]:null;if(!_){const e=u[o.material.substring(o.material.lastIndexOf("/")+1)].params;1===e.transparency&&(e.transparency=0);const i=O&&O.alphaChannelUsage,r=e.transparency>0||"transparency"===i||"maskAndTransparency"===i,s=O?V(O.alphaChannelUsage):void 0,c={ambient:Object(d["g"])(e.diffuse),diffuse:Object(d["g"])(e.diffuse),opacity:1-(e.transparency||0),transparent:r,textureAlphaMode:s,textureAlphaCutoff:.33,textureId:y,initTextureTransparent:!0,doubleSided:!0,cullFace:w["b"].None,colorMixMode:e.externalColorMixMode||"tint",textureAlphaPremultiplied:!!O&&!!O.params.preMultiplyAlpha};Object(a["k"])(t)&&t.materialParamsMixin&&Object.assign(c,t.materialParamsMixin),_=new P["a"](c),n[o.material]||(n[o.material]={}),n[o.material][o.texture]=_}r.push(_);const j=new C["a"](l,g);b+=g.position?g.position.length:0,i.push(j)}return{name:l,stageResources:{textures:s,materials:r,geometries:i},pivotOffset:o.model.pivotOffset,boundingBox:z(i),numberOfVertices:b,lodThreshold:null}}function z(e){const t=Object(h["h"])();return e.forEach(e=>{const i=e.boundingInfo;Object(a["k"])(i)&&(Object(h["n"])(t,i.getBBMin()),Object(h["n"])(t,i.getBBMax()))}),t}async function G(e,t){const i=[];for(const s in e){const r=e[s],n=r.images[0].data;if(!n){E.warn("Externally referenced texture data is not yet supported");continue}const o=r.encoding+";base64,"+n,c="/textureDefinitions/"+s,l="rgba"===r.channels?r.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:R["B"].REPEAT,t:R["B"].REPEAT},preMultiplyAlpha:V(l)!==w["a"].Opaque},h=Object(a["k"])(t)&&t.disableTextures?Promise.resolve(null):Object(T["a"])(o,t);i.push(h.then(e=>({refId:c,image:e,params:d,alphaChannelUsage:l})))}const r=await Promise.all(i),n={};for(const a of r)n[a.refId]=a;return n}function V(e){switch(e){case"mask":return w["a"].Mask;case"maskAndTransparency":return w["a"].MaskBlend;case"none":return w["a"].Opaque;default:return w["a"].Blend}}function U(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const B=new S["a"](1,2,"wosr");var k=i("b7bd"),H=i("0613"),W=i("dc56"),q=i("1c20"),$=i("4c96");async function X(e,t){const i=Y(Object(r["a"])(e));if("wosr"===i.fileType){const e=await(t.cache?t.cache.loadWOSR(i.url,t):I(i.url,t)),r=F(e,t);return{lods:[r],referenceBoundingBox:r.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:e.remove}}const n=await(t.cache?t.cache.loadGLTF(i.url,t,t.usePBR):Object(g["a"])(new m["a"](t.streamDataRequester),i.url,t,t.usePBR)),s=Object(a["i"])(n.model.meta,"ESRI_proxyEllipsoid");n.meta.isEsriSymbolResource&&Object(a["k"])(s)&&n.meta.uri.includes("/RealisticTrees/")&&K(n,s);const o=n.meta.isEsriSymbolResource?{usePBR:t.usePBR,isSchematic:!1,treeRendering:!!n.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:t.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},c={...t.materialParamsMixin,treeRendering:!!n.customMeta.esriTreeRendering};if(null!=i.specifiedLodIndex){const e=Z(n,o,c,i.specifiedLodIndex);let t=e[0].boundingBox;return 0!==i.specifiedLodIndex&&(t=Z(n,o,c,0)[0].boundingBox),{lods:e,referenceBoundingBox:t,isEsriSymbolResource:n.meta.isEsriSymbolResource,isWosr:!1,remove:n.remove}}const l=Z(n,o,c);return{lods:l,referenceBoundingBox:l[0].boundingBox,isEsriSymbolResource:n.meta.isEsriSymbolResource,isWosr:!1,remove:n.remove}}function Y(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function Z(e,t,i,r){const o=e.model,c=Object(s["b"])(),l=new Array,d=new Map,m=new Map;return o.lods.forEach((e,s)=>{if(void 0!==r&&s!==r)return;const g={name:e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:Object(a["k"])(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:Object(h["h"])()};l.push(g),e.parts.forEach(e=>{const r=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),s=o.materials.get(e.material),l=Object(a["k"])(e.attributes.texCoord0),O=Object(a["k"])(e.attributes.normal),v=J(s.alphaMode);if(!d.has(r)){if(l){if(Object(a["k"])(s.textureColor)&&!m.has(s.textureColor)){const e=o.textures.get(s.textureColor),t={...e.parameters,preMultiplyAlpha:v!==w["a"].Opaque};m.set(s.textureColor,new A["a"](e.data,t))}if(Object(a["k"])(s.textureNormal)&&!m.has(s.textureNormal)){const e=o.textures.get(s.textureNormal);m.set(s.textureNormal,new A["a"](e.data,e.parameters))}if(Object(a["k"])(s.textureOcclusion)&&!m.has(s.textureOcclusion)){const e=o.textures.get(s.textureOcclusion);m.set(s.textureOcclusion,new A["a"](e.data,e.parameters))}if(Object(a["k"])(s.textureEmissive)&&!m.has(s.textureEmissive)){const e=o.textures.get(s.textureEmissive);m.set(s.textureEmissive,new A["a"](e.data,e.parameters))}if(Object(a["k"])(s.textureMetallicRoughness)&&!m.has(s.textureMetallicRoughness)){const e=o.textures.get(s.textureMetallicRoughness);m.set(s.textureMetallicRoughness,new A["a"](e.data,e.parameters))}}const n=s.color[0]**(1/H["a"]),c=s.color[1]**(1/H["a"]),h=s.color[2]**(1/H["a"]),u=s.emissiveFactor[0]**(1/H["a"]),p=s.emissiveFactor[1]**(1/H["a"]),b=s.emissiveFactor[2]**(1/H["a"]),f=Object(a["k"])(s.textureColor)&&l?m.get(s.textureColor):null;d.set(r,new P["a"]({...t,transparent:v===w["a"].Blend,customDepthTest:w["c"].Lequal,textureAlphaMode:v,textureAlphaCutoff:s.alphaCutoff,diffuse:[n,c,h],ambient:[n,c,h],opacity:s.opacity,doubleSided:s.doubleSided,doubleSidedType:"winding-order",cullFace:s.doubleSided?w["b"].None:w["b"].Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normals:O?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:Object(a["k"])(f)?f.id:void 0,colorMixMode:s.colorMixMode,normalTextureId:Object(a["k"])(s.textureNormal)&&l?m.get(s.textureNormal).id:void 0,textureAlphaPremultiplied:Object(a["k"])(f)&&!!f.params.preMultiplyAlpha,occlusionTextureId:Object(a["k"])(s.textureOcclusion)&&l?m.get(s.textureOcclusion).id:void 0,emissiveTextureId:Object(a["k"])(s.textureEmissive)&&l?m.get(s.textureEmissive).id:void 0,metallicRoughnessTextureId:Object(a["k"])(s.textureMetallicRoughness)&&l?m.get(s.textureMetallicRoughness).id:void 0,emissiveFactor:[u,p,b],mrrFactors:[s.metallicFactor,s.roughnessFactor,t.mrrFactors[2]],isSchematic:!1,...i}))}const y=Q(e.indices||e.attributes.position.count,e.primitiveType),_=e.attributes.position.count,j=Object(f["a"])(u["u"],_);Object(p["e"])(j,e.attributes.position,e.transform);const x=[[k["a"].POSITION,{data:j.typedBuffer,size:j.elementCount,exclusive:!0}]],S=[[k["a"].POSITION,y]];if(Object(a["k"])(e.attributes.normal)){const t=Object(f["a"])(u["u"],_);Object(n["a"])(c,e.transform),Object(p["a"])(t,e.attributes.normal,c),x.push([k["a"].NORMAL,{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),S.push([k["a"].NORMAL,y])}if(Object(a["k"])(e.attributes.tangent)){const t=Object(f["a"])(u["C"],_);Object(n["a"])(c,e.transform),Object(b["d"])(t,e.attributes.tangent,c),x.push([k["a"].TANGENT,{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),S.push([k["a"].TANGENT,y])}if(Object(a["k"])(e.attributes.texCoord0)){const t=Object(f["a"])(u["m"],_);Object(W["b"])(t,e.attributes.texCoord0),x.push([k["a"].UV0,{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),S.push([k["a"].UV0,y])}if(Object(a["k"])(e.attributes.color)){const t=Object(f["a"])(u["J"],_);if(4===e.attributes.color.elementCount)e.attributes.color instanceof u["C"]?Object(b["c"])(t,e.attributes.color,255):e.attributes.color instanceof u["J"]?Object(q["a"])(t,e.attributes.color):e.attributes.color instanceof u["H"]&&Object(b["c"])(t,e.attributes.color,1/256);else{Object(q["b"])(t,255,255,255,255);const i=new u["B"](t.buffer,0,4);e.attributes.color instanceof u["u"]?Object(p["d"])(i,e.attributes.color,255):e.attributes.color instanceof u["B"]?Object($["a"])(i,e.attributes.color):e.attributes.color instanceof u["z"]&&Object(p["d"])(i,e.attributes.color,1/256)}x.push([k["a"].COLOR,{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),S.push([k["a"].COLOR,y])}const T=new C["a"](x,S);g.stageResources.geometries.push(T),g.stageResources.materials.push(d.get(r)),l&&(Object(a["k"])(s.textureColor)&&g.stageResources.textures.push(m.get(s.textureColor)),Object(a["k"])(s.textureNormal)&&g.stageResources.textures.push(m.get(s.textureNormal)),Object(a["k"])(s.textureOcclusion)&&g.stageResources.textures.push(m.get(s.textureOcclusion)),Object(a["k"])(s.textureEmissive)&&g.stageResources.textures.push(m.get(s.textureEmissive)),Object(a["k"])(s.textureMetallicRoughness)&&g.stageResources.textures.push(m.get(s.textureMetallicRoughness))),g.numberOfVertices+=_;const R=T.boundingInfo;Object(a["k"])(R)&&(Object(h["n"])(g.boundingBox,R.getBBMin()),Object(h["n"])(g.boundingBox,R.getBBMax()))})}),l}function J(e){switch(e){case"BLEND":return w["a"].Blend;case"MASK":return w["a"].Mask;case"OPAQUE":case null:case void 0:return w["a"].Opaque}}function Q(e,t){switch(t){case R["r"].TRIANGLES:return Object(O["c"])(e);case R["r"].TRIANGLE_STRIP:return Object(O["b"])(e);case R["r"].TRIANGLE_FAN:return Object(O["a"])(e)}}function K(e,t){for(let i=0;i<e.model.lods.length;++i){const r=e.model.lods[i];e.customMeta.esriTreeRendering=!0;for(const n of r.parts){const r=n.attributes.normal;if(Object(a["j"])(r))return;const s=n.attributes.position,h=s.count,p=Object(d["f"])(),b=Object(d["f"])(),m=Object(d["f"])(),g=Object(f["a"])(u["J"],h),O=Object(f["a"])(u["u"],h),v=Object(o["a"])(Object(c["d"])(),n.transform);for(let a=0;a<h;a++){s.getVec(a,b),r.getVec(a,p),Object(l["q"])(b,b,n.transform),Object(l["f"])(m,b,t.center),Object(l["c"])(m,m,t.radius);const o=m[2],c=Object(l["p"])(m),d=Math.min(.45+.55*c*c,1);Object(l["c"])(m,m,t.radius),Object(l["q"])(m,m,v),Object(l["r"])(m,m),i+1!==e.model.lods.length&&e.model.lods.length>1&&Object(l["l"])(m,m,p,o>-1?.2:Math.min(-4*o-3.8,1)),O.setVec(a,m),g.set(a,0,255*d),g.set(a,1,255*d),g.set(a,2,255*d),g.set(a,3,255)}n.attributes.normal=O,n.attributes.color=g}}}},"955a":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae"),a=i("52b2");class n extends r["a"]{constructor(e,t,i){super(e,"float",a["a"].Pass,(i,r,a)=>i.setUniform1fv(e,t(r,a)),i)}}},9617:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return o}));var r=i("d047"),a=i("d8a4"),n=i("3886"),s=i("6a3c");function o(e){e.include(r["a"]),e.uniforms.add([new s["a"]("geometryDepthTexture",(e,t)=>t.multipassGeometry.linearDepthTexture),new a["a"]("nearFar",(e,t)=>t.camera.nearFar)]),e.code.add(n["b"]`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class c{constructor(){this.enabled=!1}}},9812:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r,a,n,s={exports:{}};r=s,a=function(){function e(e,i,a){a=a||2;var n,s,o,l,d,h,u,p=i&&i.length,b=p?i[0]*a:e.length,f=t(e,0,b,a,!0),m=[];if(!f||f.next===f.prev)return m;if(p&&(f=c(e,i,f,a)),e.length>80*a){n=o=e[0],s=l=e[1];for(var g=a;g<b;g+=a)(d=e[g])<n&&(n=d),(h=e[g+1])<s&&(s=h),d>o&&(o=d),h>l&&(l=h);u=0!==(u=Math.max(o-n,l-s))?1/u:0}return r(f,m,a,n,s,u),m}function t(e,t,i,r,a){var n,s;if(a===I(e,t,i,r)>0)for(n=t;n<i;n+=r)s=P(n,e[n],e[n+1],s);else for(n=i-r;n>=t;n-=r)s=P(n,e[n],e[n+1],s);if(s&&_(s,s.next)){var o=s.next;R(s),s=o}return s}function i(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!_(r,r.next)&&0!==y(r.prev,r,r.next))r=r.next;else{var a=r.prev;if(R(r),(r=t=a)===r.next)break;i=!0}}while(i||r!==t);return t}function r(e,t,c,l,d,h,u){if(e){!u&&h&&b(e,l,d,h);for(var p,f,m=e;e.prev!==e.next;)if(p=e.prev,f=e.next,h?n(e,l,d,h):a(e))t.push(p.i/c),t.push(e.i/c),t.push(f.i/c),R(e),e=f.next,m=f.next;else if((e=f)===m){u?1===u?r(e=s(i(e),t,c),t,c,l,d,h,2):2===u&&o(e,t,c,l,d,h):r(i(e),t,c,l,d,h,1);break}}}function a(e){var t=e.prev,i=e,r=e.next;if(y(t,i,r)>=0)return!1;for(var a=e.next.next;a!==e.prev;){if(O(t.x,t.y,i.x,i.y,r.x,r.y,a.x,a.y)&&y(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function n(e,t,i,r){var a=e.prev,n=e,s=e.next;if(y(a,n,s)>=0)return!1;for(var o=a.x<n.x?a.x<s.x?a.x:s.x:n.x<s.x?n.x:s.x,c=a.y<n.y?a.y<s.y?a.y:s.y:n.y<s.y?n.y:s.y,l=a.x>n.x?a.x>s.x?a.x:s.x:n.x>s.x?n.x:s.x,d=a.y>n.y?a.y>s.y?a.y:s.y:n.y>s.y?n.y:s.y,h=m(o,c,t,i,r),u=m(l,d,t,i,r),p=e.prevZ,b=e.nextZ;p&&p.z>=h&&b&&b.z<=u;){if(p!==e.prev&&p!==e.next&&O(a.x,a.y,n.x,n.y,s.x,s.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,b!==e.prev&&b!==e.next&&O(a.x,a.y,n.x,n.y,s.x,s.y,b.x,b.y)&&y(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&O(a.x,a.y,n.x,n.y,s.x,s.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;b&&b.z<=u;){if(b!==e.prev&&b!==e.next&&O(a.x,a.y,n.x,n.y,s.x,s.y,b.x,b.y)&&y(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function s(e,t,r){var a=e;do{var n=a.prev,s=a.next.next;!_(n,s)&&j(n,a,a.next,s)&&w(n,s)&&w(s,n)&&(t.push(n.i/r),t.push(a.i/r),t.push(s.i/r),R(a),R(a.next),a=e=s),a=a.next}while(a!==e);return i(a)}function o(e,t,a,n,s,o){var c=e;do{for(var l=c.next.next;l!==c.prev;){if(c.i!==l.i&&v(c,l)){var d=A(c,l);return c=i(c,c.next),d=i(d,d.next),r(c,t,a,n,s,o),void r(d,t,a,n,s,o)}l=l.next}c=c.next}while(c!==e)}function c(e,r,a,n){var s,o,c,d=[];for(s=0,o=r.length;s<o;s++)(c=t(e,r[s]*n,s<o-1?r[s+1]*n:e.length,n,!1))===c.next&&(c.steiner=!0),d.push(g(c));for(d.sort(l),s=0;s<d.length;s++)a=i(a=h(d[s],a),a.next);return a}function l(e,t){return e.x-t.x}function d(e){if(e.next.prev===e)return e;let t=e;for(;;){const i=t.next;if(i.prev===t||i===t||i===e)break;t=i}return t}function h(e,t){var r=u(e,t);if(!r)return t;var a=A(r,e),n=i(r,r.next);let s=d(a);return i(s,s.next),n=d(n),d(t===r?n:t)}function u(e,t){var i,r=t,a=e.x,n=e.y,s=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var o=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=a&&o>s){if(s=o,o===a){if(n===r.y)return r;if(n===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(a===s)return i;var c,l=i,d=i.x,h=i.y,u=1/0;r=i;do{a>=r.x&&r.x>=d&&a!==r.x&&O(n<h?a:s,n,d,h,n<h?s:a,n,r.x,r.y)&&(c=Math.abs(n-r.y)/(a-r.x),w(r,e)&&(c<u||c===u&&(r.x>i.x||r.x===i.x&&p(i,r)))&&(i=r,u=c)),r=r.next}while(r!==l);return i}function p(e,t){return y(e.prev,e,t.prev)<0&&y(t.next,e,e.next)<0}function b(e,t,i,r){var a=e;do{null===a.z&&(a.z=m(a.x,a.y,t,i,r)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,f(a)}function f(e){var t,i,r,a,n,s,o,c,l=1;do{for(i=e,e=null,n=null,s=0;i;){for(s++,r=i,o=0,t=0;t<l&&(o++,r=r.nextZ);t++);for(c=l;o>0||c>0&&r;)0!==o&&(0===c||!r||i.z<=r.z)?(a=i,i=i.nextZ,o--):(a=r,r=r.nextZ,c--),n?n.nextZ=a:e=a,a.prevZ=n,n=a;i=r}n.nextZ=null,l*=2}while(s>1);return e}function m(e,t,i,r,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*a)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*a)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function g(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function O(e,t,i,r,a,n,s,o){return(a-s)*(t-o)-(e-s)*(n-o)>=0&&(e-s)*(r-o)-(i-s)*(t-o)>=0&&(i-s)*(n-o)-(a-s)*(r-o)>=0}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!T(e,t)&&(w(e,t)&&w(t,e)&&C(e,t)&&(y(e.prev,e,t.prev)||y(e,t.prev,t))||_(e,t)&&y(e.prev,e,e.next)>0&&y(t.prev,t,t.next)>0)}function y(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function _(e,t){return e.x===t.x&&e.y===t.y}function j(e,t,i,r){var a=S(y(e,t,i)),n=S(y(e,t,r)),s=S(y(i,r,e)),o=S(y(i,r,t));return a!==n&&s!==o||!(0!==a||!x(e,i,t))||!(0!==n||!x(e,r,t))||!(0!==s||!x(i,e,r))||!(0!==o||!x(i,t,r))}function x(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function S(e){return e>0?1:e<0?-1:0}function T(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&j(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function w(e,t){return y(e.prev,e,e.next)<0?y(e,t,e.next)>=0&&y(e,e.prev,t)>=0:y(e,t,e.prev)<0||y(e,e.next,t)<0}function C(e,t){var i=e,r=!1,a=(e.x+t.x)/2,n=(e.y+t.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&a<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}function A(e,t){var i=new E(e.i,e.x,e.y),r=new E(t.i,t.x,t.y),a=e.next,n=t.prev;return e.next=t,t.prev=e,i.next=a,a.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function P(e,t,i,r){var a=new E(e,t,i);return r?(a.next=r.next,a.prev=r,r.next.prev=a,r.next=a):(a.prev=a,a.next=a),a}function R(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function E(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function I(e,t,i,r){for(var a=0,n=t,s=i-r;n<i;n+=r)a+=(e[s]-e[n])*(e[n+1]+e[s+1]),s=n;return a}return e.deviation=function(e,t,i,r){var a=t&&t.length,n=a?t[0]*i:e.length,s=Math.abs(I(e,0,n,i));if(a)for(var o=0,c=t.length;o<c;o++){var l=t[o]*i,d=o<c-1?t[o+1]*i:e.length;s-=Math.abs(I(e,l,d,i))}var h=0;for(o=0;o<r.length;o+=3){var u=r[o]*i,p=r[o+1]*i,b=r[o+2]*i;h+=Math.abs((e[u]-e[b])*(e[p+1]-e[u+1])-(e[u]-e[p])*(e[b+1]-e[u+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},e.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,a=0;a<e.length;a++){for(var n=0;n<e[a].length;n++)for(var s=0;s<t;s++)i.vertices.push(e[a][n][s]);a>0&&(r+=e[a-1].length,i.holes.push(r))}return i},e},void 0!==(n=a())&&(r.exports=n);const o=s.exports},"9a68":function(e,t,i){"use strict";i.d(t,"a",(function(){return x})),i.d(t,"b",(function(){return T})),i.d(t,"c",(function(){return S}));var r=i("b2b2"),a=i("a05b"),n=i("d272"),s=i("e6aa"),o=i("c2d1"),c=i("6750"),l=i("c6d7"),d=i("c51b"),h=i("3976"),u=i("4377"),p=i("8e97"),b=i("d8a4"),f=i("fd48"),m=i("1fe9"),g=i("3886"),O=i("85b3"),v=i("690a"),y=i("b7c2"),_=i("b7bd"),j=i("a6b6");const x=1;function S(e){const t=new v["a"],i=e.hasMultipassTerrain&&(e.output===a["a"].Color||e.output===a["a"].Alpha);t.include(d["a"]),t.include(s["a"],e),t.include(c["a"],e),e.output===a["a"].Depth&&t.include(o["a"],e),Object(p["b"])(t,e);const{vertex:S,fragment:T}=t;S.uniforms.add([new O["a"]("inverseProjectionMatrix",(e,t)=>t.camera.inverseProjectionMatrix),new b["a"]("nearFar",(e,t)=>t.camera.nearFar),new m["a"]("miterLimit",e=>"miter"!==e.join?0:e.miterLimit),new f["a"]("viewport",(e,t)=>t.camera.fullViewport)]),S.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(_["a"].POSITION,"vec3"),t.attributes.add(_["a"].SUBDIVISIONFACTOR,"float"),t.attributes.add(_["a"].UV0,"vec2"),t.attributes.add(_["a"].AUXPOS1,"vec3"),t.attributes.add(_["a"].AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),i&&t.varyings.add("depth","float");const w=e.capType===j["a"].ROUND,C=e.stippleEnabled&&e.stippleScaleWithLineWidth||w;C&&t.varyings.add("vLineWidth","float");const A=e.stippleEnabled&&e.stippleScaleWithLineWidth;A&&t.varyings.add("vLineSizeInv","float");const P=e.innerColorEnabled||w;P&&t.varyings.add("vLineDistance","float");const R=e.stippleEnabled&&w,E=e.falloffEnabled||R;E&&t.varyings.add("vLineDistanceNorm","float"),w&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),S.code.add(g["b"]`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),S.code.add(g["b"]`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),S.code.add(g["b"]`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${i?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),S.uniforms.add(new m["a"]("pixelRatio",(e,t)=>t.camera.pixelRatio)),S.code.add(g["b"]`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${C?g["b"]`vLineWidth = lineWidth;`:""}
      ${A?g["b"]`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),(e.stippleEnabled||w)&&S.code.add(g["b"]`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${w?g["b"]`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),S.code.add(g["b"]`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?S.code.add(g["b"]`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?g["b"]`min(1.0, subdivisionFactor * ${g["b"].float((x+2)/(x+1))})`:g["b"]`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):S.code.add(g["b"]`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const I=e.capType!==j["a"].BUTT;return S.code.add(g["b"]`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${I?g["b"]`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),S.code.add(g["b"]`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${E||P?g["b"]`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${P?g["b"]`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${E?g["b"]`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),w&&S.code.add(g["b"]`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?S.uniforms.add(new m["a"]("worldToScreenRatio",(e,t)=>1/t.screenToPCSRatio)):S.code.add(g["b"]`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),S.code.add(g["b"]`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?S.code.add(g["b"]`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):S.code.add(g["b"]`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),S.code.add(g["b"]`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),S.code.add(g["b"]`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `),i&&t.include(l["b"],e),t.include(n["a"],e),T.include(u["a"]),T.code.add(g["b"]`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?T.code.add(g["b"]`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(w&&T.code.add(g["b"]`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${g["b"].float(h["b"])}) {
        discard;
      }
    `),R?T.code.add(g["b"]`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${g["b"].float(h["b"])}, stippleCoverage);
      `):T.code.add(g["b"]`float stippleAlpha = getStippleAlpha();`),T.uniforms.add(new f["a"]("intrinsicColor",e=>e.color)),T.code.add(g["b"]`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(T.uniforms.add(new f["a"]("innerColor",e=>Object(r["s"])(e.innerColor,e.color))),T.uniforms.add(new m["a"]("innerWidth",(e,t)=>e.innerWidth*t.camera.pixelRatio)),T.code.add(g["b"]`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),T.code.add(g["b"]`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(T.uniforms.add(new m["a"]("falloff",e=>e.falloff)),T.code.add(g["b"]`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),T.code.add(g["b"]`
    if (finalColor.a < ${g["b"].float(h["b"])}) {
      discard;
    }

    ${e.output===a["a"].Alpha?g["b"]`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===a["a"].Color?g["b"]`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===a["a"].Color&&e.transparencyPassType===y["i"].Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===a["a"].Highlight?g["b"]`gl_FragColor = vec4(1.0);`:""}
    ${e.output===a["a"].Depth?g["b"]`outputDepth(linearDepth);`:""}
  }
  `),t}const T=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:x,build:S},Symbol.toStringTag,{value:"Module"}))},"9cc4":function(e,t,i){"use strict";function r(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function a(e,t){const i=e.length;for(let r=0;r<i;++r)s[0]=e[r],t[r]=s[0];return t}function n(e,t){const i=e.length;for(let r=0;r<i;++r)s[0]=e[r],s[1]=e[r]-s[0],t[r]=s[1];return t}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return n}));const s=new Float32Array(2)},a05b:function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.Highlight=4]="Highlight",e[e.Draped=5]="Draped",e[e.Occlusion=6]="Occlusion",e[e.Alpha=7]="Alpha",e[e.COUNT=8]="COUNT"}(r||(r={}))},a1b1:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return o}));var r=i("38a4"),a=i("e431"),n=i("0b2d");function s(e,t,i){const r=Object(a["i"])(e,t)/Object(a["i"])(e,e);return Object(a["k"])(i,e,r)}function o(e,t){return Object(a["i"])(e,t)/Object(a["p"])(e)}function c(e,t){const i=Object(a["i"])(e,t)/(Object(a["p"])(e)*Object(a["p"])(t));return-Object(r["b"])(i)}function l(e,t,i){Object(a["r"])(d,e),Object(a["r"])(h,t);const n=Object(a["i"])(d,h),s=Object(r["b"])(n),o=Object(a["j"])(d,d,h);return Object(a["i"])(o,i)<0?2*Math.PI-s:s}const d=Object(n["f"])(),h=Object(n["f"])()},a222:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i("b2b2"),a=i("3349"),n=i("02f1"),s=i("62ae"),o=i("52b2");class c extends s["a"]{constructor(e,t){super(e,"vec2",o["a"].Draw,(i,r,a)=>i.setUniform2fv(e,t(r,a)))}}class l extends s["a"]{constructor(e,t){super(e,"sampler2D",o["a"].Draw,(i,r,a)=>i.bindTexture(e,t(r,a)))}}function d(e,t,i){const s=[new l(e,t)];if(i){const i=e+"Size";s.push(new c(i,(e,i)=>{const s=t(e,i);return Object(r["k"])(s)?Object(a["a"])(h,s.descriptor.width,s.descriptor.height):n["b"]}))}return s}const h=Object(n["c"])()},a5b5:function(e,t,i){"use strict";i.d(t,"a",(function(){return _})),i.d(t,"b",(function(){return O}));var r=i("b2b2"),a=i("3349"),n=i("02f1"),s=i("0fc4"),o=i("d272"),c=i("7c1d"),l=i("d0cb"),d=i("9617"),h=i("2f98"),u=i("d8a4"),p=i("fd48"),b=i("1fe9"),f=i("3886"),m=i("690a"),g=i("b7bd");function O(e){const t=new m["a"];t.include(c["a"]),t.include(l["a"],e),t.include(o["a"],e),t.attributes.add(g["a"].UV0,"vec2");const{vertex:i,fragment:n}=t;return i.uniforms.add([new p["a"]("viewport",(e,t)=>t.camera.fullViewport),new b["a"]("lineSize",(e,t)=>Math.ceil(e.size)*t.camera.pixelRatio),new u["a"]("pixelToNDC",(e,t)=>Object(a["a"])(y,2/t.camera.fullViewport[2],2/t.camera.fullViewport[3])),new b["a"]("borderSize",(e,t)=>Object(r["k"])(e.borderColor)?t.camera.pixelRatio:0),new u["a"]("screenOffset",(e,t)=>Object(a["a"])(y,e.screenOffset[0]*t.camera.pixelRatio,e.screenOffset[1]*t.camera.pixelRatio))]),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.hasMultipassGeometry&&t.varyings.add("depth","float"),e.hasScreenSizePerspective&&Object(h["c"])(i),i.code.add(f["b"]`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?f["b"]`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.hasScreenSizePerspective?f["b"]`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:f["b"]`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?f["b"]`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:f["b"]`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?f["b"]`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:f["b"]`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),n.uniforms.add([new p["a"]("uColor",e=>v(e.color)),new p["a"]("borderColor",e=>v(e.borderColor))]),e.hasMultipassGeometry&&(n.include(d["b"],e),n.uniforms.add(new u["a"]("inverseViewport",(e,t)=>t.inverseViewport))),n.code.add(f["b"]`
    void main() {
      ${e.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?f["b"]`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:f["b"]`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function v(e){return Object(r["k"])(e)?e:s["b"]}const y=Object(n["c"])(),_=Object.freeze(Object.defineProperty({__proto__:null,build:O},Symbol.toStringTag,{value:"Module"}))},a6b6:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return l}));var r,a=i("a4ee"),n=i("a05b"),s=i("da35"),o=i("b7c2"),c=i("6d35");!function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"}(r||(r={}));class l extends c["a"]{constructor(){super(...arguments),this.output=n["a"].Color,this.capType=r.BUTT,this.transparencyPassType=o["i"].NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1}}Object(a["a"])([Object(s["b"])({count:n["a"].COUNT})],l.prototype,"output",void 0),Object(a["a"])([Object(s["b"])({count:r.COUNT})],l.prototype,"capType",void 0),Object(a["a"])([Object(s["b"])({count:o["i"].COUNT})],l.prototype,"transparencyPassType",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"occluder",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"hasSlicePlane",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"hasPolygonOffset",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"writeDepth",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"draped",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"stippleEnabled",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"stippleOffColorEnabled",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"stippleScaleWithLineWidth",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"stipplePreferContinuous",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"roundJoins",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"vvSize",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"vvColor",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"vvOpacity",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"falloffEnabled",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"innerColorEnabled",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"hasOccludees",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"hasMultipassTerrain",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"cullAboveGround",void 0),Object(a["a"])([Object(s["b"])()],l.prototype,"wireframe",void 0),Object(a["a"])([Object(s["b"])({constValue:!0})],l.prototype,"stippleRequiresClamp",void 0),Object(a["a"])([Object(s["b"])({constValue:!0})],l.prototype,"stippleRequiresStretchMeasure",void 0),Object(a["a"])([Object(s["b"])({constValue:!0})],l.prototype,"hasVvInstancing",void 0),Object(a["a"])([Object(s["b"])({constValue:!0})],l.prototype,"hasSliceTranslatedView",void 0)},a6c9:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return c}));i("c120");var r=i("661c"),a=i("1e2c"),n=i("d17d");const s=128,o=.5;function c(e,t=s,i=t*o,r=0){const c=l(e,t,i,r);return new a["a"](c,{mipmap:!1,wrap:{s:n["B"].CLAMP_TO_EDGE,t:n["B"].CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function l(e,t=s,i=t*o,r=0){switch(e){case"circle":default:return d(t,i);case"square":return h(t,i);case"cross":return p(t,i,r);case"x":return b(t,i,r);case"kite":return u(t,i);case"triangle":return f(t,i);case"arrow":return m(t,i)}}function d(e,t){const i=e/2-.5;return _(e,v(i,i,t/2))}function h(e,t){return g(e,t,!1)}function u(e,t){return g(e,t,!0)}function p(e,t,i=0){return O(e,t,!1,i)}function b(e,t,i=0){return O(e,t,!0,i)}function f(e,t){return _(e,y(e/2,t,t/2))}function m(e,t){const i=t,r=t/2,a=e/2,n=.8*i,s=v(a,(e-t)/2-n,Math.sqrt(n*n+r*r)),o=y(a,i,r);return _(e,(e,t)=>Math.max(o(e,t),-s(e,t)))}function g(e,t,i){return i&&(t/=Math.SQRT2),_(e,(r,a)=>{let n=r-.5*e+.25,s=.5*e-a-.75;if(i){const e=(n+s)/Math.SQRT2;s=(s-n)/Math.SQRT2,n=e}return Math.max(Math.abs(n),Math.abs(s))-.5*t})}function O(e,t,i,r=0){t-=r,i&&(t*=Math.SQRT2);const a=.5*t;return _(e,(t,n)=>{let s,o=t-.5*e,c=.5*e-n-1;if(i){const e=(o+c)/Math.SQRT2;c=(c-o)/Math.SQRT2,o=e}return o=Math.abs(o),c=Math.abs(c),s=o>c?o>a?Math.sqrt((o-a)*(o-a)+c*c):c:c>a?Math.sqrt(o*o+(c-a)*(c-a)):o,s-=r/2,s})}function v(e,t,i){return(r,a)=>{const n=r-e,s=a-t;return Math.sqrt(n*n+s*s)-i}}function y(e,t,i){const r=Math.sqrt(t*t+i*i);return(a,n)=>{const s=Math.abs(a-e)-i,o=n-e+t/2+.75,c=(t*s+i*o)/r,l=-o;return Math.max(c,l)}}function _(e,t){const i=new Uint8Array(4*e*e);for(let a=0;a<e;a++)for(let n=0;n<e;n++){const s=n+e*a;let o=t(n,a);o=o/e+.5,Object(r["a"])(o,i,4*s)}return i}},a7d7:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return p}));var r=i("47f8"),a=i("7cb4"),n=i("35f0"),s=i("ea32"),o=i("3886"),c=i("a222"),l=i("6a3c"),d=i("52b2"),h=i("e93d");Object(r["c"])(0,.6,.2);var u;!function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.COUNT=5]="COUNT"}(u||(u={}));h["b"];function p(e,t){const i=e.fragment,r=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===u.Normal&&r&&e.include(a["a"],t),t.pbrMode!==u.Schematic)if(t.pbrMode!==u.Disabled){if(t.pbrMode===u.Normal){i.code.add(o["b"]`vec3 mrr;
vec3 emission;
float occlusion;`);const e=t.supportsTextureAtlas,a=t.pbrTextureBindType;t.hasMetalnessAndRoughnessTexture&&(i.uniforms.add(a===d["a"].Pass?Object(l["b"])("texMetallicRoughness",e=>e.textureMetallicRoughness,e):Object(c["a"])("texMetallicRoughness",e=>e.textureMetallicRoughness,e)),i.code.add(o["b"]`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(i.uniforms.add(a===d["a"].Pass?Object(l["b"])("texEmission",e=>e.textureEmissive,e):Object(c["a"])("texEmission",e=>e.textureEmissive,e)),i.code.add(o["b"]`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(i.uniforms.add(a===d["a"].Pass?Object(l["b"])("texOcclusion",e=>e.textureOcclusion,e):Object(c["a"])("texOcclusion",e=>e.textureOcclusion,e)),i.code.add(o["b"]`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(o["b"]`float getBakedOcclusion() { return 1.0; }`),i.uniforms.add(a===d["a"].Pass?[new s["a"]("emissionFactor",e=>e.emissiveFactor),new s["a"]("mrrFactors",e=>e.mrrFactors)]:[new n["a"]("emissionFactor",e=>e.emissiveFactor),new n["a"]("mrrFactors",e=>e.mrrFactors)]),i.code.add(o["b"]`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${r?"vtc.uv = vuv0;":""}
      ${t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)}}else i.code.add(o["b"]`float getBakedOcclusion() { return 1.0; }`);else i.code.add(o["b"]`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}},aa1e:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae"),a=i("52b2");class n extends r["a"]{constructor(e,t){super(e,"mat3",a["a"].Pass,(i,r,a)=>i.setUniformMatrix3fv(e,t(r,a)))}}},aab5:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return r}));var r,a=i("6c97"),n=i("3886");function s(e,t){const i=e.fragment;switch(i.code.add(n["b"]`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case r.None:i.code.add(n["b"]`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case r.View:i.code.add(n["b"]`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case r.WindingOrder:i.code.add(n["b"]`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:Object(a["a"])(t.doubleSidedMode);case r.COUNT:}}!function(e){e[e.None=0]="None",e[e.View=1]="View",e[e.WindingOrder=2]="WindingOrder",e[e.COUNT=3]="COUNT"}(r||(r={}))},adf1:function(e,t,i){"use strict";i.d(t,"a",(function(){return O}));var r=i("b2b2"),a=i("f2e0"),n=i("afe1"),s=i("e431"),o=i("0b2d"),c=i("0fc4"),l=i("8188"),d=i("b7c2"),h=i("0278"),u=i("f643"),p=i("5a22");const b={rootOrigin:null};var f=i("b7bd"),m=i("748f"),g=i("86ba");class O{constructor(e,t=125e4){this._originSR=e,this._gridSize=t,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+Object(a["a"])()}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){const t=b.rootOrigin;if(Object(r["k"])(t))return this._origins.set(this._rootOriginId,Object(u["a"])(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(e);const i=Object(u["a"])(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,i),i}const i=this._gridSize,a=Math.round(e[0]/i),n=Math.round(e[1]/i),o=Math.round(e[2]/i),c=`${a}/${n}/${o}`;let l=this._origins.get(c);const d=.5*i;if(Object(s["f"])(v,e,t.vec3),v[0]=Math.abs(v[0]),v[1]=Math.abs(v[1]),v[2]=Math.abs(v[2]),v[0]<d&&v[1]<d&&v[2]<d){if(l){const t=Math.max(...v);if(Object(s["f"])(v,e,l.vec3),v[0]=Math.abs(v[0]),v[1]=Math.abs(v[1]),v[2]=Math.abs(v[2]),Math.max(...v)<t)return l}return t}return l||(l=Object(u["a"])(a*i,n*i,o*i,c),this._origins.set(c,l)),l}_drawOriginBox(e,t=Object(c["g"])(1,1,0,1)){const i=window.view,r=i._stage,a=t.toString();if(!this._objects.has(a)){this._material=new g["a"]({width:2,color:t}),r.add(this._material);const e=new m["a"]({isPickable:!1}),i=new p["a"]({castShadow:!1});r.add(i),e.add(i),r.add(e),this._objects.set(a,i)}const s=this._objects.get(a),o=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],u=o.length,b=new Array(3*u),O=new Uint16Array(2*(u-1)),v=.5*this._gridSize;for(let n=0;n<u;n++)b[3*n+0]=e[0]+(1&o[n]?v:-v),b[3*n+1]=e[1]+(2&o[n]?v:-v),b[3*n+2]=e[2]+(4&o[n]?v:-v),n>0&&(O[2*n+0]=n-1,O[2*n+1]=n);Object(l["l"])(b,this._originSR,0,b,i.renderSpatialReference,0,u);const y=new h["a"]([[f["a"].POSITION,{size:3,data:b,exclusive:!0}]],[[f["a"].POSITION,O]],d["f"].Line);r.add(y),s.addGeometry(y,this._material,n["a"])}}const v=Object(o["f"])()},aeb3:function(e,t,i){"use strict";i.d(t,"a",(function(){return w})),i.d(t,"b",(function(){return S}));var r=i("a05b"),a=i("d272"),n=i("4db9"),s=i("6d5b"),o=i("c2d1"),c=i("6a07"),l=i("c6d7"),d=i("3976"),h=i("4377"),u=i("8e97"),p=i("d8a4"),b=i("fd48"),f=i("1fe9"),m=i("3886"),g=i("690a"),O=i("b7c2"),v=i("b7bd"),y=i("37e4");const _=.70710678118,j=_,x=.08715574274;function S(e){const t=new g["a"],i=e.hasMultipassTerrain&&(e.output===r["a"].Color||e.output===r["a"].Alpha);e.draped||t.extensions.add("GL_OES_standard_derivatives");const S=e.output===r["a"].Depth,{vertex:w,fragment:C}=t;Object(u["b"])(t,e),t.include(n["a"],{hasModelTransformation:!1,linearDepth:S}),t.include(s["a"],e),S&&(t.include(o["a"],e),w.uniforms.add(new p["a"]("nearFar",(e,t)=>t.camera.nearFar)),t.varyings.add("linearDepth","float")),e.draped?w.uniforms.add(new f["a"]("worldToScreenRatio",(e,t)=>1/t.screenToPCSRatio)):t.attributes.add(v["a"].BOUNDINGRECT,"mat3"),t.attributes.add(v["a"].POSITION,"vec3"),t.attributes.add(v["a"].UVMAPSPACE,"vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i&&t.varyings.add("depth","float");const A=e.style===y["a"].ForwardDiagonal||e.style===y["a"].BackwardDiagonal||e.style===y["a"].DiagonalCross;return A&&w.code.add(m["b"]`
      const mat2 rotate45 = mat2(${m["b"].float(_)}, ${m["b"].float(-j)},
                                 ${m["b"].float(j)}, ${m["b"].float(_)});
    `),e.draped||(Object(u["a"])(w,e),w.uniforms.add(new f["a"]("worldToScreenPerDistanceRatio",(e,t)=>1/t.camera.perScreenPixelRatio)),w.code.add(m["b"]`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),w.code.add(m["b"]`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),w.code.add(m["b"]`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${m["b"].float(x)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),w.code.add(m["b"]`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${A?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${A?" * rotate45":""};

      ${e.draped?"":m["b"]`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${m["b"].float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),w.code.add(m["b"]`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${S?m["b"]`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:m["b"]`transformPosition(proj, view, vpos);`}
    }
  `),t.include(a["a"],e),C.include(h["a"]),e.draped&&C.uniforms.add(new f["a"]("texelSize",(e,t)=>1/t.camera.pixelRatio)),e.output===r["a"].Highlight&&t.include(c["a"]),i&&t.include(l["b"],e),e.output!==r["a"].Highlight&&(C.code.add(m["b"]`
      const float lineWidth = ${m["b"].float(e.lineWidth)};
      const float spacing = ${m["b"].float(e.patternSpacing)};
      const float spacingINV = ${m["b"].float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||C.code.add(m["b"]`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),C.uniforms.add(new b["a"]("uColor",e=>e.color)),C.code.add(m["b"]`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${e.output!==r["a"].Highlight?m["b"]`color.a *= ${T(e)};`:""}

      if (color.a < ${m["b"].float(d["b"])}) {
        discard;
      }

      ${e.output===r["a"].Alpha?m["b"]`gl_FragColor = vec4(color.a);`:""}

      ${e.output===r["a"].Color?m["b"]`gl_FragColor = color; ${e.transparencyPassType===O["i"].Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${e.output===r["a"].Highlight?m["b"]`outputHighlight();`:""}
      ${e.output===r["a"].Depth?m["b"]`outputDepth(linearDepth);`:""};
    }
  `),t}function T(e){function t(t){return e.draped?m["b"]`coverage(vuv.${t}, texelSize)`:m["b"]`sample(vuv.${t})`}switch(e.style){case y["a"].ForwardDiagonal:case y["a"].Horizontal:return t("y");case y["a"].BackwardDiagonal:case y["a"].Vertical:return t("x");case y["a"].DiagonalCross:case y["a"].Cross:return m["b"]`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}const w=Object.freeze(Object.defineProperty({__proto__:null,build:S},Symbol.toStringTag,{value:"Module"}))},af20:function(e,t,i){"use strict";i.d(t,"a",(function(){return A})),i.d(t,"b",(function(){return C}));var r=i("bd75"),a=i("a05b"),n=i("d272"),s=i("4db9"),o=i("b49d"),c=i("c2d1"),l=i("6a07"),d=i("7088"),h=i("ea4b"),u=i("c6d7"),p=i("aab5"),b=i("040b"),f=i("d017"),m=i("4377"),g=i("8e97"),O=i("d8a4"),v=i("ea32"),y=i("db7b"),_=i("1fe9"),j=i("3886"),x=i("85b3"),S=i("690a"),T=i("b7c2"),w=i("2245");function C(e){const t=new S["a"],i=Object(g["b"])(t,e),{vertex:C,fragment:A}=t;return t.varyings.add("vpos","vec3"),t.include(o["a"],e),e.output!==a["a"].Color&&e.output!==a["a"].Alpha||(t.include(s["a"]),t.include(f["a"],e),t.include(r["a"],e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),C.code.add(j["b"]`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===a["a"].Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),t.include(u["b"],e),e.output===a["a"].Alpha&&(t.include(n["a"],e),A.uniforms.add(new _["a"]("opacity",e=>e.opacity)),A.code.add(j["b"]`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `)),e.output===a["a"].Color&&(t.include(n["a"],e),t.include(h["a"],e),t.include(d["a"],e),t.include(f["a"],e),t.include(p["a"],e),Object(g["a"])(A,e),A.uniforms.add([i,new v["a"]("ambient",e=>e.ambient),new v["a"]("diffuse",e=>e.diffuse),new v["a"]("specular",e=>e.specular),new _["a"]("opacity",e=>e.opacity),new _["a"]("lightingGlobalFactor",(e,t)=>t.lighting.globalFactor),new v["a"]("lightingMainIntensity",(e,t)=>t.lighting.mainLight.intensity)]),A.constants.add("ambientBoostFactor","float",w["b"]),A.include(m["a"]),A.code.add(j["b"]`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===T["i"].Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==a["a"].Depth&&e.output!==a["a"].Shadow||(t.include(s["a"],{hasModelTransformation:!1,linearDepth:!0}),C.uniforms.add(new O["a"]("nearFar",(e,t)=>t.camera.nearFar)),t.varyings.add("depth","float"),C.code.add(j["b"]`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(n["a"],e),t.include(c["a"],e),A.code.add(j["b"]`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`)),e.output===a["a"].Normal&&(t.include(s["a"]),t.include(b["a"],e),C.uniforms.add(new x["a"]("viewNormal",(e,t)=>t.camera.viewInverseTransposeMatrix)),t.varyings.add("vnormal","vec3"),C.code.add(j["b"]`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(n["a"],e),A.uniforms.add(new y["a"]("waterColor")),A.code.add(j["b"]`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`)),e.output===a["a"].Highlight&&(t.include(s["a"]),t.include(b["a"],e),t.varyings.add("vnormal","vec3"),C.code.add(j["b"]`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(n["a"],e),t.include(l["a"]),A.code.add(j["b"]`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const A=Object.freeze(Object.defineProperty({__proto__:null,build:C},Symbol.toStringTag,{value:"Module"}))},afe1:function(e,t,i){"use strict";function r(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function a(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function n(e,t,i,r,a,n,s,o,c,l,d,h,u,p,b,f){return[e,t,i,r,a,n,s,o,c,l,d,h,u,p,b,f]}function s(e,t){return new Float64Array(e,t,16)}i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return r})),i.d(t,"e",(function(){return n}));const o=r();Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:a,fromValues:n,createView:s,IDENTITY:o},Symbol.toStringTag,{value:"Module"}))},b061:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c}));var r=i("b2b2"),a=i("a05b"),n=i("b7c2"),s=i("614d");class o{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}destroy(){this._map.forEach((e,t)=>{Object(r["k"])(e)&&this._repository.release(this._material,c(t))})}load(e,t){this._map.has(t)||this._map.set(t,this._repository.acquire(this._material,c(t)));const i=this._map.get(t);if(Object(r["k"])(i)){if(i.ensureResources(e)===n["g"].LOADED)return i;this._repository.requestRender()}return null}}function c(e){switch(e){case s["a"].MATERIAL:return a["a"].Color;case s["a"].MATERIAL_ALPHA:return a["a"].Alpha;case s["a"].MATERIAL_DEPTH:return a["a"].Depth;case s["a"].MATERIAL_NORMAL:return a["a"].Normal;case s["a"].MATERIAL_DEPTH_SHADOWMAP_ALL:return a["a"].Shadow;case s["a"].MATERIAL_HIGHLIGHT:return a["a"].Highlight;case s["a"].MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case s["a"].MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return a["a"].Shadow}}},b09a:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886"),a=i("b7bd");function n(e){e.attributes.add(a["a"].POSITION,"vec3"),e.vertex.code.add(r["b"]`vec3 positionModel() { return position; }`)}},b0ab:function(e,t,i){"use strict";i.d(t,"a",(function(){return z})),i.d(t,"b",(function(){return F}));var r=i("bd75"),a=i("17ca"),n=i("a05b"),s=i("d272"),o=i("4db9"),c=i("d539"),l=i("c332"),d=i("b09a"),h=i("6cb2"),u=i("dfaf"),p=i("6d5b"),b=i("17b0"),f=i("7e21"),m=i("7088"),g=i("ea4b"),O=i("c6d7"),v=i("5d5f"),y=i("a7d7"),_=i("d017"),j=i("be24"),x=i("3976"),S=i("ebd5"),T=i("3626"),w=i("8e97"),C=i("ea32"),A=i("fd48"),P=i("1fe9"),R=i("3886"),E=i("3853"),I=i("690a"),M=i("6a3c"),D=i("b7c2"),L=i("b7bd"),N=i("2245");function F(e){const t=new I["a"],i=t.vertex.code,F=t.fragment.code,z=Object(w["b"])(t,e);return t.include(d["a"]),t.varyings.add("vpos","vec3"),t.include(j["a"],e),t.include(c["a"],e),t.include(b["a"],e),e.output!==n["a"].Color&&e.output!==n["a"].Alpha||(Object(w["a"])(t.vertex,e),t.include(l["a"],e),t.include(o["a"]),e.offsetBackfaces&&t.include(a["a"]),e.instancedColor&&t.attributes.add(L["a"].INSTANCECOLOR,"vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),t.include(u["a"],e),t.include(r["a"],e),t.include(h["a"],e),t.include(p["a"],e),t.vertex.uniforms.add(new A["a"]("externalColor",e=>e.externalColor)),t.varyings.add("vcolorExt","vec4"),i.add(R["b"]`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${R["b"].float(x["b"])}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.hasMultipassTerrain?R["b"]`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===n["a"].Alpha&&(t.include(s["a"],e),t.include(S["a"],e),t.include(O["b"],e),t.fragment.uniforms.add([new P["a"]("opacity",e=>e.opacity),new P["a"]("layerOpacity",e=>e.layerOpacity),new E["a"]("view")]),e.hasColorTexture&&t.fragment.uniforms.add(new M["a"]("tex",e=>e.texture)),t.fragment.include(T["a"]),F.add(R["b"]`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?R["b"]`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?R["b"]`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:R["b"]`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?R["b"]`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:R["b"]`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===n["a"].Color&&(t.include(s["a"],e),t.include(g["a"],e),t.include(m["a"],e),t.include(S["a"],e),t.include(e.instancedDoublePrecision?_["b"]:_["a"],e),t.include(O["b"],e),Object(w["a"])(t.fragment,e),t.fragment.uniforms.add([z,new C["a"]("ambient",e=>e.ambient),new C["a"]("diffuse",e=>e.diffuse),new P["a"]("opacity",e=>e.opacity),new P["a"]("layerOpacity",e=>e.layerOpacity),new E["a"]("view"),new P["a"]("lightingGlobalFactor",(e,t)=>t.lighting.globalFactor),new C["a"]("lightingMainIntensity",(e,t)=>t.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",N["b"]),e.hasColorTexture&&t.fragment.uniforms.add(new M["a"]("tex",e=>e.texture)),t.include(y["b"],e),t.include(v["a"],e),t.fragment.include(T["a"]),t.extensions.add("GL_OES_standard_derivatives"),F.add(R["b"]`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?R["b"]`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?R["b"]`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:R["b"]`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===y["a"].Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?R["b"]`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:R["b"]`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.snowCover?R["b"]`albedo = mix(albedo, vec3(1), 0.9);`:R["b"]``}
        ${R["b"]`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * lightingMainIntensity;`}
        ${e.pbrMode===y["a"].Normal||e.pbrMode===y["a"].Schematic?e.spherical?R["b"]`vec3 normalGround = normalize(vpos + localOrigin);`:R["b"]`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:R["b"]``}
        ${e.pbrMode===y["a"].Normal||e.pbrMode===y["a"].Schematic?R["b"]`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?R["b"]`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:R["b"]`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===D["i"].Color?R["b"]`gl_FragColor = premultiplyAlpha(gl_FragColor);`:R["b"]``}
      }
    `)),t.include(f["a"],e),t}const z=Object.freeze(Object.defineProperty({__proto__:null,build:F},Symbol.toStringTag,{value:"Module"}))},b139:function(e,t,i){"use strict";function r(){return[0,0,0,1]}function a(e){return[e[0],e[1],e[2],e[3]]}function n(e,t,i,r){return[e,t,i,r]}function s(e,t){return new Float64Array(e,t,4)}i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return s}));const o=r();Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:a,fromValues:n,createView:s,IDENTITY:o},Symbol.toStringTag,{value:"Module"}))},b49d:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return b}));var r=i("02f1"),a=i("b09a"),n=i("d8a4"),s=i("ea32"),o=i("76a8"),c=i("955a"),l=i("3886"),d=i("b7bd"),h=i("02a0");const u=8;function p(e,t){e.attributes.add(d["a"].FEATUREVALUE,"vec4");const i=e.vertex;i.code.add(l["b"]`bool isCapVertex() {
return featureValue.w == 1.0;
}`),i.uniforms.add(new n["a"]("size",e=>e.size)),t.vvSize?(i.uniforms.add(new s["a"]("vvSizeMinSize",e=>e.vvSizeMinSize)),i.uniforms.add(new s["a"]("vvSizeMaxSize",e=>e.vvSizeMaxSize)),i.uniforms.add(new s["a"]("vvSizeOffset",e=>e.vvSizeOffset)),i.uniforms.add(new s["a"]("vvSizeFactor",e=>e.vvSizeFactor)),i.code.add(l["b"]`vec2 getSize() {
return size * clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):i.code.add(l["b"]`vec2 getSize(){
return size;
}`),t.vvOpacity?(i.constants.add("vvOpacityNumber","int",u),i.uniforms.add([new c["a"]("vvOpacityValues",e=>e.vvOpacityValues,u),new c["a"]("vvOpacityOpacities",e=>e.vvOpacityOpacities,u)]),i.code.add(l["b"]`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):i.code.add(l["b"]`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(i.constants.add("vvColorNumber","int",h["b"]),i.uniforms.add([new c["a"]("vvColorValues",e=>e.vvColorValues,h["b"]),new o["a"]("vvColorColors",e=>e.vvColorColors,h["b"])]),i.code.add(l["b"]`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):i.code.add(l["b"]`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(a["a"]),e.attributes.add(d["a"].PROFILERIGHT,"vec4"),e.attributes.add(d["a"].PROFILEUP,"vec4"),e.attributes.add(d["a"].PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(l["b"]`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(l["b"]`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(l["b"]`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(l["b"]`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class b extends h["a"]{constructor(){super(...arguments),this.size=Object(r["g"])(1,1)}}},b623:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return l}));var r=i("b2b2"),a=i("d791"),n=i("afe1"),s=i("1153"),o=i("9cc4");function c(e,t){return Object(r["j"])(e)&&(e=[]),e.push(t),e}function l(e,t){if(Object(r["j"])(e))return null;const i=e.filter(e=>e!==t);return 0===i.length?null:i}function d(e){return!!Object(r["k"])(e)&&!e.visible}function h(e,t,i){const n=e.origin.vec3;Object(s["j"])(f,-n[0],-n[1],-n[2]),Object(r["k"])(e.transformation)?Object(a["m"])(t,f,e.transformation):Object(a["c"])(t,f),i&&(Object(a["a"])(i,t),Object(a["t"])(i,i))}function u(e,t,i,r,a){p[0]=e.get(t,0),p[1]=e.get(t,1),p[2]=e.get(t,2),Object(o["a"])(p,b,3),i.set(a,0,b[0]),r.set(a,0,b[1]),i.set(a,1,b[2]),r.set(a,1,b[3]),i.set(a,2,b[4]),r.set(a,2,b[5])}const p=new Float64Array(3),b=new Float32Array(6),f=Object(n["d"])()},b7c2:function(e,t,i){"use strict";var r,a,n,s,o,c,l,d,h,u,p,b,f,m;i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return c})),i.d(t,"h",(function(){return l})),i.d(t,"i",(function(){return s})),i.d(t,"j",(function(){return d})),i.d(t,"k",(function(){return b})),function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"}(r||(r={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(a||(a={})),function(e){e[e.NONE=0]="NONE",e[e.SMAA=1]="SMAA"}(n||(n={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"}(s||(s={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(o||(o={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(c||(c={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(l||(l={})),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(d||(d={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(h||(h={})),function(e){e[e.Triangle=0]="Triangle",e[e.Point=1]="Point",e[e.Line=2]="Line"}(u||(u={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(p||(p={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(b||(b={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(f||(f={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(m||(m={}))},ba58:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return P})),i.d(t,"c",(function(){return T})),i.d(t,"d",(function(){return R})),i.d(t,"e",(function(){return j})),i.d(t,"f",(function(){return A})),i.d(t,"g",(function(){return S})),i.d(t,"h",(function(){return x})),i.d(t,"i",(function(){return C}));var r=i("b2b2"),a=i("d791"),n=i("afe1"),s=i("0b2d"),o=i("7577"),c=i("0fc4"),l=i("8188"),d=i("4261"),h=i("9180"),u=i("57e5"),p=i("32ed"),b=i("1a54"),f=i("d3cf"),m=i("b7bd");function g(e,t){if("point"===e.type)return _(e,t,!1);if(Object(f["d"])(e))switch(e.type){case"extent":return _(e.center,t,!1);case"polygon":return _(e.centroid,t,!1);case"polyline":return _(O(e),t,!0);case"mesh":return _(e.origin,t,!1)}else switch(e.type){case"extent":return _(v(e),t,!0);case"polygon":return _(y(e),t,!0);case"polyline":return _(O(e),t,!0)}}function O(e){const t=e.paths[0];if(!t||0===t.length)return null;const i=Object(p["g"])(t,Object(p["f"])(t)/2);return Object(b["g"])(i[0],i[1],i[2],e.spatialReference)}function v(e){const t=isFinite(e.zmin);return Object(b["g"])(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function y(e){const t=e.rings[0];if(!t||0===t.length)return null;const i=Object(u["c"])(e.rings,e.hasZ);return Object(b["g"])(i[0],i[1],i[2],e.spatialReference)}function _(e,t,i){const r=i?e:Object(f["a"])(e);return t&&e?Object(l["o"])(e,r,t)?r:null:r}function j(e,t,i,r=0){if(e){t||(t=Object(h["k"])());const a=e;let n=.5*a.width*(i-1),s=.5*a.height*(i-1);return a.width<1e-7*a.height?n+=s/20:a.height<1e-7*a.width&&(s+=n/20),Object(o["l"])(t,a.xmin-n-r,a.ymin-s-r,a.xmax+n+r,a.ymax+s+r),t}return null}function x(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute(m["a"].AUXPOS1);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[i]))}}function S(e,t){const i=Object(c["f"])(c["a"]);return Object(r["k"])(e)&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),Object(r["k"])(t)?i[3]=t:Object(r["k"])(e)&&e.length>3&&(i[3]=e[3]),i}function T(e=s["a"],t,i,a=1){const n=new Array(3);if(Object(r["j"])(t)||Object(r["j"])(i))n[0]=1,n[1]=1,n[2]=1;else{let r,a=0;for(let s=2;s>=0;s--){const o=e[s];let c;const l=null!=o,d=0===s&&!r&&!l,h=i[s];"symbol-value"===o||d?c=0!==h?t[s]/h:1:l&&"proportional"!==o&&isFinite(o)&&(c=0!==h?o/h:1),null!=c&&(n[s]=c,r=c,a=Math.max(a,Math.abs(c)))}for(let e=2;e>=0;e--)null==n[e]?n[e]=r:0===n[e]&&(n[e]=.001*a)}for(let r=2;r>=0;r--)n[r]/=a;return Object(s["g"])(n)}function w(e){return null!=e.isPrimitive}function C(e){return w(e)&&(e=[e.width,e.depth,e.height]),A(e)?null:"Symbol sizes may not be negative values"}function A(e){if(Array.isArray(e)){for(const t of e)if(!A(t))return!1;return!0}return null==e||e>=0}function P(e,t,i,r=Object(n["d"])()){const s=e||0,o=t||0,c=i||0;return 0!==s&&Object(a["g"])(r,r,-s/180*Math.PI),0!==o&&Object(a["r"])(r,r,o/180*Math.PI),0!==c&&Object(a["o"])(r,r,c/180*Math.PI),r}function R(e,t){return null!=t.minDemResolution?t.minDemResolution:Object(d["s"])(e)?t.minDemResolutionForPoints:.01*Object(d["t"])(e)}},badc:function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=12]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=14]="HUD_MATERIAL",e[e.LABEL_MATERIAL=15]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",e[e.DRAPED_WATER=19]="DRAPED_WATER",e[e.VOXEL=20]="VOXEL",e[e.MAX_SLOTS=21]="MAX_SLOTS"}(r||(r={}))},bb49:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return oh}));var r=i("a4ee"),a=i("b2b2"),n=i("477c"),s=i("59b2"),o=i("b50f"),c=i("c120"),l=(i("cea0"),i("d386")),d=i("c649"),h=i("f4cc"),u=i("d2f2");const p=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(e){super.postscript(e),Object(u["c"])(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.handles.add(Object(d["c"])(()=>e.abort())),await Object(n["h"])(()=>{var e;return null==(e=this.view.defaultsFromMap)?void 0:e.heightModelInfoReady},t),Object(h["p"])(t);const i=Object(u["b"])(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(i)throw i}canResume(){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!e||!e.minScale||!e.maxScale||e.minScale>=e.maxScale)}getSuspendInfo(){const e=super.getSuspendInfo(),t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return t&&t.minScale&&t.maxScale&&t.minScale<t.maxScale&&(e.outsideScaleRange=!0),e}};return Object(r["a"])([Object(s["b"])()],t.prototype,"view",void 0),Object(r["a"])([Object(s["b"])()],t.prototype,"slicePlaneEnabled",void 0),t=Object(r["a"])([Object(l["a"])("esri.views.3d.layers.LayerView3D")],t),t};var b=i("8d60"),f=i("2c4f"),m=i("9096"),g=i("0f1c"),O=i("a6a3"),v=i("d3cf"),y=i("9ef0"),_=i("d297");function j(e,t){if(!e||e.symbol)return null;const i=t&&t.renderer;return e&&Object(a["k"])(i)&&i.getObservationRenderer?i.getObservationRenderer(e):i}function x(e,t){if(Object(a["k"])(e.symbol))return e.symbol;const i=j(e,t);return Object(a["k"])(i)&&"dot-density"!==i.type?i.getSymbol(e,t):null}function S(e,t){const i=j(e,t),r=x(e,t);if(Object(a["j"])(r))return null;const n={renderer:i,symbol:r};if(Object(a["j"])(i)||!("visualVariables"in i)||!i.visualVariables)return n;const s=Object(_["getVisualVariableValues"])(i,e,t),o=["proportional","proportional","proportional"];for(const{variable:a,value:c}of s)switch(a.type){case"color":n.color=c.toRgba();break;case"size":if("outline"===a.target)n.outlineSize=c;else{const e=a.axis,t=a.useSymbolValue?"symbol-value":c;switch(e){case"width":o[0]=t;break;case"depth":o[1]=t;break;case"height":o[2]=t;break;case"width-and-depth":o[0]=o[1]=t;break;default:o[0]=o[1]=o[2]=t}}break;case"opacity":n.opacity=c;break;case"rotation":switch(a.axis){case"tilt":n.tilt=c;break;case"roll":n.roll=c;break;default:n.heading=c}}return"proportional"===o[0]&&"proportional"===o[1]&&"proportional"===o[2]||(n.size=o),n}async function T(e,t){if(Object(a["k"])(e.symbol))return e.symbol;const i=j(e,t);return Object(a["k"])(i)&&i.getSymbolAsync(e,t)}async function w(e,t){const i=j(e,t),r=await T(e,t);if(!r)return null;const a={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return a;const n=Object(_["getVisualVariableValues"])(i,e,t),s=["proportional","proportional","proportional"];for(const{variable:o,value:c}of n)if("color"===o.type)a.color=y["a"].toUnitRGBA(c);else if("size"===o.type)if("outline"===o.target)a.outlineSize=c;else{const e=o.axis,t=o.useSymbolValue?"symbol-value":c;"width"===e?s[0]=t:"depth"===e?s[1]=t:"height"===e?s[2]=t:s[0]=s[1]="width-and-depth"===e?t:s[2]=t}else"opacity"===o.type?a.opacity=c:"rotation"===o.type&&"tilt"===o.axis?a.tilt=c:"rotation"===o.type&&"roll"===o.axis?a.roll=c:"rotation"===o.type&&(a.heading=c);return(isFinite(s[0])||isFinite(s[1])||isFinite(s[2]))&&(a.size=s),a}function C(e,t=0){const i=e[t];return"number"==typeof i&&isFinite(i)?i:null}function A(e){for(let t=0;t<3;t++){const i=e[t];if("number"==typeof i)return isFinite(i)?i:0}return 0}var P=i("69dd"),R=i("648c"),E=i("ed70"),I=(i("e06a"),i("b423"),i("261a"),i("b48d"),i("478c"),i("76b7"),i("667b"),i("ff57"),i("da00")),M=(i("f976"),i("1fd7"),i("fc29")),D=i("ce50"),L=i("af40"),N=i("e92d"),F=i("28eb"),z=i("8a44"),G=i("5815"),V=i("e431"),U=i("0b2d"),B=i("8188"),k=i("4261"),H=i("9180"),W=i("1a54"),q=i("56ff"),$=i("82fa"),X=i("c128"),Y=i("6e07"),Z=i("0fe9"),J=i("7533"),Q=i("35c9"),K=i("c919"),ee=i("a6c1"),te=i("8246");const ie=J["a"].fromSimpleMarkerSymbol(ee["a"]),re=Y["a"].fromSimpleLineSymbol(ee["c"]),ae=Q["a"].fromSimpleFillSymbol(ee["b"]),ne=new Z["a"]({symbolLayers:[new X["a"]({material:{color:te["a"]},edges:new K["a"]({size:"1px",color:te["b"]})})]});function se(e){if(Object(a["j"])(e))return null;switch(e.type){case"mesh":return ne;case"point":case"multipoint":return ie;case"polyline":return re;case"polygon":case"extent":return ae}return null}var oe,ce,le=i("cf49"),de=i("9305");i("57dc");class he{constructor(e,t){this.spatialReference=e,this.view=t}getElevation(e,t,i){return this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,i)}async queryElevation(e,t,i,r,a){return this.view.elevationProvider.queryElevation(e,t,0,this.spatialReference,a,i,r)}}!function(e){e[e.GRAPHIC=0]="GRAPHIC",e[e.LABEL=1]="LABEL",e[e._COUNT=2]="_COUNT"}(oe||(oe={})),function(e){e[e.USER_SETTING=0]="USER_SETTING",e[e.SCALE_RANGE=1]="SCALE_RANGE",e[e.FILTER=2]="FILTER",e[e.DECONFLICTION=3]="DECONFLICTION",e[e._COUNT=4]="_COUNT"}(ce||(ce={}));var ue=i("e9d6"),pe=i("ce6d"),be=i("9392"),fe=i("8152"),me=i("461f");let ge=class extends M["a"]{constructor(e){super(e),this.events=new pe["a"],this.hasZ=null,this.hasM=null,this.objectIdField=null,this.viewSpatialReference=null,this.featureAdapter={getAttribute:(e,t)=>"graphic"in e?e.graphic.attributes[t]:me["a"].getAttribute(e,t),getAttributes:e=>"graphic"in e?e.graphic.attributes:me["a"].getAttributes(e),getObjectId:e=>"graphic"in e?Object(W["e"])(e.graphic,this.objectIdField):me["a"].getObjectId(e),getGeometry:e=>"graphic"in e?e.getAsOptimizedGeometry(this.hasZ,this.hasM):me["a"].getGeometry(e),getCentroid:(e,t)=>{if("graphic"in e){let i=null;Object(a["k"])(e.centroid)?i=e.centroid:"point"===e.graphic.geometry.type&&Object(B["o"])(e.graphic.geometry,Oe,this.viewSpatialReference)&&(i=Oe);const r=new Array(2+(t.hasZ?1:0)+(t.hasM?1:0));return Object(a["j"])(i)?(r[0]=0,r[1]=0,r[2]=0,r[3]=0):(r[0]=i.x,r[1]=i.y,t.hasZ&&(r[2]=i.hasZ?i.z:0),t.hasM&&(r[t.hasZ?3:2]=i.hasM?i.m:0)),new fe["a"]([],r)}return me["a"].getCentroid(e,t)},cloneWithGeometry:(e,t)=>"graphic"in e?new be["a"](t,this.featureAdapter.getAttributes(e),null,this.featureAdapter.getObjectId(e)):me["a"].cloneWithGeometry(e,t)}}forEachInBounds(e,t){this.getSpatialIndex().forEachInBounds(e,t)}forEachBounds(e,t,i){const r=this.getSpatialIndex();for(const n of e){const e=this.featureAdapter.getObjectId(n);Object(a["k"])(r.getBounds(e,i))&&t(i)}}};Object(r["a"])([Object(s["b"])({constructOnly:!0})],ge.prototype,"getSpatialIndex",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],ge.prototype,"toArray",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],ge.prototype,"forEach",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],ge.prototype,"hasZ",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],ge.prototype,"hasM",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],ge.prototype,"objectIdField",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],ge.prototype,"viewSpatialReference",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],ge.prototype,"featureSpatialReference",void 0),ge=Object(r["a"])([Object(l["a"])("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],ge);const Oe={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};class ve{constructor(e,t,i){this.graphic=e,this.renderingInfo=t,this.layer=i}}class ye{constructor(e){this.schedule=e,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.isAsync=!1}}var _e=i("792b"),je=i("38bf"),xe=i("a915"),Se=i("02f1"),Te=i("d791"),we=i("afe1"),Ce=i("2e0f"),Ae=i("ba58"),Pe=i("6611"),Re=i("0cb9"),Ee=i("b7bd");function Ie(e,t,i,r){const a=e.stageObject,n=a.geometryRecords;let s=0;for(const o of n){const{update:e,averageGeometrySampledElevation:n}=He(o,t,i,r);s+=n,e&&a.geometryVertexAttrsUpdated(o)}return s/n.length}function Me(e,t,i,r){const a=e.stageObject,n=t.centerPointInElevationSR;let s=0;a.metadata.usesVerticalDistanceToGround?(Object(Ce["g"])(n,i,t,r,ke),Object(Ae["h"])(a,ke.verticalDistanceToGround),s=ke.sampledElevation):(Object(Ce["g"])(n,i,t,r,ke),"absolute-height"!==t.mode&&(s=ke.sampledElevation));const o=Object(Te["c"])(De,a.transformation),c=Object(V["w"])(Be,o[12],o[13],o[14]);Pe["a"].TESTS_DISABLE_OPTIMIZATIONS?(ze[0]=n.x,ze[1]=n.y,ze[2]=ke.z,Object(B["d"])(n.spatialReference,ze,o,r.spatialReference)&&(a.transformation=o)):r.setAltitudeOfTransformation(ke.z,o);const l=Fe/r.unitInMeters;return(Math.abs(o[12]-c[0])>=l||Math.abs(o[13]-c[1])>=l||Math.abs(o[14]-c[2])>=l)&&(a.transformation=o),s}const De=Object(we["d"])();function Le(e,t,i,r){const n=e.graphics3DSymbolLayer.lodRenderer;if(Object(a["j"])(n))return 0;const s=t.centerPointInElevationSR;Object(Ce["g"])(s,i,t,r,ke);const o="absolute-height"!==t.mode?ke.sampledElevation:0,c=n.instanceData,l=e.instanceIndex,d=Ue;c.getGlobalTransform(l,d);const h=Object(V["w"])(Be,d[12],d[13],d[14]);Pe["a"].TESTS_DISABLE_OPTIMIZATIONS?(ze[0]=s.x,ze[1]=s.y,ze[2]=ke.z,Object(B["d"])(s.spatialReference,ze,d,r.spatialReference)&&c.setGlobalTransform(l,d)):r.setAltitudeOfTransformation(ke.z,d);const u=Fe/r.unitInMeters;return(Pe["a"].TESTS_DISABLE_OPTIMIZATIONS||Math.abs(d[12]-h[0])>=u||Math.abs(d[13]-h[1])>=u||Math.abs(d[14]-h[2])>=u)&&c.setGlobalTransform(l,d),o}function Ne(e,t,i,r){const a=e.stageObject,n=a.geometryRecords;if(0===n.length)return 0;let s=0,o=null,c=0,l=!1;for(const d of n){const e=d.geometry.vertexAttributes.get(Ee["a"].POSITION);if(e!==o){const{update:a,averageGeometrySampledElevation:n}=He(d,t,i,r);c=n,o=e,l=a}l&&a.geometryVertexAttrsUpdated(d),s+=c}return s/n.length}const Fe=.01,ze=Object(U["f"])(),Ge=Object(U["f"])(),Ve=Object(U["f"])(),Ue=Object(we["d"])(),Be=Object(U["f"])(),ke=new Ce["a"];function He(e,t,i,r){let a=!1;const n=i.spatialReference,s=e.geometry,o=e.getShaderTransformation(),c=t.requiresSampledElevationInfo;Ge[0]=o[12],Ge[1]=o[13],Ge[2]=o[14],s.invalidateBoundingInfo();const l=s.getMutableAttribute(Ee["a"].POSITION),d=l.data,h=s.vertexAttributes.get(Ee["a"].MAPPOS).data,u=l.size,p=d.length/u,b=new Re["a"](h,n);let f=0,m=0;for(let g=0;g<p;g++){if(Ve[0]=d[f],Ve[1]=d[f+1],Ve[2]=d[f+2],Object(Ce["g"])(b,i,t,r,ke),c&&(m+=ke.sampledElevation),Pe["a"].TESTS_DISABLE_OPTIMIZATIONS)d[f]=b.array[b.offset],d[f+1]=b.array[b.offset+1],d[f+2]=ke.z,Object(B["l"])(d,n,f,d,r.spatialReference,f,1),d[f]-=Ge[0],d[f+1]-=Ge[1],d[f+2]-=Ge[2],a=!0;else{ze[0]=d[f]+Ge[0],ze[1]=d[f+1]+Ge[1],ze[2]=d[f+2]+Ge[2],r.setAltitude(ze,ke.z),d[f]=ze[0]-Ge[0],d[f+1]=ze[1]-Ge[1],d[f+2]=ze[2]-Ge[2];const e=Fe/r.unitInMeters;(Math.abs(Ve[0]-d[f])>=e||Math.abs(Ve[1]-d[f+1])>=e||Math.abs(Ve[2]-d[f+2])>=e)&&(a=!0)}f+=u,b.offset+=3}return m/=p,{update:a,averageGeometrySampledElevation:m}}var We,qe=i("0eb9"),$e=i("f895"),Xe=i("b7c2");!function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"}(We||(We={}));class Ye{constructor(e,t,i,r,a,n,s,o=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._uniqueGeometries=i,this._uniqueMaterials=r,this._sharedResource=a,this.elevationAligner=n,this.elevationContext=s,this._edgeState=o,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=e,this.stageObject=t}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(e,t){this._stageLayer=t,this._stage=e,e.addMany(this._uniqueMaterials),e.addMany(this._uniqueGeometries),e.add(this.stageObject)}destroy(){const e=this._stage;this._stageLayer&&(e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries)),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const t=this._stage.renderView.ensureEdgeView();t.hasObject(this.stageObject)&&t.removeObject(this.stageObject),this.stageObject.dispose(),Object(a["k"])(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(e,t){if(Object(a["j"])(this._edgeState))return;const i=Ze(this._edgeState.baseMaterial);let r=!1;for(const a of this._edgeState.edgeMaterials)a.objectTransparency!==i&&(a.objectTransparency=i,r=!0);r&&this._resetEdgeObject(t),this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,t){Object(a["j"])(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!t),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(null!=this._stage&&this._visible!==e&&(this._visible=e,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),Object(a["k"])(this._edgeState))){const t=this._stage.renderView.ensureEdgeView();t.hasObject(this.stageObject)?t.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(t,!1)}}get visible(){return this._visible}alignWithElevation(e,t,i,r){null!=this.elevationAligner&&(Object(a["k"])(i)&&Object(ue["f"])(this.elevationContext.featureExpressionInfoContext,i),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e,t),this._resetEdgeObject(r))}getCenterObjectSpace(e=Object(U["f"])()){return Object(V["g"])(e,Object($e["f"])(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(e=Object(k["f"])()){const t=this.stageObject.boundingVolumeObjectSpace;return Object(k["y"])(e,t.min),Object(k["x"])(e,t.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const t=this.stageObject.transformation;e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++}else for(const t of this.stageObject.geometryRecords)t.computeAttachmentOrigin(Ke)&&(Object(V["q"])(Ke,Ke,this.stageObject.transformation),Object(V["e"])(e.render.origin,e.render.origin,Ke),e.render.num++)}async getProjectedBoundingBox(e,t,i,r,n){const s=this.getBoundingBoxObjectSpace(n),o=et,c=Object(k["s"])(s)?1:o.length;for(let a=0;a<c;a++){const e=o[a];Qe[0]=s[e[0]],Qe[1]=s[e[1]],Qe[2]=s[e[2]],Object(V["q"])(Qe,Qe,this.stageObject.transformation),Je[3*a+0]=Qe[0],Je[3*a+1]=Qe[1],Je[3*a+2]=Qe[2]}if(!e(Je,0,c))return null;Object(k["h"])(s);let l=null;this.calculateRelativeScreenBounds&&(l=this.calculateRelativeScreenBounds());for(let a=0;a<3*c;a+=3){for(let e=0;e<3;e++)s[e]=Math.min(s[e],Je[a+e]),s[e+3]=Math.max(s[e+3],Je[a+e]);l&&i.push({location:Je.slice(a,a+3),screenSpaceBoundingRect:l})}if(t&&t.service&&"absolute-height"!==this.elevationContext.mode){Object(k["d"])(s,Ke);const e="relative-to-scene"===this.elevationContext.mode?"scene":"ground";let i=0;if(t.useViewElevation)i=Object(a["s"])(t.service.getElevation(Ke[0],Ke[1],e),0);else try{const n=Object(Ae["d"])(s,t);i=Object(a["s"])(await t.service.queryElevation(Ke[0],Ke[1],r,n,e),0)}catch(d){}Object(k["u"])(s,0,0,-this.alignedSampledElevation+i)}return s}addObjectState(e,t){e===Xe["d"].Highlight&&t.addObject(this.stageObject,this.stageObject.highlight()),e===Xe["d"].MaskOccludee&&t.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}_resetEdgeObject(e){if(Object(a["j"])(this._edgeState))return;const t=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(t,e):t.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,t){const i=this._edgeState;if(Object(a["j"])(i))return;const r=Ze(i.baseMaterial);for(const a of i.edgeMaterials)a.objectTransparency=r;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!t).then(()=>{var e;return null==(e=this._stageLayer)?void 0:e.sync()})}}function Ze(e){return e.isVisible?e.parameters.transparent?We.TRANSPARENT:We.OPAQUE:We.INVISIBLE}const Je=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Qe=Object(U["f"])(),Ke=Object(U["f"])(),et=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];var tt,it,rt=i("0fc4");!function(e){e[e.Recreate_Symbol=0]="Recreate_Symbol",e[e.Recreate_Graphics=1]="Recreate_Graphics",e[e.Fast_Update=2]="Fast_Update"}(tt||(tt={}));class at{constructor(e){this.schedule=e,this._loadStatus=it.LOADING,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){return this._loadStatus===it.LOADED?(e&&e(),Object(a["r"])(this._loader)):this._loadStatus===it.FAILED?(t&&t(this._loadError),Object(a["r"])(this._loader)):(Object(a["j"])(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=it.LOADED},e=>{throw this._loadError=e,this._abortController=null,this._loadStatus=it.FAILED,!Object(h["j"])(e)&&this.logger&&e.message&&this.logger.warn(e.message),e})),this._loader.then(e,t).catch(()=>{}),this._loader)}abortLoad(){Object(a["k"])(this._abortController)?this._abortController=Object(a["a"])(this._abortController):this._loadStatus===it.LOADING&&(this._loadStatus=it.FAILED),this._loader=null}}!function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"}(it||(it={}));var nt=i("6c97"),st=i("8c11"),ot=i("caf7");function ct(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function lt(e,t){const i=(e,i,r=!1)=>({levels:e.map(e=>{const a=i(e.tesselation);return r&&ot["a"].cgToGIS(a),{components:[{geometry:a,material:t}],faceCount:a.indexCount/3,minScreenSpaceRadius:e.minScreenSpaceRadius}})});switch(e){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],e=>ot["a"].createPolySphereGeometry(.5,e,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>ot["a"].createBoxGeometry(1));case"cone":return i(dt,e=>ot["a"].createConeGeometry(1,.5,e,!1),!0);case"inverted-cone":return i(dt,e=>ot["a"].createConeGeometry(1,.5,e,!0),!0);case"cylinder":return i(dt,e=>ot["a"].createCylinderGeometry(1,.5,e,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>ot["a"].createTetrahedronGeometry(1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>ot["a"].createDiamondGeometry(1),!0);default:return}}const dt=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function ht(e){return"fill"===e.type}function ut(e){return"extrude"===e.type}function pt(e){return e&&e.enabled&&(ut(e)||ht(e))&&Object(a["k"])(e.edges)}function bt(e){return e&&e.enabled&&e.edges||null}function ft(e,t){return mt(bt(e),t)}function mt(e,t){if(Object(a["j"])(e))return null;const i=Object(a["k"])(e.color)?Object(rt["d"])(y["a"].toUnitRGBA(e.color)):Object(rt["g"])(0,0,0,0),r=Object(xe["g"])(e.size),n=Object(xe["g"])(e.extensionLength);switch(e.type){case"solid":return gt({color:i,size:r,extensionLength:n,...t});case"sketch":return Ot({color:i,size:r,extensionLength:n,...t});default:return}}function gt(e){return{...vt,...e,type:"solid"}}function Ot(e){return{...yt,...e,type:"sketch"}}const vt={color:Object(rt["g"])(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:We.OPAQUE,hasSlicePlane:!1},yt={color:Object(rt["g"])(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:We.OPAQUE,hasSlicePlane:!1};function _t(e){const t=[];return e.levels.forEach(e=>{e.components.forEach(e=>{t.push(e.material)})}),Object(o["k"])(t)}function jt(e){const t=new Array;return e.levels.forEach(e=>{e.components.forEach(e=>{e.textures&&t.push(...e.textures)})}),Object(o["k"])(t)}function xt(e){const t=[];return e.components.forEach(e=>{t.push(e.geometry)}),Object(o["k"])(t)}function St(e){const t=[];return e.levels.forEach(e=>{e.components.forEach(e=>{t.push(e.geometry)})}),Object(o["k"])(t)}function Tt(e){return xt(e).reduce((e,t)=>e+t.indexCount/3,0)}const wt={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function Ct(e){return"web-style"===e.type?wt:At(e.symbolLayers.toArray().map(t=>Et(e,t)))}function At(e){let t=0,i=0,r=0,n=!1,s=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const c of e)Object(a["j"])(c)||(t+=c.primitivesPerFeature,i+=c.primitivesPerCoordinate,r+=c.drawCallsPerFeature,o.bytesPerFeature+=c.memory.bytesPerFeature,o.bytesPerFeatureLabel+=c.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=c.memory.bytesPerCoordinate,o.draped.bytesPerFeature+=c.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=c.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=c.memory.bytesPerCoordinate,n=n||c.estimated,++s);return{primitivesPerFeature:t,primitivesPerCoordinate:i,drawCallsPerFeature:r,estimated:n,memory:o,numComplexities:s}}function Pt(e){const t=At(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const Rt={};function Et(e,t){const i=It(e,t),r=pt(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:r,estimated:!1,memory:i};case"fill":return"mesh-3d"===e.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:r,estimated:!1,memory:i}:Object(a["k"])(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:i}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:i};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:i}:{...Mt(t.resource&&t.resource.primitive||st["b"]),memory:i};case"path":{const e=3,r=3,a=10;let n=0,s=0;switch(t.profile){case"circle":n=a;break;case"quad":n=4;break;default:return void Object(nt["a"])(t.profile)}switch(t.join){case"round":s=e;break;case"miter":case"bevel":s=1;break;default:return void Object(nt["a"])(t.join)}const o=2*n,c=n*s*2;let l=-2*c-o;switch(t.cap){case"none":break;case"butt":case"square":l+=2*(n-1);break;case"round":l+=2*(n*(r-1)*2+n);break;default:return}return{primitivesPerFeature:l,primitivesPerCoordinate:c+o,drawCallsPerFeature:0,estimated:!1,memory:i}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:i};default:return}}function It(e,t){const i="point-3d"===e.type;switch(t.type){case"extrude":return t.edges&&t.edges.size>0?Dt.EXTRUDE_EDGES:Dt.EXTRUDE;case"fill":return Object(a["k"])(t.outline)&&t.outline.size>0?Dt.FILL_OUTLINE:Dt.FILL;case"water":return Dt.FILL;case"line":return"round"===t.join?Dt.LINE_ROUND:Dt.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return Dt.PATH_ROUND_CIRCLE;case"quad":return Dt.PATH_ROUND_QUAD;default:return void Object(nt["a"])(t.profile)}case"miter":case"bevel":switch(t.profile){case"circle":return Dt.PATH_MITER_CIRCLE;case"quad":return Dt.PATH_MITER_QUAD;default:return void Object(nt["a"])(t.profile)}default:return void Object(nt["a"])(t.join)}case"object":return i?Dt.OBJECT_POINT:Dt.OBJECT_POLYGON;case"icon":case"text":return i?Dt.ICON_POINT:Dt.ICON_POLYGON;default:return}}function Mt(e){let t=Rt[e];if(t)return t;const i=lt(e,null);return t={primitivesPerFeature:xt(i.levels[0]).reduce((e,t)=>e+t.indices.get(Ee["a"].POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},Rt[e]=t,t}const Dt={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}},Lt=N["a"].getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class Nt extends at{constructor(e,t,i,r){super(i.schedule),this._context=i,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=Lt,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=e,this.symbolLayer=t,this._renderPriority=r.renderPriority,this._renderPriorityStep=r.renderPriorityStep,this._elevationContext=new qe["a"],this.complexity=this.computeComplexity(),this._ignoreDrivers=r.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=zt(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this._ignoreDrivers)return!1;const t=this._drivenProperties,i=zt(e);return i.color!==t.color||i.opacity!==t.opacity||i.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||i.size!==t.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,i,r){const a=e.projectionSuccess,n="polygons"in e?e.polygons:null,s=r+" geometry failed to be created";let o=null;a?!t.length||1===t.length&&!t[0].length?o=`${s} (no ${i} were defined)`:Array.isArray(t)&&Array.isArray(t[0])?n&&0===n.length&&"rings"===i&&t.length>0&&t[0].length>2&&(o=s+" (filled rings should use clockwise winding - try reversing the order of vertices)"):o=`${s} (${i} should be defined as a 2D array)`:o=s+" (failed to project geometry to view spatial reference)",o&&Lt.warnOncePerTick(o)}_validateGeometry(e,t=null,i=null){if(Object(a["k"])(t)&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+" symbol: "+e.type),!1;if("point"===e.type){const t=e;if(!isFinite(t.x)||!isFinite(t.y))return Lt.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return Gt}_defaultElevationInfoZ(){return Vt}_updateElevationContext(){Object(a["k"])(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,t){const i=Object(a["r"])(e.geometry),r=this.getDefaultElevationInfo(i);t.unit=null!=this._elevationContext.unit?this._elevationContext.unit:r.unit,t.mode=this.getGeometryElevationMode(i,r),t.offsetMeters=Object(a["s"])(this._elevationContext.meterUnitOffset,Object(a["s"])(r.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===t.mode;n&&(t.mode="relative-to-ground",t.offsetMeters=0);const s=n?ue["g"]:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(s,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return!1}onRemoveGraphic(e){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const e=this._context.layer.opacity;return null==e?1:e}_getCombinedOpacity(e,t=Ut){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(Object(a["k"])(e)?i*=e.a:t.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,t=Ut){const i=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return Object(Ae["g"])(null,i);const r=Object(a["k"])(e)?y["a"].toUnitRGB(e):U["a"];return Object(Ae["g"])(r,i)}_getVertexOpacityAndColor(e,t=null){const i=this._drivenProperties.color?e.color:null,r=this._drivenProperties.opacity?e.opacity:null,n=Object(Ae["g"])(i,r);return Object(a["k"])(t)&&(n[0]*=t,n[1]*=t,n[2]*=t,n[3]*=t),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return Et(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,i){switch(e){case"opacity":return this.layerOpacityChanged(t,i);case"elevationInfo":{const e=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,i,e)!==Ce["b"].RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(e,t,i){let r=Ce["b"].UPDATE;return e.forEach(e=>{const n=t(e);if(Object(a["k"])(n)){const t=e.graphic;this.setGraphicElevationContext(t,n.elevationContext),n.needsElevationUpdates=i(n.elevationContext.mode)}else r=Ce["b"].RECREATE}),r}applyRendererDiff(e,t){return tt.Recreate_Symbol}getFastUpdateAttrValues(e){if(!this._fastUpdates.enabled)return null;const t=this._fastUpdates.visualVariables,i=t.size?Ft(t.size.field,e):0,r=t.color?Ft(t.color.field,e):0,a=t.opacity?Ft(t.opacity.field,e):0;return Object(rt["g"])(i,r,a,0)}get draped(){return this._draped}ensureDrapedStatus(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&Lt.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var e,t,i,r,a,n,s,o,c,l,d,h,u,p,b,f;return{size:null!=(e=null==(t=this._fastUpdates)||null==(i=t.visualVariables)||null==(r=i.size)?void 0:r.field)?e:null,color:null!=(a=null==(n=this._fastUpdates)||null==(s=n.visualVariables)||null==(o=s.color)?void 0:o.field)?a:null,opacity:null!=(c=null==(l=this._fastUpdates)||null==(d=l.visualVariables)||null==(h=d.opacity)?void 0:h.field)?c:null,rotation:null!=(u=null==(p=this._fastUpdates)||null==(b=p.visualVariables)||null==(f=b.rotation)?void 0:f.field)?u:null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}}function Ft(e,t){const i=null!=e?t.attributes[e]:0;return null!=i&&isFinite(i)?i:0}function zt(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach(e=>{switch(e.type){case"color":if(t.color=!0,e.stops)for(let i=0;i<e.stops.length;i++){const r=e.stops[i].color;r&&(t.opacity=!0,r.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}}),t}const Gt={mode:"on-the-ground",offset:0,unit:"meters"},Vt={mode:"absolute-height",offset:0,unit:"meters"},Ut={hasIntrinsicColor:!1};var Bt=i("5241"),kt=i("0278"),Ht=i("35b3"),Wt=i("738e"),qt=i("fc00"),$t=i("a05b"),Xt=i("d0cb"),Yt=i("d7f7"),Zt=i("badc"),Jt=i("5957"),Qt=i("3c9c"),Kt=i("c3a4"),ei=i("ca98"),ti=i("fa1e"),ii=i("c829"),ri=i("a5b5"),ai=i("d17d"),ni=i("189c");class si extends ei["a"]{initializeConfiguration(e,t){t.spherical=e.viewingMode===Qt["a"].Global}initializeProgram(e){const t=si.shader.get().build(this.configuration);return new ii["a"](e.rctx,t,ti["a"])}setPipelineState(e){const t=e?ai["h"].ALWAYS:ai["h"].LESS;return this.configuration.depthHudEnabled?Object(ni["f"])({depthTest:{func:t},depthWrite:ni["d"]}):Object(ni["f"])({blending:Object(ni["g"])(ai["b"].ONE,ai["b"].SRC_ALPHA,ai["b"].ONE_MINUS_SRC_ALPHA,ai["b"].ONE_MINUS_SRC_ALPHA),depthTest:{func:t},colorWrite:ni["c"]})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}si.shader=new Kt["a"](ri["a"],()=>i.e("chunk-2d0efcae").then(i.bind(null,"9a2b")));var oi=i("da35"),ci=i("6d35");class li extends ci["a"]{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=Xt["b"].World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}}Object(r["a"])([Object(oi["b"])({count:Xt["b"].COUNT})],li.prototype,"screenCenterOffsetUnitsEnabled",void 0),Object(r["a"])([Object(oi["b"])()],li.prototype,"spherical",void 0),Object(r["a"])([Object(oi["b"])()],li.prototype,"occlusionTestEnabled",void 0),Object(r["a"])([Object(oi["b"])()],li.prototype,"hasVerticalOffset",void 0),Object(r["a"])([Object(oi["b"])()],li.prototype,"hasScreenSizePerspective",void 0),Object(r["a"])([Object(oi["b"])()],li.prototype,"depthHudEnabled",void 0),Object(r["a"])([Object(oi["b"])()],li.prototype,"depthHudAlignStartEnabled",void 0),Object(r["a"])([Object(oi["b"])()],li.prototype,"hasSlicePlane",void 0),Object(r["a"])([Object(oi["b"])()],li.prototype,"hasMultipassGeometry",void 0),Object(r["a"])([Object(oi["b"])({constValue:!0})],li.prototype,"hasSliceInVertexProgram",void 0),Object(r["a"])([Object(oi["b"])({constValue:!1})],li.prototype,"isDraped",void 0);class di extends Ht["a"]{constructor(e){super(e,new ui),this.techniqueConfig=new li,this._uniqueMaterialIdentifier=di.uniqueMaterialIdentifier(this.parameters)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getConfiguration(e,t){const i=(null==t?void 0:t.slot)!==Zt["a"].LINE_CALLOUTS;return this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.hasVerticalOffset=Object(a["k"])(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=Object(a["k"])(this.parameters.screenSizePerspective),this.techniqueConfig.depthHudEnabled=i,this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?Xt["b"].Screen:Xt["b"].World,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasMultipassGeometry=!!t&&t.multipassGeometry.enabled,this.techniqueConfig}intersect(){}requiresSlot(e){switch(e){case Zt["a"].LINE_CALLOUTS:case Zt["a"].LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return e.output===$t["a"].Color?new hi(e):null}createBufferWriter(){return new fi}validateParameters(e){const t=di.uniqueMaterialIdentifier(e);t!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=t)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}}class hi extends Yt["a"]{beginSlot(e){return this.ensureTechnique(si,e)}}class ui extends Ht["b"]{constructor(){super(...arguments),this.screenOffset=Se["b"],this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const pi=Object(qt["a"])().vec3f(Ee["a"].POSITION).vec3f(Ee["a"].NORMAL).vec2f(Ee["a"].UV0).vec4f(Ee["a"].AUXPOS1),bi=[Object(Wt["b"])(0,0),Object(Wt["b"])(1,0),Object(Wt["b"])(0,1),Object(Wt["b"])(1,0),Object(Wt["b"])(1,1),Object(Wt["b"])(0,1)];class fi{constructor(){this.vertexBufferLayout=pi}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(Ee["a"].POSITION).length}write(e,t,i,r){Object(Jt["e"])(t.indices.get(Ee["a"].POSITION),t.vertexAttributes.get(Ee["a"].POSITION).data,e.transformation,i.position,r,6),Object(Jt["d"])(t.indices.get(Ee["a"].NORMAL),t.vertexAttributes.get(Ee["a"].NORMAL).data,e.invTranspTransformation,i.normal,r,6),Object(Jt["a"])(t.indices.get(Ee["a"].AUXPOS1),t.vertexAttributes.get(Ee["a"].AUXPOS1).data,i.auxpos1,r,6);for(let a=0;a<bi.length;++a)i.uv0.setVec(r+a,bi[a])}}class mi extends Nt{constructor(e,t){super(e,null,t,yi),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new di(this.materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const t=this.materialParameters;return t.screenOffset=e.screenOffset||Se["b"],t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get materialParameters(){const e=this.symbol,t=e.callout,i=Object(a["k"])(t.color)?y["a"].toUnitRGBA(t.color):[0,0,0,0];i[3]*=this._getLayerOpacity();const r=Object(xe["g"])(t.size||0);let n=null;if(e.verticalOffset){const{screenLength:t,minWorldLength:i,maxWorldLength:r}=e.verticalOffset;n={screenLength:Object(xe["g"])(t),minWorldLength:i||0,maxWorldLength:null!=r?r:1/0}}const s=Object(a["k"])(t.border)&&Object(a["k"])(t.border.color)?y["a"].toUnitRGBA(t.border.color):null,o="object"===e.symbolLayers.getItemAt(0).type,c=!o,l=o?0:void 0,d="label-3d"===e.type;return{color:i,size:r,verticalOffset:n,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:s,occlusionTest:c,shaderPolygonOffset:l,depthHUDAlignStart:d,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:Ht["c"].Occlude,__tagStrict:"NoParameters"}}_defaultElevationInfoNoZ(){return vi}createGraphics3DGraphic(e){const t=e.renderingInfo,i=e.graphic,r=this.setGraphicElevationContext(i,new qe["a"],t.elevationOffset||0),n=t.symbol,s="on-the-ground"===this._elevationContext.mode&&("cim"===n.type||!n.symbolLayers.some(e=>"object"===e.type||"text"===e.type));if("label-3d"!==n.type&&s)return null;if("point-3d"===n.type&&n.symbolLayers.every(e=>"text"===e.type&&!Object(je["e"])(e)))return null;const o=Object(Ae["a"])(i.geometry);return Object(a["j"])(o)?null:this._createAs3DShape(o,r,t,i.uid)}layerOpacityChanged(){return Object(a["j"])(this._material)||this._material.setParameters(this.materialParameters),!0}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,n=Object(Ce["e"])(mi.elevationModeChangeTypes,i,r);return n!==Ce["b"].UPDATE||e.forEach(e=>{const i=t(e);Object(a["k"])(i)&&this.updateGraphicElevationContext(e.graphic,i)}),n}slicePlaneEnabledChanged(){return Object(a["j"])(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(e,t,i=0){const r=super.setGraphicElevationContext(e,t);return r.addOffsetRenderUnits(i),r}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata.elevationOffset),t.needsElevationUpdates=Object(Ce["h"])(t.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:wt.memory}}_createVertexData(e){const{translation:t,centerOffset:i}=e,r=t?{size:3,data:[t[0],t[1],t[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0},a=i?{size:4,data:[i[0],i[1],i[2],i[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0};return[[Ee["a"].POSITION,r],[Ee["a"].NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[Ee["a"].AUXPOS1,a]]}_getOrCreateMaterial(e){const t=this._perInstanceMaterialParameters(e),i=di.uniqueMaterialIdentifier(t);if(Object(a["k"])(this._material)&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(e.materialCollection){let r=e.materialCollection.get(i);return Object(a["j"])(r)&&(r=new di(t),e.materialCollection.add(i,r)),{material:r,isUnique:!1}}return{material:new di(t),isUnique:!0}}_createAs3DShape(e,t,i,r){const a=[new kt["a"](this._createVertexData(i),Oi,Xe["f"].Point)],n=this._getOrCreateMaterial(i),s=Object(Bt["a"])(this._context,e,a,[n.material],t,this._context.layer.uid,r);if(null===s)return null;const o=new Ye(this,s.object,a,n.isUnique?[n.material]:null,null,Me,t);return o.metadata={elevationOffset:i.elevationOffset||0},o.alignedSampledElevation=s.sampledElevation,o.needsElevationUpdates=Object(Ce["h"])(t.mode),Object(Bt["b"])(o,e,this._context.elevationProvider),o}}mi.elevationModeChangeTypes={definedChanged:Ce["b"].UPDATE,staysOnTheGround:Ce["b"].UPDATE,onTheGroundChanged:Ce["b"].RECREATE};const gi=new Uint16Array([0]),Oi=[[Ee["a"].POSITION,gi],[Ee["a"].NORMAL,gi],[Ee["a"].AUXPOS1,gi]],vi={mode:"relative-to-ground",offset:0},yi={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},_i=N["a"].getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function ji(e,t){if(!Object(je["b"])(e))return _i.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const i=xi[e.callout.type];return i?new i(e,t):(_i.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+e.callout.type),null)}const xi={line:mi};var Si=i("f0b9"),Ti=i("ecd7"),wi=i("3349"),Ci=i("1219"),Ai=i("6655");const Pi=new Ti["a"](Array,e=>Object(k["w"])(e,k["b"]),null,10,5),Ri=Object(H["k"])();class Ei{constructor(e,t,i,r,n){this.graphic=e,this.graphics3DSymbol=t,this.graphics=i,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=Ii(oe._COUNT,ce._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++t.referenced,this._featureExpressionFeature=n?Object(ue["c"])(n,e,r):null;for(const s of i)Object(a["k"])(s)&&(this.isElevationSource=this.isElevationSource||s.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(e,t){this._layer=t,this._stage=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e,t),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return null==this.graphics}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelGraphics.length=0}addLabelGraphic(e,t,i){this._labelGraphics.push(e),e.initialize(t,i),e.setVisibility(this.isVisible(oe.LABEL))}addAuxiliaryGraphic(e){this._auxiliaryGraphics.push(e),this._layer&&(e.initialize(this._stage,this._layer),e.setVisibility(this.isVisible()))}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(t=>{"draped"===t.type&&(e=!0)}),e}isVisible(e=oe.GRAPHIC,t){for(let i=0;i<=e;i++){const e=this._visibilityFlags[i];for(let i=0;i<e.length;++i)if(!1===e[i]&&i!==t)return!1}return!0}hasVisibilityFlag(e,t){return null!=this._visibilityFlags[t][e]}setVisibilityFlag(e,t,i){const r=this.isVisible(i);this._visibilityFlags[i][e]=t;const a=this.isVisible(i);if(r===a)return!1;if(i===oe.LABEL)this._forEachLabelGraphic(e=>e.setVisibility(a));else{this._forEachSymbolLayerGraphic(e=>e.setVisibility(a));const e=this.isVisible(oe.LABEL);this._forEachLabelGraphic(t=>t.setVisibility(e))}return!0}clearVisibilityFlag(e,t=oe.GRAPHIC){return this.setVisibilityFlag(e,void 0,t)}computeExtent(e){if(!this._extent){const t=this.graphic.geometry;if(Object(a["j"])(t))return!1;this._extent=Object(H["k"])(),Object(W["d"])(t,this._extent);const i=t.spatialReference;if(!i.equals(e)&&!Object(B["k"])(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return Object(a["k"])(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===e&&this._optimizedGeometry.hasM===t||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t),this._optimizedGeometry.hasZ=e,this._optimizedGeometry.hasM=t),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(e,t,i){let r=e.geometry;return"mesh"!==r.type&&"extent"!==r.type||(r=Ci["a"].fromExtent("mesh"===r.type?r.extent:r)),Object(Ai["d"])(r,t,i)}get usedMemory(){let e=Object(Si["b"])(this.graphic.attributes);return this._forEachSymbolLayerGraphic(t=>{const i=t.graphics3DSymbolLayer.complexity;if(Object(a["j"])(i))return;const r="draped"===t.type?i.memory.draped:i.memory;e+=r.bytesPerFeature,r.bytesPerCoordinate&&(e+=Object(W["h"])(this.graphic.geometry)*r.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:Object(U["f"])(),num:0},draped:{origin:Object(Se["c"])(),num:0}};for(const t of this.graphics)Object(a["j"])(t)||t.computeAttachmentOrigin(e);return e.render.num&&Object(V["k"])(e.render.origin,e.render.origin,1/e.render.num),e.draped.num&&Object(wi["f"])(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,t,i,r,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?Object(k["h"])(n.boundingBox):n.boundingBox=Object(k["h"])(),n.requiresDrapedElevation=!1,await Object(_e["a"])(this.graphics,async s=>{if(Object(a["j"])(s))return;const o="draped"===s.type?t:e,c=Pi.acquire(),l=await s.getProjectedBoundingBox(o,i,n.screenSpaceObjects,r,c);isFinite(l[2])&&isFinite(l[5])||(n.requiresDrapedElevation=!0),l&&Object(k["j"])(n.boundingBox,c),Pi.release(c)}),Object(k["c"])(n.boundingBox)||Object(H["a"])(Object(k["B"])(n.boundingBox,Ri))?n:null}needsElevationUpdates(){for(const e of this.graphics)if(Object(a["k"])(e)&&("object3d"===e.type||"lod-instance"===e.type)&&e.needsElevationUpdates)return!0;for(const e of this._labelGraphics)if(e&&e.needsElevationUpdates)return!0;return!1}alignWithElevation(e,t,i){this._forEachRenderedGraphic(r=>{"object3d"!==r.type&&"lod-instance"!==r.type||r.alignWithElevation(e,t,this._featureExpressionFeature,i)})}addObjectStateSet(e,t){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e,t))}removeObjectState(e){this._forEachSymbolLayerGraphic(t=>t.removeObjectState(e))}_forEachGraphicList(e,t){e.forEach(e=>e&&t(e))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.graphics,e),this._forEachGraphicList(this._auxiliaryGraphics,e)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelGraphics,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}}function Ii(e,t){const i=new Array(e);for(let r=0;r<i.length;r++)i[r]=new Array(t);return i}var Mi=i("9812"),Di=i("1c92"),Li=i("dae5"),Ni=i("8190"),Fi=i("668b"),zi=i("1666"),Gi=i("7585"),Vi=i("3af1");function Ui(e){const t=[[Ee["a"].POSITION,e.indices]],i=[[Ee["a"].POSITION,{size:3,data:e.attributeData.position,exclusive:!0}]];return Object(a["k"])(e.attributeData.color)&&(i.push([Ee["a"].COLOR,{size:4,data:e.attributeData.color,exclusive:!0}]),t.push([Ee["a"].COLOR,new Uint32Array(e.indices.length)])),Object(a["k"])(e.attributeData.uvMapSpace)&&(i.push([Ee["a"].UVMAPSPACE,{size:4,data:e.attributeData.uvMapSpace,exclusive:!0}]),t.push([Ee["a"].UVMAPSPACE,e.indices])),Object(a["k"])(e.attributeData.boundingRect)&&(i.push([Ee["a"].BOUNDINGRECT,{size:9,data:e.attributeData.boundingRect,exclusive:!0}]),t.push([Ee["a"].BOUNDINGRECT,e.indices])),Object(a["k"])(e.attributeData.mapPosition)&&(i.push([Ee["a"].MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([Ee["a"].MAPPOS,e.indices])),new kt["a"](i,t)}function Bi(e){const t=[[Ee["a"].POSITION,e.indices],[Ee["a"].UV0,e.indices]],i=[[Ee["a"].POSITION,{size:3,data:e.attributeData.position,exclusive:!0}],[Ee["a"].UV0,{size:2,data:e.attributeData.uv0,exclusive:!0}]];return Object(a["k"])(e.attributeData.mapPosition)&&(i.push([Ee["a"].MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([Ee["a"].MAPPOS,e.indices])),new kt["a"](i,t)}function ki(e){switch(e.type){case"extent":if(e instanceof Vi["a"])return Ci["a"].fromExtent(e);break;case"polygon":return e}return null}function Hi(e,t,i,r){const a=Object(zi["b"])(e.rings,e.hasZ,zi["a"].CCW_IS_HOLE),n=new Float64Array(a.position.length),s=Object(Ce["d"])(a.position,e.spatialReference,0,n,0,a.position,0,a.position.length/3,t,i,r),o=null!=s;return{position:a.position,mapPosition:n,polygons:$i(a.polygons,a.position,n),outlines:qi(a.outlines,a.position,n),projectionSuccess:o,sampledElevation:s}}function Wi(e,t){const i=Object(zi["b"])(e.rings,!1,zi["a"].CCW_IS_HOLE),r=Object(B["l"])(i.position,e.spatialReference,0,i.position,t,0,i.position.length/3);for(let a=2;a<i.position.length;a+=3)i.position[a]=Gi["a"];return{position:i.position,polygons:$i(i.polygons,i.position),outlines:qi(i.outlines,i.position),projectionSuccess:r}}function qi(e,t,i){const r=new Array;for(const{index:a,count:n}of e){if(n<=1)continue;const e=3*a,s=e+3*n;r.push({index:a,count:n,position:t.subarray(e,s),mapPosition:i?i.subarray(e,s):void 0})}return r}function $i(e,t,i){const r=new Array;for(const{index:a,count:n,holeIndices:s,pathLengths:o}of e){if(n<=1)continue;const e=3*a,c=e+3*n,l=s.map(e=>e-a);r.push({index:a,count:n,holeIndices:l,pathLengths:o,position:t.subarray(e,c),mapPosition:i?i.subarray(e,c):void 0})}return r}var Xi=i("5a22"),Yi=i("dbad");const Zi=["polygon","extent"];class Ji extends Nt{constructor(e,t,i,r){super(e,t,i,r),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=Object(Ae["i"])(this._getSymbolSize());if(e)throw new D["a"]("graphics3dextrudesymbollayer:invalid-size",e)}const e=Object(a["i"])(this.symbolLayer,"material","color"),t=this._getCombinedOpacityAndColor(e),i=Object(U["g"])(t),r=t[3],n=r<1||this.needsDrivenTransparentPass,s={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:r,transparent:n,cullFace:n?Xe["b"].None:Xe["b"].Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new Yi["a"](s),this._bottomMaterial=new Yi["a"]({...s,cullFace:Xe["b"].Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Zi,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),r=this.setGraphicElevationContext(t,new qe["a"]);return this._createAs3DShape(t,e.renderingInfo,i,r,t.uid)}layerOpacityChanged(e,t){const i=Object(a["i"])(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(i),n=r<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:r,transparent:n}),this._bottomMaterial.setParameters({opacity:r,transparent:n});const s=this._getLayerOpacity();return e.forEach(e=>{const i=t(e);Object(a["k"])(i)&&i.layerOpacityChanged(s,this._context.isAsync)}),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,Ce["i"])}slicePlaneEnabledChanged(e,t){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(e=>{const i=t(e);Object(a["k"])(i)&&i.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(e){var t;let i;return i=e.size&&this._drivenProperties.size?null!=(t=C(e.size,2))?t:0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(e,t){return this._drivenPropertiesChanged(t)?tt.Recreate_Symbol:tt.Recreate_Graphics}_getSymbolSize(){var e;return null!=(e=this.symbolLayer.size)?e:1}_createAs3DShape(e,t,i,r,n){const s=ki(e.geometry);if(Object(a["j"])(s))return null;const o=Hi(s,this._context.elevationProvider,this._context.renderCoordsHelper,r);if(this._logGeometryCreationWarnings(o,s.rings,"rings","ExtrudeSymbol3DLayer"),0===s.rings.length||!s.rings.some(e=>e.length>0))return null;const c=Object(Ae["a"])(s);if(Object(a["j"])(c))return null;const l=new Array,d=new Array,h=new Array,u=Object(k["f"])(),p=Object(we["d"])(),b=Object(U["f"])(),f=this._context.renderCoordsHelper.viewingMode===Qt["a"].Global;f||this._context.renderCoordsHelper.worldUpAtPosition(null,b),Object(B["d"])(s.spatialReference,[c.x,c.y,0],p,this._context.renderCoordsHelper.spatialReference);const m=Object(we["d"])();Object(Te["a"])(m,p);const g=Object(Li["b"])();Object(Di["a"])(g,m);const{polygons:O,mapPosition:v,position:y}=o,_=y.length/3,j=new Float64Array(3*_*6),x=new Float64Array(3*_*6),S=new Float64Array(3*_*6),T=new Float64Array(1*_*6);let w=0;for(let a=0;a<O.length;++a){const e=O[a],r=e.count;if(this._context.clippingExtent&&(Object(k["h"])(u),Object(k["k"])(u,e.mapPosition),!Object(k["r"])(u,this._context.clippingExtent)))continue;const n=Object(Mi["a"])(e.mapPosition,e.holeIndices,3);if(0===n.length)continue;const s=3*r*2+n.length,o=new Uint32Array(s),c=new Uint32Array(n.length),p=6*r,_=3*j.BYTES_PER_ELEMENT,C=new Ni["v"](j.buffer,w*_,_,(w+p)*_),A=3*x.BYTES_PER_ELEMENT,P=new Ni["v"](x.buffer,w*A,A,(w+p)*A),R=new Float64Array(S.buffer,3*w*S.BYTES_PER_ELEMENT,3*p),E=new Float64Array(T.buffer,1*w*T.BYTES_PER_ELEMENT,1*p),I=this._getExtrusionSize(t);Ki(y,v,n,e,C.typedBuffer,R,P.typedBuffer,E,0,o,c,I,b,f),Object(Fi["e"])(C,C,m),Object(Fi["a"])(P,P,g),w+=6*r;const M=Qi(o,o.length-c.length,{positions:C.typedBuffer,elevation:R,normals:P.typedBuffer,heights:E},i);l.push(M),d.push(this._material),h.push(we["a"]);const D=Qi(c,0,{positions:C.typedBuffer,elevation:R,normals:P.typedBuffer,heights:E},i);l.push(D),d.push(this._bottomMaterial),h.push(we["a"])}if(0===l.length)return null;const C=new Xi["a"]({geometries:l,materials:d,transformations:h,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});C.transformation=p;const A=ft(this.symbolLayer,{opacity:this._getLayerOpacity()}),P=Object(a["k"])(A)?{baseMaterial:this._material,edgeMaterials:[A],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,R=new Ye(this,C,l,null,null,hr,r,P);return R.alignedSampledElevation=o.sampledElevation,R.needsElevationUpdates=Object(Ce["i"])(r.mode),R}}function Qi(e,t,i,r){const a=new Uint32Array(e.length),n=[[Ee["a"].POSITION,{size:3,data:i.positions,exclusive:!0}],[Ee["a"].NORMAL,{size:3,data:i.normals,exclusive:!0}],[Ee["a"].COLOR,{size:4,data:r,exclusive:!0}],[Ee["a"].SIZE,{size:1,data:i.heights,exclusive:!0}]],s=[[Ee["a"].POSITION,e],[Ee["a"].NORMAL,e],[Ee["a"].COLOR,a]];return i.elevation&&(n.push([Ee["a"].MAPPOS,{size:3,data:i.elevation}]),s.push([Ee["a"].MAPPOS,e])),new kt["a"](n,s,Xe["f"].Triangle,t)}function Ki(e,t,i,r,a,n,s,o,c,l,d,h,u,p){const b=i.length/3;let f=0,m=2*r.count;er(e,t,r.index,r.count,i,0,b,a,n,s,o,c,l,d,m,h,u,p),c+=2*r.count,m=0,rr(a,n,o,s,f,r.pathLengths[0],r.count,c,l,m,h),c+=4*r.pathLengths[0],m+=2*r.pathLengths[0],f+=r.pathLengths[0];for(let g=1;g<r.pathLengths.length;++g)rr(a,n,o,s,f,r.pathLengths[g],r.count,c,l,m,h),c+=4*r.pathLengths[g],m+=2*r.pathLengths[g],f+=r.pathLengths[g]}function er(e,t,i,r,a,n,s,o,c,l,d,h,u,p,b,f,m,g){Object(V["g"])(pr,m);const O=f>0?1:-1;let v=3*i,y=h,_=3*y,j=h+r,x=3*j;for(let w=0;w<r;++w)g&&(pr[0]=e[v+0],pr[1]=e[v+1],pr[2]=e[v+2],Object(V["r"])(pr,pr)),o[_+0]=e[v+0],o[_+1]=e[v+1],o[_+2]=e[v+2],c[_+0]=t[v+0],c[_+1]=t[v+1],c[_+2]=t[v+2],l[_+0]=-O*pr[0],l[_+1]=-O*pr[1],l[_+2]=-O*pr[2],d[y]=0,o[x+0]=e[v+0]+f*pr[0],o[x+1]=e[v+1]+f*pr[1],o[x+2]=e[v+2]+f*pr[2],c[x+0]=t[v+0],c[x+1]=t[v+1],c[x+2]=t[v+2],l[x+0]=O*pr[0],l[x+1]=O*pr[1],l[x+2]=O*pr[2],d[j]=f,_+=3,x+=3,v+=3,y+=1,j+=1;v=3*n,_=0,x=3*b;const S=f<0?mr:fr,T=f<0?fr:mr;for(let w=0;w<s;++w)p[_+0]=a[v+S[0]],p[_+1]=a[v+S[1]],p[_+2]=a[v+S[2]],u[x+0]=a[v+T[0]]+r,u[x+1]=a[v+T[1]]+r,u[x+2]=a[v+T[2]]+r,_+=3,x+=3,v+=3}function tr(e,t,i,r,a,n,s){r[n]=r[s],s*=3,e[0+(n*=3)]=e[s+0],e[n+1]=e[s+1],e[n+2]=e[s+2],t[n+0]=t[s+0],t[n+1]=t[s+1],t[n+2]=t[s+2],i[n+0]=a[0],i[n+1]=a[1],i[n+2]=a[2]}const ir=Object(U["f"])();function rr(e,t,i,r,a,n,s,o,c,l,d){let h=a,u=a+1,p=a+s,b=a+s+1,f=o,m=o+1,g=o+2*n,O=o+2*n+1;d<0&&(h=a+s+1,b=a),l*=3;for(let v=0;v<n;++v)v===n-1&&(d>0?(u=a,b=a+s):(u=a,h=a+s)),lr(e,h,u,p,ir),tr(e,t,r,i,ir,f,h),tr(e,t,r,i,ir,m,u),tr(e,t,r,i,ir,g,p),tr(e,t,r,i,ir,O,b),c[l++]=f,c[l++]=g,c[l++]=O,c[l++]=f,c[l++]=O,c[l++]=m,h++,u++,p++,b++,f+=2,m+=2,g+=2,O+=2}const ar=Object(U["f"])(),nr=Object(U["f"])(),sr=Object(U["f"])(),or=Object(U["f"])(),cr=Object(U["f"])();function lr(e,t,i,r,a){t*=3,i*=3,r*=3,Object(V["w"])(ar,e[t++],e[t++],e[t++]),Object(V["w"])(nr,e[i++],e[i++],e[i++]),Object(V["w"])(sr,e[r++],e[r++],e[r++]),Object(V["f"])(or,nr,ar),Object(V["f"])(cr,sr,ar),Object(V["j"])(a,cr,or),Object(V["r"])(a,a)}const dr=Object(U["f"])();function hr(e,t,i,r){const a=e.stageObject,n=a.geometryRecords,s=n.length,o="absolute-height"!==t.mode;let c=0;const l=a.transformation,d=Object(Te["a"])(Object(we["d"])(),l);for(let h=0;h<s;h+=2){const e=n[h].geometry,s=e.getMutableAttribute(Ee["a"].POSITION).data,u=e.vertexAttributes.get(Ee["a"].SIZE).data,p=e.vertexAttributes.get(Ee["a"].MAPPOS).data,b=new Re["a"](p),f=s.length/3;let m=0,g=!1,O=0;const v=i.spatialReference;for(let a=0;a<f;a++){dr[0]=s[m],dr[1]=s[m+1],dr[2]=s[m+2],Object(Ce["g"])(b,i,t,r,br),o&&(O+=br.sampledElevation),Pe["a"].TESTS_DISABLE_OPTIMIZATIONS?(Object(V["w"])(ur,b.array[b.offset+0],b.array[b.offset+1],br.z+u[m/3]),r.toRenderCoords(ur,v,ur),Object(V["q"])(ur,ur,d)):(Object(V["w"])(ur,s[m+0],s[m+1],s[m+2]),Object(V["q"])(ur,ur,l),r.setAltitude(ur,br.z+u[m/3]),Object(V["q"])(ur,ur,d)),s[m]=ur[0],s[m+1]=ur[1],s[m+2]=ur[2];const e=gr/r.unitInMeters;(Math.abs(dr[0]-s[m])>=e||Math.abs(dr[1]-s[m+1])>=e||Math.abs(dr[2]-s[m+2])>=e)&&(g=!0),b.offset+=3,m+=3}g&&(e.invalidateBoundingInfo(),a.geometryVertexAttrsUpdated(n[h]),n[h+1].geometry.invalidateBoundingInfo(),a.geometryVertexAttrsUpdated(n[h+1])),c+=O/f}return c/s}const ur=Object(U["f"])(),pr=Object(U["f"])(),br=new Ce["a"],fr=[0,2,1],mr=[0,1,2],gr=.01;var Or=i("e041"),vr=i("7577"),yr=i("3dc2"),_r=i("ac8e"),jr=i("89cb"),xr=i("3bd5");class Sr{constructor(e,t,i,r){this.graphics3DSymbolLayer=e,this.renderGeometries=t,this.boundingBox=i,this._drapeSourceRenderer=r,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e}setVisibility(e){if(null!=this.stage&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,xr["a"].Geometry.ADD);if(e||this._addedToStage){for(const e of this.renderGeometries)e.instanceParameters.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,xr["a"].State.VISIBILITIES)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,xr["a"].Geometry.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=Object(U["f"])()){return Object(V["w"])(e,0,0,0)}getBoundingBoxObjectSpace(e=Object(k["f"])()){return Object(k["h"])(e)}addObjectState(e,t){e===Xe["d"].Highlight&&(this.renderGeometries.forEach(e=>{const i=e.addHighlight();t.addRenderGeometry(e,i,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,xr["a"].State.HIGHLIGHTS))}removeObjectState(e){this.renderGeometries.forEach(t=>{e.removeRenderGeometry(t)})}removeRenderGeometryObjectState(e,t){e.removeHighlight(t),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,xr["a"].State.HIGHLIGHTS)}computeAttachmentOrigin(e){for(const t of this.renderGeometries)t.computeAttachmentOrigin(Cr)&&(e.draped.origin[0]+=Cr[0],e.draped.origin[1]+=Cr[1],e.draped.num++)}async getProjectedBoundingBox(e,t,i,r,n){Object(k["h"])(n);for(let a=0;a<this.renderGeometries.length;a++){const t=this.renderGeometries[a];this._getRenderGeometryProjectedBoundingRect(t,e,Tr,i),Object(k["m"])(n,Tr)}if(t){let e;Object(k["d"])(n,Cr);const i=Object(Ae["d"])(n,t);try{e=await t.service.queryElevation(Cr[0],Cr[1],r,i,"ground")}catch(s){}Object(a["k"])(e)&&(n[2]=Math.min(n[2],e),n[5]=Math.max(n[5],e))}return n}_getRenderGeometryProjectedBoundingRect(e,t,i,r){if(this.boundingBox)Object(k["w"])(wr,this.boundingBox);else{const t=e.boundingSphere,i=t[3];wr[0]=t[0]-i,wr[1]=t[1]-i,wr[2]=t[2]-i,wr[3]=t[0]+i,wr[4]=t[1]+i,wr[5]=t[2]+i}return t(wr,0,2),this.calculateRelativeScreenBounds&&r.push({location:Object(k["d"])(wr),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),Object(k["B"])(wr,i)}}const Tr=Object(H["k"])(),wr=Object(k["f"])(),Cr=Object(U["f"])();var Ar=i("38a4");class Pr{constructor(e,t,i,r=2048){this.text=e,this._alignment=t,this._parameters=i,this.maxSize=r,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._displayWidth=null,this._heightMetrics=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._ensureTextWidth()+2*this.backgroundHorizontalPadding)}get displayHeight(){const e=this.lineSpacing*(this._lines.length-1),t=this.lineHeight;return Math.ceil(e+t+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this.firstLineYOffset+this.baselinePosition)}get firstLineYOffset(){return this.backgroundTopPadding+this.haloSize}get heightMetrics(){return this._ensureHeightMetrics()}get lineSpacing(){return(this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}get lineHeight(){return this.heightMetrics.lineHeight}get linePadding(){return this.lineHeight*Dr}get baselinePosition(){return this.heightMetrics.baselinePosition}get renderedFontSize(){return this._toRenderUnit(this.fontSize)}get fontSize(){return this._parameters.definition.size}get renderedHaloSize(){return this._toRenderUnit(this.haloSize)}get haloSize(){return this._parameters.haloSize}get backgroundHorizontalPadding(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}get backgroundVerticalPadding(){return this.hasBackground?this._parameters.definition.background.padding[1]:0}get backgroundTopPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}get backgroundBottomPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}get hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(Object(a["j"])(this._renderPixelRatio)){const e=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case Er.Left:return this.backgroundHorizontalPadding;case Er.Center:return(this.displayWidth-this._lineWidths[e])/2;case Er.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[e]}}render(e,t=0,i=0){e.save();const r=t/=this.renderPixelRatio,a=i/=this.renderPixelRatio,n=this.haloSize,s=this.firstLineYOffset;t+=n,i+=s+this.baselinePosition;const o=this.haloSize>0;o&&this._renderHalo(e,r,a,n,s),this._setFontProperties(e,this.renderedFontSize);for(let c=0;c<this._lines.length;++c){const r=this._lines[c],a=this._getLineXOffset(c);o&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,r,t+a,i),this._renderLineDecoration(e,t+a,i,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,r,t+this._getLineXOffset(c),i),this._renderLineDecoration(e,t+a,i,this._textWidths[c]),i+=this.lineSpacing}if(Pe["a"].TEXT_SHOW_BASELINE){e.strokeStyle=Nr,e.setLineDash([2,2]),e.lineWidth=1;let t=a+s;for(let i=0;i<this._lines.length;++i){const i=t+this.baselinePosition;this._drawLine(e,[r,i],[r+this.displayWidth,i]),t+=this.lineSpacing}}if(Pe["a"].TEXT_SHOW_BORDER&&(e.strokeStyle=Nr,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[r,a],[this.displayWidth,this.displayHeight])),this.hasBackground){const t=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,r,a,t),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,t,i,r,a=!1){if("none"===this._parameters.definition.font.decoration||0===r)return;const n=1,s=Math.max(this._parameters.definition.size/16,n);switch(this._parameters.definition.font.decoration){case"underline":i+=2*s;break;case"line-through":i-=.33*this.baselinePosition}const o=a?this.haloSize:0;e.strokeStyle=a?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(s+2*o),e.beginPath(),e.moveTo(this._toRenderUnit(t-o),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(t+r+o),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,t,i,r){t=this._toRenderUnit(t),i=this._toRenderUnit(i);const a=this.renderedWidth,n=this.renderedHeight;0!==r?(r=Object(Ar["e"])(r,0,Math.floor(n/2)),e.beginPath(),e.moveTo(t,i+r),e.arcTo(t,i,t+r,i,r),e.lineTo(t+a-r,i),e.arcTo(t+a,i,t+a,i+r,r),e.lineTo(t+a,i+n-r),e.arcTo(t+a,i+n,t+a-r,i+n,r),e.lineTo(t+r,i+n),e.arcTo(t,i+n,t,i+n-r,r),e.closePath()):e.rect(t,i,a,n)}_renderHalo(e,t,i,r,a){const n=this.renderedWidth,s=this.renderedHeight,o=Ir(Mr,Math.max(n,Lr),Math.max(s,Lr)),c=o.getContext("2d");c.clearRect(0,0,n,s),this._setFontProperties(c,this.renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const l=this.renderedHaloSize<3;c.lineJoin=l?"miter":"round",l?this._renderHaloEmulated(c,r,a):this._renderHaloNative(c,r,a);let d=a+this.baselinePosition;for(let h=0;h<this._lines.length;++h){const e=this._getLineXOffset(h);this._renderLineDecoration(c,r+e,d,this._textWidths[h],!0),d+=this.lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(o,0,0,n,s,this._toRenderUnit(t),this._toRenderUnit(i),n,s),e.globalAlpha=1}_renderHaloEmulated(e,t,i){i+=this.baselinePosition;for(let r=0;r<this._lines.length;++r){const a=this._lines[r],n=this._getLineXOffset(r);for(const[r,s]of Rr)this._fillText(e,a,t+n+this.haloSize*r,i+this.haloSize*s);i+=this.lineSpacing}}_renderHaloNative(e,t,i){const r=2*this.haloSize;i+=this.baselinePosition;for(let a=0;a<this._lines.length;++a){const n=this._lines[a],s=this._getLineXOffset(a),o=5,c=.1;for(let a=0;a<o;a++){const l=1-(o-1)*c+a*c;e.lineWidth=this._toRenderUnit(l*r),this._strokeText(e,n,t+s,i)}i+=this.lineSpacing}}_setFontProperties(e,t){e.font=this._parameters.fontString(t),e.textAlign="left",e.textBaseline="alphabetic"}_ensureTextWidth(){if(Object(a["k"])(this._displayWidth))return this._displayWidth;const e=Ir(Mr,Lr,Lr).getContext("2d");this._setFontProperties(e,this.fontSize);let t=2*this.haloSize;const i=this._parameters.definition.font;"italic"!==i.style&&"oblique"!==i.style&&"bold"!==i.weight&&"bolder"!==i.weight||(t+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let r=0;for(const a of this._lines){const i=e.measureText(a).width,n=i+t;this._textWidths.push(i),this._lineWidths.push(n),r=Math.max(r,n)}return this._displayWidth=r,this._displayWidth}_ensureHeightMetrics(){if(Object(a["j"])(this._heightMetrics)){const e=Ir(Mr,Lr,Lr).getContext("2d");this._setFontProperties(e,this.fontSize);const t=e.measureText(this.text+Fr),i=this.hasBackground?e.measureText(this._lines[0]):t,r=1===this._lines.length?i:this.hasBackground?e.measureText(this._lines[this._lines.length-1]):t,a=t.actualBoundingBoxAscent+t.actualBoundingBoxDescent;this._heightMetrics={paddingTop:t.actualBoundingBoxAscent-i.actualBoundingBoxAscent,paddingBottom:t.actualBoundingBoxDescent-r.actualBoundingBoxDescent,lineHeight:a,baselinePosition:t.actualBoundingBoxAscent}}return this._heightMetrics}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,t,i,r){e.fillText(t,this._toRenderUnit(i),this._toRenderUnit(r))}_strokeText(e,t,i,r){e.strokeText(t,this._toRenderUnit(i),this._toRenderUnit(r))}_drawLine(e,t,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(t[0])+.5,this._toRoundedRenderUnit(t[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,t,i){const r=this._toRenderUnit(t[0]),a=this._toRenderUnit(t[1]),n=this._toRenderUnit(i[0]),s=this._toRenderUnit(i[1]),o=Math.floor(r)+.5,c=Math.ceil(r+n)-.5,l=Math.floor(a)+.5,d=Math.ceil(a+s)-.5;e.beginPath(),e.moveTo(o,l),e.lineTo(c,l),e.lineTo(c,d),e.lineTo(o,d),e.lineTo(o,l),e.stroke()}}const Rr=[];{const e=16;for(let t=0;t<360;t+=360/e)Rr.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}var Er;function Ir(e,t,i){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=i,e.canvas}!function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"}(Er||(Er={}));const Mr={canvas:null},Dr=.2,Lr=512,Nr="rgb(255, 0, 255, 0.5)",Fr=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})(),zr={left:0,center:.5,right:1},Gr={"bottom-left":Object(Se["g"])(0,0),bottom:Object(Se["g"])(.5,0),"bottom-right":Object(Se["g"])(1,0),left:Object(Se["g"])(0,.5),center:Object(Se["g"])(.5,.5),right:Object(Se["g"])(1,.5),"top-left":Object(Se["g"])(0,1),top:Object(Se["g"])(.5,1),"top-right":Object(Se["g"])(1,1)};function Vr(e){switch(e){case"left":return Er.Left;case"right":return Er.Right;default:return Er.Center}}function Ur(e,t){switch(t){case"bottom":return"left"===e?"bottom-left":"right"===e?"bottom-right":"bottom";case"center":return e;case"top":return"left"===e?"top-left":"right"===e?"top-right":"top"}}function Br(e){return"middle"===e?"center":e}var kr,Hr,Wr,qr=i("a6c9"),$r=i("9b40");function Xr(e){return null!=e}function Yr(e){return"number"==typeof e}function Zr(e){return"string"==typeof e}function Jr(e){return null==e||Zr(e)}function Qr(e,t){e&&e.push(t)}function Kr(e,t,i,r=Object(we["d"])()){const a=e||0,n=t||0,s=i||0;return 0!==a&&Object(Te["g"])(r,r,-a/180*Math.PI),0!==n&&Object(Te["r"])(r,r,n/180*Math.PI),0!==s&&Object(Te["o"])(r,r,s/180*Math.PI),r}function ea(e,t,i,r,a){const n=e.minSize,s=e.maxSize;if(e.expression)return Qr(a,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const e=r.symbolSize[i];return t.minSize[i]=e,t.maxSize[i]=e,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=kr.DefinedSize,!0}if(Xr(e.field))return Xr(e.stops)?2===e.stops.length&&Yr(e.stops[0].size)&&Yr(e.stops[1].size)?(ta(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,i),t.type[i]=kr.DefinedSize,!0):(Qr(a,"Could not convert size info: stops only supported with 2 elements"),!1):Yr(n)&&Yr(s)&&Xr(e.minDataValue)&&Xr(e.maxDataValue)?(ta(n,s,e.minDataValue,e.maxDataValue,t,i),t.type[i]=kr.DefinedSize,!0):null!=$r["a"][e.valueUnit]?(t.minSize[i]=-1/0,t.maxSize[i]=1/0,t.offset[i]=0,t.factor[i]=1/$r["a"][e.valueUnit],t.type[i]=kr.DefinedSize,!0):"unknown"===e.valueUnit?(Qr(a,"Could not convert size info: proportional size not supported"),!1):(Qr(a,"Could not convert size info: scale-dependent size not supported"),!1);if(!Xr(e.field)){if(e.stops&&e.stops[0]&&Yr(e.stops[0].size))return t.minSize[i]=e.stops[0].size,t.maxSize[i]=e.stops[0].size,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=kr.DefinedSize,!0;if(Yr(n))return t.minSize[i]=n,t.maxSize[i]=n,t.offset[i]=n,t.factor[i]=0,t.type[i]=kr.DefinedSize,!0}return Qr(a,"Could not convert size info: unsupported variant of sizeInfo"),!1}function ta(e,t,i,r,a,n){const s=Math.abs(r-i)>0?(t-e)/(r-i):0;a.minSize[n]=s>0?e:t,a.maxSize[n]=s>0?t:e,a.offset[n]=e-i*s,a.factor[n]=s}function ia(e,t,i,r){if(e.normalizationField||e.valueRepresentation)return Qr(r,"Could not convert size info: unsupported property"),null;if(!Jr(e.field))return Qr(r,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return Qr(r,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[kr.Undefined,kr.Undefined,kr.Undefined]};let a;switch(e.axis){case"width":return a=ea(e,t.size,0,i,r),a?t:null;case"height":return a=ea(e,t.size,2,i,r),a?t:null;case"depth":return a=ea(e,t.size,1,i,r),a?t:null;case"width-and-depth":return a=ea(e,t.size,0,i,r),a&&ea(e,t.size,1,i,r),a?t:null;case null:case void 0:case"all":return a=ea(e,t.size,0,i,r),a=a&&ea(e,t.size,1,i,r),a=a&&ea(e,t.size,2,i,r),a?t:null;default:return Qr(r,`Could not convert size info: unknown axis "${e.axis}""`),null}}function ra(e,t,i){for(let a=0;a<3;++a){let i=t.unitInMeters;e.type[a]===kr.DefinedSize&&(i*=t.modelSize[a],e.type[a]=kr.DefinedScale),e.minSize[a]=e.minSize[a]/i,e.maxSize[a]=e.maxSize[a]/i,e.offset[a]=e.offset[a]/i,e.factor[a]=e.factor[a]/i}let r;if(e.type[0]!==kr.Undefined)r=0;else if(e.type[1]!==kr.Undefined)r=1;else{if(e.type[2]===kr.Undefined)return Qr(i,"No size axis contains a valid size or scale"),!1;r=2}for(let a=0;a<3;++a)e.type[a]===kr.Undefined&&(e.minSize[a]=e.minSize[r],e.maxSize[a]=e.maxSize[r],e.offset[a]=e.offset[r],e.factor[a]=e.factor[r],e.type[a]=e.type[r]);return!0}function aa(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function na(e,t,i){if(e.normalizationField)return Qr(i,"Could not convert color info: unsupported property"),null;if(Zr(e.field)){if(!e.stops)return Qr(i,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return Qr(i,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const r=e.stops;for(let e=0;e<8;++e){const i=r[Math.min(e,r.length-1)];t.color.values[e]=i.value,aa(t.color.colors,e,i.color)}}}else{if(!(e.stops&&e.stops.length>=0))return Qr(i,"Could not convert color info: no field and no colors/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.color.values[e]=1/0,aa(t.color.colors,e,i)}}return t}function sa(e,t,i){if(e.normalizationField)return Qr(i,"Could not convert opacity info: unsupported property"),null;if(Zr(e.field)){if(!e.stops)return Qr(i,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return Qr(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const r=e.stops;for(let e=0;e<8;++e){const i=r[Math.min(e,r.length-1)];t.opacity.values[e]=i.value,t.opacity.opacityValues[e]=i.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return Qr(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=i}}return t}function oa(e,t,i){const r=2===i&&"arithmetic"===e.rotationType;t.offset[i]=r?90:0,t.factor[i]=r?-1:1,t.type[i]=1}function ca(e,t,i){if(!Zr(e.field))return Qr(i,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return Qr(i,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return oa(e,t.rotation,0),t;case"roll":return oa(e,t.rotation,1),t;case null:case void 0:case"heading":return oa(e,t.rotation,2),t;default:return Qr(i,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}function la(e,t,i){if(!e)return null;const r=!t.supportedTypes||!!t.supportedTypes.size,a=!t.supportedTypes||!!t.supportedTypes.color,n=!t.supportedTypes||!!t.supportedTypes.rotation,s=!!t.supportedTypes&&!!t.supportedTypes.opacity,o=e.reduce((e,o)=>{if(!e)return e;if(o.valueExpression)return Qr(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(o.type){case"size":return r?ia(o,e,t,i):e;case"color":return a?na(o,e,i):e;case"opacity":return s?sa(o,e,i):null;case"rotation":return n?ca(o,e,i):e;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&o)||o.size||o.color||o.opacity||o.rotation?o&&o.size&&!ra(o.size,t,i)?null:o:null}function da(e){return e&&null!=e.size}function ha(e,t){if(!e)return{enabled:!1};if(Pe["a"].TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const i=la(e.visualVariables,t);return i?{enabled:!0,visualVariables:i,materialParameters:ba(i,t),requiresShaderTransformation:da(i)}:{enabled:!1}}function ua(e,t,i){if(!t||!e.enabled)return!1;const r=e.visualVariables,a=la(t.visualVariables,i);return!!a&&!!(pa(r.size,a.size,"size")&&pa(r.color,a.color,"color")&&pa(r.rotation,a.rotation,"rotation")&&pa(r.opacity,a.opacity,"opacity"))&&(e.visualVariables=a,e.materialParameters=ba(a,i),e.requiresShaderTransformation=da(a),!0)}function pa(e,t,i){if(!!e!=!!t)return!1;if(e&&e.field!==t.field)return!1;if(e&&"rotation"===i){const i=e,r=t;for(let e=0;e<3;e++)if(i.type[e]!==r.type[e]||i.offset[e]!==r.offset[e]||i.factor[e]!==r.factor[e])return!1}return!0}function ba(e,t){const i={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},r=da(e);return e&&e.size?(i.vvSizeEnabled=!0,i.vvSizeMinSize=e.size.minSize,i.vvSizeMaxSize=e.size.maxSize,i.vvSizeOffset=e.size.offset,i.vvSizeFactor=e.size.factor):e&&r&&(i.vvSizeValue=t.transformation.scale),e&&r&&(i.vvSymbolAnchor=t.transformation.anchor,i.vvSymbolRotationMatrix=Object(Li["b"])(),Object(Te["i"])(fa),Kr(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],fa),Object(Di["f"])(i.vvSymbolRotationMatrix,fa)),e&&e.color&&(i.vvColorEnabled=!0,i.vvColorValues=e.color.values,i.vvColorColors=e.color.colors),e&&e.opacity&&(i.vvOpacityEnabled=!0,i.vvOpacityValues=e.opacity.values,i.vvOpacityOpacities=e.opacity.opacityValues),i}!function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"}(kr||(kr={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(Hr||(Hr={})),function(e){const t=Object(we["d"])(),i=Object(U["f"])();function r(e,r,a){if(!e.vvSizeEnabled)return a;Object(Te["c"])(t,a);const n=e.vvSymbolRotationMatrix;Object(Te["s"])(fa,n[0],n[1],n[2],0,n[3],n[4],n[5],0,n[6],n[7],n[8],0,0,0,0,1),Object(Te["m"])(t,t,fa);for(let t=0;t<3;++t){const a=e.vvSizeOffset[t]+r[0]*e.vvSizeFactor[t];i[t]=Object(Ar["e"])(a,e.vvSizeMinSize[t],e.vvSizeMaxSize[t])}return Object(Te["h"])(t,t,i),Object(Te["j"])(t,t,e.vvSymbolAnchor),t}function a(e,t,i){if(!t.vvSizeEnabled)return Object(V["w"])(e,1,1,1);for(let r=0;r<3;++r){const a=t.vvSizeOffset[r]+i[0]*t.vvSizeFactor[r];e[r]=Object(Ar["e"])(a,t.vvSizeMinSize[r],t.vvSizeMaxSize[r])}return e}e.evaluateModelTransform=r,e.evaluateModelTransformScale=a}(Wr||(Wr={}));const fa=Object(we["d"])(),ma=Wr.evaluateModelTransform,ga=Wr.evaluateModelTransformScale;var Oa=i("6061"),va=i("1e2c"),ya=i("2df1"),_a=i("4cac");const ja=Object(we["d"])(),xa=Object(U["h"])(0,0,1),Sa=16,Ta=1.5,wa=qr["a"],Ca=[wa/2,wa/2,1-wa/2,1-wa/2],Aa=[qr["b"]*wa,qr["b"]*wa];class Pa extends Nt{constructor(e,t,i,r){super(e,t,i,r),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}async doLoad(e){this._validateOrThrow();const t=this._prepareMaterialParameters(),i=this._getPrimitive();if(Object(a["k"])(i))this._prepareResourcesPrimitive(t,i);else{const i=Object(_r["g"])(this.symbol,this.symbolLayer),r=Object(Or["h"])(i);r&&"application/json"===r.mediaType?await this._prepareResourcesCIM(t,JSON.parse(r.data),e):await this._prepareResourcesHref(t,i,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=Object(Ae["i"])(this._getIconSize());if(e)throw new D["a"]("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,t=Math.round(null!=e.size?Object(xe["g"])(e.size):Sa);return this._drivenProperties.size?Math.max(t,64):t}_generateTextureCIM(e){const t=this._getGraphicHash(e);let i=""===t?null:this._cimSymbolTextures.get(t);if(!i){const r={scaleFactor:this._cimScaleFactorOrFunction},a=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,e,"esriGeometryPoint",r,null,null);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",a.anchorPosition);const n={width:a.imageData.width,height:a.imageData.height,powerOfTwoResizeMode:Xe["e"].PAD};i=new va["a"](a.imageData,n),this._cimSymbolTextures.set(t,i),this._context.stage.add(i)}return i}_computeSize(e,t){const i=e.width/e.height;return i>1?[t,Math.round(t/i)]:[Math.round(t*i),t]}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},t=this.symbol;if(Ra(t)){const{screenLength:i,minWorldLength:r,maxWorldLength:a}=t.verticalOffset;e.verticalOffset={screenLength:Object(xe["g"])(i),minWorldLength:r||0,maxWorldLength:null!=a?a:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,t){const i=this._getOutlineSize();if(Ea(t)&&0===i)throw new Error("Nothing to render");this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize;const r=this._context.sharedResources.textures.fromData(t,()=>Object(qr["c"])(t));this._texture=r.texture,this._releaseTexture=r,e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=Ca,e.textureId=this._texture.id;const a=this._getIconSize();this._size=[a,a],this._symbolTextureRatio=1/wa,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,t,i){if(!Object(c["a"])("esri-canvas-svg-support")&&Object(Or["z"])(t))throw new D["a"]("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const r=this._getIconSize(),a=r*this._context.graphicsCoreOwner.view.state.pixelRatio,n=await Object(_e["c"])(this._context.sharedResources.textures.fromUrl(t,a,{signal:i}));if(!1===n.ok)throw Object(h["o"])(n.error),new D["a"]("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${t})`);this._releaseTexture=n.value;const s=n.value.texture,o=s.params;this._size=this._computeSize(o,r),e.textureId=s.id,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,t,r){const a=new _a["a"]({data:t});if(!this._context.sharedResources.cimSymbolRasterizer){const e=(await Promise.all([i.e("chunk-dbf6c678"),i.e("chunk-0c94263e")]).then(i.bind(null,"6b49"))).CIMSymbolRasterizer;Object(h["p"])(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new e(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(e=>e.toJSON()):null;let s,o;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(a,n,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression){const e=this._context.renderer;if(isNaN(e.scaleExpression)){const t=e.scaleExpression,i=await Object($["d"])(t,this._context.layer.spatialReference,n);o=(e,t,r)=>{const a=Object(jr["a"])(i,e,{$view:r},"esriGeometryPoint",t);return null!==a?a:1}}else s=Number(e.scaleExpression)}this._cimScaleFactorOrFunction=s||o||1;const c=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Object(h["p"])(r);const l=this._context.layer.fieldsIndex;this._cimRequiredFields=c.map(e=>l.get(e).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||yr["b"]}_getOutlineSize(){let e=0;const t=this.symbolLayer;return Object(a["k"])(t.outline)&&null!=t.outline.size?Math.max(Object(xe["g"])(t.outline.size),0):(e=Ea(this._getPrimitive())?Ta:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),t=this.symbolLayer,i=Object(a["i"])(t,"outline","color");if(Object(a["k"])(i)){const t=y["a"].toUnitRGB(i),r=i.a*e;return[t[0],t[1],t[2],r]}return[0,0,0,0]}_getFillColor(){if(Ea(this._getPrimitive()))return E["b"];const e=Object(a["j"])(this._getPrimitive()),t=Object(a["i"])(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(t,{hasIntrinsicColor:e})}_getAnchorPos(e,t){return"relative"===e?Object(Se["g"])((t.x||0)+.5,.5-(t.y||0)):e in Gr?Gr[e]:Gr.center}_createMaterialAndAddToStage(e,t){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=ha(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(e,this._fastUpdates.materialParameters),this._cimLayers){let i=Object(a["k"])(e.textureId)?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new ya["a"](e),this._cimSymbolMaterials.set(Object(a["s"])(e.textureId,0),i),t.add(i)),i}return this._material=new ya["a"](e),t.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=Object(a["p"])(this._releaseTexture)}_getScaleFactor(e,t){if(this._drivenProperties.size&&e.size){for(let t=0;t<3;t++){const i=e.size[t];i&&"symbol-value"!==i&&"proportional"!==i&&(e.size[t]=Object(xe["g"])(i))}if("symbol-value"===e.size[0])return 1;if(isFinite(+e.size[0]))return+e.size[0]/t;if(isFinite(+e.size[2]))return+e.size[2]/t}return 1}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;let i,r;if(this._cimLayers){if(!this._cimLayers.length)return null;const e=this._generateTextureCIM(t),a={textureId:e.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(a,this._context.stage),i=[e.params.width,e.params.height]}else i=this._size,r=Object(a["r"])(this._material);const n=Object(Bt["d"])(t.geometry);if(Object(a["j"])(n))return this.logger.warn("unsupported geometry type for icon symbol: "+t.geometry.type),null;const s=e.renderingInfo,o=this._getVertexOpacityAndColor(s);let c=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const e=i[0]>i[1]?i[0]:i[1];c=this._getScaleFactor(s,e)}c*=this._symbolTextureRatio;const l=[i[0]*c,i[1]*c],d=this.setGraphicElevationContext(t,new qe["a"]);return this.ensureDrapedStatus("on-the-ground"===d.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(t,n,r,o,l,e.layer.uid):this._createAs3DShape(t,n,r,o,l,d,t.uid)}layerOpacityChanged(){const e=this._getFillColor(),t=this._getOutlineColor();return this._forEachMaterial(i=>{i.setParameters({color:e}),i.setParameters({outlineColor:t})}),!0}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,a=Object(Ce["e"])(Pa.elevationModeChangeTypes,i,r);if(a!==Ce["b"].UPDATE)return a;const n=Object(Ce["h"])(r)||"absolute-height"===r;return this.updateGraphics3DGraphicElevationInfo(e,t,()=>n)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(e,t){for(const i in e.diff){if("visualVariables"!==i)return tt.Recreate_Symbol;if(!ua(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return tt.Recreate_Symbol;Object(a["k"])(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return tt.Fast_Update}_defaultElevationInfoNoZ(){return Ia}_createAs3DShape(e,t,i,r,a,n,s){const o=this.getFastUpdateAttrValues(e),c=o?e=>ma(this._fastUpdates.materialParameters,o,e):null,l=[ot["a"].createPointGeometry(xa,null,r,a,Ma,null,o)],d=Object(Bt["a"])(this._context,t,l,[i],n,this._context.layer.uid,s,c);if(null===d)return null;const h=new Ye(this,d.object,l,null,null,Me,n);return h.alignedSampledElevation=d.sampledElevation,h.needsElevationUpdates=Object(Ce["h"])(n.mode)||"absolute-height"===n.mode,h.getScreenSize=this._createScreenSizeGetter(a,c),h.calculateRelativeScreenBounds=e=>i.calculateRelativeScreenBounds(h.getScreenSize(),1,e),Object(Bt["b"])(h,t,this._context.elevationProvider),h}_createAsOverlay(e,t,i,r,n,s){i.renderPriority=this._renderPriority;const o=Object(rt["e"])();Object(B["p"])(t,o,this._context.overlaySR),o[2]=Gi["a"];const c=this._context.clippingExtent;if(Object(a["k"])(c)&&!Object(k["e"])(c,o))return null;const l=this.getFastUpdateAttrValues(e),d=l?e=>ma(this._fastUpdates.materialParameters,l,e):null,h=ot["a"].createPointGeometry(xa,o,r,n,null,null,l),u=new Oa["a"](h,i,{layerUid:s,graphicUid:e.uid,calculateShaderTransformation:d});o[3]=0,Object(vr["c"])(u.boundingSphere,o);const p=new Sr(this,[u],null,this._context.drapeSourceRenderer);return p.getScreenSize=this._createScreenSizeGetter(n,d),p.calculateRelativeScreenBounds=e=>i.calculateRelativeScreenBounds(p.getScreenSize(),1,e),p}_createScreenSizeGetter(e,t){const i=this._outlineSize+2;if(this._fastUpdates.enabled){const r=e[0]/this._symbolTextureRatio,a=e[1]/this._symbolTextureRatio;return(e=Object(Se["c"])())=>{const n=t(ja);return e[0]=n[0]*r+i,e[1]=n[5]*a+i,e}}{const t=e[0]/this._symbolTextureRatio+i,r=e[1]/this._symbolTextureRatio+i;return(e=Object(Se["c"])())=>(e[0]=t,e[1]=r,e)}}_fastVisualVariableConvertOptions(){const e=this._size[0]>this._size[1]?this._size[0]:this._size[1],t=Object(U["h"])(e,e,e),i=Object(xe["h"])(1),r=e*i;return{modelSize:t,symbolSize:Object(U["h"])(r,r,r),unitInMeters:i,transformation:{anchor:U["c"],scale:U["a"],rotation:U["c"]}}}_getGraphicHash(e){let t="";for(const i of this._cimRequiredFields)t+=i+e.attributes[i];return t}_forEachMaterial(e){Object(a["k"])(this._material)&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}}function Ra(e){return e&&"point-3d"===e.type&&e.hasVisibleVerticalOffset()}function Ea(e){return!Object(a["j"])(e)&&("cross"===e||"x"===e)}Pa.PRIMITIVE_SIZE=Aa,Pa.elevationModeChangeTypes={definedChanged:Ce["b"].UPDATE,staysOnTheGround:Ce["b"].NONE,onTheGroundChanged:Ce["b"].RECREATE};const Ia={mode:"relative-to-ground",offset:0},Ma=Object(rt["g"])(0,0,0,1);var Da=i("d408"),La=i("0a9e"),Na=i("b061"),Fa=i("e93d"),za=i("02a0"),Ga=i("7438"),Va=i("87b7"),Ua=i("528f");const Ba=new Map([[Ee["a"].POSITION,0],[Ee["a"].UV0,2],[Ee["a"].AUXPOS1,3],[Ee["a"].SIZE,6],[Ee["a"].SIZEFEATUREATTRIBUTE,6],[Ee["a"].COLOR,5],[Ee["a"].COLORFEATUREATTRIBUTE,5],[Ee["a"].OPACITYFEATUREATTRIBUTE,7]]);class ka extends ei["a"]{initializeProgram(e){const t=ka.shader.get().build(this.configuration);return new ii["a"](e.rctx,t,Ba)}_makePipelineState(e,t){const i=this.configuration,r=e===Xe["i"].NONE;return Object(ni["f"])({blending:i.output===$t["a"].Color||i.output===$t["a"].Alpha?r?Ga["d"]:Object(Ga["f"])(e):null,depthTest:{func:Object(Ga["g"])(e)},depthWrite:r?i.writeDepth&&ni["d"]:Object(Ga["h"])(e),colorWrite:ni["c"],stencilWrite:i.hasOccludees?Va["h"]:null,stencilTest:i.hasOccludees?t?Va["d"]:Va["c"]:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Object(ni["f"])({blending:Ga["d"],depthTest:Va["a"],depthWrite:null,colorWrite:ni["c"],stencilWrite:null,stencilTest:Va["f"]}),this._occluderPipelineOpaque=Object(ni["f"])({blending:Ga["d"],depthTest:Va["a"],depthWrite:null,colorWrite:ni["c"],stencilWrite:Va["g"],stencilTest:Va["e"]}),this._occluderPipelineMaskWrite=Object(ni["f"])({blending:null,depthTest:Va["b"],depthWrite:null,colorWrite:null,stencilWrite:Va["h"],stencilTest:Va["d"]})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?e===Zt["a"].TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===Zt["a"].OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,t)}}ka.shader=new Kt["a"](Ua["a"],()=>i.e("chunk-2d225231").then(i.bind(null,"e2b0")));class Ha extends ci["a"]{constructor(){super(...arguments),this.output=$t["a"].Color,this.transparencyPassType=Xe["i"].NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.draped=!1,this.hasCap=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}Object(r["a"])([Object(oi["b"])({count:$t["a"].COUNT})],Ha.prototype,"output",void 0),Object(r["a"])([Object(oi["b"])({count:Xe["i"].COUNT})],Ha.prototype,"transparencyPassType",void 0),Object(r["a"])([Object(oi["b"])()],Ha.prototype,"occluder",void 0),Object(r["a"])([Object(oi["b"])()],Ha.prototype,"hasSlicePlane",void 0),Object(r["a"])([Object(oi["b"])()],Ha.prototype,"writeDepth",void 0),Object(r["a"])([Object(oi["b"])()],Ha.prototype,"draped",void 0),Object(r["a"])([Object(oi["b"])()],Ha.prototype,"hasCap",void 0),Object(r["a"])([Object(oi["b"])()],Ha.prototype,"vvSize",void 0),Object(r["a"])([Object(oi["b"])()],Ha.prototype,"vvColor",void 0),Object(r["a"])([Object(oi["b"])()],Ha.prototype,"vvOpacity",void 0),Object(r["a"])([Object(oi["b"])()],Ha.prototype,"hasOccludees",void 0),Object(r["a"])([Object(oi["b"])()],Ha.prototype,"hasMultipassTerrain",void 0),Object(r["a"])([Object(oi["b"])()],Ha.prototype,"cullAboveGround",void 0),Object(r["a"])([Object(oi["b"])({constValue:!0})],Ha.prototype,"hasVvInstancing",void 0),Object(r["a"])([Object(oi["b"])({constValue:!0})],Ha.prototype,"hasSliceTranslatedView",void 0);var Wa=i("a6b6");class qa extends Ht["a"]{constructor(e){super(e,new Xa),this._vertexAttributeLocations=Ba,this.techniqueConfig=new Ha,this.layout=this.createLayout()}dispose(){}getConfiguration(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.draped=t.slot===Zt["a"].DRAPED_MATERIAL,this.techniqueConfig.hasCap=this.parameters.cap!==Wa["a"].BUTT,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.occluder=this.parameters.renderOccluded===Ht["c"].OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(){}createLayout(){const e=Object(qt["a"])().vec3f(Ee["a"].POSITION).vec2f(Ee["a"].UV0).vec3f(Ee["a"].AUXPOS1);return this.parameters.vvSizeEnabled?e.f32(Ee["a"].SIZEFEATUREATTRIBUTE):e.f32(Ee["a"].SIZE),this.parameters.vvColorEnabled?e.f32(Ee["a"].COLORFEATUREATTRIBUTE):e.vec4f(Ee["a"].COLOR),this.parameters.vvOpacityEnabled&&e.f32(Ee["a"].OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new Ya(this.layout,this.parameters)}requiresSlot(e,t){if(e===Zt["a"].DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===Ht["c"].OccludeAndTransparentStencil)return e===Zt["a"].OPAQUE_MATERIAL||e===Zt["a"].OCCLUDER_MATERIAL||e===Zt["a"].TRANSPARENT_OCCLUDER_MATERIAL;const i=Object(Na["b"])(t);return i===$t["a"].Color||i===$t["a"].Alpha?e===(this.parameters.writeDepth?Zt["a"].TRANSPARENT_MATERIAL:Zt["a"].TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===Zt["a"].OPAQUE_MATERIAL}createGLMaterial(e){return e.output===$t["a"].Color||e.output===$t["a"].Alpha||e.output===$t["a"].Highlight||e.output===$t["a"].Depth?new $a(e):null}}class $a extends Fa["a"]{_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(ka,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==$t["a"].Color&&this._output!==$t["a"].Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}class Xa extends za["a"]{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=Wa["a"].BUTT,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}}class Ya{constructor(e,t){this.vertexBufferLayout=e,this.parameters=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(){return"begin-end"===this.parameters.placement?12:6}write(e,t,i,r){const a=t.vertexAttributes.get(Ee["a"].POSITION).data,n=a.length/3;let s=1,o=0;this.parameters.vvSizeEnabled?o=t.vertexAttributes.get(Ee["a"].SIZEFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(Ee["a"].SIZE)&&(s=t.vertexAttributes.get(Ee["a"].SIZE).data[0]);let c=[1,1,1,1],l=0;this.parameters.vvColorEnabled?l=t.vertexAttributes.get(Ee["a"].COLORFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(Ee["a"].COLOR)&&(c=t.vertexAttributes.get(Ee["a"].COLOR).data);let d=0;this.parameters.vvOpacityEnabled&&(d=t.vertexAttributes.get(Ee["a"].OPACITYFEATUREATTRIBUTE).data[0]);const h=e.transformation,u=new Float32Array(i.buffer);let p=r*(this.vertexBufferLayout.stride/4);const b=(e,t,i,r)=>{if(u[p++]=e[0],u[p++]=e[1],u[p++]=e[2],u[p++]=i[0],u[p++]=i[1],u[p++]=t[0],u[p++]=t[1],u[p++]=t[2],this.parameters.vvSizeEnabled?u[p++]=o:u[p++]=s,this.parameters.vvColorEnabled)u[p++]=l;else{const e=Math.min(4*r,c.length-4);u[p++]=c[e+0],u[p++]=c[e+1],u[p++]=c[e+2],u[p++]=c[e+3]}this.parameters.vvOpacityEnabled&&(u[p++]=d)};let f;!function(e){e[e.ASCENDING=1]="ASCENDING",e[e.DESCENDING=-1]="DESCENDING"}(f||(f={}));const m=(e,t)=>{const i=Object(V["w"])(Za,a[3*e],a[3*e+1],a[3*e+2]),r=Ja;let s=e+t;do{Object(V["w"])(r,a[3*s],a[3*s+1],a[3*s+2]),s+=t}while(Object(V["D"])(i,r)&&s>=0&&s<n);h&&(Object(V["q"])(i,i,h),Object(V["q"])(r,r,h)),b(i,r,[-1,-1],e),b(i,r,[1,-1],e),b(i,r,[1,1],e),b(i,r,[-1,-1],e),b(i,r,[1,1],e),b(i,r,[-1,1],e)},g=this.parameters.placement;"begin"!==g&&"begin-end"!==g||m(0,f.ASCENDING),"end"!==g&&"begin-end"!==g||m(n-1,f.DESCENDING)}}const Za=Object(U["f"])(),Ja=Object(U["f"])();var Qa=i("3544"),Ka=i("86ba");const en=["polyline","polygon","extent"];class tn extends Nt{constructor(e,t,i,r){super(e,t,i,r),this._uniformSize=1}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=ha(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){const e=null!=this.symbolLayer.size?this.symbolLayer.size:Object(xe["h"])(1);if(e<0)throw new D["a"]("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=e}this._markerTexture=Object(La["c"])(this._context.sharedResources.textures,this.symbolLayer.marker)}_getMaterialParameters(e,t=!1){var i;const r=this._getCombinedOpacityAndColor(t&&this._markerColor||this._materialColor);this._patternHidesLine&&!t&&(r[3]=0);const a={width:this._computeMaterialWidth(null==(i=this.symbolLayer)?void 0:i.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:Object(Da["e"])(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:Object(Qa["b"])(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...a,...this._fastUpdates.materialParameters}:a}get _materialColor(){return Object(a["b"])(this.symbolLayer.material,e=>e.color)}get _markerColor(){return Object(a["b"])(this.symbolLayer.marker,e=>e.color)}get lineMaterial(){return Object(a["j"])(this._lineMaterial)&&(this._lineMaterial=new Ka["a"](this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return Object(a["j"])(this._ringMaterial)&&(this._ringMaterial=new Ka["a"](this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}get wireframeLineMaterial(){return Object(a["j"])(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new Ka["a"]({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterial)),this._wireframeLineMaterial}get wireframeRingMaterial(){return Object(a["j"])(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new Ka["a"]({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterial)),this._wireframeRingMaterial}get markerMaterial(){return Object(a["j"])(this._markerMaterial)&&Object(a["k"])(this.symbolLayer.marker)&&Object(a["k"])(this._markerTexture)&&(this._markerMaterial=new qa({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterial)),this._markerMaterial}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._lineMaterial=null,this._ringMaterial=null,this._wireframeLineMaterial=null,this._wireframeRingMaterial=null,this._markerMaterial=null,this._markerTexture=Object(a["p"])(this._markerTexture)}_getDrivenSize(e){return this._drivenProperties.size&&e.size?Object(xe["g"])(A(e.size)):1}_getSizeFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?Ft(this._fastUpdates.visualVariables.size.field,e):null}_getDrivenColor(e){const t=Object(rt["g"])(1,1,1,1);return this._drivenProperties.color&&e.color&&(t[0]=e.color[0],t[1]=e.color[1],t[2]=e.color[2],e.color.length>0&&(t[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(t[3]=e.opacity),t}_getColorFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?Ft(this._fastUpdates.visualVariables.color.field,e):null}_getOpacityFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?Ft(this._fastUpdates.visualVariables.opacity.field,e):null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,en,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(t,new qe["a"]);return this.ensureDrapedStatus("on-the-ground"===i.mode),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,t.uid)}applyRendererDiff(e,t){for(const i in e.diff){if("visualVariables"!==i)return tt.Recreate_Symbol;if(!ua(this._fastUpdates,t,this._vvConvertOptions))return tt.Recreate_Symbol;this._forEachMaterial(e=>e.setParameters(this._fastUpdates.materialParameters))}return tt.Fast_Update}prepareSymbolLayerPatch(e){var t,i;if("partial"!==e.diff.type)return;const r=e.diff.diff,n={};"complete"===(null==(t=r.size)?void 0:t.type)&&(n.width=this._computeMaterialWidth(r.size.newValue),delete r.size),"complete"===(null==(i=r.cap)?void 0:i.type)&&(n.cap=Object(Da["e"])(Object(a["s"])(r.cap.newValue,"butt")),delete r.cap);const s=this._prepareMarkerPatch(e,r);this._prepareMaterialPatch(e,r,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(e=>e.setParameters(n)))}layerOpacityChanged(){return this._forEachMaterial((e,t)=>this._updateMaterialLayerOpacity(e,t)),!0}_forEachMaterial(e){Object(a["k"])(this._lineMaterial)&&e(this._lineMaterial),Object(a["k"])(this._ringMaterial)&&e(this._ringMaterial),Object(a["k"])(this._wireframeLineMaterial)&&e(this._wireframeLineMaterial),Object(a["k"])(this._wireframeRingMaterial)&&e(this._wireframeRingMaterial),Object(a["k"])(this._markerMaterial)&&e(this._markerMaterial,!0)}_updateMaterialLayerOpacity(e,t=!1){const i=e.parameters.color,r=Object(a["i"])(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!t?0:this._getCombinedOpacity(r),s=Object(rt["g"])(i[0],i[1],i[2],n);e.setParameters({color:s})}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,a=Object(Ce["e"])(tn.elevationModeChangeTypes,i,r);if(a!==Ce["b"].UPDATE)return a;const n=Object(Ce["h"])(r);return this.updateGraphics3DGraphicElevationInfo(e,t,()=>n)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(t=>t.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof Vi["a"])return Ci["a"].fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,t,i){const r=e.graphic,n=this._getGeometryAsPolygonOrPolyline(r.geometry),s="polygon"===n.type?n.rings:n.paths,o=new Array,c=new Array,l=new Array,d=Object(k["f"])(),h=Object(Da["c"])(n,this._context.elevationProvider,this._context.renderCoordsHelper,t),u="polygon"===n.type?"rings":"paths";this._logGeometryCreationWarnings(h,s,u,"LineSymbol3DLayer");for(let f=0;f<h.lines.length;f++){const{position:t,mapPosition:i}=h.lines[f];if(Object(a["k"])(this._context.clippingExtent)&&(Object(k["h"])(d),Object(k["k"])(d,i),!Object(k["r"])(d,this._context.clippingExtent)))continue;const r=this._createGeometry(e,t,i,n.type,rn.ELEVATED);o.push(r),c.push("polygon"===n.type?this.ringMaterial:this.lineMaterial),l.push(we["a"]),Pe["a"].LINE_WIREFRAMES&&(o.push(r.cloneShallow()),c.push("polygon"===n.type?this.wireframeRingMaterial:this.wireframeLineMaterial),l.push(we["a"]));const s=this.markerMaterial;Object(a["k"])(s)&&(o.push(r.cloneShallow()),c.push(s),l.push(we["a"]))}if(0===o.length)return null;const p=new Xi["a"]({geometries:o,materials:c,transformations:l,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),b=new Ye(this,p,o,null,null,Ne,t);return b.alignedSampledElevation=h.sampledElevation,b.needsElevationUpdates=Object(Ce["h"])(t.mode),b}_createGeometry(e,t,i,r,a){const n="polygon"===r?Da["a"].REMOVE:Da["a"].KEEP,s=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,o=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return Object(Da["b"])({overlayInfo:a===rn.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:n,uniformSize:this._uniformSize,attributeData:{position:t,mapPosition:i,size:o?null:this._getDrivenSize(e.renderingInfo),color:s?null:this._getDrivenColor(e.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(e.graphic),colorFeature:this._getColorFeatureAttributeData(e.graphic),opacityFeature:this._getOpacityFeatureAttributeData(e.graphic)}})}_createAsOverlay(e,t){const i=e.graphic,r=this._getGeometryAsPolygonOrPolyline(i.geometry),n="polygon"===r.type?r.rings:r.paths,s="polygon"===r.type?this.ringMaterial:this.lineMaterial;s.renderPriority=this._renderPriority;const o=Pe["a"].LINE_WIREFRAMES?"polygon"===r.type?this.wireframeRingMaterial:this.wireframeLineMaterial:null,c=this.markerMaterial;Object(a["k"])(o)&&(o.renderPriority=this._renderPriority-.001),Object(a["k"])(c)&&(c.renderPriority=this._renderPriority-.002);const l=new Array,d=Object(k["f"])(),h=Object(k["h"])(),u=Object(Da["d"])(r,this._context.overlaySR),p="polygon"===r.type?"rings":"paths";this._logGeometryCreationWarnings(u,n,p,"LineSymbol3DLayer");for(const b of u.lines){if(Object(k["h"])(d),Object(k["k"])(d,b.position),!Object(k["r"])(d,this._context.clippingExtent))continue;Object(k["j"])(h,d);const n=this._createGeometry(e,b.position,null,r.type,rn.DRAPED),u=e=>{const r=new Oa["a"](n,e,{layerUid:t,graphicUid:i.uid});return l.push(r),r};if(Object(a["k"])(c)){const e=u(c),t=Object(a["r"])(this.symbolLayer.marker).placement;"begin"!==t&&"begin-end"!==t||Object(k["k"])(d,b.position,0,1),"end"!==t&&"begin-end"!==t||Object(k["k"])(d,b.position,b.position.length-3,1),this._updateBoundingSphere(e,d)}const p=u(s);if(this._updateBoundingSphere(p,d),Pe["a"].LINE_WIREFRAMES){const e=u(o);this._updateBoundingSphere(e,d)}}return new Sr(this,l,h,this._context.drapeSourceRenderer)}_updateBoundingSphere(e,t){Object(vr["l"])(e.boundingSphere,.5*(t[0]+t[3]),.5*(t[1]+t[4]),0,.5*Math.sqrt((t[3]-t[0])*(t[3]-t[0])+(t[4]-t[1])*(t[4]-t[1])))}get _patternHidesLine(){const e=this.symbolLayer.pattern;return Object(a["k"])(e)&&"style"===e.type&&"none"===e.style}_computeMaterialWidth(e){return e=Object(a["s"])(e,Object(xe["h"])(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?Object(xe["g"])(1):1:Object(xe["g"])(e)}_prepareMaterialPatch(e,t,i){const r=t.material;if(Object(a["j"])(r))return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterial,e));if("collection"===r.type)return;const n="complete"===r.type?Object(a["b"])(r.newValue,e=>e.color):"complete"===r.diff.color.type?r.diff.color.newValue:null,s=this._getCombinedOpacityAndColor(n);i.useMaterialColor&&this._patchMaterialColor(Object(rt["f"])(s),this._markerMaterial,e),this._patternHidesLine&&(s[3]=0),this._patchMaterialColor(s,this._lineMaterial,e),delete t.material}_prepareMarkerPatch(e,t){const i=t.marker;if(Object(a["j"])(i)||"partial"!==i.type||Object(a["k"])(i.diff.style)||Object(a["k"])(i.diff.placement)||Object(a["k"])(i.diff.color)&&"complete"!==i.diff.color.type)return{changed:!1,useMaterialColor:Object(a["j"])(this._markerColor)};const r=i.diff.color;if(Object(a["j"])(r))return delete t.marker,{changed:!1,useMaterialColor:Object(a["j"])(this._markerColor)};const n=Object(a["r"])(r.newValue);return Object(a["j"])(n)?(delete t.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterial,e),delete t.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(e,t,i){Object(a["j"])(t)||i.symbolLayerStatePatches.push(()=>t.setParameters({color:e}))}}var rn;tn.elevationModeChangeTypes={definedChanged:Ce["b"].RECREATE,staysOnTheGround:Ce["b"].NONE,onTheGroundChanged:Ce["b"].RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(rn||(rn={}));var an=i("f0ba"),nn=i("83fa"),sn=i("4554"),on=i("caf1e"),cn=i("1038"),ln=i("3748");const dn=["mesh"];class hn extends Nt{constructor(e,t,i,r){super(e,t,i,r),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Pe["a"].DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new ln["a"]({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new ln["a"]({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),e=>e.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,dn,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(t,new qe["a"]),r=e.renderingInfo;return this._createAs3DShape(t,r,i,t.uid)}layerOpacityChanged(e,t){const i=this._getLayerOpacity();return this._materials.forEach(e=>{e.material.setParameters({layerOpacity:i});const t=e.material.parameters;this._setMaterialTransparentParameter(t,e),e.material.setParameters({transparent:t.transparent})}),e.forEach(e=>{const r=t(e);Object(a["k"])(r)&&r.layerOpacityChanged(i,this._context.isAsync)}),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,Ce["i"])}slicePlaneEnabledChanged(e,t){return this._materials.forEach(e=>{e.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(e=>{const i=t(e);Object(a["k"])(i)&&i.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._materials.forEach(t=>t.material.setParameters({usePBR:e})),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return Object(a["j"])(e)?"-":e instanceof y["a"]?e.toHex():e.contentHash}_materialPropertiesDefault(e,t){const i=this._requiresSymbolVertexColors(),r=!!e.vertexAttributes.color,a=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:r,hasVertexTangents:a,uid:`vc:${r},vt:${a},vct${t},svc:${i}`}}_materialProperties(e,t,i){const r=this._materialPropertiesDefault(e,i);if(!t.material)return r;const{color:a,colorTexture:n,normalTexture:s,doubleSided:o,alphaCutoff:c,alphaMode:l}=t.material,d=this._colorOrTextureUid(a),h=this._colorOrTextureUid(n),u=this._colorOrTextureUid(s);if(r.color=a,r.colorTexture=n,r.normalTexture=s,r.uid=`${r.uid},cmuid:${d},ctmuid:${h},ntmuid:${u},ds:${o},ac:${c},am:${l}`,t.material instanceof nn["a"]){const{metallic:e,roughness:i,metallicRoughnessTexture:a,emissiveColor:n,emissiveTexture:s,occlusionTexture:o}=t.material,c=this._colorOrTextureUid(a),l=this._colorOrTextureUid(n),d=this._colorOrTextureUid(s),h=this._colorOrTextureUid(o);r.metallic=e,r.roughness=i,r.metallicRoughnessTexture=a,r.emissiveColor=n,r.emissiveTexture=s,r.occlusionTexture=o,r.uid=`${r.uid},mrm:${e},mrr:${i},mrt:${c},emuid:${l},etmuid:${d},otmuid:${h}`}return r}_setInternalColorValueParameters(e,t){t.diffuse=y["a"].toUnitRGB(e),t.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const t=this._getInternalTexture(e,Xe["a"].Opaque);return Object(a["k"])(t)?t.id:null}_getInternalTexture(e,t){const i=this._getLoadableTextureResource(e);if(!i)return null;const r=`${e.contentHash}/${t}`;let a=this._textures.get(r);return a||(a=new va["a"](i,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:t!==Xe["a"].Opaque}),this._textures.set(r,a),this._context.stage.add(a),this._context.stage.loadImmediate(a)),a}_castTextureWrap(e="repeat"){if("string"==typeof e){const t=this._castTextureWrapIndividual(e);return{s:t,t:t}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return ai["B"].CLAMP_TO_EDGE;case"mirror":return ai["B"].MIRRORED_REPEAT;default:return ai["B"].REPEAT}}_setInternalMaterialParameters(e,t){if(Object(a["k"])(e.color)&&this._setInternalColorValueParameters(e.color,t),Object(a["k"])(e.colorTexture)){const i=this._getInternalTexture(e.colorTexture,t.textureAlphaMode);Object(a["k"])(i)?(t.textureId=i.id,t.textureAlphaPremultiplied=!!i.params.preMultiplyAlpha):t.textureId=void 0}Object(a["k"])(e.normalTexture)&&(t.normalTextureId=this._getInternalTextureId(e.normalTexture)),Object(a["k"])(e.emissiveColor)&&(t.emissiveFactor=y["a"].toUnitRGB(e.emissiveColor)),Object(a["k"])(e.emissiveTexture)&&(t.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),Object(a["k"])(e.occlusionTexture)&&(t.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),Object(a["k"])(e.metallicRoughnessTexture)&&(t.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture))}_setExternalMaterialParameters(e){const t=this._drivenProperties.color;let i=Object(a["k"])(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(t)e.externalColor=rt["a"];else{const t=Object(a["k"])(this.symbolLayer.material)?this.symbolLayer.material.color:null;Object(a["k"])(t)?e.externalColor=y["a"].toUnitRGBA(t):(i=null,e.externalColor=rt["a"])}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const t=e.vertexAttributes.color;if(Object(a["j"])(t))return!1;for(let i=3;i<t.length;i+=4)if(255!==t[i])return!0;return!1}_getOrCreateMaterial(e,t){var i,r,n;const s=null==(i=t.material)?void 0:i.color,o=null==(r=t.material)?void 0:r.colorTexture,c=null==(n=t.material)?void 0:n.alphaMode,l="blend"===c,d=!("opaque"===c)&&(this._hasTransparentVertexColors(e)||Object(a["k"])(s)&&s.a<1||Object(a["k"])(o)&&o.transparent||l),h=this._materialProperties(e,t,d),u=this._materials.get(h.uid);if(u)return u.material;const p={material:null,isComponentTransparent:d,alphaMode:t.material?t.material.alphaMode:"opaque"},b=null==h.metallicRoughnessTexture&&null==h.metallic&&null==h.roughness,f={usePBR:this._usePBR(),isSchematic:b,hasVertexColors:h.hasVertexColors,hasSymbolColors:h.hasSymbolVertexColors,hasVertexTangents:h.hasVertexTangents,ambient:U["c"],diffuse:U["a"],opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Xe["b"].None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};b||(f.mrrFactors=[null!=h.metallic?h.metallic:1,null!=h.roughness?h.roughness:1,.5]),t.material&&(f.doubleSided=t.material.doubleSided,f.cullFace=t.material.doubleSided?Xe["b"].None:Xe["b"].Back,f.textureAlphaCutoff=t.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,p),this._setInternalMaterialParameters(h,f);const m=new Yi["a"](f);return p.material=m,this._materials.set(h.uid,p),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,t){e.transparent=this.needsDrivenTransparentPass||t.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,"auto"===t.alphaMode?e.textureAlphaMode=e.transparent?Xe["a"].MaskBlend:Xe["a"].Opaque:e.textureAlphaMode="opaque"===t.alphaMode?Xe["a"].Opaque:"mask"===t.alphaMode?Xe["a"].Mask:Xe["a"].Blend}_addDebugNormals(e,t,i,r){const a=t.length,n=e.spatialReference.isGeographic?20015077/180:1,s=.1*Math.max(e.extent.width*n,e.extent.height*n,e.extent.zmax-e.extent.zmin),o=[],c=[],l=[],d=[];for(let p=0;p<a;p++){const e=t[p],i=e.vertexAttributes.get(Ee["a"].POSITION),r=e.vertexAttributes.get(Ee["a"].NORMAL),a=e.indices.get(Ee["a"].POSITION),n=e.indices.get(Ee["a"].NORMAL),h=i.data,u=r.data;for(let t=0;t<a.length;t++){const e=3*a[t],i=3*n[t];for(let t=0;t<3;t++)o.push(h[e+t]);for(let t=0;t<3;t++)o.push(h[e+t]+u[i+t]*s);if(c.push(c.length),c.push(c.length),t%3==0){this._calculateFaceNormal(h,a,t,mn),this._getFaceVertices(h,a,t,pn,bn,fn),Object(V["e"])(pn,pn,bn),Object(V["e"])(pn,pn,fn),Object(V["k"])(pn,pn,1/3);for(let e=0;e<3;e++)l.push(pn[e]);for(let e=0;e<3;e++)l.push(pn[e]+mn[e]*s);d.push(d.length),d.push(d.length)}}}const h=new kt["a"]([[Ee["a"].POSITION,{data:o,size:3,exclusive:!0}]],[[Ee["a"].POSITION,new Uint32Array(c)]],Xe["f"].Line);t.push(h),i.push(this._debugVertexNormalMaterial),r.push(Object(we["c"])(r[0]));const u=new kt["a"]([[Ee["a"].POSITION,{data:l,size:3,exclusive:!0}]],[[Ee["a"].POSITION,new Uint32Array(d)]],Xe["f"].Line);t.push(u),i.push(this._debugFaceNormalMaterial),r.push(Object(we["c"])(r[0]))}_createAs3DShape(e,t,i,r){const n=e.geometry;if("mesh"!==n.type)return null;const s=this._createGeometryInfo(n,t);if(!s)return null;const{geometries:o,materials:c,transformations:l,objectTransformation:d}=s;Pe["a"].DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,o,c,l);const h=new Xi["a"]({geometries:o,materials:c,transformations:l,metadata:{layerUid:this._context.layer.uid,graphicUid:r}});h.transformation=d;const u=this._createEdgeMaterial(),p=Object(a["k"])(u)?{baseMaterial:c[0],edgeMaterials:[u],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,b=new Ye(this,h,o,null,null,Me,i,p);return b.needsElevationUpdates=Object(Ce["i"])(i.mode),b.useObjectOriginAsAttachmentOrigin=!0,b.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(h),b.alignedSampledElevation=Me(b,b.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),b}_getCenterPointInElevationSR(e){const t=Object(W["g"])(0,0,0,this._context.elevationProvider.spatialReference);return Object(B["u"])([e.transformation[12],e.transformation[13],e.transformation[14]],this._context.renderCoordsHelper.spatialReference,t),t}_createComponentNormals(e,t,i,r){switch(i.shading||"flat"){case"source":return this._createComponentNormalsSource(e,t,i,r);case"flat":return this._createComponentNormalsFlat(e,r);case"smooth":return this._createComponentNormalsSmooth(e,r);default:return}}_createComponentNormalsSource(e,t,i,r){if(Object(a["j"])(t))return this._createComponentNormalsFlat(e,r);let n=!1;if(!i.trustSourceNormals)for(let a=0;a<r.length;a+=3){this._calculateFaceNormal(e,r,a,mn);for(let e=0;e<3;e++){const i=3*r[a+e];pn[0]=t[i+0],pn[1]=t[i+1],pn[2]=t[i+2],Object(V["i"])(mn,pn)<0&&(t[i+0]=-t[i+0],t[i+1]=-t[i+1],t[i+2]=-t[i+2],n=!0)}}return{normals:t,indices:r,didFlipNormals:n}}_createComponentNormalsFlat(e,t){const i=new Float32Array(t.length),r=new Uint32Array(3*t.length);for(let a=0;a<t.length;a+=3){const n=this._calculateFaceNormal(e,t,a,mn);for(let e=0;e<3;e++)i[a+e]=n[e],r[a+e]=a/3}return{normals:i,indices:r,didFlipNormals:!1}}_createComponentNormalsSmooth(e,t){const i={};for(let n=0;n<t.length;n+=3){const r=this._calculateFaceNormal(e,t,n,mn);for(let e=0;e<3;e++){const a=t[n+e];let s=i[a];s||(s={normal:Object(U["f"])(),count:0},i[a]=s),Object(V["e"])(s.normal,s.normal,r),s.count++}}const r=new Float32Array(3*t.length),a=new Uint32Array(3*t.length);for(let n=0;n<t.length;n++){const e=i[t[n]];1!==e.count&&(Object(V["r"])(e.normal,e.normal),e.count=1);for(let t=0;t<3;t++)r[3*n+t]=e.normal[t];a[n]=n}return{normals:r,indices:a,didFlipNormals:!1}}_getFaceVertices(e,t,i,r,a,n){const s=3*t[i+0],o=3*t[i+1],c=3*t[i+2];r[0]=e[s+0],r[1]=e[s+1],r[2]=e[s+2],a[0]=e[o+0],a[1]=e[o+1],a[2]=e[o+2],n[0]=e[c+0],n[1]=e[c+1],n[2]=e[c+2]}_calculateFaceNormal(e,t,i,r){return this._getFaceVertices(e,t,i,pn,bn,fn),Object(V["f"])(bn,bn,pn),Object(V["f"])(fn,fn,pn),Object(V["j"])(pn,bn,fn),Object(V["r"])(r,pn),r}_getOrCreateComponents(e){return Object(a["s"])(e.components,yn)}_createPositionBuffer(e,t){let i=e.vertexAttributes.position;const r=t.reprojection===_n.ECEF?t.transformBeforeProject:null;if(Object(a["k"])(r)&&(i=Object(sn["h"])(i,new Float64Array(i.length),r)),t.reprojection===_n.NONE)return t.needsBufferCopy?new Float64Array(i):i;const n=Object(a["k"])(r)?i:new Float64Array(i.length);return Object(B["l"])(i,e.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,i.length/3),n}_createNormalBuffer(e,t,i){let r=e.vertexAttributes.normal;if(Object(a["j"])(r))return null;const n=i.reprojection===_n.ECEF?i.transformBeforeProject:null;if(Object(a["k"])(n)&&(r=Object(sn["g"])(r,new Float32Array(r.length),n)),"local"===this._context.graphicsCoreOwner.view.viewingMode||i.reprojection===_n.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===r?new Float32Array(r):r;const s=e.vertexAttributes.position,o=Object(a["k"])(n)?r:new Float32Array(r.length);return Object(sn["c"])(r,s,t,e.spatialReference,o)}_createTangentBuffer(e,t,i){let r=e.vertexAttributes.tangent;if(Object(a["j"])(r))return null;const n=i.reprojection===_n.ECEF?i.transformBeforeProject:null;if(Object(a["k"])(n)&&(r=Object(sn["i"])(r,new Float32Array(r.length),n)),"local"===this._context.graphicsCoreOwner.view.viewingMode||i.reprojection===_n.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===r?new Float32Array(r):r;const s=e.vertexAttributes.position,o=Object(a["k"])(n)?r:new Float32Array(r.length);return Object(sn["e"])(r,s,t,e.spatialReference,o)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const t=this._getVertexOpacityAndColor(e),i=Object(on["c"])(Object(a["i"])(this.symbolLayer,"material","colorMixMode")),r=new Uint8Array(4);return Object(on["b"])(t,i,r),r}return null}_createBuffers(e,t){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const r=e.vertexAttributes.normal,n=e.vertexAttributes.uv,s=e.vertexAttributes.tangent;if(Object(a["k"])(r)&&r.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(Object(a["k"])(s)&&s.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(Object(a["k"])(n)&&n.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const o=this._computeReprojectionInfo(e),c=this._createPositionBuffer(e,o),l=this._createColorBuffer(e),d=this._createSymbolColorBuffer(t),h=this._createNormalBuffer(e,c,o),u=this._createTangentBuffer(e,c,o);return{positionBuffer:c,normalBuffer:h,tangentBuffer:u,uvBuffer:n,colorBuffer:l,symbolColorBuffer:d,objectTransformation:o.reprojection===_n.NONE&&Object(a["k"])(o.objectTransformation)?o.objectTransformation:this._transformOriginLocal(e,c,h,u),geometryTransformation:o.reprojection===_n.NONE&&Object(a["k"])(o.geometryTransformation)?o.geometryTransformation:Object(we["d"])()}}_computeReprojectionInfo(e){const t=Object(a["k"])(e.transform),i=t&&e.transform.geographic||this._context.renderCoordsHelper.viewingMode===Qt["a"].Local?_n.NONE:_n.ECEF;if(t){if(i===_n.NONE){const t=Object(we["d"])();return Object(B["d"])(e.spatialReference,e.transform.origin,t,this._context.renderCoordsHelper.spatialReference),{reprojection:i,objectTransformation:t,geometryTransformation:Object(we["c"])(e.transform.localMatrix),needsBufferCopy:!1}}const t=Object(Te["f"])(Object(we["d"])(),e.transform.origin);return Object(Te["m"])(t,t,e.transform.localMatrix),{reprojection:i,transformBeforeProject:t,needsBufferCopy:!0}}return{reprojection:i,needsBufferCopy:!0}}_transformOriginLocal(e,t,i,r){const n=this._context.renderCoordsHelper.spatialReference,s=e.anchor;un[0]=s.x,un[1]=s.y,un[2]=s.z;const o=Object(we["d"])();Object(B["d"])(e.spatialReference,un,o,n);const c=Ni["v"].fromTypedArray(t);if(Object(Te["a"])(gn,o),Object(Fi["e"])(c,c,gn),Object(a["k"])(i)||Object(a["k"])(r)){if(Object(Di["f"])(On,o),Object(Di["n"])(On,On),Object(a["k"])(i)){const e=Ni["u"].fromTypedArray(i);Object(Fi["a"])(e,e,On)}if(Object(a["k"])(r)){const e=Ni["u"].fromTypedArray(r,4*r.BYTES_PER_ELEMENT);Object(Fi["a"])(e,e,On)}}return o}_validateFaces(e,t){const i=e.vertexAttributes.position.length/3,r=t.faces;if(r){let e=-1;for(let t=0;t<r.length;t++){const i=r[t];i>e&&(e=i)}if(i<=e)return this.logger.warn(`Vertex index ${e} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,t){return t.faces?t.faces:Object(cn["d"])(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const t=e.vertexAttributes&&e.vertexAttributes.position;if(!t)return!1;const i=this._context.elevationProvider.spatialReference;let r;const a=t.length/3;return e.spatialReference.equals(i)?r=t:(r=new Float64Array(t.length),Object(B["l"])(e.vertexAttributes.position,e.spatialReference,0,r,i,0,a)),Object(k["h"])(vn),Object(k["k"])(vn,r,0,a),!Object(k["r"])(vn,this._context.clippingExtent)}_createGeometryInfo(e,t){if(!Object(B["b"])(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const i=this._createBuffers(e,t);if(Object(a["j"])(i))return null;const{positionBuffer:r,uvBuffer:n,colorBuffer:s,symbolColorBuffer:o,normalBuffer:c,tangentBuffer:l,objectTransformation:d,geometryTransformation:h}=i,u=this._getOrCreateComponents(e),p=[],b=[],f=[];let m=!1;for(const g of u){if(!this._validateFaces(e,g))return null;const t=this._getOrCreateFaces(e,g);if(0===t.length)continue;const i=this._createComponentNormals(r,c,g,t);i.didFlipNormals&&(m=!0);const d=[[Ee["a"].POSITION,{size:3,data:r,exclusive:!0}],[Ee["a"].NORMAL,{size:3,data:i.normals,exclusive:!0}]],u=[[Ee["a"].POSITION,t],[Ee["a"].NORMAL,i.indices]];Object(a["k"])(s)&&(d.push([Ee["a"].COLOR,{size:4,data:s,exclusive:!0}]),u.push([Ee["a"].COLOR,t])),Object(a["k"])(o)&&(d.push([Ee["a"].SYMBOLCOLOR,{size:4,data:o,exclusive:!0}]),u.push([Ee["a"].SYMBOLCOLOR,new Uint16Array(t.length)])),Object(a["k"])(n)&&(d.push([Ee["a"].UV0,{size:2,data:n,exclusive:!0}]),u.push([Ee["a"].UV0,t])),Object(a["k"])(l)&&(d.push([Ee["a"].TANGENT,{size:4,data:l,exclusive:!0}]),u.push([Ee["a"].TANGENT,t]));const O=new kt["a"](d,u);p.push(O),b.push(h),f.push(this._getOrCreateMaterial(e,g))}return m&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:p,transformations:b,materials:f,objectTransformation:d}}_createEdgeMaterial(){const e={opacity:this._getLayerOpacity()};return ft(this.symbolLayer,e)}}const un=Object(U["f"])(),pn=Object(U["f"])(),bn=Object(U["f"])(),fn=Object(U["f"])(),mn=Object(U["f"])(),gn=Object(we["d"])(),On=Object(Li["b"])(),vn=Object(k["f"])(),yn=[new an["a"]];var _n;!function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF"}(_n||(_n={}));var jn=i("af3d"),xn=i("bea9");class Sn{constructor(e,t,i,r){this.graphics3DSymbolLayer=e,this.instanceIndex=t,this.elevationAligner=i,this.elevationContext=r,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const t=this.lodRenderer.instanceData;e!==t.getVisible(this.instanceIndex)&&t.setVisible(this.instanceIndex,e)}destroy(){null!=this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,t,i){if(this.elevationAligner){Object(ue["f"])(this.elevationContext.featureExpressionInfoContext,i);const r=this.elevationAligner(this,this.elevationContext,e,t);Object(a["k"])(r)&&(this.alignedSampledElevation=r)}}getCenterObjectSpace(e=Object(U["f"])()){return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Pn),Object(V["q"])(e,this.lodRenderer.baseBoundingSphere.center,Pn)}getBoundingBoxObjectSpace(e=Object(k["f"])()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Pn);const t=this.lodRenderer.baseBoundingBox;Object(k["h"])(e);for(let i=0;i<8;++i)Object(V["w"])(wn,0==(1&i)?t[0]:t[3],0==(2&i)?t[1]:t[4],0==(4&i)?t[2]:t[5]),Object(V["q"])(wn,wn,Pn),Object(k["n"])(e,wn);return e}computeAttachmentOrigin(e){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Pn),e.render.origin[0]+=Pn[12],e.render.origin[1]+=Pn[13],e.render.origin[2]+=Pn[14],e.render.num++}async getProjectedBoundingBox(e,t,i,r,n){const s=this.getBoundingBoxObjectSpace(n),o=An,c=Object(k["s"])(s)?1:o.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Pn);for(let a=0;a<c;a++){const e=o[a];wn[0]=s[e[0]],wn[1]=s[e[1]],wn[2]=s[e[2]],Object(V["q"])(wn,wn,Pn),Tn[3*a+0]=wn[0],Tn[3*a+1]=wn[1],Tn[3*a+2]=wn[2]}if(!e(Tn,0,c))return null;Object(k["h"])(s);let l=null;this.calculateRelativeScreenBounds&&(l=this.calculateRelativeScreenBounds());for(let a=0;a<3*c;a+=3){for(let e=0;e<3;e++)s[e]=Math.min(s[e],Tn[a+e]),s[e+3]=Math.max(s[e+3],Tn[a+e]);l&&i.push({location:Tn.slice(a,a+3),screenSpaceBoundingRect:l})}if(t&&(Object(k["d"])(s,Cn),"absolute-height"!==this.elevationContext.mode)){let e;const i=Object(Ae["d"])(s,t);try{e=await t.service.queryElevation(Cn[0],Cn[1],r,i,"ground")}catch(d){}Object(a["k"])(e)&&Object(k["u"])(s,0,0,-this.alignedSampledElevation+e)}return s}addObjectState(e,t){if(e===Xe["d"].Highlight){const i=new xn["a"](e);this._addHighlightId(i),t.addExternal(e=>{this._removeHighlightId(e)},i)}}removeObjectState(e){this._highlights.forEach(t=>e.remove(t))}_addHighlightId(e){this._highlights.add(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const Tn=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],wn=Object(U["f"])(),Cn=Object(U["f"])(),An=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Pn=Object(we["d"])();function Rn(e){const t=[];return e.stageResources.geometries.forEach((i,r)=>{const a=e.stageResources.materials[r],n=e.stageResources.textures;t.push({material:a,geometry:i,textures:n})}),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}function En(e){return{levels:e.map(e=>Rn(e))}}function In(e,t=Dn){const i=Tt(e);return Math.sqrt(i/(t*Math.PI))}function Mn(e){e.levels.forEach(e=>{e.minScreenSpaceRadius||(e.minScreenSpaceRadius=In(e))})}const Dn=.05;var Ln,Nn=i("94a6"),Fn=i("2ebb"),zn=i("171c"),Gn=i("1942"),Vn=i("0bde"),Un=i("614d"),Bn=i("1153"),kn=i("680b");function Hn(e){let t=Object(qt["a"])().mat4f64(Ee["a"].LOCALTRANSFORM).mat4f64(Ee["a"].GLOBALTRANSFORM).vec4f64(Ee["a"].BOUNDINGSPHERE).vec3f64(Ee["a"].MODELORIGIN).mat3f(Ee["a"].MODEL).mat3f(Ee["a"].MODELNORMAL).vec2f(Ee["a"].MODELSCALEFACTORS);return e.includes("color")&&(t=t.vec4f(Ee["a"].COLOR)),e.includes("featureAttribute")&&(t=t.vec4f(Ee["a"].FEATUREATTRIBUTE)),t=t.u8(Ee["a"].STATE).u8(Ee["a"].LODLEVEL).alignTo(8),t}!function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"}(Ln||(Ln={}));class Wn{constructor(e){this.localTransform=e.getField(Ee["a"].LOCALTRANSFORM,Ni["i"]),this.globalTransform=e.getField(Ee["a"].GLOBALTRANSFORM,Ni["i"]),this.modelOrigin=e.getField(Ee["a"].MODELORIGIN,Ni["v"]),this.model=e.getField(Ee["a"].MODEL,Ni["f"]),this.modelNormal=e.getField(Ee["a"].MODELNORMAL,Ni["f"]),this.modelScaleFactors=e.getField(Ee["a"].MODELSCALEFACTORS,Ni["m"]),this.boundingSphere=e.getField(Ee["a"].BOUNDINGSPHERE,Ni["D"]),this.color=e.getField(Ee["a"].COLOR,Ni["C"]),this.featureAttribute=e.getField(Ee["a"].FEATUREATTRIBUTE,Ni["C"]),this.state=e.getField(Ee["a"].STATE,Ni["l"]),this.lodLevel=e.getField(Ee["a"].LODLEVEL,Ni["l"])}}class qn extends pe["a"]{constructor(e,t){super(),this._capacity=0,this._size=0,this._next=0,this._layout=Hn(e),this._shaderTransformation=t}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Ln.ALLOCATED),this._size++,this.emit("instance-added",{index:e}),e}removeInstance(e){const t=this._view.state;Object(Bn["a"])(e>=0&&e<this._capacity&&t.get(e)&Ln.ALLOCATED,"invalid instance handle"),this._getStateFlag(e,Ln.ACTIVE)?this._setStateFlags(e,Ln.REMOVE):this.freeInstance(e),this.emit("instance-removed",{index:e})}freeInstance(e){const t=this._view.state;Object(Bn["a"])(e>=0&&e<this._capacity&&t.get(e)&Ln.ALLOCATED,"invalid instance handle"),t.set(e,0),this._size--}setLocalTransform(e,t,i=!0){this._view.localTransform.setMat(e,t),i&&this.updateModelTransform(e)}getLocalTransform(e,t){this._view.localTransform.getMat(e,t)}setGlobalTransform(e,t,i=!0){this._view.globalTransform.setMat(e,t),i&&this.updateModelTransform(e)}getGlobalTransform(e,t){this._view.globalTransform.getMat(e,t)}updateModelTransform(e){const t=this._view,i=Yn,r=Zn;t.localTransform.getMat(e,Jn),t.globalTransform.getMat(e,Qn);const a=Object(Te["m"])(Qn,Qn,Jn);Object(V["w"])(i,a[12],a[13],a[14]),t.modelOrigin.setVec(e,i),Object(Di["f"])(r,a),t.model.setMat(e,r);const n=Object(kn["c"])(Yn,a);n.sort(),t.modelScaleFactors.set(e,0,n[1]),t.modelScaleFactors.set(e,1,n[2]),Object(Di["e"])(r,r),Object(Di["n"])(r,r),t.modelNormal.setMat(e,r),this._setStateFlags(e,Ln.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:e})}getModelTransform(e,t){const i=this._view;i.model.getMat(e,Zn),i.modelOrigin.getVec(e,Yn),t[0]=Zn[0],t[1]=Zn[1],t[2]=Zn[2],t[3]=0,t[4]=Zn[3],t[5]=Zn[4],t[6]=Zn[5],t[7]=0,t[8]=Zn[6],t[9]=Zn[7],t[10]=Zn[8],t[11]=0,t[12]=Yn[0],t[13]=Yn[1],t[14]=Yn[2],t[15]=1}applyShaderTransformation(e,t){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t)}getCombinedModelTransform(e,t){return this.getModelTransform(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t}getCombinedLocalTransform(e,t){return this._view.localTransform.getMat(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t}getCombinedMaxScaleFactor(e){let t=this._view.modelScaleFactors.get(e,1);if(this._shaderTransformation){const i=this._shaderTransformation.scaleFactor(Yn,this,e);t*=Math.max(i[0],i[1],i[2])}return t}getCombinedMedianScaleFactor(e){let t=this._view.modelScaleFactors.get(e,0);if(this._shaderTransformation){const i=this._shaderTransformation.scaleFactor(Yn,this,e);i.sort(),t*=i[1]}return t}getModel(e,t){this._view.model.getMat(e,t)}setFeatureAttribute(e,t){this._view.featureAttribute.setVec(e,t)}getFeatureAttribute(e,t){this._view.featureAttribute.getVec(e,t)}setColor(e,t){this._view.color.setVec(e,t)}getColor(e,t){this._view.color.getVec(e,t)}setVisible(e,t){t!==this.getVisible(e)&&(this._setStateFlag(e,Ln.VISIBLE,t),this.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Ln.VISIBLE)}setHighlight(e,t){t!==this.getHighlight(e)&&(this._setStateFlag(e,Ln.HIGHLIGHT,t),this.emit("instance-highlight-changed",{index:e}))}getHighlight(e){return this._getStateFlag(e,Ln.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let t=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++t;return t}_setStateFlags(e,t){const i=this._view.state;t=i.get(e)|t,i.set(e,t)}_clearStateFlags(e,t){const i=this._view.state;t=i.get(e)&~t,i.set(e,t)}_setStateFlag(e,t,i){i?this._setStateFlags(e,t):this._clearStateFlags(e,t)}_getStateFlag(e,t){return!!(this._view.state.get(e)&t)}_grow(){const e=Math.max($n,Math.floor(this._capacity*Xn)),t=this._layout.createBuffer(e);if(this._buffer){const e=new Uint8Array(this._buffer.buffer);new Uint8Array(t.buffer).set(e)}this._capacity=e,this._buffer=t,this._view=new Wn(this._buffer)}_findSlot(){const e=this._view.state;let t=this._next;for(;e.get(t)&Ln.ALLOCATED;)t=(t+1)%this._capacity;return this._next=(t+1)%this._capacity,t}}const $n=1024,Xn=2,Yn=Object(U["f"])(),Zn=Object(Li["b"])(),Jn=Object(we["d"])(),Qn=Object(we["d"])();class Kn extends Vn["a"]{constructor(e,t){super(e=>Object($e["j"])(this._instanceData.view.boundingSphere.getVec(e,this._tmpSphere)),{maximumDepth:25}),this._tmpSphere=Object($e["c"])(),this._tmpMat4=Object(we["d"])(),this._instanceData=e,this._boundingSphere=t}addInstance(e){const t=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);Object(V["q"])(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*Object(kn["a"])(i),t.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}}class es{constructor(e,t){this.thresholdScale=1,this._camera=new zn["a"],this._worldSpaceRadius=e,this._thresholds=t.map(e=>e)}updateCamera(e){this._camera.copyFrom(e)}selectLevel(e,t){const i=this._camera.computeScreenPixelSizeAt(e),r=this._worldSpaceRadius*t/i,a=this._thresholds;let n=-1;for(let s=0;s<a.length;++s)r>=a[s]*this.thresholdScale&&(n=s);return n}}var ts=i("9250"),is=i("7ce4"),rs=i("0fa6");class as{constructor(e,t){const i=e.renderContext.rctx,{geometry:r,material:a}=t;this._materialRepository=e.materialRep,a.setParameters({instancedDoublePrecision:!0});const n=a.createBufferWriter(),s=n.vertexBufferLayout,o=n.elementCount(r),c=n.allocate(o);n.write({},r,c,0),this.geometry=r,this.material=a,this.glMaterials=new Na["a"](a,this._materialRepository),this.vertexBufferLayout=s,this.vbo=is["a"].createVertex(i,ai["D"].STATIC_DRAW,c.buffer),this.vao=new rs["a"](i,ti["a"],{geometry:Object(Fn["a"])(s)},{geometry:this.vbo}),this.vertexCount=o}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,t,i,r,a,n,s,o){const c=this.geometry.id;this.material.intersect(this.geometry,null,e.transform.transform,e,i,r,(i,r,l,d,h)=>{if(i>=0){if(null!=t&&!t(e.rayBegin,e.rayEnd,i))return;const d={layerUid:n.layerUid,graphicUid:n.graphicUid(a),geometryId:c,triangleNr:l,baseBoundingSphere:s,numLodLevels:o};if((null==e.results.min.drapedLayerOrder||h>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||i<e.results.min.dist)&&e.results.min.set(Gn["b"].LOD,d,i,r,e.transform.transform,h),e.options.store!==Gn["c"].MIN&&(null==e.results.max.drapedLayerOrder||h>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||i>e.results.max.dist)&&e.results.max.set(Gn["b"].LOD,d,i,r,e.transform.transform,h),e.options.store===Gn["c"].ALL){const t=Object(ts["b"])(e.results.min.ray);t.set(Gn["b"].LOD,d,i,r,e.transform.transform,h),e.results.all.push(t)}}})}}class ns{constructor(e,t){this.minScreenSpaceRadius=e,this.components=t}static async create(e,t,i){const r=await Promise.allSettled(t.components.map(t=>e.schedule(()=>new as(e,t),i))),a=r.map(e=>"fulfilled"===e.status?e.value:null).filter(e=>e);if(Object(h["k"])(i)||a.length!==r.length){a.forEach(e=>e.destroy()),Object(h["p"])(i);for(const e of r)if("rejected"===e.status)throw e.reason}return new ns(t.minScreenSpaceRadius,a)}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,t,i,r,a,n,s){this.components.forEach(o=>o.intersect(e,t,i,r,a,n,this.boundingSphere,s))}get boundingBox(){if(Object(a["j"])(this._boundingBox)){const e=Object(k["h"])();this.components.forEach(t=>{Object(a["k"])(t.boundingInfo)&&(Object(k["n"])(e,t.boundingInfo.bbMin),Object(k["n"])(e,t.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(Object(a["j"])(this._boundingSphere)){const e=this.boundingBox,t=Object(U["f"])();Object(k["d"])(e,t),this._boundingSphere={center:t,radius:.5*Object(k["g"])(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,t)=>e+t.triangleCount,0)}}class ss{constructor(e,t,i){this._elementSize=t,this._buffer=is["a"].createVertex(e,ai["D"].STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,t,i,r=0){const a=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(i.array,r*this.elementSize).set(a)}transferAll(){this._buffer.setData(this._array)}transferRange(e,t){const i=e*this._elementSize,r=t*this._elementSize;this._buffer.setSubData(this._array,i,i,r)}resize(e){const t=e*this._elementSize,i=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(t),this._capacity=e}}class os{constructor(e){this.modelOriginHi=e.getField(Ee["a"].MODELORIGINHI,Ni["u"]),this.modelOriginLo=e.getField(Ee["a"].MODELORIGINLO,Ni["u"]),this.model=e.getField(Ee["a"].MODEL,Ni["f"]),this.modelNormal=e.getField(Ee["a"].MODELNORMAL,Ni["f"]),this.color=e.getField(Ee["a"].INSTANCECOLOR,Ni["C"]),this.featureAttribute=e.getField(Ee["a"].INSTANCEFEATUREATTRIBUTE,Ni["C"])}}class cs{constructor(e,t){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=t,this._elementSize=t.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){Object(Bn["a"])(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){Object(Bn["a"])(this._updating,"not updating"),this.size<hs*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){Object(Bn["a"])(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),Object(Bn["a"])(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){Object(Bn["a"])(this._updating,"not updating"),Object(Bn["a"])(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(ls,Math.floor(this._capacity*ds));this._resize(e)}_shrink(){const e=Math.max(ls,Math.floor(this._capacity*us));this._resize(e)}_resize(e){if(Object(Bn["a"])(this._updating,"not updating"),e===this._capacity)return;const t=new ss(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const e=this.size,i=this._compactInstances(t);Object(Bn["a"])(i===e,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=i,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new os(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const t=this._headIndex,i=this._tailIndex;return i<t?(this._buffer.copyRange(i,t,e),t-i):i>t?(this._buffer.copyRange(i,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-i),t+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))}}const ls=1024,ds=2,hs=.3,us=.5;var ps=i("7c51"),bs=i("b623"),fs=i("e1cb"),ms=i("8539");let gs=e=>{const t=e.baseBoundingSphere.radius,i=e.levels.map(e=>e.minScreenSpaceRadius);return new es(t,i)};class Os{constructor(e,t,i,r){this.type=Gn["b"].LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new zn["a"],this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[Zt["a"].OPAQUE_MATERIAL,Zt["a"].TRANSPARENT_MATERIAL],this.canRender=!0,this._symbol=e,this._optionalFields=t,this._metadata=i,this._instanceBufferLayout=Object(Yi["b"])({instancedDoublePrecision:!0,instanced:t}),this._glInstanceBufferLayout=Object(Fn["a"])(this._instanceBufferLayout,1),this._instanceData=new qn(this._optionalFields,r),this._instanceData.on("instance-added",()=>this._requestUpdateCycle()),this._instanceData.on("instance-removed",()=>this._requestUpdateCycle()),this._instanceData.on("instance-transform-changed",e=>{this._requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(e.index)}),this._instanceData.on("instance-visibility-changed",e=>{this._requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(e.index)}),this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0)),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(t=>{const i=t.memoryUsage;e.cpu+=i.cpu,e.gpu+=i.gpu}),this._highlightRenderInstanceData.forEach(t=>{const i=t.memoryUsage;e.cpu+=i.cpu,e.gpu+=i.gpu}),e}get renderStats(){const e=this._instanceData.size,t=[];return this._levels.forEach((e,i)=>{const r=this._defaultRenderInstanceData[i],a=this._highlightRenderInstanceData[i],n=r.size+a.size,s=e.triangleCount;t.push({renderedInstances:n,renderedTriangles:n*s,trianglesPerInstance:s})}),{totalInstances:e,renderedInstances:t.reduce((e,t)=>e+t.renderedInstances,0),renderedTriangles:t.reduce((e,t)=>e+t.renderedTriangles,0),levels:t}}async initializeRenderContext(e,t){this._context=e;const i=e.renderContext.rctx,r=await Promise.allSettled(this._symbol.levels.map(r=>(this._defaultRenderInstanceData.push(new cs(i,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new cs(i,this._instanceBufferLayout)),ns.create(e,r,t)))),a=r.map(e=>"fulfilled"===e.status?e.value:null).filter(e=>e);if(Object(h["k"])(t)||a.length!==r.length){a.forEach(e=>e.destroy()),Object(h["p"])(t);for(const e of r)if("rejected"===e.status)throw e.reason}this._levels=a,this._levelSelector=gs(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData.forEach(e=>e.destroy()),this._highlightRenderInstanceData.forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(e=>e.material.requiresSlot(Zt["a"].TRANSPARENT_MATERIAL)))}get needsHighlight(){return this._highlightRenderInstanceData.some(e=>e.size>0)}prepareRender(e){if(Pe["a"].LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const t=e.bindParameters.contentCamera.equals(this._lastCamera);this._lastCamera.copyFrom(e.bindParameters.contentCamera),t||this._requestUpdateCycle()}const t=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this._updateInstances(e.bindParameters.contentCamera,t),this.needsUpdates&&this._context.requestRender()}render(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(e.pass))return;e.rctx.bindVAO();const t=e.pass!==Un["a"].MATERIAL_HIGHLIGHT&&e.pass!==Un["a"].MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,i=e.pass!==Un["a"].MATERIAL_DEPTH_SHADOWMAP_DEFAULT;t&&this._renderComponents(e,this._defaultRenderInstanceData),i&&this._renderComponents(e,this._highlightRenderInstanceData)}intersect(e,t,i,r){if(!this.baseMaterial.isVisible())return;const a=Object(U["f"])();Object(V["f"])(a,r,i);const n=a=>{this._instanceData.getCombinedModelTransform(a,xs),e.transform.set(xs),Object(V["q"])(Ss,i,e.transform.inverse),Object(V["q"])(Ts,r,e.transform.inverse);const n=this._instanceData.getState(a),s=this._instanceData.getLodLevel(a),o=this._levels.length;Object(Bn["a"])(n&Ln.ACTIVE,"invalid instance state"),Object(Bn["a"])(s>=0&&s<o,"invaid lod level"),this._levels[s].intersect(e,t,Ss,Ts,a,this._metadata,o)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(n):this.octree.forEachAlongRay(i,a,n)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree()}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,e&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender()}get needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get octree(){return this._octree||(this._octree=this._buildOctree()),this._octree}_invalidateOctree(){this._octree&&(this._octree.destroy(),this._octree=null)}_buildOctree(){const e=new Kn(this._instanceData,this.baseBoundingSphere),t=this._instanceData,i=t.view?t.view.state:null;for(let r=0;r<this._instanceData.capacity;++r)i.get(r)&Ln.ACTIVE&&e.addInstance(r);return e}_queryDepthRangeOctree(e){const t=e.eye,i=e.viewForward,r=this.octree.findClosest(i,Vn["a"].DepthOrder.FRONT_TO_BACK,e.frustum),a=this.octree.findClosest(i,Vn["a"].DepthOrder.BACK_TO_FRONT,e.frustum);if(null!=r&&null!=a){this._instanceData.view.boundingSphere.getVec(r,js),Object(V["f"])(js,js,t);const n=Object(V["i"])(js,i)-js[3];this._instanceData.view.boundingSphere.getVec(a,js),Object(V["f"])(js,js,t);const s=Object(V["i"])(js,i)+js[3];return{near:Math.max(e.near,n),far:Math.min(e.far,s)}}return{near:1/0,far:-1/0}}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(e=>{e.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(e=>{e.startUpdateCylce()}),this.needsUpdates&&this._context.requestRender()}_updateInstances(e,t){const i=this._enableLevelSelection,r=this._levelSelector;r.updateCamera(e),this._defaultRenderInstanceData.forEach(e=>{e.beginUpdate()}),this._highlightRenderInstanceData.forEach(e=>{e.beginUpdate()});const a=this._instanceData,n=this._instanceData.view,s=a.size,o=a.capacity;let c=this._instanceIndex;t=Math.min(s,t);for(let l=0;l<t;++l){0===c&&this._startUpdateCycle();const e=n.state.get(c);let s=0;if(!(e&Ln.ALLOCATED)){c=(c+1)%o,t++;continue}const l=n.lodLevel.get(c);if(e&Ln.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[l].freeTail(),e&Ln.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[l].freeTail(),e&Ln.REMOVE)a.freeInstance(c);else if(e&Ln.VISIBLE){let t=0;i&&(n.modelOrigin.getVec(c,_s),t=r.selectLevel(_s,a.getCombinedMedianScaleFactor(c))),s=e&~(Ln.ACTIVE|Ln.TRANSFORM_CHANGED),t>=0&&(e&Ln.HIGHLIGHT?(vs(this._highlightRenderInstanceData[t],n,c),s|=Ln.HIGHLIGHT_ACTIVE):(vs(this._defaultRenderInstanceData[t],n,c),s|=Ln.DEFAULT_ACTIVE)),n.state.set(c,s),n.lodLevel.set(c,t)}else s=e&~(Ln.ACTIVE|Ln.TRANSFORM_CHANGED),n.state.set(c,s);if(this._octree){const t=!!(e&Ln.ACTIVE),i=!!(s&Ln.ACTIVE);!t&&i?this._octree.addInstance(c):t&&!i?this._octree.removeInstance(c):t&&i&&e&Ln.TRANSFORM_CHANGED&&(this._octree.removeInstance(c),this._octree.addInstance(c))}c=(c+1)%o}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(e=>{e.endUpdate()}),this._highlightRenderInstanceData.forEach(e=>{e.endUpdate()})}_renderComponents(e,t){this.levels.forEach((i,r)=>{i.components.forEach(i=>{this._renderComponent(e,t[r],i,r)})})}_renderComponent(e,t,i,r){const n=e.bindParameters;if(0===t.size||!i.material.requiresSlot(n.slot))return;const{rctx:s,pass:o}=e,c=i.glMaterials.load(s,o);if(Object(a["j"])(c))return;const l=c.beginSlot(n),d=s.bindTechnique(l,i.material.parameters,n);s.bindVAO(i.vao),l.ensureAttributeLocations(i.vao),l.bindDraw(Cs,n),Pe["a"].LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.pass===Un["a"].MATERIAL&&(d.setUniform4fv("externalColor",ws[Math.min(r,ws.length-1)]),d.setUniform1i("colorMixMode",ps["a"].replace));const h=s.capabilities.instancing,u=t.capacity,p=t.headIndex,b=t.tailIndex,f=t.firstIndex,m=this._glInstanceBufferLayout,g=(e,r)=>{Object(ms["a"])(s,ti["a"],t.buffer,m,e),h.drawArraysInstanced(l.primitiveType,0,i.vertexCount,r-e),Object(ms["e"])(s,ti["a"],t.buffer,m)};i.material.parameters.transparent&&null!=f?p>b?(Object(Bn["a"])(f>=b&&f<=p,"invalid firstIndex"),g(f,p),g(b,f)):p<b&&(f<=p?(Object(Bn["a"])(f>=0&&f<=p,"invalid firstIndex"),g(f,p),g(b,u),g(0,f)):(Object(Bn["a"])(f>=b&&f<=u,"invalid firstIndex"),g(f,u),g(0,p),g(b,f))):p>b?g(b,p):p<b&&(g(0,p),g(b,u)),s.bindVAO(null)}}function vs(e,t,i){const r=e.allocateHead();ys(t,i,e.view,r)}function ys(e,t,i,r){Object(bs["c"])(e.modelOrigin,t,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,e.model,t),i.modelNormal.copyFrom(r,e.modelNormal,t),e.color&&i.color&&i.color.copyFrom(r,e.color,t),e.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,e.featureAttribute,t)}const _s=Object(U["f"])(),js=Object(rt["e"])(),xs=Object(we["d"])(),Ss=Object(U["f"])(),Ts=Object(U["f"])(),ws=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]],Cs=new fs["a"];class As extends Nt{constructor(e,t,i,r){super(e,t,i,r),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}getCachedSize(){const[e,t,i]=Object(a["k"])(this._resources)?this._resources.symbolSize:[1,1,1];return{width:e,depth:t,height:i}}async doLoad(e){if(!this._drivenProperties.size&&Object(Ae["i"])(this.symbolLayer))throw new Error;const t=this.symbolLayer;if(this.isPrimitive){const i=t.resource?t.resource.primitive:st["b"];this._resources=await this._createResourcesForPrimitive(i,e)}else this._resources=await this._createResourcesForUrl(t.resource.href,e);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return Object(a["k"])(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return Object(a["i"])(this._resources,"lodRenderer")}_setMaterialTransparencyParams(e,t=Object(a["i"])(this.symbolLayer,"material","color")){const i=this._getCombinedOpacity(t),r=i<1||this.needsDrivenTransparentPass;return e.transparent=r,e.opacity=i,e.cullFace=r?Xe["b"].None:Xe["b"].Back,e}async _createResourcesForPrimitive(e,t){if(!ct(e))throw new Error("Unknown object symbol primitive: "+e);const i=this.symbolLayer,r=Object(k["f"])(Object(jn["c"])(e)),n=Object(U["g"])(Object(k["z"])(r)),s=Object(U["g"])(Object(jn["d"])(n,i)),o=Object(V["p"])(s),c=!1,l=!1,d={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:U["a"],diffuse:U["a"],hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},h=d.usePBR;this._setMaterialTransparencyParams(d);const u=this.symbol;if("point-3d"===u.type&&u.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:i}=u.verticalOffset;d.verticalOffset={screenLength:Object(xe["g"])(e),minWorldLength:t||0,maxWorldLength:null!=i?i:1/0},d.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(d.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)d.externalColor=rt["a"];else{const e=Object(a["k"])(i.material)&&i.material.color,t=Object(a["k"])(e)?y["a"].toUnitRGBA(e):rt["a"];d.externalColor=t}this._fastUpdates=ha(this._context.renderer,this._fastVisualVariableConvertOptions(r,s,n,a["n"])),d.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(d,this._fastUpdates.materialParameters),d.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(d.instanced.push("color"),this._optionalFields.push("color"));const p=new Yi["a"](d),b=lt(e,p);if(!b)throw new Error("Unknown object symbol primitive: "+e);const f=_t(b).map(e=>({opacity:1,transparent:e.parameters.transparent})),m=await this._createStageResources(b,h);return{lodResources:b,lodRenderer:await this._createLodRenderer(b,t),stageResources:m,symbolSize:s,extentPadding:o,isEsriSymbolResource:c,isWosr:l,originalMaterialParameters:f,physicalBasedRenderingEnabled:h,resourceBoundingBox:r,resourceSize:n,pivotOffset:a["n"]}}async _createResourcesForUrl(e,t){const i=["transformation"],r={materialParamsMixin:{instanced:i,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=ha(this._context.renderer,this._fastVisualVariableConvertOptions(a["n"],a["n"],a["n"],a["n"])),this._fastUpdates.enabled?(Object.assign(r.materialParamsMixin,this._fastUpdates.materialParameters),i.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(i.push("color"),this._optionalFields.push("color"));const n=this.symbol;if("point-3d"===n.type&&n.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:i}=n.verticalOffset;r.materialParamsMixin.verticalOffset={screenLength:Object(xe["g"])(e),minWorldLength:t||0,maxWorldLength:null!=i?i:1/0},r.materialParamsMixin.castShadows=!1}r.signal=t,r.usePBR=this._context.physicalBasedRenderingEnabled;const s=r.usePBR,o=await Object(Nn["fetch"])(e,r),c=o.isEsriSymbolResource,l=o.isWosr;this._addDisposeResource(()=>o.remove());const d=En(o.lods);Mn(d),d.levels.sort((e,t)=>e.minScreenSpaceRadius-t.minScreenSpaceRadius),d.levels[0].minScreenSpaceRadius=Math.min(2,d.levels[0].minScreenSpaceRadius);const h=this._context,u=this.symbolLayer.material,p=this._getExternalColorParameters(u),b=Object(a["i"])(this.symbolLayer,"material","color"),f=this._getCombinedOpacity(b,{hasIntrinsicColor:!0}),m=this.needsDrivenTransparentPass,g=_t(d),O=_t(d).map(e=>({opacity:e.parameters.opacity||1,transparent:e.parameters.transparent}));g.forEach(e=>{const t=e.parameters;e.setParameters(p);const i=t.opacity*f,r=i<1||m||t.transparent;e.setParameters({opacity:i,transparent:r}),h.screenSizePerspectiveEnabled&&e.setParameters({screenSizePerspective:h.sharedResources.screenSizePerspectiveSettings})});const v=o.referenceBoundingBox,y=Object(U["g"])(Object(k["z"])(v)),_=Object(U["g"])(d.levels[0].pivotOffset),j=Object(U["g"])(Object(jn["d"])(y,this.symbolLayer)),x=Object(V["p"])(j);ua(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(v,j,y,_))&&g.forEach(e=>e.setParameters(this._fastUpdates.materialParameters));const S=await this._createStageResources(d,s);return{lodResources:d,lodRenderer:await this._createLodRenderer(d,t),stageResources:S,symbolSize:j,extentPadding:x,isEsriSymbolResource:c,isWosr:l,originalMaterialParameters:O,physicalBasedRenderingEnabled:s,resourceBoundingBox:v,resourceSize:y,pivotOffset:_}}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,t){const i=this._context.stage,r=_t(e);t!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),i.addMany(r),this._addDisposeResource(()=>i.removeMany(r));const a=jt(e);i.addMany(a),this._addDisposeResource(()=>i.removeMany(a)),await i.load(a);const n=St(e);return i.addMany(n),this._addDisposeResource(()=>i.removeMany(n)),{materials:r,textures:a,geometries:n}}async _createLodRenderer(e,t){const i=this._context.stage,r={layerUid:this._context.layer.uid,graphicUid:e=>this._instanceIndexToGraphicUid.get(e),notifyGraphicGeometryChanged:e=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(e)),notifyGraphicVisibilityChanged:e=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(e))},a=this._fastUpdates.enabled?{applyTransform:(e,t,i)=>{e.getFeatureAttribute(t,Is),Object(Te["c"])(i,ma(this._fastUpdates.materialParameters,Is,i))},scaleFactor:(e,t,i)=>(t.getFeatureAttribute(i,Is),ga(e,this._fastUpdates.materialParameters,Is))}:null,n=new Os(e,this._optionalFields,r,a);return n.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(n)}),await i.addRenderPlugin(n.slots,n,t),n}_getExternalColorParameters(e){const t={};return this._drivenProperties.color?t.externalColor=rt["a"]:Object(a["k"])(e)&&Object(a["k"])(e.color)?t.externalColor=y["a"].toUnitRGBA(e.color):(t.externalColor=rt["a"],t.colorMixMode="ignore"),t}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;const i=Object(Bt["d"])(t.geometry);if(Object(a["j"])(i))return this.logger.warn("unsupported geometry type for icon symbol: "+t.geometry.type),null;const r=this.setGraphicElevationContext(t,new qe["a"]),n=e.renderingInfo;return this._createAs3DShape(t,i,n,r,t.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(Object(a["j"])(this._resources))return!0;const e=this._drivenProperties.opacity,t=!this.isPrimitive,i=this._resources.stageResources.materials,r=this._resources.originalMaterialParameters;for(let n=0;n<i.length;n++){const s=i[n],o=Object(a["i"])(this.symbolLayer,"material","color"),c=r[n],l=this._getCombinedOpacity(o,{hasIntrinsicColor:t})*c.opacity,d=l<1||e||c.transparent;s.setParameters({opacity:l,transparent:d}),this.isPrimitive&&s.setParameters({cullFace:d?Xe["b"].None:Xe["b"].Back})}return!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,Ce["i"])}slicePlaneEnabledChanged(){if(Object(a["j"])(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(Object(a["j"])(this._resources))return!0;const{stageResources:e,isWosr:t}=this._resources;for(const i of e.materials)this.isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):t||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1!==this.hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(e,t){if(Object(a["j"])(this._resources))return tt.Recreate_Symbol;const{stageResources:{materials:i},lodRenderer:r,resourceBoundingBox:n,symbolSize:s,resourceSize:o,pivotOffset:c}=this._resources;for(const a in e.diff){if("visualVariables"!==a)return tt.Recreate_Symbol;if(!ua(this._fastUpdates,t,this._fastVisualVariableConvertOptions(n,s,o,c)))return tt.Recreate_Symbol;for(const e of i)e.setParameters(this._fastUpdates.materialParameters);r.notifyShaderTransformationChanged()}return tt.Fast_Update}computeComplexity(){return Object(a["j"])(this._resources)?super.computeComplexity():{primitivesPerFeature:xt(this._resources.lodResources.levels[0]).reduce((e,t)=>e+t.indices.get(Ee["a"].POSITION).length,0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:It(this.symbol,this.symbolLayer)}}_hasLodRenderer(){return Object(a["k"])(this._resources)}_createAs3DShape(e,t,i,r,n){if(!this._hasLodRenderer()||Object(a["j"])(this._resources))return null;const s=this.getFastUpdateAttrValues(e),o=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?Object(Ae["g"])(i.color,i.opacity):null,c=this._context.clippingExtent;if(Object(B["p"])(t,Ps,this._context.elevationProvider.spatialReference),Object(a["k"])(c)&&!Object(k["e"])(c,Ps))return null;const l=this._requiresTerrainElevation(r),d=this._computeGlobalTransform(t,r,Es,Ms),h=this._computeLocalTransform(this._resources,this.symbolLayer,i,Rs),u=this._resources.lodRenderer.instanceData,p=u.addInstance();this._instanceIndexToGraphicUid.set(p,n),u.setLocalTransform(p,h,!1),u.setGlobalTransform(p,d),s&&u.setFeatureAttribute(p,s),o&&u.setColor(p,o);const b=new Sn(this,p,Le,r);return l&&(b.alignedSampledElevation=Ms.sampledElevation),b.needsElevationUpdates=Object(Ce["i"])(r.mode),Object(Bt["b"])(b,t,this._context.elevationProvider),b}_computeGlobalTransform(e,t,i,r){return Object(Ce["g"])(e,this._context.elevationProvider,t,this._context.renderCoordsHelper,r),Ps[0]=e.x,Ps[1]=e.y,Ps[2]=r.z,Object(B["d"])(e.spatialReference,Ps,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,t,i,r){return Object(Te["i"])(r),this._applyObjectRotation(i,!1,r),this._applyObjectRotation(t,!0,r),this._applyObjectScale(e,i,r),this._applyAnchor(e,t,r),r}_applyObjectScale(e,t,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const r=this._drivenProperties.size&&t.size?t.size:e.symbolSize,a=Object(Ae["c"])(r,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===a[0]&&1===a[1]&&1===a[2]||Object(Te["h"])(i,i,a)}prepareSymbolLayerPatch(e){if("partial"!==e.diff.type)return;const t=e.diff.diff;this._preparePatchTransform(e,t),this._preparePatchColor(e,t)}updateGeometry(e,t){if(Object(a["j"])(this._resources))return!0;const i=t&&Object(Bt["d"])(t);if(Object(a["j"])(i))return!1;const r=this.getGeometryElevationMode(t);return e.elevationContext.mode===r&&(this._computeGlobalTransform(i,e.elevationContext,Es,Ms),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=Ms.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,Es,!0),Object(Bt["b"])(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,t){if(!(t.heading||t.tilt||t.roll||t.width||t.height||t.depth||t.anchor||t.anchorPosition))return;if(Object(a["j"])(this._resources))return;const i=(e,t,i)=>Object(a["s"])(null!=e&&"complete"===e.type?e.newValue:t,i),r=i(t.heading,this.symbolLayer.heading,0),n=i(t.tilt,this.symbolLayer.tilt,0),s=i(t.roll,this.symbolLayer.roll,0),o=i(t.width,this.symbolLayer.width,void 0),c=i(t.height,this.symbolLayer.height,void 0),l=i(t.depth,this.symbolLayer.depth,void 0),d=i(t.anchor,this.symbolLayer.anchor,void 0),h=i(t.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete t.heading,delete t.tilt,delete t.roll,delete t.width,delete t.height,delete t.depth,delete t.anchor,delete t.anchorPosition;const u={heading:r,tilt:n,roll:s,anchor:d,anchorPosition:h},p=this._resources;this.loadStatus===it.LOADED&&e.symbolLayerStatePatches.push(()=>{p.symbolSize=Object(U["g"])(Object(jn["d"])(p.resourceSize,{width:o,height:c,depth:l,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((e,t)=>{const i=this._computeLocalTransform(p,u,t,Rs),r=e.instanceIndex;p.lodRenderer.instanceData.setLocalTransform(r,i,!0)})}_preparePatchColor(e,t){if(!t.material||"partial"!==t.material.type)return;const i=t.material.diff;if(!i.color||"complete"!==i.color.type||null==i.color.newValue||null==i.color.oldValue)return;const r=i.color.newValue,n=Object(a["k"])(r)?y["a"].toUnitRGBA(r):rt["a"];delete i.color;const s=this._resources;Object(a["j"])(s)||e.graphics3DGraphicPatches.push(e=>{let t;this._hasPerInstanceColor()?(s.lodRenderer.instanceData.setColor(e.instanceIndex,n),t=this._setMaterialTransparencyParams({},r)):t=this._setMaterialTransparencyParams({externalColor:n},r);for(const i of s.stageResources.materials)i.setParameters(t)})}_requiresTerrainElevation(e){return"absolute-height"!==e.mode}_applyObjectRotation(e,t,i){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&t))return Object(Ae["b"])(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,t,i){const r=Object(U["f"])();switch(i.anchor){case"center":Object(V["g"])(r,Object(k["d"])(e)),Object(V["s"])(r,r);break;case"top":{const t=Object(k["d"])(e);Object(V["w"])(r,-t[0],-t[1],-e[5]);break}case"bottom":{const t=Object(k["d"])(e);Object(V["w"])(r,-t[0],-t[1],-e[2]);break}case"relative":{const t=Object(k["d"])(e),a=Object(k["z"])(e),n=i.anchorPosition,s=n?Object(U["h"])(n.x,n.y,n.z):U["c"];Object(V["b"])(r,a,s),Object(V["e"])(r,r,t),Object(V["s"])(r,r);break}default:Object(a["k"])(t)?Object(V["s"])(r,t):Object(V["g"])(r,U["c"])}return r}_applyAnchor(e,t,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const r=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,t);r&&Object(Te["j"])(i,i,r)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,t,i,r){const n=Object(a["k"])(e)?Object(U["g"])(Object(k["z"])(e)):U["a"],s=Object(a["k"])(e)?this._computeAnchor(e,r,this.symbolLayer):U["c"],o=this._context.renderCoordsHelper.unitInMeters,c=Object(Ae["c"])(Object(a["k"])(t)?t:void 0,t,i,o),l=Object(U["h"])(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:Object(a["k"])(t)?t:U["a"],unitInMeters:o,transformation:{anchor:s,scale:c,rotation:l}}}}const Ps=Object(U["f"])(),Rs=Object(we["d"])(),Es=Object(we["d"])(),Is=Object(rt["e"])(),Ms=new Ce["a"];var Ds=i("4212");function Ls(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Ns(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function Fs(e,t,i,r,a){return e[0]=t,e[1]=i,e[2]=r,e[3]=a,e}function zs(e,t){if(e===t){const i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function Gs(e,t){const i=t[0],r=t[1],a=t[2],n=t[3];let s=i*n-a*r;return s?(s=1/s,e[0]=n*s,e[1]=-r*s,e[2]=-a*s,e[3]=i*s,e):null}function Vs(e,t){const i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e}function Us(e){return e[0]*e[3]-e[2]*e[1]}function Bs(e,t,i){const r=t[0],a=t[1],n=t[2],s=t[3],o=i[0],c=i[1],l=i[2],d=i[3];return e[0]=r*o+n*c,e[1]=a*o+s*c,e[2]=r*l+n*d,e[3]=a*l+s*d,e}function ks(e,t,i){const r=t[0],a=t[1],n=t[2],s=t[3],o=Math.sin(i),c=Math.cos(i);return e[0]=r*c+n*o,e[1]=a*c+s*o,e[2]=r*-o+n*c,e[3]=a*-o+s*c,e}function Hs(e,t,i){const r=t[0],a=t[1],n=t[2],s=t[3],o=i[0],c=i[1];return e[0]=r*o,e[1]=a*o,e[2]=n*c,e[3]=s*c,e}function Ws(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e}function qs(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function $s(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Xs(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)}function Ys(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]}function Zs(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function Js(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function Qs(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Ks(e,t){const i=e[0],r=e[1],a=e[2],n=e[3],s=t[0],o=t[1],c=t[2],l=t[3];return Math.abs(i-s)<=Ds["a"]*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-o)<=Ds["a"]*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(a-c)<=Ds["a"]*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(n-l)<=Ds["a"]*Math.max(1,Math.abs(n),Math.abs(l))}function eo(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function to(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}const io=Bs,ro=Js;Object.freeze(Object.defineProperty({__proto__:null,copy:Ls,identity:Ns,set:Fs,transpose:zs,invert:Gs,adjoint:Vs,determinant:Us,multiply:Bs,rotate:ks,scale:Hs,fromRotation:Ws,fromScaling:qs,str:$s,frob:Xs,LDU:Ys,add:Zs,subtract:Js,exactEquals:Qs,equals:Ks,multiplyScalar:eo,multiplyScalarAndAdd:to,mul:io,sub:ro},Symbol.toStringTag,{value:"Module"}));var ao=i("47f8");class no extends kt["a"]{constructor(e,t,i,r,a,n){super(e,t),this.path=i,this.geometrySR=r,this.upVectorAlignment=a,this.stencilWidth=n}}function so(e){return"upVectorAlignment"in e}function oo(){return[1,0,0,1]}function co(e){return[e[0],e[1],e[2],e[3]]}function lo(e,t,i,r){return[e,t,i,r]}function ho(e,t){return new Float64Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:oo,clone:co,fromValues:lo,createView:ho},Symbol.toStringTag,{value:"Module"}));var uo=i("7289"),po=i("d18f");function bo(){return{up:Object(U["f"])(),right:Object(U["f"])()}}function fo(e,t,i){Object(V["q"])(e.up,t.up,i),Object(V["q"])(e.right,t.right,i)}function mo(e,t,i){Object(wi["a"])(e,Object(V["i"])(i,t.right),Object(V["i"])(i,t.up))}class go{constructor(){this.pos=Object(U["f"])(),this.posES=Object(U["f"])(),this.posGS=Object(U["f"])(),this.vRight=Object(U["f"])(),this.vLeft=Object(U["f"])(),this.frame=bo(),this.rotationFrame=bo(),this.rotationRight=Object(Se["c"])(),this.rotationAngle=0,this.miterStretch=oo()}setFrameFromUpVector(e){Object(V["g"])(this.frame.up,e),Object(V["e"])(Fo,this.vLeft,this.vRight),Object(V["r"])(Fo,Fo),Object(V["k"])(No,this.frame.up,Object(V["i"])(Fo,this.frame.up)),Object(V["f"])(Vo,Fo,No),Object(V["r"])(Vo,Vo),Object(V["j"])(this.frame.right,Vo,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){Object(V["g"])(this.rotationFrame.up,this.frame.up),Object(V["g"])(this.rotationFrame.right,this.frame.right),Object(wi["a"])(this.rotationRight,1,0),Object(V["k"])(No,this.frame.up,Object(V["i"])(this.frame.up,this.vLeft)),Object(V["f"])(No,this.vLeft,No),Object(V["s"])(No,No),Object(V["r"])(No,No),Object(V["k"])(Fo,this.frame.up,Object(V["i"])(this.frame.up,this.vRight)),Object(V["f"])(Fo,this.vRight,Fo),Object(V["r"])(Fo,Fo),Object(V["j"])(zo,this.rotationFrame.up,this.vLeft);const e=Math.sign(Object(V["i"])(zo,this.vRight));if(this.rotationAngle=e*(Math.PI-Object(Ar["b"])(Object(V["i"])(No,Fo))),Math.abs(this.rotationAngle)>0){const e=Object(Ar["p"])(Math.cos(.5*this.rotationAngle));Fs(this.miterStretch,e-1+1,0,0,1)}const t=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*t))}}class Oo{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(e,t){return this.vertices.push(Object(Se["f"])(e)),this.vertexNormals.push(Object(Se["f"])(t)),this.vertices.length-1}addUV(e){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(e),this.uvs.length-1}addPole(e,t=null){return this.poles.push({position:Object(Se["f"])(e),normal:t?Object(Se["f"])(t):null}),this.poles.length-1}addSegment(e,t=null,i=null){this.vertexIndices.push(e.v0),this.vertexIndices.push(e.v1),t&&(this.uvIndices.push(t.v0),this.uvIndices.push(t.v1)),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return null!=this.uvs}translate(e,t){for(const i of this.vertices)i[0]+=e,i[1]+=t;for(const i of this.poles)i.position[0]+=e,i.position[1]+=t}static circle(e=20){const t=.5,i=new Oo,r={v0:0,v1:0};i.addPole(Object(Se["g"])(0,0));for(let s=0;s<e;++s){const r=2*s*Math.PI/e,a=Math.cos(r),n=Math.sin(r),o=Object(Se["g"])(a*t,n*t),c=Object(Se["g"])(a,n);i.addVertex(o,c),i.addUV(s/e)}i.addUV(1);for(let s=0;s<e-1;++s){const e={v0:s,v1:s+1},t=e;i.addSegment(e,t,r)}const a={v0:e-1,v1:0},n={v0:e-1,v1:e};return i.addSegment(a,n,r),i}static rect(){const e=1,t=1,i=new Oo,r=Object(Se["g"])(.5*-e,.5*-t),a=Object(Se["g"])(.5*e,.5*-t),n=Object(Se["g"])(.5*e,.5*t),s=Object(Se["g"])(.5*-e,.5*t),o=Object(Se["g"])(0,-1),c=Object(Se["g"])(1,0),l=Object(Se["g"])(0,1),d=Object(Se["g"])(-1,0);i.addUV(0),i.addUV(1),i.addPole(Object(Se["g"])(0,.5*t),l),i.addPole(Object(Se["g"])(0,.5*t)),i.addPole(Object(Se["g"])(0,.5*-t)),i.addPole(Object(Se["g"])(0,.5*-t),o);const h={v0:0,v1:1};return i.addVertex(r,o),i.addVertex(a,o),i.addSegment({v0:0,v1:1},h,{v0:3,v1:3}),i.addVertex(a,c),i.addVertex(n,c),i.addSegment({v0:2,v1:3},h,{v0:2,v1:1}),i.addVertex(n,l),i.addVertex(s,l),i.addSegment({v0:4,v1:5},h,{v0:0,v1:0}),i.addVertex(s,d),i.addVertex(r,d),i.addSegment({v0:6,v1:7},h,{v0:1,v1:2}),i}}class vo{constructor(e){this.vertices=[],this.offset=Object(U["f"])(),this.xform=Object(we["d"])(),this.vertices=e;const t=Math.floor((e.length-1)/2);Object(V["g"])(this.offset,this.vertices[t].pos);for(const i of this.vertices)Object(V["f"])(i.pos,i.pos,this.offset);Object(Te["j"])(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length;let t=this.vertices[0];t.index=0,Object(V["w"])(t.vLeft,0,0,0),t.vLeftLength=0,Object(V["f"])(t.vRight,this.vertices[1].pos,t.pos),t.vRightLength=Object(V["p"])(t.vRight),Object(V["r"])(t.vRight,t.vRight);let i=t;for(let r=1;r<e;++r)t=this.vertices[r],t.index=r,Object(V["g"])(t.vLeft,i.vRight),t.vLeftLength=i.vRightLength,r<e-1?(Object(V["f"])(t.vRight,this.vertices[r+1].pos,t.pos),t.vRightLength=Object(V["p"])(t.vRight),Object(V["r"])(t.vRight,t.vRight)):(Object(V["g"])(t.vRight,t.vLeft),t.vRightLength=t.vLeftLength),i=t}}function yo(e,t){let i=null;const r=e.vertices.length,a=.99619469809,n=Object(U["f"])(),s=Object(U["f"])(),o=Object(U["f"])(),c=Object(U["f"])(),l=Object(U["f"])(),d=Object(U["f"])(),h=Object(uo["d"])();let u=e.vertices[0];Object(V["g"])(s,t),Object(V["w"])(n,0,1,0),ot["a"].makeOrthoBasisDirUpFallback(u.vRight,s,n,n,o,s,a),Object(V["g"])(u.frame.up,s),Object(V["g"])(u.frame.right,o),i=u;for(let p=1;p<r;++p){u=e.vertices[p],Object(V["e"])(l,u.vLeft,u.vRight);let t=Object(V["p"])(l);t>0?(t=1/Math.sqrt(t),l[0]=l[0]*t,l[1]=l[1]*t,l[2]=l[2]*t):(l[0]=u.vRight[0],l[1]=u.vRight[1],l[2]=u.vRight[2]),Object(V["e"])(d,i.pos,i.frame.up),Object(uo["g"])(u.pos,l,h),Object(uo["m"])(h,Object(po["g"])(d,u.vLeft),c)?(Object(V["f"])(c,c,u.pos),Object(V["r"])(s,c),Object(V["j"])(o,l,s),Object(V["r"])(o,o)):ot["a"].makeOrthoBasisDirUpFallback(l,i.frame.up,i.frame.right,n,o,s,a),Object(V["g"])(u.frame.up,s),Object(V["g"])(u.frame.right,o),i=u}}class _o{numProfilesPerJoin(){return 1}extrude(e,t,i){for(let r=0;r<t.vertices.length;++r)i(e.index,e.frame,t.vertices[r],t.vertexNormals[r],!1)}}class jo{constructor(e=.8*Math.PI,t=1){this.cutoffAngle=e,this.numBendSubdivisions=t}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,t,i){const r=Uo;if(Math.abs(e.rotationAngle)>=this.cutoffAngle)for(let a=0;a<this.numBendSubdivisions+1;++a){Object(Te["d"])(Bo,.5*-e.rotationAngle+a*e.rotationAngle/this.numBendSubdivisions,e.rotationFrame.up),fo(r,e.frame,Bo);for(let a=0;a<t.vertices.length;++a)Object(wi["h"])(t.vertices[a],e.rotationRight)*e.rotationAngle>=0?i(e.index,r,t.vertices[a],t.vertexNormals[a],!1):(Object(wi["p"])(Mo,t.vertices[a],e.miterStretch),i(e.index,e.frame,Mo,t.vertexNormals[a],!0))}else for(let a=0;a<this.numBendSubdivisions+1;++a)for(let r=0;r<t.vertices.length;++r){const a=Object(wi["h"])(t.vertices[r],e.rotationRight)*e.rotationAngle>=0;Object(wi["p"])(Mo,t.vertices[r],e.miterStretch),i(e.index,e.frame,Mo,t.vertexNormals[r],!a)}}}const xo={generateUV:!1};class So{rebuildConnectingProfileGeometry(e,t,i){for(let r=0;r<t.vertices.length;++r)i(e.index,e.frame,t.vertices[r],t.vertexNormals[r],0,0)}}class To extends So{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class wo extends So{constructor(e,t=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=t,this.flip=i}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,t,i){for(let r=0;r<t.vertices.length;++r)i(e.index,e.frame,t.vertices[r],t.vertexNormals[r],this.profilePlaneOffset,0)}rebuildCapGeometry(e,t){const i=Do;Object(wi["a"])(i,0,0);const r=this.flip?1:-1;for(let a=0;a<this.profile.vertices.length;++a)t(e.index,e.frame,this.profile.vertices[a],i,this.profilePlaneOffset,r)}buildTopology(e,t){const i=this.vertexBufferStart+this.profile.vertexIndices[0];for(let r=1;r<this.profile.numSegments;++r){const e=this.profile.vertexIndices[2*r+0],a=this.profile.vertexIndices[2*r+1],n=this.vertexBufferStart+e,s=this.vertexBufferStart+a;this.flip?t(s,n,i):t(i,n,s)}}}class Co extends So{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}getNumVertices(){let e=0;return e=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(e+=this.profile.vertices.length),e+=this.profile.poles.length,e}getNumIndices(){let e=0;e+=2*this.profile.numSegments*(this.numSegments-1);for(let t=0;t<this.profile.numSegments;++t){const i=this.profile.vertexIndices[2*t+0],r=this.profile.vertexIndices[2*t+1];this.profile.poleIndices[i]===this.profile.poleIndices[r]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,t){const i=e.frame,r=.5*this.sign,a=Mo,n=Do;Object(wi["a"])(n,0,0);for(let s=0;s<this.profile.poles.length;++s){const a=this.profile.poles[s];a.normal?t(e.index,i,a.position,a.normal,r,0):t(e.index,i,a.position,n,r,this.sign)}if(this.breakNormals)for(let s=0;s<this.profile.vertices.length;++s)t(e.index,i,this.profile.vertices[s],this.profile.vertexNormals[s],0,0);for(let s=0;s<this.numSegments-1;++s){const o=(1-(s+1)/this.numSegments)*Math.PI*.5,c=Math.sin(o),l=Math.cos(o);for(let s=0;s<this.profile.vertices.length;++s){const o=this.profile.poles[this.profile.poleIndices[s]];Object(wi["g"])(a,this.profile.vertices[s],o.position),Object(wi["f"])(a,a,c),o.normal?(Object(wi["b"])(a,a,o.position),t(e.index,i,a,o.normal,r*l,0)):(Object(wi["i"])(n,a),Object(wi["f"])(n,n,c),Object(wi["b"])(a,a,o.position),t(e.index,i,a,n,r*l,this.sign*l))}}}buildTopology(e,t){const i=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let a=0;a<this.profile.numSegments;++a){const e=this.profile.vertexIndices[2*a+0],n=this.profile.vertexIndices[2*a+1],s=this.vertexBufferStart+this.profile.poleIndices[e],o=this.vertexBufferStart+this.profile.poleIndices[n];let c=i+e,l=i+n;for(let i=0;i<this.numSegments-1;++i){const a=r+i*this.profile.vertices.length+e,s=r+i*this.profile.vertices.length+n;this.flip?(t(a,l,c),t(l,a,s)):(t(c,l,a),t(s,a,l)),c=a,l=s}this.flip?(t(s,l,c),s!==o&&t(s,o,l)):(t(c,l,s),s!==o&&t(l,o,s))}}}class Ao{constructor(e,t,i,r,a,n=xo){this.options=n,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=t,this.path=e,this.extruder=i,this.startCap=r,this.endCap=a;const s=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*s+2,this.numVerticesTotal=t.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const o=this.startCap.getNumVertices();this.numVerticesTotal+=o,this.numNormalsTotal+=o,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,t,i,r,a){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=r[1],this.pathVertexData[this._extrusionVertexCount]=e,a){const t=this.path.vertices[e];this.profileRightAxisData[4*this._extrusionVertexCount+3]=t.rotationRight[0]*t.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=t.rotationRight[1]*t.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(e,t,i,r,a,n){this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=r[1],this.pathVertexData[this._extrusionVertexCount]=e,this.profileRightAxisData[4*this._extrusionVertexCount+3]=a,this.profileUpAxisData[4*this._extrusionVertexCount+3]=n,++this._extrusionVertexCount}emitTriangle(e,t,i){this.vertexIndices[3*this._triangleCount+0]=e,this.vertexIndices[3*this._triangleCount+1]=t,this.vertexIndices[3*this._triangleCount+2]=i,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[e],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[i],this.normalIndices[3*this._triangleCount+0]=e,this.normalIndices[3*this._triangleCount+1]=t,this.normalIndices[3*this._triangleCount+2]=i,++this._triangleCount}_rebuildGeometry(){const e=(e,t,i,r,a)=>this.emitVertex(e,t,i,r,a),t=(e,t,i,r,a,n)=>this.emitCapVertex(e,t,i,r,a,n);this._extrusionVertexCount=0;for(const i of this.path.vertices)this.originData[3*i.index+0]=i.pos[0],this.originData[3*i.index+1]=i.pos[1],this.originData[3*i.index+2]=i.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,t);for(let i=1;i<this.path.vertices.length-1;++i)this.extruder.extrude(this.path.vertices[i],this.profile,e);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,t),this.startCap.rebuildCapGeometry(this.path.vertices[0],t),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],t),this.profile.hasUV()&&this.options.generateUV)for(let i=0;i<this.profile.uvs.length;++i)this.uvData[2*i+0]=this.profile.uvs[i],this.uvData[2*i+1]=0}buildTopology(){const e=(e,t,i)=>this.emitTriangle(e,t,i);this._triangleCount=0;const t=this.profile.vertices.length,i=this.profile.numSegments,r=this.numExtrusionProfiles-1;let a=i*r*2*3;this.startCap.indexBufferStart=a,this.startCap.firstProfileVertexIndex=0,a+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=a,this.endCap.firstProfileVertexIndex=t*(this.numExtrusionProfiles-1),a+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(a),this.normalIndices=new Uint32Array(a),this.pathVertexIndices=new Uint32Array(a),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(a));for(let n=0;n<i;++n){const i=this.profile.vertexIndices[2*n],a=this.profile.vertexIndices[2*n+1];for(let n=0;n<r;++n){const r=n*t+i,s=(n+1)*t+a,o=n*t+a;e(r,(n+1)*t+i,s),e(r,s,o)}}this.startCap.buildTopology(this.path.vertices[0],e),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],e)}onPathChanged(){this._rebuildGeometry()}}class Po{constructor(e){this.builder=e}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class Ro extends Po{constructor(e){super(e),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;for(let t=0;t<this.builder.numVerticesTotal;++t){let i=this.builder.pathVertexData[t];const r=0===i||i===this.builder.path.vertices.length-1;i*=3;const a=Io;Object(V["w"])(a,this.builder.originData[i++],this.builder.originData[i++],this.builder.originData[i]);const n=4*t,s=No,o=Mo,c=Fo,l=zo,d=Go;let h=0,u=0;if(Object(V["w"])(l,this.builder.profileRightAxisData[n],this.builder.profileRightAxisData[n+1],this.builder.profileRightAxisData[n+2]),Object(V["w"])(d,this.builder.profileUpAxisData[n],this.builder.profileUpAxisData[n+1],this.builder.profileUpAxisData[n+2]),Object(wi["a"])(o,this.builder.profileVertexAndNormalData[n]*e[0],this.builder.profileVertexAndNormalData[n+1]*e[1]),r)Object(V["j"])(c,d,l),h=this.builder.profileRightAxisData[n+3]*e[0],u=this.builder.profileUpAxisData[n+3];else{const e=Do,t=Lo;Object(wi["a"])(e,this.builder.profileRightAxisData[n+3],this.builder.profileUpAxisData[n+3]);const i=Object(wi["o"])(e);Object(wi["i"])(e,e);const r=Object(wi["h"])(o,e);if(Math.abs(r)>i){Object(wi["a"])(t,-e[1],e[0]);const a=Object(wi["h"])(o,t);Object(wi["f"])(e,e,i*Math.sign(r)),Object(wi["f"])(t,t,a),Object(wi["b"])(o,e,t)}Object(V["w"])(c,0,0,0)}Object(V["w"])(s,l[0]*o[0]+d[0]*o[1],l[1]*o[0]+d[1]*o[1],l[2]*o[0]+d[2]*o[1]),this.vertexAttributePosition[3*t+0]=a[0]+s[0]+c[0]*h,this.vertexAttributePosition[3*t+1]=a[1]+s[1]+c[1]*h,this.vertexAttributePosition[3*t+2]=a[2]+s[2]+c[2]*h;const p=Mo;Object(wi["a"])(p,this.builder.profileVertexAndNormalData[n+2],this.builder.profileVertexAndNormalData[n+3]),this.vertexAttributeNormal[3*t+0]=l[0]*p[0]+d[0]*p[1]+c[0]*u,this.vertexAttributeNormal[3*t+1]=l[1]*p[0]+d[1]*p[1]+c[1]*u,this.vertexAttributeNormal[3*t+2]=l[2]*p[0]+d[2]*p[1]+c[2]*u}}createGeometryData(){const e=[[Ee["a"].POSITION,this.builder.vertexIndices],[Ee["a"].NORMAL,this.builder.normalIndices]],t=[[Ee["a"].POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[Ee["a"].NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){const i=this.builder.vertexIndices.length;e.push([Ee["a"].COLOR,new Uint32Array(i)]),t.push([Ee["a"].COLOR,{size:4,data:this.vertexAttributeColor}])}return{vertexAttributes:t,indices:e}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(e,t,i){const r=this.builder.vertexIndices,a={size:3,data:this.vertexAttributePosition},n=r.length/3;Object(ps["f"])(e,t,0,n,r,a,void 0,void 0,i)}}class Eo extends Po{constructor(e,t,i,r){super(e),this.sizeAttributeValue=t,this.colorAttributeValue=i,this.opacityAttributeValue=r,this.vvData=null,this.baked=new Ro(e),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let a=0;a<this.builder.path.vertices.length;++a){this.vvData[4*a+0]=t,this.vvData[4*a+1]=i,this.vvData[4*a+2]=r;const e=0===a||a===this.builder.path.vertices.length-1;this.vvData[4*a+3]=e?1:0}}createGeometryData(){return{vertexAttributes:[[Ee["a"].POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[Ee["a"].PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[Ee["a"].PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[Ee["a"].PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[Ee["a"].FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[Ee["a"].POSITION,this.builder.pathVertexIndices],[Ee["a"].PROFILERIGHT,this.builder.vertexIndices],[Ee["a"].PROFILEUP,this.builder.vertexIndices],[Ee["a"].PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[Ee["a"].FEATUREVALUE,this.builder.pathVertexIndices]]}}}const Io=Object(U["f"])(),Mo=Object(Se["c"])(),Do=Object(Se["c"])(),Lo=Object(Se["c"])(),No=Object(U["f"])(),Fo=Object(U["f"])(),zo=Object(U["f"])(),Go=Object(U["f"])(),Vo=Object(U["f"])(),Uo=bo(),Bo=Object(we["d"])();var ko=i("aab5"),Ho=i("b49d"),Wo=i("a7d7"),qo=i("6a21"),$o=i("af20");const Xo=new Map([[Ee["a"].POSITION,0],[Ee["a"].PROFILERIGHT,1],[Ee["a"].PROFILEUP,2],[Ee["a"].PROFILEVERTEXANDNORMAL,3],[Ee["a"].FEATUREVALUE,4]]);class Yo extends Ho["b"]{constructor(){super(...arguments),this.ambient=Object(U["h"])(.2,.2,.2),this.diffuse=Object(U["h"])(.8,.8,.8),this.specular=Object(U["h"])(0,0,0),this.opacity=1}}class Zo extends ei["a"]{initializeConfiguration(e,t){t.spherical=e.viewingMode===Qt["a"].Global,t.doublePrecisionRequiresObfuscation=Object(qo["b"])(e.rctx)}initializeProgram(e){const t=Zo.shader.get().build(this.configuration);return new ii["a"](e.rctx,t,Xo)}_setPipelineState(e){const t=this.configuration,i=e===Xe["i"].NONE,r=e===Xe["i"].FrontFace,a=e=>!e.hasSlicePlane&&!(e.transparent||e.doubleSidedMode===ko["b"].None);return Object(ni["f"])({blending:t.output!==$t["a"].Color&&t.output!==$t["a"].Alpha||!t.transparent?null:i?Ga["d"]:Object(Ga["f"])(e),culling:a(t)&&ni["e"],depthTest:{func:Object(Ga["g"])(e)},depthWrite:i||r?ni["d"]:null,colorWrite:ni["c"],stencilWrite:t.hasOccludees?Va["h"]:null,stencilTest:t.hasOccludees?Va["c"]:null,polygonOffset:i||r?null:Ga["a"]})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}Zo.shader=new Kt["a"]($o["a"],()=>i.e("chunk-2d0c7e33").then(i.bind(null,"5310")));class Jo extends ci["a"]{constructor(){super(...arguments),this.output=$t["a"].Color,this.doubleSidedMode=ko["b"].None,this.transparencyPassType=Xe["i"].NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}}Object(r["a"])([Object(oi["b"])({count:$t["a"].COUNT})],Jo.prototype,"output",void 0),Object(r["a"])([Object(oi["b"])({count:ko["b"].COUNT})],Jo.prototype,"doubleSidedMode",void 0),Object(r["a"])([Object(oi["b"])({count:Xe["i"].COUNT})],Jo.prototype,"transparencyPassType",void 0),Object(r["a"])([Object(oi["b"])()],Jo.prototype,"spherical",void 0),Object(r["a"])([Object(oi["b"])()],Jo.prototype,"receiveShadows",void 0),Object(r["a"])([Object(oi["b"])()],Jo.prototype,"receiveAmbientOcclusion",void 0),Object(r["a"])([Object(oi["b"])()],Jo.prototype,"vvSize",void 0),Object(r["a"])([Object(oi["b"])()],Jo.prototype,"vvColor",void 0),Object(r["a"])([Object(oi["b"])()],Jo.prototype,"vvOpacity",void 0),Object(r["a"])([Object(oi["b"])()],Jo.prototype,"hasSlicePlane",void 0),Object(r["a"])([Object(oi["b"])()],Jo.prototype,"transparent",void 0),Object(r["a"])([Object(oi["b"])()],Jo.prototype,"hasOccludees",void 0),Object(r["a"])([Object(oi["b"])()],Jo.prototype,"hasMultipassTerrain",void 0),Object(r["a"])([Object(oi["b"])()],Jo.prototype,"cullAboveGround",void 0),Object(r["a"])([Object(oi["b"])()],Jo.prototype,"doublePrecisionRequiresObfuscation",void 0),Object(r["a"])([Object(oi["b"])({constValue:Wo["a"].Disabled})],Jo.prototype,"pbrMode",void 0),Object(r["a"])([Object(oi["b"])({constValue:!0})],Jo.prototype,"hasVvInstancing",void 0),Object(r["a"])([Object(oi["b"])({constValue:!1})],Jo.prototype,"useCustomDTRExponentForWater",void 0),Object(r["a"])([Object(oi["b"])({constValue:!1})],Jo.prototype,"useFillLights",void 0);class Qo extends Ht["a"]{constructor(e){super(e,new ec),this.supportsEdges=!0,this._vertexAttributeLocations=Xo,this._configuration=new Jo,this.vertexBufferLayout=Qo.getVertexBufferLayout(this.parameters)}getConfiguration(e,t){return this._configuration.output=e,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==$t["a"].Color&&e!==$t["a"].Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?ko["b"].View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?ko["b"].WindingOrder:ko["b"].None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!t.ssaoHelper.ready&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}isVisibleInPass(e){return e!==Un["a"].MATERIAL_DEPTH_SHADOWMAP_ALL&&e!==Un["a"].MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&e!==Un["a"].MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const e=this.parameters;return!!super.isVisible()&&e.opacity>0}intersect(e,t,i,r,n,s,o){const c=e;if(!so(c))return;const l=c.path,d=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const e=this.parameters.vvSizeOffset,t=this.parameters.vvSizeFactor,i=this.parameters.vvSizeMinSize,r=this.parameters.vvSizeMaxSize,a=l.sizeAttributeValue;d[0]*=Object(Ar["e"])(e[0]+a*t[0],i[0],r[0]),d[1]*=Object(Ar["e"])(e[2]+a*t[2],i[2],r[2])}const h=Math.max(d[0],d[1]),u=e.boundingInfo;if(Object(a["j"])(u))return void this._intersectTriangles(l,d,n,s,o);const p=Object(k["p"])(u.bbMin[0]-h,u.bbMin[1]-h,u.bbMin[2]-h,u.bbMax[0]+h,u.bbMax[1]+h,u.bbMax[2]+h),b=[s[0]-n[0],s[1]-n[1],s[2]-n[2]],f=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]),m=[f/b[0],f/b[1],f/b[2]];Object(ps["c"])(p,n,m,r.tolerance)&&this._intersectTriangles(l,d,n,s,o)}_intersectTriangles(e,t,i,r,a){e.baked.size&&e.baked.size[0]===t[0]&&e.baked.size[1]===t[1]||e.baked.bake(t),e.baked.intersect(i,r,a)}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return null;const r=i.get(Ee["a"].POSITION);return Object(cn["a"])(r,null,!1,t)}createBufferWriter(){return new tc(this.vertexBufferLayout)}requiresSlot(e){return e===(this.parameters.transparent?Zt["a"].TRANSPARENT_MATERIAL:Zt["a"].OPAQUE_MATERIAL)||e===Zt["a"].DRAPED_MATERIAL}createGLMaterial(e){return e.output===$t["a"].Color||e.output===$t["a"].Alpha||e.output===$t["a"].Depth||e.output===$t["a"].Normal||e.output===$t["a"].Highlight||e.output===$t["a"].Shadow&&this.parameters.castShadows?new Ko(e):null}static getVertexBufferLayout(e){let t=Object(qt["a"])().vec3f(Ee["a"].POSITION).vec4f(Ee["a"].PROFILERIGHT).vec4f(Ee["a"].PROFILEUP).vec4f(Ee["a"].PROFILEVERTEXANDNORMAL);return(e.vvColorEnabled||e.vvSizeEnabled||e.vvOpacityEnabled)&&(t=t.vec4f(Ee["a"].FEATUREVALUE)),t}}class Ko extends Yt["a"]{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){(Object(a["j"])(this.technique)||e.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==$t["a"].Color&&this._output!==$t["a"].Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(Zo,e)}}class ec extends Yo{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}class tc{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(Ee["a"].POSITION).length}write(e,t,i,r){const a=e=>{if(t.vertexAttributes.has(e)){const a=t.vertexAttributes.get(e),n=t.indices.get(e);Object(Bn["a"])(4===a.size);const s=i.getField(e,Ni["C"]);if(!s)throw new Error("unable to acquire view for "+e);Object(Jt["a"])(n,a.data,s,r)}};a(Ee["a"].PROFILERIGHT),a(Ee["a"].PROFILEUP),a(Ee["a"].PROFILEVERTEXANDNORMAL),this.vertexBufferLayout.hasField(Ee["a"].FEATUREVALUE)&&a(Ee["a"].FEATUREVALUE),Object(Jt["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r)}}const ic=["polyline"];class rc extends Nt{constructor(e,t,i,r){super(e,t,i,r),this._intrinsicSize=Object(Se["g"])(1,1),this.upVectorAlignment="path",this.stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const e=Object(a["k"])(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,t=Object(a["k"])(this.symbolLayer.height)?this.symbolLayer.height:e;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[e,1,t],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=ha(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const i=this.symbolLayer.anchor||"center";this.upVectorAlignment="path","heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");const r=this.symbolLayer.profile||"circle";switch(r){case"circle":default:this._profile=Oo.circle(mc);break;case"quad":this._profile=Oo.rect()}let n=[0,0];switch("center"!==i&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[i],this._profile.translate(n[0],n[1])),this.symbolLayer.join||"simple"){case"round":this._extruder=new jo(0,bc);break;case"bevel":this._extruder=new jo(0,1);break;case"miter":this._extruder=new jo(.8*Math.PI,1);break;default:this._extruder=new _o}const s=this.symbolLayer.cap||"butt";switch(s){case"none":this._startCap=new To,this._endCap=new To;break;case"butt":default:this._startCap=new wo(this._profile,0),this._endCap=new wo(this._profile,0,!0);break;case"square":this._startCap=new wo(this._profile,-.5),this._endCap=new wo(this._profile,.5,!0);break;case"round":{const e="quad"===r;this._startCap=new Co({profile:this._profile,flip:!1,breakNormals:e,subdivisions:fc}),this._endCap=new Co({profile:this._profile,flip:!0,breakNormals:e,subdivisions:fc});break}}const o=Object(a["i"])(this.symbolLayer,"material","color"),c=this._getCombinedOpacityAndColor(o),l=Object(U["g"])(c),d=c[3],h=d<1||this.needsDrivenTransparentPass,u={diffuse:l,ambient:l,opacity:d,transparent:h,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:h||"none"===s?Xe["b"].None:Xe["b"].Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(Object(wi["a"])(this._intrinsicSize,e,t),!Object(Ae["f"])(this._intrinsicSize[0])||!Object(Ae["f"])(this._intrinsicSize[1])))throw new D["a"]("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||Object(wi["f"])(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const e={...u,...this._fastUpdates.materialParameters,size:Object(Se["d"])(this._intrinsicSize)};this._material=new Qo(e)}else u.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new Yi["a"](u);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,ic,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(t,new qe["a"]),r=e.renderingInfo;return this._createAs3DShape(t,r,i,t.uid)}layerOpacityChanged(){const e=Object(a["i"])(this.symbolLayer,"material","color"),t=this._getCombinedOpacity(e),i=t<1||this.needsDrivenTransparentPass;return this._material.setParameters({opacity:t,transparent:i}),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,Ce["i"])}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(e,t){for(const i in e.diff){if("visualVariables"!==i)return tt.Recreate_Symbol;if(!ua(this._fastUpdates,t,this._vvConvertOptions))return tt.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return tt.Fast_Update}getVertexData(e){let t=0;const i=e.paths,r=[],a=e.spatialReference,n=this._context.elevationProvider.spatialReference,s=this._context.renderCoordsHelper.spatialReference;for(const u of i)t+=u.length;const o=new Float64Array(3*t),c=new Float64Array(3*t),l=new Float64Array(3*t);let d=0;for(const u of i){r.push({index:d,numVertices:u.length});for(const t of u)o[d++]=t[0],o[d++]=t[1],o[d++]=e.hasZ?t[2]:0}let h=!0;return a.equals(n)?this._copyVertices(o,0,c,0,t):h=Object(B["l"])(o,a,0,c,n,0,t),n.equals(s)?this._copyVertices(c,0,l,0,t):Object(B["l"])(c,n,0,l,s,0,t),{pathVertexDataInfos:r,vertexDataGS:o,vertexDataES:c,vertexDataRS:l,projectionSuccess:h,terrainElevation:0}}_copyVertices(e,t,i,r,a){t*=3,r*=3;for(let n=0;n<a;++n)i[r++]=e[t++],i[r++]=e[t++],i[r++]=e[t++]}_createAs3DShape(e,t,i,r){const n=e.geometry,s=new Array,o=new Array,c=new Array,l=n.spatialReference,d=Object(k["f"])(),h=this._context.renderCoordsHelper;lc.spatialReference=l;const u=this.getVertexData(n);if(!u.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(u.pathVertexDataInfos.length>0){for(let r=0;r<u.pathVertexDataInfos.length;++r){const n=u.pathVertexDataInfos[r],p=n.index,b=n.numVertices;if(b<2)continue;if(Object(a["k"])(this._context.clippingExtent)&&(Object(k["h"])(d),Object(k["k"])(d,u.vertexDataES,3*p,b),!Object(k["r"])(d,this._context.clippingExtent)))continue;const f=[];for(let e=p;e<p+3*b;){const t=e++,r=e++,a=e++,n=new go;Object(V["w"])(n.posGS,u.vertexDataGS[t],u.vertexDataGS[r],u.vertexDataGS[a]),Object(V["w"])(n.posES,u.vertexDataES[t],u.vertexDataES[r],u.vertexDataES[a]);const s=Object(Ce["f"])(n.posES,this._context.elevationProvider,i,h);Object(V["w"])(dc,u.vertexDataRS[t],u.vertexDataRS[r],u.vertexDataRS[a]),h.setAltitude(dc,s),Object(V["w"])(n.pos,dc[0],dc[1],dc[2]),f.push(n)}const m=new vo(f);ac(m,this.upVectorAlignment,this._context.renderCoordsHelper);const g=new Ao(m,this._profile,this._extruder,this._startCap,this._endCap);let O=null;if(this._fastUpdates.enabled){const t=this._fastUpdates.visualVariables,i=t.size?Ft(t.size.field,e):0,r=t.color?Ft(t.color.field,e):0,a=t.opacity?Ft(t.opacity.field,e):0;O=new Eo(g,i,r,a)}else{const e=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(e[0]*=nc(t.size[0],"symbol-value"===t.size[2]?this.symbolLayer.height||0:t.size[2],this.symbolLayer.width||0),e[1]*=nc(t.size[2],"symbol-value"===t.size[0]?this.symbolLayer.width||0:t.size[0],this.symbolLayer.height||0));let i=null;this._drivenProperties.color&&(i=t.color),this._drivenProperties.opacity&&null!=t.opacity&&(i=i?[i[0],i[1],i[2],t.opacity]:[1,1,1,t.opacity]);const r=new Ro(g);r.bake(e),i&&r.bakeVertexColors(i),O=r}const{vertexAttributes:v,indices:y}=O.createGeometryData(),_=new no(v,y,O,l,this.upVectorAlignment,this.stencilWidth);s.push(_),o.push(this._material),c.push(O.xform)}if(s.length>0){const e={layerUid:this._context.layer.uid,graphicUid:r},t=new Xi["a"]({geometries:s,materials:o,transformations:c,metadata:e}),a=new Ye(this,t,s,null,null,oc,i);return a.alignedSampledElevation=u.terrainElevation,a.needsElevationUpdates=Object(Ce["i"])(i.mode),a}}else 0!==n.paths.length&&n.paths.some(e=>e.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}function ac(e,t,i){switch(t){case"world":for(const t of e.vertices)Object(V["e"])(hc,t.pos,e.offset),i.worldUpAtPosition(hc,dc),t.setFrameFromUpVector(dc),t.computeRotationAxisAndAngleFromUpVector();break;case"path":Object(V["e"])(hc,e.vertices[0].pos,e.offset),i.worldUpAtPosition(hc,dc),yo(e,dc);for(const t of e.vertices){const e=Math.sign(Object(V["i"])(t.frame.right,t.vRight));Object(V["j"])(t.rotationFrame.up,t.vRight,t.vLeft),Object(V["k"])(t.rotationFrame.up,t.rotationFrame.up,e),Object(V["r"])(t.rotationFrame.up,t.rotationFrame.up);const i=Object(V["i"])(t.rotationFrame.up,t.frame.up),r=Object(V["i"])(t.rotationFrame.up,t.frame.right);if(Object(V["k"])(hc,t.frame.up,-r),Object(V["k"])(uc,t.frame.right,i),Object(V["e"])(hc,hc,uc),Object(V["r"])(t.rotationFrame.right,hc),mo(t.rotationRight,t.frame,t.rotationFrame.right),Object(V["s"])(hc,t.vLeft),t.rotationAngle=-e*(Math.PI-Object(Ar["b"])(Object(V["i"])(hc,t.vRight))),Math.abs(t.rotationAngle)>0){const e=Object(Ar["p"])(Math.cos(.5*t.rotationAngle));Fs(t.miterStretch,1+(e-1)*t.rotationRight[0]*t.rotationRight[0],(e-1)*t.rotationRight[0]*t.rotationRight[1],(e-1)*t.rotationRight[0]*t.rotationRight[1],1+(e-1)*t.rotationRight[1]*t.rotationRight[1])}const a=Math.PI-t.rotationAngle;t.maxStretchDistance=Math.abs(Math.min(t.vLeftLength,t.vRightLength)*Object(Ar["p"])(Math.cos(.5*a)))}}}function nc(e,t,i){switch(e){case"symbol-value":return i;case"proportional":return t;default:return e}}function sc(e,t,i,r){let a=0;for(const n of e.vertices)Object(Ce["g"])(n.posES,i,t,r,pc),a+=pc.sampledElevation,Object(V["e"])(dc,n.pos,e.offset),r.setAltitude(dc,pc.z),Object(V["f"])(n.pos,dc,e.offset);return e.updatePathVertexInformation(),a/e.vertices.length}function oc(e,t,i,r){const a=e.stageObject,n=a.geometryRecords;let s=0;cc.spatialReference=r.spatialReference;for(const o of n){const e=o.geometry;if(!so(e))continue;const n=e.path,c=n.builder.path,l=e.geometrySR;lc.spatialReference=l,s+=sc(c,t,i,r),"world"!==e.upVectorAlignment&&ac(c,e.upVectorAlignment,r),n.onPathChanged(),e.invalidateBoundingInfo(),a.geometryVertexAttrsUpdated(o)}return s/n.length}const cc=Object(W["g"])(0,0,0,null),lc=Object(W["g"])(0,0,0,null),dc=Object(U["f"])(),hc=Object(ao["b"])(),uc=Object(ao["b"])(),pc=new Ce["a"],bc=3,fc=3,mc=10;var gc=i("f694");function Oc(e,t,i,r,a=1){if(i.isGeographic&&r===Qt["a"].Global){const e=new Float64Array(t.typedBuffer.length),r=3*t.count,a=Object(gc["e"])(i);for(let i=0;i<r;i+=3)Object(B["i"])(t.typedBuffer,i,e,i,a);t=Ni["v"].fromTypedArray(e)}Object(wi["a"])(wc,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let o=0;o<t.count;o++)t.getVec(o,_c),wc[0]=Math.min(wc[0],_c[0]),wc[1]=Math.min(wc[1],_c[1]);const n=wc[0]%a,s=wc[1]%a;Ac[0]=wc[0]-n,Ac[1]=wc[1]-s;for(let o=0;o<t.count;o++)t.getVec(o,_c),e.setValues(o,(_c[0]-Ac[0])/a,(_c[1]-Ac[1])/a,Ac[0]/a,Ac[1]/a)}function vc(e,t,i,r,a=1){Object(V["w"])(xc,1,0,0),Object(V["w"])(Sc,0,1,0),Object(V["w"])(Tc,0,0,1),zc(yc,t),Ic(t,jc)&&Mc(jc,xc,Sc,Tc,i,yc),Object(wi["a"])(wc,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Object(wi["a"])(Cc,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let c=0;c<t.count;c++){t.getVec(c,_c);const e=Object(V["i"])(xc,_c),i=Object(V["i"])(Sc,_c);wc[0]=Math.min(wc[0],e),wc[1]=Math.min(wc[1],i),Cc[0]=Math.max(Cc[0],e),Cc[1]=Math.max(Cc[1],i)}const n=Object(V["i"])(Tc,yc);Vc(Pc,wc[0],wc[1],n,xc,Sc,Tc),Vc(Rc,Cc[0],wc[1],n,xc,Sc,Tc),Vc(Ec,wc[0],Cc[1],n,xc,Sc,Tc),Object(V["f"])(Rc,Rc,Pc),Object(V["k"])(Rc,Rc,.5),Object(V["f"])(Ec,Ec,Pc),Object(V["k"])(Ec,Ec,.5),Object(V["e"])(Pc,Pc,Rc),Object(V["e"])(Pc,Pc,Ec);const s=wc[0]%a,o=wc[1]%a;Ac[0]=wc[0]-s,Ac[1]=wc[1]-o;for(let c=0;c<t.count;c++){t.getVec(c,_c),e.setValues(c,(Object(V["i"])(xc,_c)-Ac[0])/a,(Object(V["i"])(Sc,_c)-Ac[1])/a,Ac[0]/a,Ac[1]/a);for(let e=0;e<3;e++)r.set(c,e,Pc[e]),r.set(c,e+3,Rc[e]),r.set(c,e+6,Ec[e])}}const yc=Object(U["f"])(),_c=Object(U["f"])(),jc=Object(uo["d"])(),xc=Object(U["f"])(),Sc=Object(U["f"])(),Tc=Object(U["f"])(),wc=Object(Se["c"])(),Cc=Object(Se["c"])(),Ac=Object(Se["c"])(),Pc=Object(U["f"])(),Rc=Object(U["f"])(),Ec=Object(U["f"])();function Ic(e,t){const i=e.count-1;return Object(uo["e"])(e,t,0,Math.floor(i/3),Math.floor(i*(2/3)))}function Mc(e,t,i,r,n,s){Object(a["k"])(n)?(n.basisMatrixAtPosition(s,Dc),Object(V["w"])(Lc,Dc[0],Dc[1],Dc[2]),Object(V["w"])(Nc,Dc[4],Dc[5],Dc[6]),Object(V["w"])(Fc,Dc[8],Dc[9],Dc[10])):(Object(V["w"])(Lc,1,0,0),Object(V["w"])(Nc,0,1,0),Object(V["w"])(Fc,0,0,1));const o=Object(uo["q"])(e);Object(V["i"])(o,Fc)<0&&Object(V["k"])(o,o,-1),Object(V["g"])(r,o);const c=Object(V["i"])(o,Nc),l=Object(V["i"])(o,Lc);Math.abs(c)<Math.abs(l)?(Object(V["a"])(t,Lc,o,-l),Object(V["r"])(t,t),Object(V["j"])(i,t,o),Object(V["r"])(i,i),Object(V["k"])(i,i,-1)):(Object(V["a"])(i,Nc,o,-c),Object(V["r"])(i,i),Object(V["j"])(t,i,o),Object(V["r"])(t,t))}const Dc=Object(we["d"])(),Lc=Object(U["f"])(),Nc=Object(U["f"])(),Fc=Object(U["f"])();function zc(e,t){Object(V["w"])(Gc,0,0,0);for(let i=0;i<t.count-1;i++)t.getVec(i,_c),Object(V["e"])(Gc,Gc,_c);Object(V["k"])(e,Gc,1/(t.count-1))}const Gc=Object(U["f"])();function Vc(e,t,i,r,a,n,s){Object(V["w"])(e,t*a[0]+i*n[0]+r*s[0],t*a[1]+i*n[1]+r*s[1],t*a[2]+i*n[2]+r*s[2])}var Uc=i("d36e"),Bc=i("37e4"),kc=i("8675"),Hc=i("aeb3");class Wc extends ei["a"]{initializeProgram(e){const t=Wc.shader.get().build(this.configuration);return new ii["a"](e.rctx,t,Xc)}_setPipelineState(e,t){const i=this.configuration,r=e===Xe["i"].NONE,a=e===Xe["i"].FrontFace;return Object(ni["f"])({blending:i.output===$t["a"].Color||i.output===$t["a"].Alpha?r?Ga["d"]:Object(Ga["f"])(e):null,culling:Object(ni["b"])(i.cullFace),depthTest:{func:Object(Ga["g"])(e)},depthWrite:r?i.writeDepth&&ni["d"]:Object(Ga["h"])(e),colorWrite:ni["c"],stencilWrite:i.hasOccludees?Va["h"]:null,stencilTest:i.hasOccludees?t?Va["d"]:Va["c"]:null,polygonOffset:r||a?i.polygonOffset&&qc:Object(Ga["e"])(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}Wc.shader=new Kt["a"](Hc["a"],()=>i.e("chunk-2d208701").then(i.bind(null,"a590")));const qc={factor:1,units:1};class $c extends ci["a"]{constructor(){super(...arguments),this.output=$t["a"].Color,this.cullFace=Xe["b"].None,this.transparencyPassType=Xe["i"].NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}Object(r["a"])([Object(oi["b"])({count:$t["a"].COUNT})],$c.prototype,"output",void 0),Object(r["a"])([Object(oi["b"])({count:Xe["b"].COUNT})],$c.prototype,"cullFace",void 0),Object(r["a"])([Object(oi["b"])({count:Bc["a"].COUNT})],$c.prototype,"style",void 0),Object(r["a"])([Object(oi["b"])({count:Xe["i"].COUNT})],$c.prototype,"transparencyPassType",void 0),Object(r["a"])([Object(oi["b"])()],$c.prototype,"hasSlicePlane",void 0),Object(r["a"])([Object(oi["b"])()],$c.prototype,"hasVertexColors",void 0),Object(r["a"])([Object(oi["b"])()],$c.prototype,"polygonOffset",void 0),Object(r["a"])([Object(oi["b"])()],$c.prototype,"writeDepth",void 0),Object(r["a"])([Object(oi["b"])()],$c.prototype,"hasOccludees",void 0),Object(r["a"])([Object(oi["b"])()],$c.prototype,"patternSpacing",void 0),Object(r["a"])([Object(oi["b"])()],$c.prototype,"lineWidth",void 0),Object(r["a"])([Object(oi["b"])()],$c.prototype,"enableOffset",void 0),Object(r["a"])([Object(oi["b"])()],$c.prototype,"draped",void 0),Object(r["a"])([Object(oi["b"])()],$c.prototype,"hasMultipassTerrain",void 0),Object(r["a"])([Object(oi["b"])()],$c.prototype,"cullAboveGround",void 0);const Xc=new Map([[Ee["a"].POSITION,0],[Ee["a"].COLOR,3],[Ee["a"].UVMAPSPACE,4],[Ee["a"].BOUNDINGRECT,5]]);class Yc extends Ht["a"]{constructor(e){super(e,new Qc),this.supportsEdges=!0,this._vertexAttributeLocations=Xc,this.techniqueConfig=new $c}getConfiguration(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.style=this.parameters.style,this.techniqueConfig.patternSpacing=this.parameters.patternSpacing,this.techniqueConfig.lineWidth=this.parameters.lineWidth,this.techniqueConfig.draped=this.parameters.draped,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<Ga["b"],this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,a,n,s){Object(ps["e"])(e,t,r,a,n,void 0,s)}requiresSlot(e,t){return e===Zt["a"].DRAPED_MATERIAL||(Object(Na["b"])(t)===$t["a"].Highlight?e===Zt["a"].OPAQUE_MATERIAL:e===(this.parameters.writeDepth?Zt["a"].TRANSPARENT_MATERIAL:Zt["a"].TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL))}createGLMaterial(e){return e.output===$t["a"].Color||e.output===$t["a"].Alpha||e.output===$t["a"].Highlight||e.output===$t["a"].Depth&&this.parameters.writeLinearDepth?new Zc(e):null}createBufferWriter(){const e=Object(qt["a"])().vec3f(Ee["a"].POSITION).vec4u8(Ee["a"].COLOR).vec4f(Ee["a"].UVMAPSPACE);return this.parameters.draped||e.mat3f(Ee["a"].BOUNDINGRECT),new Jc(e)}}class Zc extends Yt["a"]{_updateParameters(e){return this.ensureTechnique(Wc,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==$t["a"].Color&&this._output!==$t["a"].Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}class Jc extends kc["a"]{write(e,t,i,r){for(const a of this.vertexBufferLayout.fieldNames){const n=t.vertexAttributes.get(a),s=t.indices.get(a);if(n&&s)switch(a){case Ee["a"].POSITION:{Object(Bn["a"])(3===n.size);const t=i.getField(a,Ni["u"]);t&&Object(Jt["e"])(s,n.data,e.transformation,t,r);break}case Ee["a"].COLOR:{Object(Bn["a"])(3===n.size||4===n.size);const e=i.getField(a,Ni["J"]);e&&Object(Jt["b"])(s,n.data,n.size,e,r);break}case Ee["a"].UVMAPSPACE:{Object(Bn["a"])(4===n.size);const e=i.getField(a,Ni["C"]);e&&Object(Jt["a"])(s,n.data,e,r);break}case Ee["a"].BOUNDINGRECT:{Object(Bn["a"])(9===n.size);const t=i.getField(a,Ni["f"]);t&&this.writeBoundingRect(s,n.data,e.transformation,t,r);break}}}}writeBoundingRect(e,t,i,r,a){const n=i,s=r.typedBuffer,o=r.typedBufferStride,c=e.length;a*=o;for(let l=0;l<c;++l){const i=9*e[l],r=t[i],c=t[i+1],d=t[i+2];s[a]=n[0]*r+n[4]*c+n[8]*d+n[12],s[a+1]=n[1]*r+n[5]*c+n[9]*d+n[13],s[a+2]=n[2]*r+n[6]*c+n[10]*d+n[14];for(let e=3;e<9;++e)s[a+e]=t[i+e];a+=o}}}class Qc extends Ht["b"]{constructor(){super(...arguments),this.color=Object(rt["g"])(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Xe["b"].None,this.hasOccludees=!1,this.style=Bc["a"].Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function Kc(e,t,i){return tl(el(e),t,i)}function el(e){return e&&e.pattern||null}function tl(e,t,i){return Object(a["k"])(e)?"none"===e.style||"solid"===e.style?("none"===e.style&&(t.color=Object(rt["g"])(0,0,0,0),t.transparent=!0),new Uc["a"](t)):(t.style=il(e.style),t.draped=i.isDraped,new Yc(t)):new Uc["a"](t)}function il(e){switch(e){case"horizontal":return Bc["a"].Horizontal;case"vertical":return Bc["a"].Vertical;case"cross":return Bc["a"].Cross;case"forward-diagonal":return Bc["a"].ForwardDiagonal;case"backward-diagonal":return Bc["a"].BackwardDiagonal;case"diagonal-cross":return Bc["a"].DiagonalCross;default:return}}function rl(e){return e.material instanceof Yc&&!e.material.parameters.draped}function al(e,t){if(rl(e)){const i=e.geometry.vertexAttributes,r=i.get(Ee["a"].POSITION).data,a=i.get(Ee["a"].UVMAPSPACE).data,n=i.get(Ee["a"].BOUNDINGRECT).data;vc(Ni["C"].fromTypedArray(a),Ni["v"].fromTypedArray(r),t,Ni["g"].fromTypedArray(n))}}function nl(e,t,i,r){const a=Ie(e,t,i,r),n=e.stageObject.geometryRecords;for(let s=0;s<n.length;s++)al(n[s],r);return a}const sl=["polyline","polygon","extent"];class ol extends Nt{constructor(e,t,i,r){super(e,t,i,r),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(Object(a["k"])(this._material))return;const e=Object(a["i"])(this.symbolLayer,"material","color"),t=this._getCombinedOpacityAndColor(e);this._material=Kc(this.symbolLayer,{color:t,transparent:t[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof Yc,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(Object(a["k"])(this._outlineMaterial)||!this._isValidOutline(e))return;this._hasOutline=!0;const t=t=>{const i=Object(Qa["b"])(e.pattern);return new Ka["a"]({width:t,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:i,stippleScaleWithLineWidth:!0,cap:Object(Da["e"])(e.patternCap||"butt")})};this._outlineMaterial=t(Object(xe["g"])(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return Object(a["k"])(e)&&e.size&&e.size>0&&Object(a["k"])(e.color)&&(Object(a["j"])(e.pattern)||"style"!==e.pattern.type||"none"!==e.pattern.style)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,sl,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),r=this.setGraphicElevationContext(t,new qe["a"]);return this.ensureDrapedStatus("on-the-ground"===r.mode),this._ensureMaterials(),this.draped?this._createAsOverlay(t,i):this._createAs3DShape(t,i,r)}layerOpacityChanged(){if(Object(a["k"])(this._material)){const e=this._material.parameters.color,t=Object(a["i"])(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(t);this._material.setParameters({color:[e[0],e[1],e[2],i],transparent:i<1||this.needsDrivenTransparentPass})}if(Object(a["k"])(this._outlineMaterial)){const e=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}return!0}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,a=Object(Ce["e"])(ol.elevationModeChangeTypes,i,r);if(a!==Ce["b"].UPDATE)return a;const n=Object(Ce["h"])(r);return this.updateGraphics3DGraphicElevationInfo(e,t,()=>n)}slicePlaneEnabledChanged(){if(Object(a["k"])(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),Object(a["k"])(this._outlineMaterial)){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(e,t,i){const r=ki(e.geometry);if(Object(a["j"])(r))return null;ll.renderData=Hi(r,this._context.elevationProvider,this._context.renderCoordsHelper,i),ll.color=t;const n=ll.renderData.position.length/3;if(this._needsUV&&(ll.uvMapSpace=new Float32Array(4*n),ll.boundingRect=new Float64Array(9*n)),ll.outNum=0,ll.outGeometries=[],ll.outTransforms=[],ll.outMaterials=[],this._createAs3DShapeFill(ll),this._hasOutline&&this._createAs3DShapeOutline(ll),this._logGeometryCreationWarnings(ll.renderData,r.rings,"rings","FillSymbol3DLayer"),0===ll.outNum)return null;this._needsUV&&vc(Ni["C"].fromTypedArray(ll.uvMapSpace),Ni["v"].fromTypedArray(ll.renderData.position),this._context.renderCoordsHelper,Ni["g"].fromTypedArray(ll.boundingRect));const s=new Xi["a"]({geometries:ll.outGeometries,materials:ll.outMaterials,transformations:ll.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e.uid}}),o=new Ye(this,s,ll.outGeometries,null,null,nl,i);return o.alignedSampledElevation=ll.renderData.sampledElevation,o.needsElevationUpdates=Object(Ce["h"])(i.mode),o}_createAs3DShapeFill(e){const t=e.renderData.polygons;for(const{position:i,mapPosition:r,holeIndices:n,index:s,count:o}of t){if(Object(a["k"])(this._context.clippingExtent)&&(Object(k["h"])(cl),Object(k["k"])(cl,r),!Object(k["r"])(cl,this._context.clippingExtent)))continue;const t=Object(Mi["a"])(r,n,3);if(0===t.length)continue;const c=new Uint32Array(t),l=Ui({indices:c,attributeData:{position:i,color:e.color,mapPosition:r,uvMapSpace:this._needsUV?new Float32Array(e.uvMapSpace.buffer,4*s*e.uvMapSpace.BYTES_PER_ELEMENT,4*o):null,boundingRect:this._needsUV?new Float64Array(e.boundingRect.buffer,9*s*e.boundingRect.BYTES_PER_ELEMENT,9*o):null}});e.outGeometries.push(l),e.outMaterials.push(Object(a["r"])(this._material)),e.outTransforms.push(we["a"]),e.outNum++}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const t=e.renderData.outlines;for(let i=0;i<t.length;++i){const{mapPosition:r,position:n}=t[i];if(Object(a["k"])(this._context.clippingExtent)&&(Object(k["h"])(cl),Object(k["k"])(cl,r),!Object(k["r"])(cl,this._context.clippingExtent)))continue;const s=Object(Da["b"])({overlayInfo:null,removeDuplicateStartEnd:Da["a"].REMOVE,attributeData:{position:n,mapPosition:r}}),o=s.vertexAttributes.get(Ee["a"].POSITION);o.data===n&&(o.data=new Float64Array(n)),e.outGeometries.push(s),e.outMaterials.push(Object(a["r"])(this._outlineMaterial)),e.outTransforms.push(we["a"]),e.outNum++}}_createAsOverlay(e,t){const i=ki(e.geometry);if(Object(a["j"])(i))return null;Object(a["r"])(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2,Object(a["k"])(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),dl.renderData=Wi(i,this._context.overlaySR),dl.color=t;const r=dl.renderData.position.length/3;return this._needsUV&&(dl.uvMapSpace=new Float32Array(4*r)),dl.outNum=0,dl.outGeometries=[],dl.outBoundingBox=Object(k["h"])(),dl.layerUid=this._context.layer.uid,dl.graphicsUid=e.uid,this._createAsOverlayFill(dl),this._hasOutline&&this._createAsOverlayOutline(dl),this._logGeometryCreationWarnings(dl.renderData,i.rings,"rings","FillSymbol3DLayer"),0===dl.outNum?null:(this._needsUV&&Oc(Ni["C"].fromTypedArray(dl.uvMapSpace),Ni["v"].fromTypedArray(dl.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode),dl.outNum>0?new Sr(this,dl.outGeometries,dl.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayFill(e){const t=e.renderData.polygons;for(const{position:i,holeIndices:r,index:n,count:s}of t){if(Object(k["h"])(cl),Object(k["k"])(cl,i),!Object(k["r"])(cl,this._context.clippingExtent))continue;const t=Object(Mi["a"])(i,r,3);if(0===t.length)continue;Object(k["j"])(e.outBoundingBox,cl);const o=new Uint32Array(t),c=Ui({indices:o,attributeData:{position:i,color:e.color,uvMapSpace:this._needsUV?new Float32Array(e.uvMapSpace.buffer,4*n*e.uvMapSpace.BYTES_PER_ELEMENT,4*s):null}}),l=new Oa["a"](c,Object(a["r"])(this._material),{layerUid:e.layerUid,graphicUid:e.graphicsUid}),d=cl;Object(vr["l"])(l.boundingSphere,.5*(d[0]+d[3]),.5*(d[1]+d[4]),0,.5*Math.sqrt((d[3]-d[0])*(d[3]-d[0])+(d[4]-d[1])*(d[4]-d[1]))),e.outGeometries.push(l),e.outNum++}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const t=e.renderData.outlines;for(let i=0;i<t.length;++i){const{position:r}=t[i];if(Object(k["h"])(cl),Object(k["k"])(cl,r),!Object(k["r"])(cl,this._context.clippingExtent))continue;Object(k["j"])(e.outBoundingBox,cl);const n=Object(Da["b"])({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:Da["a"].REMOVE,attributeData:{position:r}}),s=new Oa["a"](n,Object(a["r"])(this._outlineMaterial),{layerUid:e.layerUid,graphicUid:e.graphicsUid}),o=cl;Object(vr["l"])(s.boundingSphere,.5*(o[0]+o[3]),.5*(o[1]+o[4]),0,.5*Math.sqrt((o[3]-o[0])*(o[3]-o[0])+(o[4]-o[1])*(o[4]-o[1]))),e.outGeometries.push(s),e.outNum++}}_getOutlineOpacity(){const e=Object(a["i"])(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(Object(a["k"])(e)?e.a:0)}_getOutlineColor(){const e=Object(a["i"])(this.symbolLayer,"outline","color"),t=this._getOutlineOpacity();return Object(Ae["g"])(Object(a["k"])(e)?y["a"].toUnitRGB(e):null,t)}test(){return{...super.test(),createAsOverlay:(e,t)=>this._createAsOverlay(e,t),createAs3DShape:(e,t,i)=>this._createAs3DShape(e,t,i)}}}ol.elevationModeChangeTypes={definedChanged:Ce["b"].RECREATE,staysOnTheGround:Ce["b"].NONE,onTheGroundChanged:Ce["b"].RECREATE};const cl=Object(k["f"])(),ll={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},dl={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},hl=N["a"].getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");class ul{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=0!==e.background.color[3]?this._colorToRGBA(e.background.color):null}fontString(e){const t=this.definition.font;return`${t.style} ${t.weight} ${e}px ${t.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map(e=>Math.floor(255*e)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(e=>Math.floor(255*e)).toString()},${e[3]})`}static async fromSymbol(e,t=1){const i=Object(a["i"])(e,"material","color"),r=Object(a["m"])(i,rt["b"],y["a"].toUnitRGBA),n=Object(a["m"])(e.size,12,xe["g"]),s=e.lineHeight,o=Object(a["k"])(e.background)?y["a"].toUnitRGBA(e.background.color):rt["b"],c={family:Object(a["m"])(e.font,"sans-serif",e=>e.family),decoration:Object(a["m"])(e.font,"none",e=>e.decoration),weight:Object(a["m"])(e.font,"normal",e=>e.weight),style:Object(a["m"])(e.font,"normal",e=>e.style)},l=e.halo,d=Object(a["k"])(l)&&Object(a["k"])(l.color)&&l.size>0?{size:Object(xe["g"])(l.size),color:y["a"].toUnitRGBA(l.color)}:{size:0,color:rt["b"]},h=new ul({color:r,size:n,background:{color:o,padding:Object(a["k"])(e.background)?[.65*n,.5*n]:[0,0],borderRadius:Object(a["k"])(e.background)?n*(6/16):0},lineSpacingFactor:s,font:c,halo:d,pixelRatio:t}),u=h.fontString(n);try{await document.fonts.load(u)}catch(p){hl.warnOnce(`Failed to preload font '${u}'. Some text symbology may be rendered using the default browser font.`)}return h}}class pl{constructor(e,t,i){this._renderer=new Pr(e,t,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=Ir(bl,this._renderer.renderedWidth,this._renderer.renderedHeight),t=e.getContext("2d");return t.save(),this._renderer.render(t,0,0),t.restore(),new va["a"](e,{wrap:{s:ai["B"].CLAMP_TO_EDGE,t:ai["B"].CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:Xe["e"].PAD})}}const bl={canvas:null},fl=[0,0,1];class ml extends Nt{constructor(e,t,i,r){super(e,t,i,r),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=Object(Ae["i"])(this.symbolLayer.size);if(e)throw new D["a"]("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.pixelRatio;this._textRenderParameters=await ul.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const t=e.graphic,i=Object(Bt["d"])(t.geometry);if(Object(a["j"])(i))return this.logger.warn("unsupported geometry type for text symbol: "+t.geometry.type),null;const r=this.symbolLayer.text;if(Object(a["j"])(r)||""===r)return null;const n=Object(je["b"])(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(Object(a["k"])(n)&&!Object(je["e"])(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const s={...yl,verticalOffset:n,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:Br(this.symbolLayer.verticalAlignment)};return this._createAs3DShape(t,i,r,s)}createLabel(e,t,i,r){const n=e.graphic,s=Object(Bt["d"])(n.geometry);if(Object(a["j"])(s))return this.logger.warn("unsupported geometry type for label: "+n.geometry.type),null;const o=t.text;return!o||/^\s+$/.test(o)?null:this._createAs3DShape(n,s,o,t,i,r)}setGraphicElevationContext(e,t,i=0){const r=super.setGraphicElevationContext(e,t);return r.addOffsetRenderUnits(i),r}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,t){return gl(e,t,(e,t)=>{this.updateGraphicElevationContext(t,e)}),Ce["b"].UPDATE}slicePlaneEnabledChanged(e,t){return gl(e,t,e=>{for(const t of e.stageObject.geometryRecords)t.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata.elevationOffset),t.needsElevationUpdates=Object(Ce["h"])(t.elevationContext.mode)||"absolute-height"===t.elevationContext.mode}_defaultElevationInfoNoZ(){return vl}_createAs3DShape(e,t,i,r,n,s){const o=this.setGraphicElevationContext(e,new qe["a"],r.elevationOffset),c="polyline"===Object(a["i"])(e.geometry,"type"),l=e.uid;let d=null,u=null;if(Object(a["j"])(s)){const e=Vr(r.horizontalPlacement);d=new pl(i,e,this._textRenderParameters);let t=null;u=this._context.sharedResources.textures.fromData(d.key,()=>Object(a["r"])(d).create(),()=>{Object(a["k"])(t)&&t.release()});const n=this._context.stage.renderView.textureRepository.acquire(u.texture.id);if(Object(a["j"])(n)||Object(h["l"])(n))return u.release(),null;t=n}const p=Ol(d,r),b={occlusionTest:!0,screenOffset:r.screenOffset,anchorPosition:p,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:r.centerOffsetUnits,debugDrawLabelBorder:r.debugDrawLabelBorder,drawInSecondSlot:!0};if(Object(a["k"])(u)&&(b.textureId=u.texture.id),Object(a["k"])(s)&&(b.textureId=s.id),Object(a["k"])(r.verticalOffset)){const{screenLength:e,minWorldLength:t,maxWorldLength:i}=r.verticalOffset;b.verticalOffset={screenLength:Object(xe["g"])(e),minWorldLength:t||0,maxWorldLength:null!=i?i:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:e,screenSizePerspectiveSettingsLabels:t}=this._context.sharedResources;b.screenSizePerspective=t.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),b.screenSizePerspectiveAlignment=e}let f;if(c&&(b.shaderPolygonOffset=1e-4),b.hasSlicePlane=this._context.slicePlaneEnabled,Object(a["k"])(n)){const e=JSON.stringify(b);f=n.get(e),Object(a["j"])(f)&&(f=new ya["a"](b),n.add(e,f))}else f=new ya["a"](b);const m=[f],g=r.translation,O=Object(a["k"])(d)?[d.displayWidth,d.displayHeight]:[0,0],v=r.centerOffset,y=fl,_=[0,0],j=[ot["a"].createPointGeometry(y,g,null,O,v,_,null)],x=this._context.layer.uid,S=Object(Bt["a"])(this._context,t,j,m,o,x,l);if(null===S)return null;const T=new Ye(this,S.object,j,Object(a["j"])(n)?m:null,u,Me,o);T.alignedSampledElevation=S.sampledElevation,T.needsElevationUpdates=Object(Ce["h"])(o.mode)||"absolute-height"===o.mode;const{displayWidth:w,displayHeight:C}=Object(a["k"])(d)?d:r;T.getScreenSize=(e=Object(Se["c"])())=>(e[0]=w,e[1]=C,e);const A={labelText:i,elevationOffset:r.elevationOffset};return T.metadata=A,Object(Bt["b"])(T,t,this._context.elevationProvider),T}}function gl(e,t,i){e&&e.forEach(e=>{const r=t(e);Object(a["k"])(r)&&i(r,e.graphic)})}function Ol(e,t){if("baseline"===t.verticalPlacement){const i=zr[t.horizontalPlacement],r=Object(a["k"])(e)?e.baselineAnchorY:0;return Object(Se["g"])(i,r)}const i=Ur(t.horizontalPlacement,t.verticalPlacement);return Gr[i]}const vl={mode:"relative-to-ground",offset:0},yl={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0};var _l=i("8048"),jl=i("1f93");const xl={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},Sl=["polyline","polygon","extent"];class Tl extends Nt{constructor(e,t,i,r){super(e,t,i,r)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Sl,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(t,new qe["a"]);return this.ensureDrapedStatus("on-the-ground"===i.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(t):this._createAs3DShape(t,i,t.uid)}ensureMaterial(){if(Object(a["k"])(this._material))return;const e=new jl["b"],t=this.symbolLayer.color;Object(a["k"])(t)&&(e.color=y["a"].toUnitRGBA(t));const i=this._getCombinedOpacity(t,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=Object(a["k"])(this.symbolLayer.waveDirection)?Tl.headingVectorFromAngle(this.symbolLayer.waveDirection):Object(Se["g"])(0,0);const r=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=xl[r];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new jl["a"](e),this._context.stage.add(this._material)}layerOpacityChanged(){if(Object(a["j"])(this._material))return!0;const e=this._material.parameters.color,t=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=t<1||this.needsDrivenTransparentPass;return this._material.setParameters({color:[e[0],e[1],e[2],t],transparent:i}),!0}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,a=Object(Ce["e"])(Tl.elevationModeChangeTypes,i,r);if(a!==Ce["b"].UPDATE)return a;const n=Object(Ce["h"])(r);return this.updateGraphics3DGraphicElevationInfo(e,t,()=>n)}slicePlaneEnabledChanged(){return Object(a["k"])(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(e,t,i){const r=ki(e.geometry);if(Object(a["j"])(r))return null;Rl.renderData=Hi(r,this._context.elevationProvider,this._context.renderCoordsHelper,t);const n=Rl.renderData.position.length/3;if(Rl.uvCoords=new Float64Array(2*n),Rl.outNum=0,Rl.outGeometries=[],Rl.outTransforms=[],Rl.outMaterials=[],this._create3DShapeGeometries(Rl),this._logGeometryCreationWarnings(Rl.renderData,r.rings,"rings","WaterSymbol3DLayer"),0===Rl.outNum)return null;this._createUVCoordsFromVertices(Rl.uvCoords,Rl.renderData.mapPosition,n,this._context.elevationProvider.spatialReference);const s=new Xi["a"]({geometries:Rl.outGeometries,materials:Rl.outMaterials,transformations:Rl.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),o=new Ye(this,s,Rl.outGeometries,null,null,Ie,t);return o.alignedSampledElevation=Rl.renderData.sampledElevation,o.needsElevationUpdates=Object(Ce["h"])(t.mode),o}_createUVCoordsFromVertices(e,t,i,r){const a=Object(_l["f"])(r);Object(H["l"])(Cl);for(let o=0;o<i;o++)Object(wi["a"])(Al,t[3*o+0],t[3*o+1]),Object(H["n"])(Cl,Al);Object(vr["b"])(Cl,Cl,a);const n=Cl[0]%Tl.unitSizeOfTexture,s=Cl[1]%Tl.unitSizeOfTexture;wl[0]=Cl[0]-n,wl[1]=Cl[1]-s;for(let o=0;o<i;o++)e[2*o+0]=(t[3*o+0]*a-wl[0])/Tl.unitSizeOfTexture,e[2*o+1]=(t[3*o+1]*a-wl[1])/Tl.unitSizeOfTexture}_create3DShapeGeometries(e){const t=e.renderData.polygons,i=e.uvCoords;for(const{count:r,index:n,position:s,mapPosition:o,holeIndices:c}of t){if(Object(a["k"])(this._context.clippingExtent)&&(Object(k["h"])(Pl),Object(k["k"])(Pl,o),!Object(k["r"])(Pl,this._context.clippingExtent)))continue;const t=Object(Mi["a"])(o,c,3);if(0===t.length)continue;const l=new Uint32Array(t),d=new Float64Array(i.buffer,2*n*i.BYTES_PER_ELEMENT,2*r),h=Bi({indices:l,attributeData:{position:s,uv0:d,mapPosition:o}});e.outGeometries.push(h),e.outMaterials.push(Object(a["r"])(this._material)),e.outTransforms.push(we["a"]),e.outNum++}}_createAsOverlay(e){const t=ki(e.geometry);if(Object(a["j"])(t))return null;Object(a["r"])(this._material).renderPriority=this._renderPriority,El.renderData=Wi(t,this._context.overlaySR);const i=El.renderData.position.length/3;return El.uvCoords=new Float64Array(2*i),El.outNum=0,El.outGeometries=[],El.outBoundingBox=Object(k["h"])(),El.layerUid=this._context.layer.uid,El.graphicsUid=e.uid,this._createAsOverlayWater(El),this._logGeometryCreationWarnings(El.renderData,t.rings,"rings","WaterSymbol3DLayer"),0===El.outNum?null:(this._createUVCoordsFromVertices(El.uvCoords,El.renderData.position,i,this._context.overlaySR),El.outNum>0?new Sr(this,El.outGeometries,El.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayWater(e){const t=e.uvCoords,i=e.renderData.polygons;for(const{position:r,holeIndices:n,index:s,count:o}of i){if(Object(k["h"])(Pl),Object(k["k"])(Pl,r),!Object(k["r"])(Pl,this._context.clippingExtent))continue;Object(k["j"])(e.outBoundingBox,Pl);const i=Object(Mi["a"])(r,n,3);if(0===i.length)continue;const c=new Uint32Array(i),l=new Float64Array(t.buffer,2*s*t.BYTES_PER_ELEMENT,2*o),d=Bi({indices:c,attributeData:{position:r,uv0:l}}),h=new Oa["a"](d,Object(a["r"])(this._material),{layerUid:e.layerUid,graphicUid:e.graphicsUid}),u=Pl;Object(vr["l"])(h.boundingSphere,.5*(u[0]+u[3]),.5*(u[1]+u[4]),0,.5*Math.sqrt((u[3]-u[0])*(u[3]-u[0])+(u[4]-u[1])*(u[4]-u[1]))),e.outGeometries.push(h),e.outNum++}}static headingVectorFromAngle(e){const t=Object(Se["c"])(),i=Object(Ds["c"])(e);return t[0]=Math.sin(i),t[1]=Math.cos(i),t}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}Tl.unitSizeOfTexture=100,Tl.elevationModeChangeTypes={definedChanged:Ce["b"].RECREATE,staysOnTheGround:Ce["b"].NONE,onTheGroundChanged:Ce["b"].RECREATE};const wl=Object(Se["c"])(),Cl=Object(H["k"])(),Al=Object(Se["c"])(),Pl=Object(k["f"])(),Rl={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},El={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Il=N["a"].getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function Ml(e,t,i,r){const a=Ll[e.type]&&Ll[e.type][t.type]||Dl[t.type];return a?new a(e,t,i,r):(Il.error("GraphicsLayerFactory#make","unknown symbol type "+t.type),null)}const Dl={icon:Pa,object:As,line:tn,path:rc,fill:ol,extrude:Ji,text:ml,water:Tl};const Ll={"mesh-3d":{fill:hn}};class Nl extends at{constructor(e,t,i){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}set symbol(e){this._symbol=e;for(let t=0;t<e.symbolLayers.length;t++){const i=this.symbolLayers[t];Object(a["j"])(i)||(i.symbol=e,i.symbolLayer=e.symbolLayers.items[t])}}get symbol(){return this._symbol}async doLoad(e){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));const i=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;const r=[];for(let a=0;a<i;a++){const n=t.getItemAt(a);if(!1===n.enabled)continue;Fl.renderPriority=1-(1+a)/i,Fl.renderPriorityStep=1/i,Fl.ignoreDrivers=n._ignoreDrivers;const s=Ml(this.symbol,n,this._context,Fl);r.push(Object(h["n"])(e,()=>{this.symbolLayers[a]=null,s.destroy()})),this.symbolLayers[a]=s}await Object(_e["a"])(this.symbolLayers,async(e,t)=>{if(Object(a["k"])(e))try{await e.load(),this._extentPadding+=Math.max(this._extentPadding,e.extentPadding)}catch{this.symbolLayers[t]=null}});for(const a of r)null==a||a.remove();if(r.length=0,Object(h["p"])(e),this.symbolLayers.length&&!this.symbolLayers.some(e=>!!e))throw new Error}getSymbolLayerSize(e){const t=this.symbolLayers[e];return Object(a["k"])(t)?t.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(e,t){const i=e.graphic,r=new Array(this.symbolLayers.length);for(let s=0;s<this.symbolLayers.length;s++){const t=this.symbolLayers[s];r[s]=Object(a["k"])(t)?t.createGraphics3DGraphic(e):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new Ei(i,t||this,r,e.layer,n)}get complexity(){return At(this.symbolLayers.map(e=>Object(a["i"])(e,"complexity")))}globalPropertyChanged(e,t){const i=this.symbolLayers.length;for(let r=0;r<i;r++){const i=this.symbolLayers[r],n=e=>{const t=e.graphics[r];return t instanceof Ye?t:null};if(Object(a["k"])(i)&&!i.globalPropertyChanged(e,t,n))return!1}return!0}applyRendererDiff(e,t){return this.loadStatus!==it.LOADED?tt.Recreate_Symbol:this.symbolLayers.reduce((i,r)=>i!==tt.Recreate_Symbol&&Object(a["k"])(r)?Math.min(i,r.applyRendererDiff(e,t)):i,tt.Fast_Update)}prepareSymbolPatch(e){if(this.loadStatus===it.FAILED)return;if("partial"!==e.diff.type)return;const t=e.diff.diff;if(!t.symbolLayers||"partial"!==t.symbolLayers.type)return;const i=t.symbolLayers.diff;this.symbolLayers.forEach((t,r)=>{if(Object(a["j"])(t))return;const n=i[r];if(n){const i={diff:n,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(i),e.symbolStatePatches.push(...i.symbolLayerStatePatches),i.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((e,t)=>{const n=e.graphics[r];Object(a["k"])(n)&&i.graphics3DGraphicPatches.forEach(e=>e(n,t))})}})}updateGeometry(e,t){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(Object(a["j"])(r))continue;const n=e.graphics[i];if(Object(a["j"])(n)||!r.updateGeometry(n,t))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){const i=this.symbolLayers[t];if(Object(a["j"])(i))continue;const r=e.graphics[t];Object(a["k"])(r)&&i.onRemoveGraphic(r)}}getFastUpdateStatus(){let e=0,t=0,i=0;return this.symbolLayers.forEach(r=>{Object(a["j"])(r)||(r.loadStatus===it.LOADING?e++:r.isFastUpdatesEnabled()?i++:t++)}),{loading:e,slow:t,fast:i}}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)Object(a["k"])(e)&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const Fl={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};class zl extends Nl{constructor(e,t,i){super(e,t,i),this.calloutSymbolLayer=null,this.symbol.hasVisibleCallout()&&(this.calloutSymbolLayer=ji(this.symbol,t))}async doLoad(e){const t=this.calloutSymbolLayer?Object(_e["c"])(this.calloutSymbolLayer.load()):null;try{await super.doLoad(e),Object(h["p"])(e)}catch(r){var i;throw null!=(i=this.calloutSymbolLayer)&&i.abortLoad(),r}t&&await t}destroy(){super.destroy(),this.calloutSymbolLayer=Object(a["d"])(this.calloutSymbolLayer)}createGraphics3DGraphic(e,t){const i=super.createGraphics3DGraphic(e,t);if(Object(a["k"])(this.calloutSymbolLayer)&&Object(a["k"])(i)){const t=this._createCalloutGraphic(e);Object(a["k"])(t)&&i.addAuxiliaryGraphic(t)}return i}globalPropertyChanged(e,t){return!!super.globalPropertyChanged(e,t)&&(!this.calloutSymbolLayer||this.calloutSymbolLayer.globalPropertyChanged(e,t,e=>this._getCalloutGraphicLayer(e)))}updateGeometry(e,t){const i=super.updateGeometry(e,t);if(i&&this.calloutSymbolLayer){const i=this._getCalloutGraphicLayer(e);if(i)return this.calloutSymbolLayer.updateGeometry(i,t)}return i}_createCalloutGraphic(e){const t=e.renderingInfo,i={renderer:t.renderer,symbol:t.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return e.renderingInfo=i,this.calloutSymbolLayer.createGraphics3DGraphic(e)}_getCalloutGraphicLayer(e){for(const t of e._auxiliaryGraphics)if(t.graphics3DSymbolLayer===this.calloutSymbolLayer)return t}}function Gl(e,t,i){let r;return r="point-3d"===e.type?zl:Nl,new r(e,t,i)}class Vl extends at{constructor(e,t,i){super(t),this.symbol=e,this.convert=i,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return Object(a["k"])(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return Object(a["k"])(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return Object(a["k"])(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const t=await this.symbol.fetchSymbol({signal:e});t.id=this.symbol.id,this.graphics3DSymbol=this.convert(t),Object(a["k"])(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return Object(a["k"])(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return Object(a["k"])(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:wt}globalPropertyChanged(e,t){return!!Object(a["k"])(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return Object(a["k"])(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(e,t):tt.Recreate_Symbol}prepareSymbolPatch(e){Object(a["k"])(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,t){return!!Object(a["k"])(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(e,t)}onRemoveGraphic(){}getFastUpdateStatus(){return Object(a["k"])(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){Object(a["k"])(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}}class Ul{constructor(e){this.graphicsCore=e,this.idToState=new Map,this.states=new Set;const t=e.owner.layer&&e.owner.layer.objectIdField;t?(this.getGraphicId=e=>Object(W["e"])(e,t),this.getGraphics3DGraphicById=e=>this.graphicsCore.getGraphics3DGraphicByObjectId(e)):(this.getGraphicId=e=>e.uid,this.getGraphics3DGraphicById=e=>this.graphicsCore.getGraphics3DGraphicById(e))}destroy(){this.idToState.clear(),this.states.forEach((e,t)=>this.remove(t))}add(e){const t={remove:()=>this.remove(e)};if(this.states.has(e))return t;const i=this.getGraphicId(e.graphic),r=this.getGraphics3DGraphicById(i);return this.states.has(e)||this.states.add(e),this._ensureStateList(i).push(e),e.displaying=!!Object(a["k"])(r)&&r.isVisible(),e.isDraped=!!Object(a["k"])(r)&&r.isDraped,e.tracking=!0,Object(a["k"])(r)&&e.emit("changed",{}),t}remove(e){if(this.states.has(e)){if(this.idToState.size){const t=this.getGraphicId(e.graphic),i=this.idToState.get(t);i&&(Object(o["h"])(i,e),0===i.length&&this.idToState.delete(t))}this.states.delete(e),e.tracking=!1,e.displaying=!1}}addGraphic(e){this._forEachState(e,t=>{t.displaying=e.isVisible(),t.isDraped=e.isDraped,t.emit("changed",{})})}removeGraphic(e){this._forEachState(e,e=>{e.displaying=!1,e.isDraped=!1})}updateGraphicGeometry(e){this._forEachState(e,e=>{e.emit("changed",{})})}updateGraphicVisibility(e){this._forEachState(e,t=>{t.displaying=e.isVisible()})}allGraphicsDeleted(){this.states.forEach(e=>{e.displaying=!1})}_ensureStateList(e){const t=this.idToState.get(e);if(t)return t;const i=new Array;return this.idToState.set(e,i),i}_forEachState(e,t){if(0===this.states.size||0===this.idToState.size)return;const i=this.getGraphicId(e.graphic),r=this.idToState.get(i);null!=r&&r.forEach(t)}}var Bl=i("ce76");let kl=class extends M["a"]{constructor(e){super(e),this._index=new Bl["a"](9,Object(c["a"])("esri-csp-restrictions")?e=>({minX:e.extent[0],minY:e.extent[1],maxX:e.extent[2],maxY:e.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),this._missing=new Set,this._boundsByFeature=new Map,this.spatialReference=null,this.hasZ=null,this.hasM=null,this.objectIdField=null,this.updating=!1}setup(e){this._addMany(e)}destroy(){this._missing.clear(),this._index.destroy(),this._index=null,this._boundsByFeature.clear(),this._boundsByFeature=null}update(){this._missing.size>0&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())}get updatingRemaining(){return this._missing.size}queryGraphicUIDsInExtent(e,t,i){t.equals(this.spatialReference)&&(Hl.minX=e[0],Hl.minY=e[1],Hl.maxX=e[2],Hl.maxY=e[3],this.update(),this._index.search(Hl,e=>i(e.graphic.uid)))}add(e){this._missing.add(e),this.updating=!0}remove(e){if(this._missing.delete(e))return void(this.updating=this._missing.size>0);this._index.remove(e);const t=Object(W["e"])(e.graphic,this._get("objectIdField"));null!=t&&this._boundsByFeature.delete(t)}_addMany(e){if(0===e.length)return;const t=this._get("objectIdField");for(const i of e){i.computeExtent(this.spatialReference);const e=Object(W["e"])(i.graphic,t);null!=e&&this._boundsByFeature.set(e,i.extent)}this._index.load(e)}clear(){this._index.clear(),this._missing.clear(),this._boundsByFeature.clear(),this.updating=!1}forEachInBounds(e,t){Hl.minX=e[0],Hl.minY=e[1],Hl.maxX=e[2],Hl.maxY=e[3],this.update(),this._index.search(Hl,e=>{t(e)})}getBounds(e,t){this.update();const i=this._boundsByFeature.get(e);return i?Object(k["o"])(t,i):null}};Object(r["a"])([Object(s["b"])({constructOnly:!0})],kl.prototype,"spatialReference",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],kl.prototype,"hasZ",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],kl.prototype,"hasM",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],kl.prototype,"objectIdField",void 0),Object(r["a"])([Object(s["b"])()],kl.prototype,"updating",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],kl.prototype,"updatingRemaining",null),kl=Object(r["a"])([Object(l["a"])("esri.views.3d.layers.graphics.SpatialIndex2D")],kl);const Hl={minX:0,minY:0,maxX:0,maxY:0};var Wl=i("8076");const ql=N["a"].getLogger("esri.views.3d.layers.support.StageLayerElevationProvider"),$l=1;let Xl=class extends(pe["a"].EventedMixin(M["a"])){constructor(e){super(e),this.elevationOffset=0,this._layerHandes=new L["a"]}initialize(){this.renderCoordsHelper=this.view.renderCoordsHelper,this.intersectLayers=[this.stageLayer],this.intersector=Object(ts["a"])(this.view.state.viewingMode),this.intersector.options.store=Gn["c"].MIN;const e=this._computeLayerExtent(this.stageLayer);this.zmin=e[2],this.zmax=e[5];const t=this.stageLayer.events;this._layerHandes.add([t.on("layerObjectAdded",e=>this._objectChanged(e.object)),t.on("layerObjectRemoved",e=>this._objectChanged(e.object)),t.on("objectGeometryAdded",e=>this._objectChanged(e.object)),t.on("objectGeometryRemoved",e=>this._objectChanged(e.object)),t.on("vertexAttrsUpdated",e=>this._objectChanged(e.object)),t.on("objectTransformation",e=>this._objectChanged(e))])}dispose(){this._layerHandes.destroy()}elevationInfoChanged(){const e=null!=this.layer?this.layer.elevationInfo:null;if(null!=e&&"on-the-ground"!==e.mode){const t=Object(_l["g"])(this.layer.spatialReference),i=Object(Wl["a"])(e.unit);this.elevationOffset=Object(a["s"])(e.offset,0)*i/t}else this.elevationOffset=0}getElevation(e,t,i,r){if(Ql[0]=e,Ql[1]=t,Ql[2]=i,!this.renderCoordsHelper.toRenderCoords(Ql,r,Ql))return ql.error("could not project point for elevation alignment"),null;const a=this.elevationOffset,n=this.zmin+a,s=this.zmax+a;this.renderCoordsHelper.setAltitude(Kl,s,Ql),this.renderCoordsHelper.setAltitude(ed,n,Ql);const o=e=>e.metadata&&e.metadata.isElevationSource;return this.intersector.reset(Kl,ed,null),this.intersector.intersect(this.intersectLayers,null,$l,null,o),this.intersector.results.min.getIntersectionPoint(Ql)?this.renderCoordsHelper.getAltitude(Ql):null}_objectChanged(e){var t;if(null==(t=e.metadata)||!t.isElevationSource||!this.spatialReference)return;Object(k["h"])(Yl),e.metadata.lastValidElevationBB.isEmpty()||this._expandExtent(e.metadata.lastValidElevationBB.min,e.metadata.lastValidElevationBB.max,Yl);const i=e.boundingVolumeWorldSpace.min,r=e.boundingVolumeWorldSpace.max;this._expandExtent(i,r,Yl),Object(k["B"])(Yl,Zl),this.zmin=Math.min(this.zmin,Yl[2]),this.zmax=Math.max(this.zmax,Yl[5]),Jl.extent=Zl,Jl.spatialReference=this.spatialReference,this.emit("elevation-change",Jl),Object(V["g"])(e.metadata.lastValidElevationBB.min,i),Object(V["g"])(e.metadata.lastValidElevationBB.max,r)}_computeLayerExtent(e){return Object(k["h"])(Yl),e.objects.forAll(e=>this._expandExtent(e.boundingVolumeWorldSpace.min,e.boundingVolumeWorldSpace.max,Yl)),Yl}_expandExtent(e,t,i){for(let r=0;r<8;++r)Ql[0]=1&r?e[0]:t[0],Ql[1]=2&r?e[1]:t[1],Ql[2]=4&r?e[2]:t[2],this.renderCoordsHelper.fromRenderCoords(Ql,Ql,this.spatialReference),Object(k["n"])(i,Ql);return i}};Object(r["a"])([Object(s["b"])({constructOnly:!0})],Xl.prototype,"layer",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],Xl.prototype,"stageLayer",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],Xl.prototype,"view",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0,aliasOf:"view.spatialReference"})],Xl.prototype,"spatialReference",void 0),Xl=Object(r["a"])([Object(l["a"])("esri.views.3d.layers.support.StageLayerElevationProvider")],Xl);const Yl=Object(k["h"])(),Zl=Object(H["l"])(),Jl={spatialReference:null,extent:Zl,context:"scene"},Ql=Object(U["f"])(),Kl=Object(U["f"])(),ed=Object(U["f"])();function td(e,t,i){if(Object(a["j"])(e)||Object(a["j"])(i))return!1;let r=!0;return id[0]=null!=e.xmin?e.xmin:0,id[1]=null!=e.ymin?e.ymin:0,id[2]=null!=e.zmin?e.zmin:0,r=r&&Object(B["l"])(id,e.spatialReference,0,id,i,0,1),t[0]=id[0],t[1]=id[1],id[0]=null!=e.xmax?e.xmax:0,id[1]=null!=e.ymax?e.ymax:0,id[2]=null!=e.zmax?e.zmax:0,r=r&&Object(B["l"])(id,e.spatialReference,0,id,i,0,1),t[2]=id[0],t[3]=id[1],null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.xmax&&(t[2]=1/0),null==e.ymax&&(t[3]=1/0),r}const id=Object(U["f"])();var rd,ad=i("9714"),nd=i("adf1"),sd=i("748f"),od=i("4ae5"),cd=i("9fab"),ld=i("21ba"),dd=i("ddc2");const hd=Object(U["f"])(),ud=Object(k["f"])(),pd=N["a"].getLogger("esri.views.3d.layers.graphics.Graphics3DCore");let bd=rd=class extends M["a"]{constructor(e){super(e),this.propertiesPool=new ad["a"]({computedExtent:Vi["a"]},this),this.computedExtent=null,this.currentRenderer=null,this.rendererHasGeometryOperations=!1,this.graphicStateTracking=null,this.symbolCreationContext=new ye((e,t)=>this._frameTask.schedule(e,t)),this.graphics3DGraphics=new Map,this.stageLayer=null,this.stage=null,this.graphicsDrapedUids=new Set,this.graphicsBySymbol=new Map,this.symbolConversionCache=new Map,this.symbols=new Map,this.graphicsWithoutSymbol=new Map,this.graphicsWaitingForSymbol=new Map,this.graphicsUpdateId=0,this._handles=new L["a"],this._frameTask=de["a"],this.suspendSymbolCleanup=!1,this._viewSpatialReference=null,this.arcadeOnDemand=null,this.rendererChangeAbortController=null,this.elevationInfoChangeAbortController=null,this.setupAbortController=null,this.elevationAlignment=null,this.scaleVisibility=null,this._spatialIndex=null,this.extentPadding=0,this._updatingPendingLoadedGraphicsChange=null,this.featureStore=null,this.deconflictor=null,this.labeler=null,this.objectStates=null,this.viewElevationProvider=null,this.stageLayerElevationProvider=null,this.sharedSymbolResourcesOwnerHandle=null,this.whenGraphics3DGraphicRequests={},this.pendingUpdates=new Map,this.numberOfGraphics=0,this.numberOfGraphicsProvidingElevation=0,this.pendingAdds=0,this.pendingRemoves=0,this._loadingSymbols=0,this.pendingUpdatesPool=new z["a"]({allocator:e=>e||new md,deallocator:e=>(e.clear(),e)}),this.symbolWarningLogged=!1,this.geometryWarningLogged=!1,this.objectIdInvisibleSet=new Set,this._whenSymbolRemoved=new z["a"],this.preferredUpdatePolicy=Xe["j"].SYNC,this.forcedUpdatePolicy=null,this.elevationFeatureExpressionEnabled=!0,this.owner=null,this.layer=null,this.graphicSymbolSupported=!0,this.getRenderingInfoWithoutRenderer=!1,this.hasZ=null,this.hasM=null,this._usedMemory=0,this._visible=void 0,this._startCreateGraphics=!1}get spatialIndex(){var e;return this._spatialIndex||(this._spatialIndex=new kl({objectIdField:null==(e=this.owner.layer)?void 0:e.objectIdField,spatialReference:this._viewSpatialReference,hasZ:this.hasZ,hasM:this.hasM}),this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values()))),this._spatialIndex.update(),this._spatialIndex}get effectiveUpdatePolicy(){return Object(a["k"])(this.currentRenderer)&&"dictionary"===this.currentRenderer.type?Xe["j"].ASYNC:Object(a["s"])(this.forcedUpdatePolicy,this.preferredUpdatePolicy)}get updating(){var e;return!!(this.graphicsWaitingForSymbol.size>0||this.running||null!=(e=this.elevationAlignment)&&e.updating||Object(a["k"])(this.scaleVisibility)&&this.scaleVisibility.updating||Object(a["k"])(this.filterVisibility)&&this.filterVisibility.updating||this.rendererChangeAbortController||this.elevationInfoChangeAbortController||this._updatingPendingLoadedGraphicsChange||this._frameTask.updating||this._loadingSymbols>0)}get running(){var e;return this.pendingUpdates.size>0||!(null==(e=this._spatialIndex)||!e.updating)}get suspendedOrOutsideOfView(){var e;return this.owner.suspended||(null==(e=this.owner.suspendInfo)?void 0:e.outsideOfView)}get updatingRemaining(){var e,t;return this.updating?this.pendingUpdates.size+.1*((null==(e=this._spatialIndex)?void 0:e.updatingRemaining)||0)+.1*((null==(t=this.elevationAlignment)?void 0:t.updatingRemaining)||0):0}get displayFeatureLimit(){const e=this.owner&&this.owner.view&&this.owner.view.qualitySettings,t=e?e.graphics3D.minTotalNumberOfFeatures:0,i=e?e.graphics3D.maxTotalNumberOfFeatures:0,r=e?e.graphics3D.maxTotalNumberOfPrimitives:0,n=this.averageSymbolComplexity,s=Math.max(1,Object(a["k"])(n)?n.primitivesPerFeature:1),o=Object(a["k"])(n)&&n.drawCallsPerFeature>0?i/n.drawCallsPerFeature*.3:i,c=Math.ceil(r/s),l=Math.max(t,Math.min(i,c,o)),d=this._get("displayFeatureLimit");return d&&d.minimumTotalNumberOfFeatures===t&&d.maximumTotalNumberOfFeatures===i&&d.maximumTotalNumberOfPrimitives===r&&d.averageSymbolComplexity===n&&d.maximumNumberOfFeatures===l?d:{minimumTotalNumberOfFeatures:t,maximumTotalNumberOfFeatures:i,maximumTotalNumberOfPrimitives:r,averageSymbolComplexity:n,maximumNumberOfFeatures:l}}get averageSymbolComplexity(){const e=Pt(this.symbolComplexities),t=this._get("averageSymbolComplexity");return 0===e.numComplexities||Object(a["k"])(t)&&(e.estimated&&(t.primitivesPerFeature>=e.primitivesPerFeature||t.primitivesPerCoordinate>=e.primitivesPerCoordinate||t.drawCallsPerFeature>=e.drawCallsPerFeature)||t.primitivesPerFeature===e.primitivesPerFeature&&t.primitivesPerCoordinate===e.primitivesPerCoordinate&&t.drawCallsPerFeature===e.drawCallsPerFeature)?t:e}get usedMemory(){const e=Object(a["k"])(this.averageSymbolComplexity)&&this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this.numberOfGraphics:0;return this._usedMemory+e}get usedMemoryPerGraphic(){if(this._usedMemory&&this.numberOfGraphics)return Math.abs(this.pendingAdds-this.pendingRemoves)/this.numberOfGraphics>30?0:this._usedMemory/this.numberOfGraphics;if(Object(a["k"])(this.averageSymbolComplexity)){const e=this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0;return this.averageSymbolComplexity.memory.bytesPerFeature+e}return 0}get unprocessedMemoryEstimate(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)}get symbolComplexities(){return this.currentRenderer?this._getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this._getSymbolComplexitiesUsed()}_getConvertedSymbol(e){if("web-style"===e.type)return e.clone();const t=this.symbolConversionCache.get(e.id);if(Object(a["k"])(t))return t;const i=Object(le["a"])(e,{retainId:!0,hasLabelingContext:this._hasLabelingContext(e)}),r=i.symbol||null;return Object(a["j"])(r)&&i.error&&pd.error(i.error.message),this.symbolConversionCache.set(e.id,r),r}_getSymbolComplexitiesUsedOrRenderer(e){if(Object(a["j"])(e))return[];const t=e.getSymbols(),i="backgroundFillSymbol"in e&&e.backgroundFillSymbol;if(!(i||t&&t.length))return[];const r=[],n=this._getSymbolComplexityUsedOrRenderer(i);Object(a["k"])(n)&&r.push(n);for(const s of t){const e=this._getSymbolComplexityUsedOrRenderer(s);Object(a["k"])(e)&&r.push(e)}return r}_getSymbolComplexityUsedOrRenderer(e){if(Object(a["j"])(e))return null;const t=this.symbols.get(e.id);if(Object(a["k"])(t))return t.complexity;const i=this._getConvertedSymbol(e);return Object(a["k"])(i)?Ct(i):null}_getSymbolComplexitiesUsed(){const e=[];return this.symbols.forEach(t=>{Object(a["k"])(t)&&e.push(t.complexity)}),e}initialize(){this._viewSpatialReference=this.owner.view.spatialReference,this._set("featureStore",new ge({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,hasZ:this.hasZ,hasM:this.hasM,viewSpatialReference:this._viewSpatialReference,featureSpatialReference:this.owner.featureSpatialReference,getSpatialIndex:()=>this.spatialIndex,forEach:e=>this.graphics3DGraphics.forEach(e),toArray:()=>Array.from(this.graphics3DGraphics.values())}))}async setup(e){this.setupAbortController=new AbortController;const t=this.setupAbortController.signal;this._set("elevationAlignment",e.elevationAlignment),this._set("scaleVisibility",e.scaleVisibility),this._set("filterVisibility",e.filterVisibility),this._set("deconflictor",e.deconflictor),this._set("labeler",e.labeler),this._set("objectStates",e.objectStates);const i=this.owner.view;this.viewElevationProvider=new he(this._viewSpatialReference,i),this._initializeStage(i,this.layer.uid),this.symbolCreationContext.sharedResources=i.sharedSymbolResources,this.sharedSymbolResourcesOwnerHandle=i.sharedSymbolResources.addGraphicsOwner(this.owner),Object(a["k"])(this.currentRenderer)&&(this.symbolCreationContext.renderer=this.currentRenderer),this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataRequester=i.sharedSymbolResources.streamDataRequester,this.symbolCreationContext.renderCoordsHelper=i.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.graphicsCoreOwner=this.owner,this.symbolCreationContext.localOriginFactory=new nd["a"](i.renderSpatialReference),this.symbolCreationContext.elevationProvider=i.elevationProvider,this.symbolCreationContext.notifyGraphicGeometryChanged=e=>this.notifyGraphicGeometryChanged(e),this.symbolCreationContext.notifyGraphicVisibilityChanged=e=>this.notifyGraphicVisibilityChanged(e);const r=Object(ue["e"])(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);if(this.symbolCreationContext.featureExpressionInfoContext=await Object(ue["b"])(r,this._viewSpatialReference,pd),Object(h["p"])(t),this.symbolCreationContext.screenSizePerspectiveEnabled=i.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings.physicallyBasedRenderingEnabled,"drapeSourceType"in this.owner){const{owner:e}=this;this.symbolCreationContext.drapeSourceRenderer=i.basemapTerrain.overlayManager.registerGeometryDrapeSource(e),this._handles.add(Object(d["c"])(()=>i.basemapTerrain.overlayManager.unregisterDrapeSource(e)))}this._handles.add([Object(n["f"])(()=>this.suspendedOrOutsideOfView,()=>this._frameTask.reschedule(()=>this._updateLayerVisibility())),Object(n["f"])(()=>{var e;return[null==(e=this.layer)?void 0:e.screenSizePerspectiveEnabled,this.owner.view.screenSizePerspectiveEnabled]},()=>{var e;const t=i.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;t!==this.symbolCreationContext.screenSizePerspectiveEnabled&&(this.symbolCreationContext.screenSizePerspectiveEnabled=t,null!=(e=this.labeler)&&e.reset(),this.recreateAllGraphicsAndSymbols())}),Object(n["f"])(()=>this.owner.slicePlaneEnabled,e=>this._slicePlaneEnabledChange(!!e)),Object(n["f"])(()=>{var e;return null==(e=this.owner.view.state)?void 0:e.pixelRatio},()=>this._pixelRatioChange()),Object(n["f"])(()=>{var e;return null==(e=this.owner.view.qualitySettings)?void 0:e.physicallyBasedRenderingEnabled},e=>this._physicalBasedRenderingChange(e)),Object(n["g"])(()=>{var e;return null==(e=i.basemapTerrain)?void 0:e.tilingScheme},e=>{if(e.spatialReference.equals(this.symbolCreationContext.overlaySR)||(this.symbolCreationContext.overlaySR=i.basemapTerrain.spatialReference),this._handles.has("loaded-graphics"))this.recreateAllGraphics();else{const e=()=>{var e;return null==(e=this.owner)?void 0:e.loadedGraphics};this._handles.add([Object(n["b"])(e,"change",e=>{this._graphicsCollectionChanged(e),this._signalUpdatingDuringAsyncLoadedGraphicsChange()},{onListenerAdd:()=>{this.recreateAllGraphics(),this._signalUpdatingDuringAsyncLoadedGraphicsChange()}})],"loaded-graphics")}},{initial:!0}),Object(n["f"])(()=>this.effectiveUpdatePolicy,e=>{Object(a["k"])(this.stageLayer)&&(this.stageLayer.updatePolicy=e),this.symbolCreationContext.isAsync=this.effectiveUpdatePolicy===Xe["j"].ASYNC,e===Xe["j"].SYNC&&this.runTask(de["c"])},n["e"])]),this._frameTask=i.resourceController.scheduler.registerTask(de["b"].GRAPHICS_CORE,this),this.layer&&"featureReduction"in this.layer&&this._handles.add(Object(n["f"])(()=>this.layer.featureReduction,()=>this.deconflictor.featureReductionChange())),this.notifyChange("averageSymbolComplexity");try{await this.rendererChange(this.layer.renderer)}catch{}Object(h["p"])(t),this.setupAbortController=null}_abortSetup(){this.setupAbortController&&(this.setupAbortController.abort(),this.setupAbortController=null)}destroy(){this._abortSetup(),this._abortRendererChange(),this._abortElevationInfoChange(),this.owner.view.deconflictor.removeGraphicsOwner(this),this.owner.view.labeler.removeGraphicsOwner(this),this._updatingPendingLoadedGraphicsChange=Object(a["q"])(this._updatingPendingLoadedGraphicsChange),this.clear(),this.graphicStateTracking=Object(a["d"])(this.graphicStateTracking),this.stage&&(this.stage.remove(this.stageLayer),this.stageLayer=null,this.stage=null),this._handles=Object(a["d"])(this._handles),this._frameTask.remove(),this._frameTask=de["a"],this._viewSpatialReference=null,this._set("owner",null);for(const e in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[e].reject(new D["a"]("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null,this.sharedSymbolResourcesOwnerHandle=Object(a["q"])(this.sharedSymbolResourcesOwnerHandle),this.propertiesPool=Object(a["d"])(this.propertiesPool),this.pendingUpdatesPool=null,this.symbolConversionCache.clear(),this.objectIdInvisibleSet.clear(),this._spatialIndex=Object(a["d"])(this._spatialIndex),this._set("featureStore",Object(a["d"])(this.featureStore))}clear(){var e,t;null!=(e=this.objectStates)&&e.allGraphicsDeleted(),Object(a["k"])(this.graphicStateTracking)&&this.graphicStateTracking.allGraphicsDeleted(),this.graphics3DGraphics.forEach(e=>e.destroy()),null!=(t=this._spatialIndex)&&t.clear(),this.graphics3DGraphics.clear(),this.numberOfGraphics=0,this._usedMemory=0,this._updateLayerVisibility(),this.symbols.forEach(a["d"]),this.symbols.clear(),this.graphicsBySymbol.clear(),this.graphicsWithoutSymbol.clear(),this.graphicsWaitingForSymbol.clear(),this.pendingUpdates.clear(),this.pendingUpdatesPool.clear(),this.pendingAdds=0,this.pendingRemoves=0,this.notifyChange("updating"),this.notifyChange("running"),this.notifyChange("updatingRemaining"),this.featureStore.events.emit("changed")}_initializeStage(e,t){this.stage=e._stage,this.stageLayer=new sd["a"]({isPickable:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},t),this.stage.add(this.stageLayer);const i=this.stageLayer.events;i.on("objectTransformation",e=>this.notifyGraphicGeometryChanged(e.metadata.graphicUid)),i.on("visibilityChanged",e=>this.notifyGraphicVisibilityChanged(e.metadata.graphicUid)),i.on("objectGeometryAdded",e=>this.notifyGraphicGeometryChanged(e.object.metadata.graphicUid)),i.on("objectGeometryRemoved",e=>this.notifyGraphicGeometryChanged(e.object.metadata.graphicUid)),i.on("vertexAttrsUpdated",e=>this.notifyGraphicGeometryChanged(e.object.metadata.graphicUid))}notifyGraphicGeometryChanged(e){if(Object(a["j"])(this.graphicStateTracking)||Object(a["j"])(e))return;const t=this.graphics3DGraphics.get(e);t&&this.graphicStateTracking.updateGraphicGeometry(t)}notifyGraphicVisibilityChanged(e){if(Object(a["j"])(this.graphicStateTracking)||Object(a["j"])(e))return;const t=this.graphics3DGraphics.get(e);t&&this.graphicStateTracking.updateGraphicVisibility(t)}_updateLayerVisibility(){const e=this.displayFeatureLimit.maximumNumberOfFeatures,t=this.numberOfGraphics>e*gd,i=!this.suspendedOrOutsideOfView&&!t;i!==this._visible&&(this._visible=i,i?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this._hideAllGraphics()),this._updateStageLayerVisibility())}_updateStageLayerVisibility(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||this.layer.opacity>0)}getGraphics3DGraphicById(e){return this.graphics3DGraphics.get(e)}getGraphics3DGraphicByObjectId(e){var t;return null!=(t=this.owner.layer)&&t.objectIdField?this._findGraphics3DGraphicByObjectId(e):null}_getGraphicObjectID(e,t=this.owner.layer&&this.owner.layer.objectIdField){return Object(W["e"])(e,t)}get graphics3DGraphicsByObjectID(){const e=this.owner.layer&&this.owner.layer.objectIdField;if(!e)return null;const t=new Map;return this.graphics3DGraphics.forEach(i=>{if(!i)return;const r=i.graphic,n=this._getGraphicObjectID(r,e);Object(a["k"])(n)&&t.set(n,i)}),t}get labelsEnabled(){return!(!this.labeler||!this.labeler.layerLabelsEnabled())}async updateLabelingInfo(e){const t=this.deconflictor&&this.deconflictor.labelingInfoChange(e),i=this.labeler&&this.labeler.labelingInfoChange(e);await Object(h["g"])([t,i])}updateVisibilityInfo(){this.deconflictor&&this.deconflictor.labelingInfoChange(),this.labeler&&this.labeler.visibilityInfoChange()}get symbolUpdateType(){if(this.pendingUpdates.size>0)return"unknown";let e=0,t=0;return Object(F["c"])(this.symbols,(i,r)=>{if(Object(a["k"])(i)){const a=i.getFastUpdateStatus();if(a.loading>0)return!0;this.graphicsBySymbol.has(r)&&(t+=a.fast,e+=a.slow)}return!1})?"unknown":t>=0&&0===e?"fast":e>=0&&0===t?"slow":"mixed"}runTask(e){this._frameTask.processQueue(e),this._applyPendingUpdates(e),this.notifyChange("running"),this.running||this.notifyChange("updating"),this.notifyChange("updatingRemaining")}setObjectIdVisibility(e,t){t?this.objectIdInvisibleSet.delete(e):this.objectIdInvisibleSet.add(e);const i=this._findGraphics3DGraphicByObjectId(e);Object(a["k"])(i)&&this._updateUserVisibility(i)}_findGraphics3DGraphicByObjectId(e){return Object(F["a"])(this.graphics3DGraphics,t=>this._getGraphicObjectID(t.graphic)===e)}_updateUserVisibility(e){if(Object(a["j"])(e))return!1;const t=e.graphic,i=this._getGraphicObjectID(t),r=t.visible&&!this.owner.suspended&&(Object(a["j"])(i)||!this.objectIdInvisibleSet.has(i));return e.setVisibilityFlag(ce.USER_SETTING,r,oe.GRAPHIC)}_whenGraphics3DGraphic(e){const t=this.graphics3DGraphics.get(e.uid);if(t)return Promise.resolve(t);const i=this.whenGraphics3DGraphicRequests[e.uid];if(i)return i.promise;const r=Object(h["c"])();return this.whenGraphics3DGraphicRequests[e.uid]=r,r.promise}async _boundsForGraphics3DGraphic(e,t){const i=this._viewSpatialReference,r=this.owner.view.renderSpatialReference,n=this.owner.view.basemapTerrain.spatialReference,s=(e,t,a)=>Object(B["l"])(e,r,t,e,i,t,a),o=(e,t,r)=>Object(B["l"])(e,n,t,e,i,t,r),c=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:Object(a["k"])(t)&&t.useViewElevation,minDemResolution:Object(a["k"])(t)&&t.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null,l=await e.getProjectedBoundingBox(s,o,c,Object(a["i"])(t,"signal"));if(!l)return null;const d=l.boundingBox;if(l.requiresDrapedElevation){const e=this.symbolCreationContext.elevationProvider;if(e){Object(k["d"])(d,hd);const t=Object(a["s"])(e.getElevation(hd[0],hd[1],0,i,"ground"),0);d[2]=Math.min(d[2],t),d[5]=Math.max(d[5],t)}}return{boundingBox:d,screenSpaceObjects:l.screenSpaceObjects}}async whenGraphicBounds(e,t){await Object(n["h"])(()=>{var e;return null==(e=this.owner)?void 0:e.loadedGraphics});const i=this.owner.layer&&this.owner.layer.objectIdField,r=this.owner.loadedGraphics.find(t=>t===e||i&&t.attributes&&e.attributes&&t.attributes[i]===e.attributes[i]);if(!r)throw new D["a"]("internal:graphic-not-part-of-view","Graphic is not part of this view");const a=await this._whenGraphics3DGraphic(r);return this._boundsForGraphics3DGraphic(a,t)}computeAttachmentOrigin(e,t){const i=this.graphics3DGraphics.get(e.uid);if(!i)return null;const r=i.computeAttachmentOrigin();if(0===r.render.num&&0===r.draped.num)return null;Object(V["w"])(Od,0,0,0);let n=0;if(r.render.num>0){if(!Object(B["w"])(r.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,vd,t))return null;Object(V["e"])(Od,Od,vd),n++}if(r.draped.num>0){const[e,i]=r.draped.origin,s=Object(a["s"])(this.viewElevationProvider.getElevation(e,i,"ground"),0);if(Object(V["w"])(vd,e,i,s),!Object(B["w"])(vd,this.viewElevationProvider.spatialReference,vd,t))return null;Object(V["e"])(Od,Od,vd),n++}return n>1&&Object(V["k"])(Od,Od,1/n),new od["a"]({x:Od[0],y:Od[1],z:Od[2],spatialReference:t})}getSymbolLayerSize(e,t){const i=this.symbols.get(e.id);if(Object(a["j"])(i))throw new D["a"]("internal:symbol-not-part-of-view","Symbol is not part of this view");const r=e.symbolLayers.indexOf(t);if(-1===r)throw new D["a"]("internal:missing-symbol-layer","Symbol layer is not in symbol");const n=i.getSymbolLayerSize(r);if(null==n)throw new D["a"]("internal:missing-size","Symbol layer has no valid size");return n}_graphicsCollectionChanged(e){this._startCreateGraphics&&(this.add(e.added),this.remove(e.removed))}graphicUpdateHandler(e){const t=e.graphic.uid,i=this.graphics3DGraphics.get(t);if(!Object(a["j"])(i)||!Object(a["j"])(this.graphicsWithoutSymbol.get(t)))switch(e.property){case"visible":this._graphicUpdateVisibleHandler(i);break;case"geometry":this._graphicUpdateGeometryHandler(i,e);break;case"symbol":this._graphicUpdateSymbolHandler(i,e);break;case"attributes":break;case"transform":this._graphicUpdateTransformHandler(i,e)}}_graphicUpdateGeometryHandler(e,t){const i=t.graphic.geometry;if(Object(a["j"])(i))return void this._recreateGraphic(t.graphic);if(Object(a["j"])(e)){const e=t.graphic.symbol&&t.graphic.symbol.id;if(e){const t=this.symbols.get(e);if(Object(a["k"])(t)&&t.loadStatus===it.LOADING)return}return void this._recreateGraphic(t.graphic)}const r=e.graphics3DSymbol;!Object(a["j"])(t.newValue)&&r.updateGeometry(e,t.newValue)||this._recreateGraphic(e.graphic),this._expandComputedExtent(i)}_graphicUpdateSymbolHandler(e,t){const i=t.graphic,r=Object(a["k"])(e)?e.graphics3DSymbol:Object(a["k"])(t.oldValue)?this.symbols.get(t.oldValue.id):null;if(Object(a["j"])(r)||Object(a["j"])(t.newValue))return void this._recreateGraphic(i);const n=r.symbol,s=this._getConvertedSymbol(t.newValue);if(Object(a["k"])(s)&&(s.type!==n.type||"web-style"===s.type)||"web-style"===n.type)return void this._recreateGraphic(i);const o=this.graphicsBySymbol.get(n.id);if(o&&1!==o.size)return void this._recreateGraphic(i);const c=Object(g["a"])(n,s);if(Object(a["j"])(c))return void this._updateSymbolMapping(n.id,s);const l={diff:c,graphics3DGraphicPatches:[],symbolStatePatches:[]};if(r.prepareSymbolPatch(l),!Object(g["d"])(l.diff))return void this._recreateGraphic(i);const d=this._getRenderingInfo(i);if(Object(a["j"])(d))return void this._recreateGraphic(i);const h=r.extentPadding;for(const a of l.symbolStatePatches)a();if(h!==r.extentPadding&&this._recomputeExtentPadding(),Object(a["k"])(e))for(const a of l.graphics3DGraphicPatches)a(e,d);this._updateSymbolMapping(n.id,s)}_graphicUpdateVisibleHandler(e){this._updateUserVisibility(e)&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())}_graphicUpdateTransformHandler(e,t){}recreateGraphics(e){this.suspendSymbolCleanup=!0,this.remove(e),this.add(e),this.suspendSymbolCleanup=!1,this.effectiveUpdatePolicy===Xe["j"].SYNC&&this._cleanupSymbols()}_recreateGraphic(e){this.recreateGraphics([e])}_beginGraphicUpdate(e){const t=this.graphicsUpdateId;return this.graphicsUpdateId++,this.graphicsWaitingForSymbol.set(e.uid,t),1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating"),t}_endGraphicUpdate(e){e&&(this.graphicsWaitingForSymbol.delete(e.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating")))}_recomputeExtentPadding(){let e=0;this.symbols.forEach(t=>{Object(a["k"])(t)&&(e=Math.max(e,t.extentPadding))}),this._set("extentPadding",e)}_expandComputedExtent(e){const t=ud,i=e.spatialReference;Object(W["c"])(e,t);const r=this._viewSpatialReference,a=rd.tmpVec;if(i.equals(r)||Object(B["y"])(t[0],t[1],0,i,a,r)&&(t[0]=a[0],t[1]=a[1],Object(B["y"])(t[3],t[4],0,i,a,r),t[3]=a[0],t[4]=a[1]),!(isFinite(t[0])&&isFinite(t[3])&&isFinite(t[1])&&isFinite(t[4])))return;const n=this.computedExtent;let s=null;const o=isFinite(t[2])&&isFinite(t[5]),c=o&&(!n||null==n.zmin||t[2]<n.zmin),l=o&&(!n||null==n.zmax||t[5]>n.zmax);n?(t[0]<n.xmin||t[1]<n.ymin||t[3]>n.xmax||t[4]>n.ymax||c||l)&&(s=this.propertiesPool.get("computedExtent"),s.xmin=Math.min(t[0],n.xmin),s.ymin=Math.min(t[1],n.ymin),s.xmax=Math.max(t[3],n.xmax),s.ymax=Math.max(t[4],n.ymax),s.spatialReference=r):(s=this.propertiesPool.get("computedExtent"),s.xmin=t[0],s.ymin=t[1],s.xmax=t[3],s.ymax=t[4],s.spatialReference=r),s&&(c&&(s.zmin=t[2]),l&&(s.zmax=t[5]),this._set("computedExtent",s))}_abortElevationInfoChange(){this.elevationInfoChangeAbortController&&(this.elevationInfoChangeAbortController.abort(),this.elevationInfoChangeAbortController=null)}async elevationInfoChange(){var e,t;this._abortElevationInfoChange();const i=new AbortController;this.elevationInfoChangeAbortController=i;const r=Object(ue["e"])(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=await Object(ue["b"])(r,this._viewSpatialReference,pd),Object(h["p"])(i),this.elevationInfoChangeAbortController=null,null!=(e=this.labeler)&&e.elevationInfoChange(),this.forEachGraphics3DSymbol((e,t,i)=>{e.globalPropertyChanged("elevationInfo",t)?t.forEach(e=>{const t=e.graphic,i=e.labelGraphics;for(const r of i)r.graphics3DSymbolLayer.updateGraphicElevationContext(t,r)}):this._recreateSymbol(i)}),this.updateStageLayerElevationProvider(),null==(t=this.elevationAlignment)||t.elevationInfoChange()}updateStageLayerElevationProvider(){this.stageLayerElevationProvider?(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this.numberOfGraphicsProvidingElevation)&&(this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null):(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&this.numberOfGraphicsProvidingElevation>0&&(this.stageLayerElevationProvider=new Xl({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this.stageLayerElevationProvider))}_clearSymbolsAndGraphics(){var e,t,i,r;this.clear(),Object(a["k"])(this.filterVisibility)&&this.filterVisibility.clear(),null!=(e=this.labeler)&&e.reset(),null!=(t=this.deconflictor)&&t.clear(),null!=(i=this.elevationAlignment)&&i.clear(),null!=(r=this.stageLayer)&&r.invalidateSpatialQueryAccelerator(),this.stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null)}startCreateGraphics(){this._startCreateGraphics=!0,this.recreateAllGraphics()}recreateAllGraphics(){this._recreateAllGraphics(!1)}recreateAllGraphicsAndSymbols(){this._recreateAllGraphics(!0)}_recreateAllGraphics(e=!1){if(!this._startCreateGraphics)return;const{loadedGraphics:t,view:i}=this.owner,r=i.basemapTerrain.tilingScheme&&t&&t.length?t.toArray():null;!e&&r||this._clearSymbolsAndGraphics(),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this._set("computedExtent",null),r&&(e?this.add(r):this.recreateGraphics(r))}_recreateSymbol(e){const t=this.graphicsBySymbol.get(e),i=[];t&&(t.forEach((e,t)=>{var r;const a=e.usedMemory;this._conditionalRemove(e,t),null!=(r=this._spatialIndex)&&r.remove(e),i.push(e.graphic),e.destroy(),this._removeGraphics3DGraphic(t,a),this._updateLayerVisibility(),this.featureStore.events.emit("changed")}),this.graphicsBySymbol.set(e,new Map));const r=this.symbols.get(e);Object(a["d"])(r),this.symbols.delete(e),this.add(i)}_recreateGraphicsForSymbol(e){const t=this.graphicsBySymbol.get(e);if(t){const e=[];t.forEach(t=>e.push(t.graphic)),this.recreateGraphics(e)}}_conditionalRemove(e,t){var i,r,n;this.graphicsDrapedUids.delete(t),null!=(i=this.objectStates)&&i.removeGraphic(e),null!=(r=this.labeler)&&r.removeGraphic(e),null!=(n=this.deconflictor)&&n.removeGraphic(e),Object(a["k"])(this.graphicStateTracking)&&this.graphicStateTracking.removeGraphic(e)}add(e){e&&0!==e.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this._updatePolicyForGraphics(e)===Xe["j"].ASYNC?this._addDelayed(e):this._addImmediate(e),this.notifyChange("updating")):pd.error("#add()","Cannot add graphics before terrain surface has been initialized"))}_updatePolicyForGraphics(e){if(this.effectiveUpdatePolicy===Xe["j"].SYNC&&("mesh"===this.layer.geometryType||null==this.layer.geometryType))for(const t of e)if(Object(a["k"])(t.geometry)&&"mesh"===t.geometry.type&&!t.geometry.loaded)return Xe["j"].ASYNC;return this.effectiveUpdatePolicy}_addImmediate(e){this.geometryWarningLogged=!1,this.symbolWarningLogged=!1;for(const t of e)this._addGraphic(t,this._getRenderingInfo(t,pd),Xe["j"].SYNC);this._cleanupSymbols(),this.labeler&&(this.owner.view.labeler.setDirty(),this._cleanupSymbols()),this.owner.view.deconflictor.setDirty()}_addDelayed(e){for(const t of e){const e=t.uid;let i=this.pendingUpdates.get(e);i?i.add?i.state!==fd.NEW&&i.abortController.abort():this.pendingAdds++:(i=this.pendingUpdatesPool.pushNew(),this.pendingAdds++,this.pendingUpdates.set(e,i)),i.add=t}this.notifyChange("running"),this.notifyChange("updatingRemaining")}remove(e){this.effectiveUpdatePolicy===Xe["j"].ASYNC?this._removeDelayed(e):this._removeImmediate(e),this.notifyChange("updating")}_removeImmediate(e){for(const t of e)this._removeGraphic(t);this._cleanupSymbols(),this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty()}_removeDelayed(e){for(const t of e){const e=t.uid,i=this.pendingUpdates.get(e);if(i)i.add&&(i.remove?i.add=null:this.pendingUpdates.delete(e),i.state===fd.LOADING&&i.abortController.abort(),this.pendingAdds--);else{const i=this.pendingUpdatesPool.pushNew();i.remove=t,this.pendingUpdates.set(e,i),this.pendingRemoves++}}0===this.pendingUpdates.size&&this._finishPendingUpdates(),this.notifyChange("running"),this.notifyChange("updatingRemaining")}_finishPendingUpdates(){this.pendingUpdatesPool.clear(),this._cleanupSymbols(),(this.pendingAdds||this.pendingRemoves)&&pd.warn("pendingAdds/Removes in inconsistent state!"),this.pendingAdds=0,this.pendingRemoves=0}_applyPendingUpdates(e){var t;if(this.geometryWarningLogged=!1,this.symbolWarningLogged=!1,0===this.pendingUpdates.size&&null!=(t=this._spatialIndex)&&t.updating)this._spatialIndex.update();else{for(const[t,i]of this.pendingUpdates){if(e.done)break;i.add&&i.state===fd.NEW&&this._processPendingUpdateNew(i);let r=this.effectiveUpdatePolicy;if(!i.remove||i.add&&i.state!==fd.READY||(this.pendingRemoves--,e.madeProgress(),this._removeGraphic(i.remove),i.remove=null,r=Xe["j"].SYNC),i.add)switch(i.state){case fd.READY:this._addGraphic(i.add,i.renderingInfo,r),i.add=null,this.pendingAdds--,e.madeProgress();break;case fd.REJECTED:i.add=null,this.pendingAdds--;case fd.LOADING:}null==i.remove&&null==i.add&&this.pendingUpdates.delete(t)}0===this.pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("running"))}}_processPendingUpdateNew(e){if(!e.add)return void(e.state=fd.READY);const t=e.add.geometry;Object(a["k"])(t)&&"mesh"===t.type&&!t.loaded?this._processPendingUpdateNewMesh(e,t):this._processPendingUpdateNewRenderingInfo(e)}async _processPendingUpdateNewMesh(e,t){e.state=fd.LOADING,e.abortController=new AbortController;const i=e.abortController.signal;try{await t.load({signal:i})}catch(r){return this._processPendingUpdateNewError(e,r)}e.abortController=null,this._processPendingUpdateNewRenderingInfo(e)}_processPendingUpdateNewError(e,t){e.abortController=null,Object(h["j"])(t)?e.state=fd.NEW:e.state=fd.REJECTED}async _processPendingUpdateNewRenderingInfo(e){if(Object(a["j"])(this.layer.renderer)||"dictionary"!==this.layer.renderer.type)return e.renderingInfo=this._getRenderingInfo(e.add,pd),void(e.state=fd.READY);e.state=fd.LOADING,e.abortController=new AbortController;let t=null;try{t=await this._getRenderingInfoAsync(e.add,{signal:e.abortController.signal})}catch(i){return e.abortController=null,void(Object(h["j"])(i)?e.state=fd.NEW:e.state=fd.REJECTED)}Object(a["j"])(t)||Object(a["j"])(t.symbol)?(pd&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,pd.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),e.renderingInfo=null):e.renderingInfo=t,e.state=fd.READY}_addGraphic(e,t,i){if(this.graphicsWithoutSymbol.set(e.uid,e),Object(a["j"])(t)||Object(a["j"])(t.symbol)||!Object(W["f"])(e))return;const r=t.symbol,n=this.getOrCreateGraphics3DSymbol(r,t.renderer);if(Object(a["j"])(n))return;this._expandComputedExtent(e.geometry);const s=this._beginGraphicUpdate(e),o=new ve(e,t,this.layer);let c=!1;const l=e=>{e===n.symbol.id&&(c=!0)};this._whenSymbolRemoved.push(l);const d=()=>{if(--this._loadingSymbols,!this.destroyed){if(this._whenSymbolRemoved.removeUnordered(l),this.graphicsWaitingForSymbol.get(e.uid)!==s||c||n.destroyed||this.graphicSymbolSupported&&e.symbol&&e.symbol.id!==n.symbol.id)--n.referenced,this._cleanupSymbols();else{const t=this._createGraphics3DGraphic(n,o);this._spatialIndex&&Object(a["k"])(t)&&this._spatialIndex.add(t),--n.referenced,this._endGraphicUpdate(e)}this.featureStore.events.emit("changed"),this.labeler&&this.owner.view.labeler.setDirty()}},u=t=>{--this._loadingSymbols,this.destroyed||(this._whenSymbolRemoved.removeUnordered(l),c||(Object(h["j"])(t)?this.add([e]):n.destroyed||this._endGraphicUpdate(e)))};++this._loadingSymbols,i===Xe["j"].ASYNC?n.load(()=>this._frameTask.schedule(d),e=>this._frameTask.schedule(()=>u(e))):n.load(d,u)}_removeGraphic(e){const t=e.uid,i=this.graphics3DGraphics.get(t);if(i){var r;i.graphics3DSymbol.onRemoveGraphic(i);const e=i.usedMemory,a=i.isElevationSource;this._conditionalRemove(i,t),null==(r=this._spatialIndex)||r.remove(i);const n=i.graphics3DSymbol.symbol.id;this.graphicsBySymbol.get(n).delete(t),this.graphicsWithoutSymbol.delete(t),this._removeGraphics3DGraphic(t,e,a),i.destroy(),this.featureStore.events.emit("changed")}else this.graphicsWithoutSymbol.delete(t),this.graphicsWaitingForSymbol.delete(t),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"))}_hasLabelingContext(e){if(e instanceof cd["a"]||e instanceof ld["a"]){const t=this.symbolCreationContext.layer;return!!t.labelingInfo&&t.labelingInfo.some(t=>t.symbol===e)}return!1}_hasValidSymbolCreationContext(e){return!(e instanceof cd["a"]&&!this._hasLabelingContext(e))||(pd.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1)}_getRenderingInfo(e,t){const i=e.geometry;if(Object(a["j"])(i))return t&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,t.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!Object(B["b"])(i.spatialReference,this._viewSpatialReference))return t&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,t.warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)),null;if(!this.graphicSymbolSupported&&Object(a["k"])(e.symbol))return t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;const r=this.rendererHasGeometryOperations?Object(v["c"])(e,this.layer):e;let n;return n=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||Object(a["k"])(this.currentRenderer))?this.owner.getRenderingInfo(r,this.currentRenderer,Object(a["r"])(this.arcadeOnDemand)):{symbol:r.symbol||se(r.geometry)},Object(a["j"])(n)||Object(a["j"])(n.symbol)?(t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),null):n}_getRenderingInfoAsync(e,t){const i=e.geometry;if(Object(a["j"])(i))return pd&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,pd.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!this.graphicSymbolSupported&&Object(a["k"])(e.symbol))return pd&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,pd.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;const r=this.rendererHasGeometryOperations?Object(v["c"])(e,this.layer):e;return this.owner.getRenderingInfoAsync(r,Object(a["r"])(this.currentRenderer),Object(a["r"])(this.arcadeOnDemand),t)}_createGraphics3DSymbol(e,t){if(!this._hasValidSymbolCreationContext(e))return null;const i=this._getConvertedSymbol(e);if(!i)return null;let r;if(Object(a["k"])(t)&&"backgroundFillSymbol"in t&&t.backgroundFillSymbol){const e=Object(le["a"])(t.backgroundFillSymbol,{ignoreDrivers:!0});Object(a["k"])(e.symbol)&&"web-style"!==e.symbol.type&&"cim"!==e.symbol.type&&(r=e.symbol.symbolLayers)}const n=Gl(i,this.symbolCreationContext,r);return n.load(()=>{const e=n.extentPadding;e>this.extentPadding&&this._set("extentPadding",e),this.notifyChange("averageSymbolComplexity")},()=>{}),n}getOrCreateGraphics3DSymbol(e,t){let i=this.symbols.get(e.id);return void 0===i&&(i=e instanceof dd["a"]?new Vl(e,e=>this._frameTask.schedule(e),e=>this._createGraphics3DSymbol(e,t)):this._createGraphics3DSymbol(e,t),this.symbols.set(e.id,i)),Object(a["k"])(i)&&++i.referenced,i}trackGraphicState(e){return Object(a["j"])(this.graphicStateTracking)&&(this.graphicStateTracking=new Ul(this)),this.graphicStateTracking.add(e)}_addGraphics3DGraphic(e){this._usedMemory+=e.usedMemory,this.graphics3DGraphics.set(e.graphic.uid,e),this.numberOfGraphics++,e.isElevationSource&&(this.numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider()),this._updateLayerVisibility()}_removeGraphics3DGraphic(e,t,i=!1){this._usedMemory-=t,this.graphics3DGraphics.delete(e),this.numberOfGraphics--,i&&(this.numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider()),this._updateLayerVisibility()}_createGraphics3DGraphic(e,t){var i,r,n;const s=t.graphic;if(this.graphicsWithoutSymbol.delete(s.uid),!this.symbols.has(e.symbol.id))return this.add([s]),null;if(this.graphics3DGraphics.has(s.uid))return null;const o=e.createGraphics3DGraphic(t);if(Object(a["j"])(o))return null;this._addGraphics3DGraphic(o);const c=e.symbol.id;this.graphicsBySymbol.has(c)||this.graphicsBySymbol.set(c,new Map),this.graphicsBySymbol.get(c).set(s.uid,o),o.isDraped&&this.graphicsDrapedUids.add(s.uid),o.centroid=null,Object(a["k"])(s.geometry)&&"point"!==s.geometry.type&&(o.centroid=Object(Ae["a"])(s.geometry,this._viewSpatialReference)),this._updateUserVisibility(o),Object(a["k"])(this.scaleVisibility)&&this.scaleVisibility.updateVisibility(o),Object(a["k"])(this.filterVisibility)&&this.filterVisibility.updateVisibility(o),null!=(i=this.deconflictor)&&i.addGraphic(o),null!=(r=this.labeler)&&r.addGraphic(o),null!=(n=this.objectStates)&&n.addGraphic(o),this.deconflictor&&this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,o),o.initialize(this.stage,this.stageLayer,this.owner),Object(a["k"])(this.graphicStateTracking)&&this.graphicStateTracking.addGraphic(o);const l=this.whenGraphics3DGraphicRequests[s.uid];return l&&(delete this.whenGraphics3DGraphicRequests[s.uid],l.resolve(o)),o}_abortRendererChange(){this.rendererChangeAbortController&&(this.rendererChangeAbortController.abort(),this.rendererChangeAbortController=null)}async rendererChange(e){if(this._abortRendererChange(),e!==this.currentRenderer)if(this._validateRenderer(e),Object(a["j"])(e)&&this._currentRendererChange(null,!1),Object(q["a"])(e))if(Object(a["k"])(e)&&e.arcadeRequired){const t=new AbortController;this.rendererChangeAbortController=t;const{arcadeUtils:i}=await this._ensureArcade();Object(h["p"])(t),i.hasGeometryOperations(e)&&(await i.enableGeometryOperations(),Object(h["p"])(t)),this.effectiveUpdatePolicy===Xe["j"].ASYNC?await this._frameTask.schedule(()=>this._currentRendererChange(e,!0),t.signal):this._currentRendererChange(e,!0),this.rendererChangeAbortController=null}else if(this.effectiveUpdatePolicy===Xe["j"].ASYNC){const t=new AbortController;this.rendererChangeAbortController=t,await this._frameTask.schedule(()=>this._currentRendererChange(e,!1),t.signal),this.rendererChangeAbortController=null}else this._currentRendererChange(e,!1);else this._currentRendererChange(e,!1)}async _ensureArcade(){return Object(a["j"])(this.arcadeOnDemand)?(this.arcadeOnDemand=await Object($["e"])(),this.arcadeOnDemand):this.arcadeOnDemand}_currentRendererChange(e,t){this.currentRenderer=e,this.rendererHasGeometryOperations=t,this.symbolCreationContext.arcade=Object(a["r"])(this.arcadeOnDemand);const i=this.symbolCreationContext.renderer;if(e===i)return;if(this.symbolConversionCache.clear(),Object(a["j"])(e))return this.symbolCreationContext.renderer=null,void this.recreateAllGraphicsAndSymbols();const r=Object(g["a"])(i,e);this._updateUnchangedSymbolMappings(r,e,i),this.symbolCreationContext.renderer=e,Object(a["j"])(r)||("complete"===r.type?this.recreateAllGraphicsAndSymbols():"partial"===r.type&&(this._applyRendererDiff(r,e,i)?this._volatileGraphicsUpdated():this.recreateAllGraphicsAndSymbols()),this.notifyChange("averageSymbolComplexity"))}_diffHasSymbolChange(e){for(const t in e.diff)switch(t){case"visualVariables":case"defaultSymbol":case"uniqueValueInfos":break;case"authoringInfo":case"fieldDelimiter":delete e.diff[t];break;default:return!0}return!1}_applySymbolSetDiff(e,t,i){e=e||[],t=t||[];const r=[];for(const n of t){const t=this.graphicsBySymbol.get(n.id);t&&t.forEach((s,o)=>{const c=s.graphic,l=this.layer instanceof O["a"]?this.layer:null,d=Object(a["r"])(this.arcadeOnDemand);if(n===i.defaultSymbol&&i.getSymbol(Object(v["c"])(c,l),{arcade:d})===i.defaultSymbol)return;const h=s.usedMemory;e.length||i.defaultSymbol?r.push(c):this.graphicsWithoutSymbol.set(o,c);const u=this.graphics3DGraphics.get(o);this._conditionalRemove(u,o),s.destroy(),t.delete(o),this._removeGraphics3DGraphic(o,h),this._updateLayerVisibility()}),this._whenSymbolRemoved.forAll(e=>e(n.id))}(e.length||r.length)&&(this.graphicsWithoutSymbol.forEach(e=>r.push(e)),this.graphicsWithoutSymbol.clear(),this.add(r)),this._cleanupSymbols(),this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty()}_applyUniqueValueRendererDiff(e,t,i){const r=e.diff.defaultSymbol,a=e.diff.uniqueValueInfos;if(r||a){const n=a?a.added.map(e=>e.symbol):[],s=a?a.removed.map(e=>e.symbol):[];if(a)for(let e=0;e<a.changed.length;e++)n.push(a.changed[e].newValue.symbol),s.push(a.changed[e].oldValue.symbol);return r?(i.defaultSymbol&&s.push(i.defaultSymbol),t.defaultSymbol&&n.push(t.defaultSymbol)):i.defaultSymbol&&n.length&&s.push(t.defaultSymbol),this._applySymbolSetDiff(n,s,t),delete e.diff.defaultSymbol,delete e.diff.uniqueValueInfos,!0}return!1}_calculateUnchangedSymbolMapping(e,t,i){if("unique-value"!==(null==t?void 0:t.type)||"unique-value"!==(null==i?void 0:i.type)||Object(a["k"])(e)&&"partial"!==e.type)return[];const r=e=>Object(a["k"])(e)?e.id:null,n=e&&e.diff,s=n&&n.defaultSymbol,o=n&&n.uniqueValueInfos;let c;if(o)c=o.unchanged.map(e=>({oldId:r(e.oldValue.symbol),newId:r(e.newValue.symbol)}));else{c=[];for(const e of i.uniqueValueInfos){const i=r(e.symbol),a=t.uniqueValueInfos.find(t=>t.value===e.value);a&&i!==r(a.symbol)&&c.push({oldId:i,newId:r(a.symbol)})}}return!s&&i.defaultSymbol&&c.push({oldId:r(i.defaultSymbol),newId:r(t.defaultSymbol)}),c}_updateSymbolMapping(e,t){const i=Object(a["k"])(t)&&t?"string"==typeof t?t:t.id:null;if(!e||e===i)return;const r=this.graphicsBySymbol.get(e);this.graphicsBySymbol.delete(e),void 0!==r&&this.graphicsBySymbol.set(i,r);const n=this.symbols.get(e);if(void 0!==n&&(this.symbols.delete(e),this.symbols.set(i,n),Object(a["k"])(n))){const e="string"==typeof t?null:t;Object(a["k"])(e)?n.symbol=e:n.symbol.id=i}}_updateUnchangedSymbolMappings(e,t,i){const r=this._calculateUnchangedSymbolMapping(e,t,i);for(const{oldId:a,newId:n}of r)this._updateSymbolMapping(a,n)}_applyRendererDiff(e,t,i){if(this._diffHasSymbolChange(e))return!1;if(t instanceof I["a"]&&i instanceof I["a"]&&this._applyUniqueValueRendererDiff(e,t,i)&&0===Object.keys(e.diff).length)return!0;for(const[r]of this.graphicsBySymbol){const i=this.symbols.get(r);if(Object(a["k"])(i))switch(i.applyRendererDiff(e,t)){case tt.Recreate_Symbol:this._recreateSymbol(r);break;case tt.Recreate_Graphics:this._recreateGraphicsForSymbol(r);case tt.Fast_Update:}}return!0}opacityChange(){this.forEachGraphics3DSymbol((e,t)=>e.globalPropertyChanged("opacity",t)),this._updateStageLayerVisibility()}_slicePlaneEnabledChange(e){e!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=e,this.stageLayer.isSliceable=e,this.forEachGraphics3DSymbol((e,t)=>e.globalPropertyChanged("slicePlaneEnabled",t)),this.deconflictor&&this.deconflictor.slicePlaneEnabledChange(),this.labeler&&this.labeler.slicePlaneEnabledChange())}_physicalBasedRenderingChange(e){e!==this.symbolCreationContext.physicalBasedRenderingEnabled&&(this.symbolCreationContext.physicalBasedRenderingEnabled=e,this.forEachGraphics3DSymbol((e,t,i)=>{e.globalPropertyChanged("physicalBasedRenderingEnabled",t)||this._recreateSymbol(i)}))}_pixelRatioChange(){this.forEachGraphics3DSymbol((e,t,i)=>{e.globalPropertyChanged("pixelRatio",t)||this._recreateSymbol(i)})}_signalUpdatingDuringAsyncLoadedGraphicsChange(){this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove(),this._updatingPendingLoadedGraphicsChange=Object(G["b"])(()=>{this._updatingPendingLoadedGraphicsChange=null})}setClippingExtent(e,t){const i=this.symbolCreationContext.clippingExtent,r=Object(H["k"])();return td(e,r,t)?this.symbolCreationContext.clippingExtent=Object(k["o"])(Object(k["f"])(),r):this.symbolCreationContext.clippingExtent=null,!Object(k["i"])(this.symbolCreationContext.clippingExtent,i)}modifyGraphics3DGraphicVisibilities(e){let t=!1;this.graphics3DGraphics.forEach(i=>{e(i)&&(t=!0)}),t&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())}forEachGraphics3DSymbol(e){for(const[t,i]of this.symbols){if(Object(a["j"])(i))return;e(i,this.graphicsBySymbol.get(t)||yd,t)}}updateAllGraphicsVisibility(){Object(a["k"])(this.filterVisibility)&&(this.filterVisibility.dirty=!0),this.modifyGraphics3DGraphicVisibilities(e=>{const t=this._updateUserVisibility(e),i=Object(a["k"])(this.scaleVisibility)&&this.scaleVisibility.updateVisibility(e);return t||i})}_hideAllGraphics(){this.modifyGraphics3DGraphicVisibilities(e=>e.setVisibilityFlag(ce.USER_SETTING,!1,oe.GRAPHIC))}_validateRenderer(e){const t=Object(q["b"])(e);if(t){const e=`Renderer for layer '${this.layer.title?this.layer.title+", ":""}, id:${this.layer.id}' is not supported in a SceneView`;pd.warn(e,t.message)}}_volatileGraphicsUpdated(){var e;null!=(e=this.labeler)&&e.reset(),this.stageLayer.shaderTransformationChanged(),this.notifyChange("updating")}_cleanupSymbols(){if(this.graphicsWaitingForSymbol.size>0||this.suspendSymbolCleanup)return;let e=!1;this.symbols.forEach((t,i)=>{if(Object(a["j"])(t)||t.referenced>0)return;const r=this.graphicsBySymbol.get(i);r&&0!==r.size||(this.graphicsBySymbol.delete(i),this.symbols.delete(i),Object(a["d"])(t),e=!0)}),e&&(this._recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}get test(){return{snapshotInternals:()=>({graphics:[...this.graphics3DGraphics.keys()].sort(),symbols:[...this.symbols.keys()].sort(),graphicsBySymbol:[...this.graphicsBySymbol.keys()].sort().map(e=>({symbolId:e,graphics:[...this.graphicsBySymbol.get(e).keys()].sort()})),graphicsWithoutSymbol:[...this.graphicsWithoutSymbol.keys()].sort(),graphicsDrapedUids:[...this.graphicsDrapedUids].sort(),pendingUpdates:this.pendingUpdates}),symbols:this.symbols,filterVisibility:this.filterVisibility,numPending:this.pendingUpdates.size,forceUpdatePolicy:e=>{this.forcedUpdatePolicy=e}}}get performanceInfo(){return{visible:this.graphics3DGraphics.size,missing:this.graphicsWithoutSymbol.size,pending:this.pendingUpdates.size}}};var fd;bd.tmpVec=Object(U["f"])(),Object(r["a"])([Object(s["b"])({readOnly:!0})],bd.prototype,"computedExtent",void 0),Object(r["a"])([Object(s["b"])()],bd.prototype,"currentRenderer",void 0),Object(r["a"])([Object(s["b"])()],bd.prototype,"rendererHasGeometryOperations",void 0),Object(r["a"])([Object(s["b"])()],bd.prototype,"_frameTask",void 0),Object(r["a"])([Object(s["b"])()],bd.prototype,"rendererChangeAbortController",void 0),Object(r["a"])([Object(s["b"])()],bd.prototype,"elevationInfoChangeAbortController",void 0),Object(r["a"])([Object(s["b"])()],bd.prototype,"setupAbortController",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],bd.prototype,"elevationAlignment",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],bd.prototype,"scaleVisibility",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],bd.prototype,"filterVisibility",void 0),Object(r["a"])([Object(s["b"])()],bd.prototype,"_spatialIndex",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],bd.prototype,"extentPadding",void 0),Object(r["a"])([Object(s["b"])()],bd.prototype,"_updatingPendingLoadedGraphicsChange",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],bd.prototype,"featureStore",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],bd.prototype,"deconflictor",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],bd.prototype,"labeler",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],bd.prototype,"objectStates",void 0),Object(r["a"])([Object(s["b"])()],bd.prototype,"_loadingSymbols",void 0),Object(r["a"])([Object(s["b"])()],bd.prototype,"preferredUpdatePolicy",void 0),Object(r["a"])([Object(s["b"])()],bd.prototype,"forcedUpdatePolicy",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],bd.prototype,"effectiveUpdatePolicy",null),Object(r["a"])([Object(s["b"])({constructOnly:!0})],bd.prototype,"elevationFeatureExpressionEnabled",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],bd.prototype,"owner",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],bd.prototype,"layer",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],bd.prototype,"graphicSymbolSupported",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],bd.prototype,"getRenderingInfoWithoutRenderer",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],bd.prototype,"updating",null),Object(r["a"])([Object(s["b"])({readOnly:!0})],bd.prototype,"running",null),Object(r["a"])([Object(s["b"])({readOnly:!0})],bd.prototype,"suspendedOrOutsideOfView",null),Object(r["a"])([Object(s["b"])({readOnly:!0,dependsOn:[]})],bd.prototype,"updatingRemaining",null),Object(r["a"])([Object(s["b"])({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","averageSymbolComplexity"]})],bd.prototype,"displayFeatureLimit",null),Object(r["a"])([Object(s["b"])({readOnly:!0,dependsOn:[]})],bd.prototype,"averageSymbolComplexity",null),Object(r["a"])([Object(s["b"])({constructOnly:!0})],bd.prototype,"hasZ",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],bd.prototype,"hasM",void 0),bd=rd=Object(r["a"])([Object(l["a"])("esri.views.3d.layers.graphics.Graphics3DCore")],bd),function(e){e[e.NEW=0]="NEW",e[e.LOADING=1]="LOADING",e[e.READY=2]="READY",e[e.REJECTED=3]="REJECTED"}(fd||(fd={}));class md{constructor(){this.add=null,this.renderingInfo=null,this.state=fd.NEW,this.remove=null}clear(){this.add=null,this.renderingInfo=null,this.state=fd.NEW,this.abortController=null,this.remove=null}}const gd=10,Od=Object(U["f"])(),vd=Object(U["f"])(),yd=new Map,_d=.05;class jd{constructor(){this._extents=new z["a"]({allocator:e=>e||Object(H["k"])()}),this._tmpExtent=Object(H["k"])(),this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(e){this._contains(e)||(this._removeContained(e),Object(H["j"])(this._extents.pushNew(),e),this._dirty=!0)}pop(){return this._dirty&&this._mergeTight(),this._extents.pop()}merge(e){return this._mergeTight(e),e.hasProgressed}_mergeTight(e=de["c"]){const t=this._extents,i=new Set;let r=0;for(;r!==t.length;){t.sort((e,t)=>e[0]-t[0]),r=t.length,i.clear();for(let r=0;r<t.length;++r){if(e.done)return;const a=t.getItemAt(r);for(let e=r+1;e<t.length;++e){const r=t.getItemAt(e);if(r[0]>=a[2])break;i.add(r)}i.forEach(r=>{if(a===r)return;if(r[2]<=a[0])return void i.delete(r);const n=Object(H["b"])(a),s=Object(H["b"])(r),o=this._tmpExtent;Object(H["m"])(a,r,o);const c=n+s;(Object(H["b"])(o)-c)/c<_d&&(Object(H["j"])(a,o),i.delete(r),t.remove(r),e.madeProgress())}),i.add(a)}}this._dirty=!1}_contains(e){return this._extents.some(t=>Object(H["e"])(t,e))}_removeContained(e){this._extents.filterInPlace(t=>!Object(H["e"])(e,t))}get test(){const e=this;return{containsPoint:t=>e._extents.some(e=>Object(H["f"])(e,t))}}}let xd=class extends M["a"]{constructor(){super(...arguments),this.dirtyExtents=new jd,this.globalDirty=!1,this.averageExtentUpdateSize=0,this.dirtyGraphicsSet=new Set,this.handles=new L["a"],this.updateElevation=!1,this.graphicsCoreOwner=null,this.graphicsCore=null,this.events=new pe["a"]}setup(e,t,i,r){this.graphicsCoreOwner=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=i,this.elevationProvider=r;const a=this.graphicsCoreOwner.view.resourceController.scheduler;this.handles.add([r.on("elevation-change",e=>this._elevationChanged(e)),Object(n["f"])(()=>this.graphicsCoreOwner.suspended,()=>this._suspendedChange()),a.registerTask(de["b"].ELEVATION_ALIGNMENT,this)])}destroy(){this.dirtyGraphicsSet.clear(),this.handles.destroy(),this.handles=null,this.graphicsCoreOwner=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null}clear(){this.dirtyGraphicsSet.clear(),this.notifyChange("updating")}_suspendedChange(){!0===this.graphicsCoreOwner.suspended?this.updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this.globalDirty=!0,this.notifyChange("updating")}get updating(){return this.running}get running(){return this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}get updatingRemaining(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}runTask(e){for(this.globalDirty&&(this._markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress()),e.run(()=>this.dirtyExtents.merge(e));this.running&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.graphicsCoreOwner.view.deconflictor.setDirty(),this.notifyChange("updating")}_updateDirtyGraphics(e){const t=this.graphicsCoreOwner.view.renderCoordsHelper,i=this.graphicsCore.effectiveUpdatePolicy===Xe["j"].ASYNC;for(const r of this.dirtyGraphicsSet.keys()){const n=this.graphicsCore.getGraphics3DGraphicById(r);if(this.dirtyGraphicsSet.delete(r),Object(a["k"])(n)&&(n.alignWithElevation(this.elevationProvider,t,i),e.madeProgress()),e.done)return}}_updateDirtyExtents(e){for(;!this.dirtyExtents.empty&&!e.done;){const t=this.dirtyExtents.pop(),i=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:t,spatialReference:i});const r=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(t,i,e=>{const t=this.graphicsCore.getGraphics3DGraphicById(e);Object(a["k"])(t)&&t.needsElevationUpdates()&&this.dirtyGraphicsSet.add(e)}),this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-r)+.9*this.averageExtentUpdateSize,e.madeProgress()}}_markAllGraphicsElevationDirty(){this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach((e,t)=>this.dirtyGraphicsSet.add(t))}_elevationChanged(e){if("scene"===e.context&&(!this.graphicsCore.layer.elevationInfo||"relative-to-scene"!==this.graphicsCore.layer.elevationInfo.mode))return;const{extent:t,spatialReference:i}=e;if(this.graphicsCoreOwner.suspended){if(!this.updateElevation){const e=this.graphicsCore.computedExtent;e&&t[2]>e.xmin&&t[0]<e.xmax&&t[3]>e.ymin&&t[1]<e.ymax&&(this.updateElevation=!0)}this.events.emit("invalidate-elevation",{extent:t,spatialReference:i})}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.notifyChange("updating")}};Object(r["a"])([Object(s["b"])({readOnly:!0})],xd.prototype,"updating",null),Object(r["a"])([Object(s["b"])({readOnly:!0})],xd.prototype,"updatingRemaining",null),xd=Object(r["a"])([Object(l["a"])("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],xd);const Sd=xd;var Td=i("d359"),wd=i("bd7e");function Cd(e,t,i,r){return Ed(e,t,i,Pd(r,t,i,!0))}const Ad={dir:Object(U["f"])(),len:0,clip:Object(Se["c"])()};function Pd(e,t,i,r){const a=Ad;return e?(i&&r&&(a.len=Object(V["m"])(t,i)),Object(V["g"])(a.dir,e)):r?(a.len=Object(V["m"])(t,i),Object(V["f"])(a.dir,i,t),Object(V["k"])(a.dir,a.dir,1/a.len)):(Object(V["f"])(a.dir,i,t),Object(V["r"])(a.dir,a.dir)),a}function Rd(e,t,i){const r=Object(V["i"])(Object(uo["q"])(e),i.dir),a=-Object(uo["u"])(e,t);if(a<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return a>0;if((a<0||r<0)&&!(a<0&&r<0))return!0;const n=a/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function Ed(e,t,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let a=0;a<e.length;a++)if(!Rd(e[a],t,r))return!1;return!0}const Id=.5*Math.PI,Md=Id/Math.PI*180;class Dd{constructor(e){this.renderCoordsHelper=e.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:Object(U["f"])(),direction:Object(U["f"])()};for(let t=0;t<4;t++)this.extent[t]={origin:Object(U["f"])(),direction:Object(U["f"])(),cap:{next:null,direction:Object(U["f"])()}},this.planes[t]=Object(uo["d"])();this.planes[Td["a"].NEAR]=Object(uo["d"])(),this.planes[Td["a"].FAR]=Object(uo["d"])(),this.planesWithoutFar=this.planes.slice(0,5)}update(e,t,i,r=!0){const a=this.extent;this._toRenderBoundingExtent(e,t,i),Object(V["e"])(this.center.origin,a[0].origin,a[2].origin),Object(V["k"])(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),r||Object(V["k"])(this.center.direction,this.center.direction,-1);for(let n=0;n<4;n++){const e=a[n];this.renderCoordsHelper.worldUpAtPosition(e.origin,e.direction);const t=a[3===n?0:n+1];e.cap.next=t.origin,Object(V["v"])(e.cap.direction,e.origin,t.origin),Object(uo["i"])(e.direction,e.cap.direction,e.origin,this.planes[n]),r||Object(V["k"])(e.direction,e.direction,-1)}Object(uo["i"])(a[0].cap.direction,a[1].cap.direction,a[0].origin,this.planes[Td["a"].NEAR]),r?Object(uo["p"])(this.planes[Td["a"].NEAR],this.planes[Td["a"].FAR]):(Object(uo["c"])(this.planes[Td["a"].FAR],this.planes[Td["a"].NEAR]),Object(uo["p"])(this.planes[Td["a"].NEAR],this.planes[Td["a"].NEAR])),this.maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this.maxSpanSpatialReference=t,this.minGlobalAltitude=.9*Object(gc["e"])(this.maxSpanSpatialReference).radius}isVisibleInFrustum(e,t,i=!1){if(null==e)return!1;if(this.renderCoordsHelper.viewingMode===Qt["a"].Global){const i=this.maxSpanSpatialReference.isGeographic?Md:Id*t;if(this.maxSpan>i)return!0;if(e.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(0===this.maxSpan){const t=this.extent[0];return!(i||!e.intersectsRay(Object(po["g"])(t.origin,t.direction)))}for(let a=0;a<this.extent.length;a++){const t=this.extent[a];if(!i&&e.intersectsRay(Object(po["g"])(t.origin,t.direction)))return!0;if(e.intersectsLineSegment(Object(wd["f"])(t.origin,t.cap.next,Ud),t.cap.direction))return!0}const r=i?this.planes:this.planesWithoutFar;for(let a=0;a<e.lines.length;a++){const t=e.lines[a];if(Cd(r,t.origin,t.endpoint,t.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,t,i){const r=5;Object(H["c"])(e,Nd),Nd[2]=i,Object(B["d"])(t,Nd,Fd,this.renderCoordsHelper.spatialReference),Object(Te["a"])(zd,Fd),Object(k["h"])(Gd);for(const{x0:a,x1:n,y0:s,y1:o}of Ld)for(let c=0;c<r;c++){const l=c/(r-1);Nd[0]=Object(Ar["l"])(e[a],e[n],l),Nd[1]=Object(Ar["l"])(e[s],e[o],l),Nd[2]=i,Object(B["w"])(Nd,t,Nd,this.renderCoordsHelper.spatialReference),Object(V["q"])(Nd,Nd,zd),Object(k["n"])(Gd,Nd)}Object(V["w"])(this.extent[0].origin,Gd[0],Gd[1],Gd[2]),Object(V["w"])(this.extent[1].origin,Gd[3],Gd[1],Gd[2]),Object(V["w"])(this.extent[2].origin,Gd[3],Gd[4],Gd[2]),Object(V["w"])(this.extent[3].origin,Gd[0],Gd[4],Gd[2]);for(let a=0;a<4;++a)Object(V["q"])(this.extent[a].origin,this.extent[a].origin,Fd)}_toRenderBoundingExtentLocal(e,t,i){Object(B["k"])(e,t,Vd,this.renderCoordsHelper.spatialReference),Object(V["w"])(this.extent[0].origin,Vd[0],Vd[1],i),Object(V["w"])(this.extent[1].origin,Vd[2],Vd[1],i),Object(V["w"])(this.extent[2].origin,Vd[2],Vd[3],i),Object(V["w"])(this.extent[3].origin,Vd[0],Vd[3],i)}_toRenderBoundingExtent(e,t,i){switch(this.renderCoordsHelper.viewingMode){case Qt["a"].Global:this._toRenderBoundingExtentGlobal(e,t,i);break;case Qt["a"].Local:this._toRenderBoundingExtentLocal(e,t,i);break;default:Object(nt["a"])(this.renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(e){if(Object(uo["u"])(e.planes[Td["a"].NEAR],this.center.origin)<0&&Object(V["i"])(this.center.direction,e.direction)<0)return!0;for(let t=0;t<4;t++){const i=this.extent[t];if(Object(uo["u"])(e.planes[Td["a"].NEAR],i.origin)<0&&Object(V["i"])(i.direction,e.direction)<0)return!0}return!1}}const Ld=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Nd=Object(U["f"])(),Fd=Object(we["d"])(),zd=Object(we["d"])(),Gd=Object(k["f"])(),Vd=Object(H["k"])(),Ud=Object(wd["d"])(),Bd=1.2;let kd=class extends M["a"]{constructor(){super(...arguments),this.suspended=!1,this.extent=null,this.extentIntersectionDirty=!0,this._isVisibleBelowSurface=!1,this.handles=new L["a"],this.graphicsCoreOwner=null,this.updating=!0}setup(e){this.graphicsCoreOwner=e,this.extentIntersection=new Dd({renderCoordsHelper:e.view.renderCoordsHelper});const t=e.view,i=t.basemapTerrain,r=t.resourceController.scheduler;this.handles.add([t.on("resize",()=>this._viewChange()),Object(n["f"])(()=>t.state.camera,()=>this._viewChange(),n["d"]),r.registerTask(de["b"].FRUSTUM_VISIBILITY,this),i.on("elevation-bounds-change",()=>this._elevationBoundsChange())]),"local"===t.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([Object(n["f"])(()=>{var e,r,a;return[i.baseOpacity,i.wireframe,null==(e=t.map)||null==(r=e.ground)||null==(a=r.navigationConstraint)?void 0:a.type]},()=>this._updateIsVisibleBelowSurface(),n["a"])])}destroy(){this.graphicsCoreOwner=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}_setDirty(){this.updating||this._set("updating",!0)}setExtent(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()}_viewChange(){this._setDirty()}_elevationBoundsChange(){this._setDirty(),this.extentIntersectionDirty=!0}set isVisibleBelowSurface(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0}_updateIsVisibleBelowSurface(){const e=this.graphicsCoreOwner.view,t=e.basemapTerrain,i="local"===e.viewingMode,r=e.map.ground&&e.map.ground.navigationConstraint&&"none"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=i||!t.opaque||r}_updateExtentIntersection(){if(!this.extentIntersectionDirty)return;this.extentIntersectionDirty=!1;const e=this.graphicsCoreOwner.view;let t;if(this._isVisibleBelowSurface)t=-.3*Object(gc["e"])(e.spatialReference).radius;else{const{min:i,max:r}=e.basemapTerrain.elevationBounds;t=i-Math.max(1,(r-i)*(Bd-1))}this.extentIntersection.update(this.extent,e.spatialReference,t)}get running(){return this.updating}runTask(){if(this._set("updating",!1),!this.extent)return void this._set("suspended",!1);this._updateExtentIntersection();const e=this.graphicsCoreOwner.view.frustum,t=Object(gc["e"])(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e,t))}};Object(r["a"])([Object(s["b"])({readOnly:!0})],kd.prototype,"suspended",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],kd.prototype,"updating",void 0),kd=Object(r["a"])([Object(l["a"])("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],kd);const Hd=kd;var Wd;!function(e){e[e.Object=0]="Object",e[e.RenderGeometry=1]="RenderGeometry",e[e.External=2]="External",e[e.COUNT=3]="COUNT"}(Wd||(Wd={}));class qd{constructor(){this.items=[]}addObject(e,t){this.items.push({type:Wd.Object,objectStateId:t,object:e})}addRenderGeometry(e,t,i){this.items.push({type:Wd.RenderGeometry,objectStateId:t,renderGeometry:e,owner:i})}addExternal(e,t){this.items.push({type:Wd.External,objectStateId:t,remove:e})}remove(e){for(let t=this.items.length-1;t>=0;--t){const i=this.items[t];i.objectStateId===e&&(this._removeObjectStateItem(i),this.items.splice(t,1))}}removeObject(e){for(let t=this.items.length-1;t>=0;--t){const i=this.items[t];i.type===Wd.Object&&i.object===e&&(this._removeObjectStateItem(i),this.items.splice(t,1))}}removeRenderGeometry(e){for(let t=this.items.length-1;t>=0;--t){const i=this.items[t];i.type===Wd.RenderGeometry&&i.renderGeometry===e&&(this._removeObjectStateItem(i),this.items.splice(t,1))}}removeAll(){this.items.forEach(e=>{this._removeObjectStateItem(e)}),this.items=[]}_removeObjectStateItem(e){switch(e.type){case Wd.Object:e.objectStateId.channel===Xe["d"].Highlight?e.object.removeHighlight(e.objectStateId):e.objectStateId.channel===Xe["d"].MaskOccludee&&e.object.removeOcclude(e.objectStateId);break;case Wd.RenderGeometry:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case Wd.External:e.remove(e.objectStateId)}}}class $d{constructor(e,t){this.stateType=e,this.objectIdField=t,this.objectStateSet=new qd,this.ids=new Set,this.paused=!1}hasGraphic(e){if(this.objectIdField){const t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)}}class Xd{constructor(e){this._graphicsCore=e,this._stateSets=new Array}destroy(){this._stateSets&&this._stateSets.forEach(e=>e.objectStateSet.removeAll()),this._stateSets=null}acquireSet(e,t){const i=new $d(e,t);this._stateSets.push(i);const r=Object(d["c"])(()=>this.releaseSet(i));return{set:i,handle:r}}releaseSet(e){e.objectStateSet.removeAll();const t=this._stateSets?this._stateSets.indexOf(e):-1;-1!==t&&this._stateSets.splice(t,1)}_addObjectStateSet(e,t){e.addObjectStateSet(t.stateType,t.objectStateSet)}_removeObjectStateSet(e,t){e.removeObjectState(t.objectStateSet)}setUid(e,t){e.ids.add(t);const i=this._graphicsCore.graphics3DGraphics.get(t);i&&this._addObjectStateSet(i,e)}setUids(e,t){t.forEach(t=>this.setUid(e,t))}setObjectIds(e,t){t.forEach(t=>e.ids.add(t)),this._initializeSet(e)}addGraphic(e){this._stateSets.forEach(t=>{!t.paused&&t.hasGraphic(e)&&this._addObjectStateSet(e,t)})}removeGraphic(e){this._stateSets.forEach(t=>{t.hasGraphic(e)&&this._removeObjectStateSet(e,t)})}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach(e=>e.objectStateSet.removeAll())}_initializeSet(e){const t=this._graphicsCore.graphics3DGraphics;e.objectIdField?t.forEach(t=>{t&&e.hasGraphic(t)&&this._addObjectStateSet(t,e)}):e.ids.forEach(i=>{const r=t.get(i);r&&this._addObjectStateSet(r,e)})}get test(){return{states:this._stateSets}}}var Yd=i("5e70");let Zd=class extends M["a"]{constructor(){super(...arguments),this._scaleRangeActive=!1,this.layerScaleRangeVisibilityQuery=!1,this.handles=new L["a"],this.graphicsCoreOwner=null,this.layer=null,this.queryGraphicUIDsInExtent=null,this.extent=null,this.graphicsCore=null,this.basemapTerrain=null,this.layerScaleEnabled=!0,this.suspended=!1,this.updating=!0}setup(e,t,i,r,a){this.graphicsCoreOwner=e,this.layer=t,this.queryGraphicUIDsInExtent=i,this.graphicsCore=r,this.basemapTerrain=a,this.updateScaleRangeActive();const n=this.graphicsCoreOwner.view.resourceController.scheduler;this.handles.add(n.registerTask(de["b"].SCALE_VISIBILITY,this))}destroy(){this.handles.destroy(),this.handles=null,this.graphicsCoreOwner=null,this.extent=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null}_setDirty(){this.updating||this._set("updating",!0)}setExtent(e){const t=this.graphicsCoreOwner.view.spatialReference,i=this.graphicsCoreOwner.view.basemapTerrain.spatialReference;if(t===i)this.extent=e;else{const r=Object(H["k"])();Object(B["k"])(e,t,r,i)?this.extent=r:this.extent=null}this._setDirty()}scaleRangeActive(){return this._scaleRangeActive}updateScaleRangeActive(){const e=this.layer,t=e.effectiveScaleRange;let i=this.layerScaleEnabled&&Jd(t.minScale,t.maxScale);e.labelingInfo&&!i&&(i=e.labelingInfo.some(e=>e&&Jd(e.minScale,e.maxScale)));const r=this._scaleRangeActive!==i;return this._scaleRangeActive=i,i&&!this.handles.has(Qd)&&this.basemapTerrain?(this.handles.add(this.basemapTerrain.on("scale-change",e=>this._scaleUpdateHandler(e)),Qd),this.layerScaleEnabled&&this.handles.add(this.basemapTerrain.on("tiles-visibility-changed",()=>this._setDirty()),Qd)):!i&&this.handles.has(Qd)&&this.handles.remove(Qd),r}get running(){return!(!this.graphicsCoreOwner.view.basemapTerrain||!this.updating)}runTask(){const e=this.graphicsCoreOwner.view.basemapTerrain;if(this.extent&&e&&e.ready&&this._scaleRangeActive&&this.layerScaleEnabled){if(!this.layerScaleRangeVisibilityQuery){this.layerScaleRangeVisibilityQuery=!0;const t=this.layer.effectiveScaleRange;e.queryVisibleScaleRange(this.extent,t.minScale,t.maxScale,e=>this._finishUpdate(e))}}else this._finishUpdate(!0)}_finishUpdate(e){this.layerScaleRangeVisibilityQuery=!1,this._set("suspended",!e),this._set("updating",!1)}_visibleAtLayerScale(e){const t=this.layer.effectiveScaleRange;return!this.layerScaleEnabled||Object(Yd["b"])(e,t.minScale||0,t.maxScale||0)}_visibleAtLabelScale(e,t){return Object(Yd["b"])(e,t.minScale||0,t.maxScale||0)}_graphicScale(e){let t;return Object(a["k"])(e.centroid)?t=e.centroid:Object(a["k"])(e.graphic.geometry)&&"point"===e.graphic.geometry.type&&(t=e.graphic.geometry),t?this.graphicsCoreOwner.view.basemapTerrain?this.graphicsCoreOwner.view.basemapTerrain.getScale(t):1:null}_graphicVisible(e){if(!this.layerScaleEnabled)return!0;const t=this._graphicScale(e);return this._visibleAtLayerScale(t)}updateVisibility(e){if(this._scaleRangeActive){const t=this._graphicVisible(e);return e.setVisibilityFlag(ce.SCALE_RANGE,t,oe.GRAPHIC)}return!1}updateGraphicLabelScaleVisibility(e){if(!this._scaleRangeActive)return!1;if(!e.labelGraphics||0===e.labelGraphics.length)return!1;const t=this._graphicScale(e),i=this._updateLabelScaleVisibility(e,t);return i&&(this.graphicsCoreOwner.view.deconflictor.setDirty(),this.graphicsCoreOwner.view.labeler.setDirty()),i}_updateLabelScaleVisibility(e,t){if(!e.labelGraphics||0===e.labelGraphics.length)return!1;const i=e.labelGraphics[0]._labelClass;if(i&&null!=i.minScale&&null!=i.maxScale){const r=this._visibleAtLabelScale(t,i);if(e.setVisibilityFlag(ce.SCALE_RANGE,r,oe.LABEL))return!0}return!1}_scaleUpdateHandler(e){if(this._setDirty(),this.graphicsCoreOwner.suspended)return;const t=e.extent,i=e.scale,r=this._visibleAtLayerScale(i);let n=!1;this.queryGraphicUIDsInExtent(t,e.spatialReference,e=>{const s=this.graphicsCore.getGraphics3DGraphicById(e);if(Object(a["j"])(s))return;const o=s.centroid;Object(a["k"])(o)&&(t[0]>o.x||t[1]>o.y||t[2]<o.x||t[3]<o.y)||(s.setVisibilityFlag(ce.SCALE_RANGE,r,oe.GRAPHIC)&&(n=!0),this._updateLabelScaleVisibility(s,i)&&(n=!0))}),n&&(this.graphicsCoreOwner.view.deconflictor.setDirty(),this.graphicsCoreOwner.view.labeler.setDirty())}layerMinMaxScaleChangeHandler(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(e=>e.clearVisibilityFlag(ce.SCALE_RANGE)):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility(),this._setDirty()}};function Jd(e,t){return e>0||t>0}Object(r["a"])([Object(s["b"])({constructOnly:!0})],Zd.prototype,"layerScaleEnabled",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],Zd.prototype,"suspended",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],Zd.prototype,"updating",void 0),Zd=Object(r["a"])([Object(l["a"])("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],Zd);const Qd="terrain-events",Kd=Zd;let eh=class extends m["a"]{constructor(e){super(e),this.type="graphics-3d",this.graphicsCore=null,this.elevationAlignment=new Sd,this.drapeSourceType=R["a"].Features,this._suspendResumeExtent=null}normalizeCtorArgs(e){const t={...e,scaleVisibility:null,frustumVisibility:null};return delete t.scaleVisibilityEnabled,delete t.frustumVisibilityEnabled,e.scaleVisibilityEnabled&&(t.scaleVisibility=new Kd),e.frustumVisibilityEnabled&&(t.frustumVisibility=new Hd),t}initialize(){const e=new bd({owner:this,layer:this.owner.layer,preferredUpdatePolicy:Xe["j"].SYNC,graphicSymbolSupported:!0});this._set("graphicsCore",e);const{layer:t,scaleVisibility:i}=this;if(Object(a["k"])(i)&&"effectiveScaleRange"in t){const e=t;this.updatingHandles.add(()=>e.effectiveScaleRange,()=>i.layerMinMaxScaleChangeHandler())}if("fullOpacity"in this.owner){const e=this.owner;this.updatingHandles.add(()=>e.fullOpacity,()=>this.graphicsCore.opacityChange())}if("elevationInfo"in t){const e=t;this.updatingHandles.add(()=>e.elevationInfo,(e,t)=>{Object(g["a"])(e,t)&&this.updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())})}}async setup(){const e=(e,t,i)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(e,t,i);if(this.elevationAlignment.setup(this,e,this.graphicsCore,this.view.elevationProvider),Object(a["k"])(this.scaleVisibility)&&"effectiveScaleRange"in this.layer){const t=this.owner.view.basemapTerrain;this.scaleVisibility.setup(this,this.layer,e,this.graphicsCore,t)}Object(a["k"])(this.frustumVisibility)&&this.frustumVisibility.setup(this),this._set("objectStates",new Xd(this.graphicsCore));try{await this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,objectStates:this.objectStates})}catch(t){if(Object(h["j"])(t))return;throw t}this.destroyed||(this.handles.add(Object(n["f"])(()=>this.view.clippingArea,()=>this._updateClippingExtent(),n["d"])),this._updateClippingExtent(),this._setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics())}destroy(){this.handles.removeAll(),this.updatingHandles.removeAll(),this._set("elevationAlignment",Object(a["d"])(this.elevationAlignment)),this._set("scaleVisibility",Object(a["d"])(this.scaleVisibility)),this._set("frustumVisibility",Object(a["d"])(this.frustumVisibility)),this._set("objectStates",Object(a["d"])(this.objectStates)),this._set("graphicsCore",Object(a["d"])(this.graphicsCore))}get layer(){return this.owner.layer}get view(){return this.owner.view}get scaleVisibilitySuspended(){return!(!Object(a["k"])(this.scaleVisibility)||!this.scaleVisibility.suspended)}get frustumVisibilitySuspended(){return!(!Object(a["k"])(this.frustumVisibility)||!this.frustumVisibility.suspended)}get suspended(){var e;return null!=(e=this.owner.suspended)&&e}get updating(){var e;return!!(null!=(e=this.graphicsCore)&&e.updating||Object(a["k"])(this.scaleVisibility)&&this.scaleVisibility.updating||Object(a["k"])(this.frustumVisibility)&&this.frustumVisibility.updating||this.updatingHandles.updating)}get graphics3DGraphics(){var e;return null==(e=this.graphicsCore)?void 0:e.graphics3DGraphics}get graphics3DGraphicsByObjectID(){var e;return null==(e=this.graphicsCore)?void 0:e.graphics3DGraphicsByObjectID}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){var e;return null!=(e=this.owner.fullOpacity)?e:1}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get updatePolicy(){return this.owner.updatePolicy}notifyGraphicGeometryChanged(e){this.graphicsCore.notifyGraphicGeometryChanged(e)}notifyGraphicVisibilityChanged(e){this.graphicsCore.notifyGraphicVisibilityChanged(e)}getRenderingInfo(e,t,i){const r=S(e,{renderer:t,arcade:i});if(Object(a["k"])(r)&&r.color){const e=r.color;e[0]=e[0]/255,e[1]=e[1]/255,e[2]=e[2]/255}return r}getRenderingInfoAsync(e,t,i,r){return w(e,{renderer:t,arcade:i,...r})}getHit(e){if(this.owner.loadedGraphics){const t=this.owner.loadedGraphics.find(t=>t.uid===e);if(t){const e=this.layer instanceof O["a"]?this.layer:null,i=Object(v["c"])(t,e);return{type:"graphic",graphic:i,layer:i.layer}}}return null}whenGraphicBounds(e,t){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(e,t):Promise.reject()}computeAttachmentOrigin(e,t){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(e,t):null}getSymbolLayerSize(e,t){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(e,t):null}maskOccludee(e){const{set:t,handle:i}=this.objectStates.acquireSet(Xe["d"].MaskOccludee,null);return this.objectStates.setUid(t,e.uid),i}highlight(e){if(e instanceof P["a"])return th;if("number"==typeof e)return this.highlight([e]);if(e instanceof b["a"])return this.highlight([e]);if(e instanceof f["a"]&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof b["a"]){const t=e.map(e=>e.uid),{set:i,handle:r}=this.objectStates.acquireSet(Xe["d"].Highlight,null);return this.objectStates.setUids(i,t),r}if("number"==typeof e[0]){const t=e,{set:i,handle:r}=this.objectStates.acquireSet(Xe["d"].Highlight,null);return this.objectStates.setObjectIds(i,t),r}}return th}_setupSuspendResumeExtent(){const{scaleVisibility:e,frustumVisibility:t}=this;if(Object(a["j"])(e)&&Object(a["j"])(t))return;const i=({computedExtent:i,extentPadding:r})=>{this._suspendResumeExtent=Object(Ae["e"])(i,this._suspendResumeExtent,E["a"],r),Object(a["k"])(e)&&e.setExtent(this._suspendResumeExtent),Object(a["k"])(t)&&t.setExtent(this._suspendResumeExtent)};this.handles.add(Object(n["f"])(()=>{var e,t;return{computedExtent:null==(e=this.graphicsCore)?void 0:e.computedExtent,extentPadding:null==(t=this.graphicsCore)?void 0:t.extentPadding}},e=>i(e),n["e"]))}_updateClippingExtent(){const e=this.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()}};Object(r["a"])([Object(s["b"])()],eh.prototype,"type",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],eh.prototype,"owner",void 0),Object(r["a"])([Object(s["b"])()],eh.prototype,"layer",null),Object(r["a"])([Object(s["b"])()],eh.prototype,"view",null),Object(r["a"])([Object(s["b"])({constructOnly:!0})],eh.prototype,"graphicsCore",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],eh.prototype,"scaleVisibility",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],eh.prototype,"frustumVisibility",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],eh.prototype,"elevationAlignment",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],eh.prototype,"objectStates",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],eh.prototype,"scaleVisibilitySuspended",null),Object(r["a"])([Object(s["b"])({readOnly:!0})],eh.prototype,"frustumVisibilitySuspended",null),Object(r["a"])([Object(s["b"])()],eh.prototype,"suspended",null),Object(r["a"])([Object(s["b"])({readOnly:!0})],eh.prototype,"updating",null),Object(r["a"])([Object(s["b"])()],eh.prototype,"loadedGraphics",null),Object(r["a"])([Object(s["b"])()],eh.prototype,"fullOpacity",null),Object(r["a"])([Object(s["b"])()],eh.prototype,"slicePlaneEnabled",null),Object(r["a"])([Object(s["b"])()],eh.prototype,"drapeSourceType",void 0),Object(r["a"])([Object(s["b"])()],eh.prototype,"updatePolicy",null),eh=Object(r["a"])([Object(l["a"])("esri.views.3d.layers.graphics.GraphicsProcessor")],eh);const th=Object(d["c"])();var ih=i("9786"),rh=i("e2e8");function ah(e){const t=e.view.spatialReference,i=e.layer.fullExtent,r=Object(a["k"])(i)&&i.spatialReference;if(Object(a["j"])(i)||!r)return Promise.resolve(null);if(r.equals(t))return Promise.resolve(i.clone());const n=Object(ih["d"])(i,t);return Object(a["k"])(n)?Promise.resolve(n):e.view.state.isLocal?Object(rh["projectGeometry"])(i,t,e.layer.portalItem).then(t=>!e.destroyed&&t?t:void 0).catch(()=>null):Promise.resolve(null)}var nh=i("365a");let sh=class extends(p(nh["a"])){constructor(){super(...arguments),this.type="graphics-3d",this.slicePlaneEnabled=!1,this.fullExtentInLocalViewSpatialReference=null}initialize(){this._set("processor",new eh({owner:this,scaleVisibilityEnabled:!0,frustumVisibilityEnabled:!0})),this.addResolvingPromise(this.processor.setup()),this.handles.add(this.layer.on("graphic-update",e=>this.processor.graphicsCore.graphicUpdateHandler(e))),this.addResolvingPromise(ah(this).then(e=>this.fullExtentInLocalViewSpatialReference=e)),this.layer.internal?this.notifyChange("updating"):this.handles.add(Object(n["g"])(()=>{var e,t;return null==(e=this.view)||null==(t=e.basemapTerrain)?void 0:t.ready},()=>()=>this.notifyChange("updating"),{once:!0}))}destroy(){this.handles.removeAll(),this.updatingHandles.removeAll(),this._set("processor",Object(a["d"])(this.processor))}get loadedGraphics(){return this.layer.graphics}get legendEnabled(){var e;return this.canResume()&&!(null!=(e=this.processor)&&e.frustumVisibilitySuspended)}getSuspendInfo(){var e,t,i,r;const a=super.getSuspendInfo();return a.outsideScaleRange=null!=(e=null==(t=this.processor)?void 0:t.scaleVisibilitySuspended)&&e,a.outsideOfView=null!=(i=null==(r=this.processor)?void 0:r.frustumVisibilitySuspended)&&i,a}async fetchPopupFeatures(e,t){return Object(a["k"])(t)?t.clientGraphics:null}getHit(e){return this.processor.getHit(e)}whenGraphicBounds(e,t){return this.processor.whenGraphicBounds(e,t)}computeAttachmentOrigin(e,t){var i;return null==(i=this.processor)?void 0:i.computeAttachmentOrigin(e,t)}getSymbolLayerSize(e,t){return this.processor.getSymbolLayerSize(e,t)}queryGraphics(){return Promise.resolve(this.loadedGraphics)}maskOccludee(e){return this.processor.maskOccludee(e)}highlight(e){return this.processor.highlight(e)}get updatePolicy(){var e;return(null==(e=this.processor)?void 0:e.graphicsCore.effectiveUpdatePolicy)||Xe["j"].SYNC}canResume(){var e;return super.canResume()&&!(null!=(e=this.processor)&&e.scaleVisibilitySuspended)}isUpdating(){var e,t,i;return!((null==(e=this.processor)||!e.updating)&&(this.layer.internal||null!=(t=this.view)&&null!=(i=t.basemapTerrain)&&i.ready))}get performanceInfo(){var e,t,i,r;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:-1,totalNumberOfFeatures:-1,nodes:0,core:null,updating:this.updating,elevationUpdating:null!=(e=null==(t=this.processor)?void 0:t.elevationAlignment.updating)&&e,visibilityFrustum:null!=(i=!(null!=(r=this.processor)&&r.frustumVisibilitySuspended))&&i}}};Object(r["a"])([Object(s["b"])()],sh.prototype,"loadedGraphics",null),Object(r["a"])([Object(s["b"])({readOnly:!0})],sh.prototype,"legendEnabled",null),Object(r["a"])([Object(s["b"])()],sh.prototype,"layer",void 0),Object(r["a"])([Object(s["b"])({readOnly:!0})],sh.prototype,"processor",void 0),Object(r["a"])([Object(s["b"])({type:Boolean})],sh.prototype,"slicePlaneEnabled",void 0),sh=Object(r["a"])([Object(l["a"])("esri.views.3d.layers.GraphicsLayerView3D")],sh);const oh=sh},bc40:function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return g})),i.d(t,"c",(function(){return m}));var r=i("dae5"),a=i("afe1"),n=i("47f8"),s=i("0b2d"),o=i("b09a"),c=i("6a21"),l=i("35f0"),d=i("ea32"),h=i("3886"),u=i("037a"),p=i("aa1e"),b=i("85b3");function f(e,t){e.include(o["a"]);const i=e.vertex;i.include(c["a"],t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),i.uniforms.add([new d["a"]("transformWorldFromViewTH",e=>e.transformWorldFromViewTH),new d["a"]("transformWorldFromViewTL",e=>e.transformWorldFromViewTL),new p["a"]("transformViewFromCameraRelativeRS",e=>e.transformViewFromCameraRelativeRS),new b["a"]("transformProjFromView",e=>e.transformProjFromView),new u["a"]("transformWorldFromModelRS",e=>e.transformWorldFromModelRS),new l["a"]("transformWorldFromModelTH",e=>e.transformWorldFromModelTH),new l["a"]("transformWorldFromModelTL",e=>e.transformWorldFromModelTL)]),i.code.add(h["b"]`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(h["b"]`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?h["b"]`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:h["b"]`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new d["a"]("transformWorldFromViewTL",e=>e.transformWorldFromViewTL)),i.code.add(h["b"]`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(h["b"]`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class m extends h["a"]{constructor(){super(...arguments),this.transformWorldFromViewTH=Object(s["f"])(),this.transformWorldFromViewTL=Object(s["f"])(),this.transformViewFromCameraRelativeRS=Object(r["b"])(),this.transformProjFromView=Object(a["d"])()}}class g extends h["a"]{constructor(){super(...arguments),this.transformWorldFromModelRS=Object(r["b"])(),this.transformWorldFromModelTH=Object(n["b"])(),this.transformWorldFromModelTL=Object(n["b"])()}}},bd75:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("a05b"),a=i("bc40"),n=i("d8a4"),s=i("3886");function o(e,t){t.output===r["a"].Color&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(s["b"]`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):t.output===r["a"].Depth||t.output===r["a"].Shadow?(e.include(a["a"],t),e.varyings.add("linearDepth","float"),e.vertex.uniforms.add(new n["a"]("nearFar",(e,t)=>t.camera.nearFar)),e.vertex.code.add(s["b"]`void forwardLinearDepth() {
linearDepth = (-vPosition_view.z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):e.vertex.code.add(s["b"]`void forwardLinearDepth() {}`)}},be24:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i("ea32"),a=i("76a8"),n=i("955a"),s=i("3886"),o=i("aa1e"),c=i("b7bd"),l=i("02a0");function d(e,t){t.hasVvInstancing&&(t.vvSize||t.vvColor)&&e.attributes.add(c["a"].INSTANCEFEATUREATTRIBUTE,"vec4");const i=e.vertex;t.vvSize?(i.uniforms.add(new r["a"]("vvSizeMinSize",e=>e.vvSizeMinSize)),i.uniforms.add(new r["a"]("vvSizeMaxSize",e=>e.vvSizeMaxSize)),i.uniforms.add(new r["a"]("vvSizeOffset",e=>e.vvSizeOffset)),i.uniforms.add(new r["a"]("vvSizeFactor",e=>e.vvSizeFactor)),i.uniforms.add(new o["a"]("vvSymbolRotationMatrix",e=>e.vvSymbolRotationMatrix)),i.uniforms.add(new r["a"]("vvSymbolAnchor",e=>e.vvSymbolAnchor)),i.code.add(s["b"]`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(s["b"]`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?s["b"]`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(s["b"]`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(i.constants.add("vvColorNumber","int",l["b"]),t.hasVvInstancing&&i.uniforms.add([new n["a"]("vvColorValues",e=>e.vvColorValues,l["b"]),new a["a"]("vvColorColors",e=>e.vvColorColors,l["b"])]),i.code.add(s["b"]`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.hasVvInstancing?s["b"]`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):i.code.add(s["b"]`vec4 vvColor() { return vec4(1.0); }`)}},bea9:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("f2e0");class a{constructor(e){this.channel=e,this.id=Object(r["a"])()}}},c2d1:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("a05b"),a=i("501b"),n=i("3886");function s(e,t){e.fragment.include(a["a"]),t.output===r["a"].Shadow?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(n["b"]`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):t.output===r["a"].Depth&&e.fragment.code.add(n["b"]`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}},c332:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return n}));var r=i("3886");function a(e){const t=r["b"]`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.fragment.code.add(t),e.vertex.code.add(t)}var n,s=i("b7bd");function o(e,t){t.normalType===n.Attribute&&(e.attributes.add(s["a"].NORMAL,"vec3"),e.vertex.code.add(r["b"]`vec3 normalModel() {
return normal;
}`)),t.normalType===n.CompressedAttribute&&(e.include(a),e.attributes.add(s["a"].NORMALCOMPRESSED,"vec2"),e.vertex.code.add(r["b"]`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),t.normalType===n.ScreenDerivative&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(r["b"]`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}!function(e){e[e.Attribute=0]="Attribute",e[e.CompressedAttribute=1]="CompressedAttribute",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"}(n||(n={}))},c3a4:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(e,t){this._module=e,this._loadModule=t}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}},c51b:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("3886");function a(e){e.vertex.code.add(r["b"]`const float PI = 3.141592653589793;`),e.fragment.code.add(r["b"]`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}},c6d7:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return o}));var r=i("d047"),a=i("d8a4"),n=i("3886"),s=i("6a3c");function o(e,t){t.hasMultipassTerrain&&(e.fragment.include(r["a"]),e.fragment.uniforms.add(new s["a"]("terrainDepthTexture",(e,t)=>t.multipassTerrain.linearDepthTexture)),e.fragment.uniforms.add(new a["a"]("nearFar",(e,t)=>t.camera.nearFar)),e.fragment.uniforms.add(new a["a"]("inverseViewport",(e,t)=>t.inverseViewport)),e.fragment.code.add(n["b"]`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class c{constructor(){this.enabled=!1,this.cullAboveGround=!1}}},c76b:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("ea32"),a=i("1fe9"),n=i("3886");function s(e,t){const i=e.fragment;t.isGround?i.uniforms.add(new a["a"]("lightingFixedFactor",(e,t)=>(1-t.lighting.groundLightingFactor)*(1-t.lighting.globalFactor))):i.constants.add("lightingFixedFactor","float",0),i.uniforms.add([new r["a"]("lightingMainDirection",(e,t)=>t.lighting.lightingMainDirection),new r["a"]("lightingMainIntensity",(e,t)=>t.lighting.mainLight.intensity)]),i.code.add(n["b"]`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}},c829:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("b2b2"),a=i("8a44"),n=i("52b2"),s=i("1956");class o{constructor(e,t,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new a["a"]({deallocator:null}),this._glProgram=e.programCache.acquire(t.generate("vertex"),t.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=t.generateBind(n["a"].Pass,this),this.bindDraw=t.generateBind(n["a"].Draw,this),this._fragmentUniforms=Object(s["b"])()?t.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(e,t){this._glProgram.setUniform1i(e,t?1:0)}setUniform1i(e,t){this._glProgram.setUniform1i(e,t)}setUniform1f(e,t){this._glProgram.setUniform1f(e,t)}setUniform2f(e,t,i){this._glProgram.setUniform2f(e,t,i)}setUniform2fv(e,t){this._glProgram.setUniform2fv(e,t)}setUniform3f(e,t,i,r){this._glProgram.setUniform3f(e,t,i,r)}setUniform3fv(e,t){this._glProgram.setUniform3fv(e,t)}setUniform4f(e,t,i,r,a){this._glProgram.setUniform4f(e,t,i,r,a)}setUniform4fv(e,t){this._glProgram.setUniform4fv(e,t)}setUniformMatrix3fv(e,t){this._glProgram.setUniformMatrix3fv(e,t)}setUniformMatrix4fv(e,t){this._glProgram.setUniformMatrix4fv(e,t)}setUniform1fv(e,t){this._glProgram.setUniform1fv(e,t)}setUniform1iv(e,t){this._glProgram.setUniform1iv(e,t)}setUniform2iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform3iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform4iv(e,t){this._glProgram.setUniform4iv(e,t)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,t){if(Object(r["j"])(t)||null==t.glName){const t=this._textures.get(e);return t&&(this._context.bindTexture(null,t.unit),this._freeTextureUnit(t),this._textures.delete(e)),null}let i=this._textures.get(e);return null==i?(i=this._allocTextureUnit(t),this._textures.set(e,i)):i.texture=t,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(t,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)}),Object(r["k"])(this._fragmentUniforms)&&this._fragmentUniforms.forEach(e=>{"sampler2D"!==e.type&&"samplerCube"!==e.type||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}}},ca98:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("b2b2"),a=i("d17d");class n{constructor(e,t,i){this.release=i,t&&(this.initializeConfiguration(e,t),this._configuration=t.snapshot()),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=Object(r["e"])(this._program),this._pipeline=this._configuration=null}reload(e){Object(r["e"])(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.isCompiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPass(e,t){this.program.bindPass(e,t)}bindDraw(e,t){this.program.bindDraw(e,t),this.program.rebindTextures()}bindPipelineState(e,t=null,i){e.setPipelineState(this.getPipelineState(t,i))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return a["r"].TRIANGLES}getPipelineState(e,t){return this._pipeline}initializeConfiguration(e,t){}}},caf1e:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s}));var r,a=i("38a4"),n=i("b2b2");function s(e){switch(e){case"multiply":default:return r.Multiply;case"ignore":return r.Ignore;case"replace":return r.Replace;case"tint":return r.Tint}}function o(e,t,i){if(Object(n["j"])(e)||t===r.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const s=Object(a["e"])(Math.round(e[3]*l),0,l),o=0===s||t===r.Tint?0:t===r.Replace?d:h;i[0]=Object(a["e"])(Math.round(e[0]*c),0,c),i[1]=Object(a["e"])(Math.round(e[1]*c),0,c),i[2]=Object(a["e"])(Math.round(e[2]*c),0,c),i[3]=s+o}!function(e){e[e.Multiply=1]="Multiply",e[e.Ignore=2]="Ignore",e[e.Replace=3]="Replace",e[e.Tint=4]="Tint"}(r||(r={}));const c=255,l=85,d=l,h=2*l},caf7:function(e,t,i){"use strict";i.d(t,"a",(function(){return _}));var r,a=i("e431"),n=i("47f8"),s=i("0b2d"),o=i("7289"),c=i("d18f"),l=i("b7c2");!function(e){function t(e,t){const i=e[t],r=e[t+1],a=e[t+2];return Math.sqrt(i*i+r*r+a*a)}function i(e,t){const i=e[t],r=e[t+1],a=e[t+2],n=1/Math.sqrt(i*i+r*r+a*a);e[t]*=n,e[t+1]*=n,e[t+2]*=n}function r(e,t,i){e[t]*=i,e[t+1]*=i,e[t+2]*=i}function a(e,t,i,r,a,n=t){(a=a||e)[n]=e[t]+i[r],a[n+1]=e[t+1]+i[r+1],a[n+2]=e[t+2]+i[r+2]}function n(e,t,i,r,a,n=t){(a=a||e)[n]=e[t]-i[r],a[n+1]=e[t+1]-i[r+1],a[n+2]=e[t+2]-i[r+2]}e.length=t,e.normalize=i,e.scale=r,e.add=a,e.subtract=n}(r||(r={}));var d=i("0278"),h=i("1038"),u=i("1153"),p=i("b7bd");const b=r;var f,m,g,O;!function(e){const t=.5,i=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],a=[0,0,1,0,1,1,0,1],n=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),s=new Uint16Array(36);for(let l=0;l<6;l++)for(let e=0;e<6;e++)s[6*l+e]=l;const o=new Uint16Array(36);for(let l=0;l<6;l++)o[6*l+0]=0,o[6*l+1]=1,o[6*l+2]=2,o[6*l+3]=2,o[6*l+4]=3,o[6*l+5]=0;function c(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(24);for(let r=0;r<8;r++)t[3*r]=i[r][0]*e[0],t[3*r+1]=i[r][1]*e[1],t[3*r+2]=i[r][2]*e[2];return new d["a"]([[p["a"].POSITION,{size:3,data:t,exclusive:!0}],[p["a"].NORMAL,{size:3,data:r}],[p["a"].UV0,{size:2,data:a}]],[[p["a"].POSITION,n],[p["a"].NORMAL,s],[p["a"].UV0,o]])}e.createGeometry=c}(f||(f={})),function(e){const t=.5,i=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],a=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),n=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function s(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(18);for(let r=0;r<6;r++)t[3*r]=i[r][0]*e[0],t[3*r+1]=i[r][1]*e[1],t[3*r+2]=i[r][2]*e[2];return new d["a"]([[p["a"].POSITION,{size:3,data:t,exclusive:!0}],[p["a"].NORMAL,{size:3,data:r}]],[[p["a"].POSITION,a],[p["a"].NORMAL,n]])}e.createGeometry=s}(m||(m={})),function(e){const t=.5,i=0,r=Object(n["c"])(-t,i,-t),s=Object(n["c"])(t,i,-t),o=Object(n["c"])(0,i,t),c=Object(n["c"])(0,i+t,0),l=Object(n["b"])(),h=Object(n["b"])(),u=Object(n["b"])(),b=Object(n["b"])(),f=Object(n["b"])();Object(a["f"])(l,r,c),Object(a["f"])(h,r,s),Object(a["j"])(u,l,h),Object(a["r"])(u,u),Object(a["f"])(l,s,c),Object(a["f"])(h,s,o),Object(a["j"])(b,l,h),Object(a["r"])(b,b),Object(a["f"])(l,o,c),Object(a["f"])(h,o,r),Object(a["j"])(f,l,h),Object(a["r"])(f,f);const m=[r,s,o,c],g=[0,-1,0,u[0],u[1],u[2],b[0],b[1],b[2],f[0],f[1],f[2]],O=[0,1,2,3,1,0,3,2,1,3,0,2],v=[0,0,0,1,1,1,2,2,2,3,3,3];function y(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(12);for(let i=0;i<4;i++)t[3*i]=m[i][0]*e[0],t[3*i+1]=m[i][1]*e[1],t[3*i+2]=m[i][2]*e[2];return new d["a"]([[p["a"].POSITION,{size:3,data:t,exclusive:!0}],[p["a"].NORMAL,{size:3,data:g}]],[[p["a"].POSITION,new Uint16Array(O)],[p["a"].NORMAL,new Uint16Array(v)]])}e.createGeometry=y}(g||(g={})),function(e){function t(e,t,i,r={uv:!0}){const a=-Math.PI,n=2*Math.PI,s=-Math.PI/2,o=Math.PI,c=Math.max(3,Math.floor(t)),l=Math.max(2,Math.floor(i)),h=(c+1)*(l+1),u=new Float32Array(3*h),b=new Float32Array(3*h),f=new Float32Array(2*h),m=[];let g=0;for(let d=0;d<=l;d++){const t=[],i=d/l,r=s+i*o,h=Math.cos(r);for(let s=0;s<=c;s++){const o=s/c,l=a+o*n,d=Math.cos(l)*h,p=Math.sin(r),m=-Math.sin(l)*h;u[3*g]=d*e,u[3*g+1]=p*e,u[3*g+2]=m*e,b[3*g]=d,b[3*g+1]=p,b[3*g+2]=m,f[2*g]=o,f[2*g+1]=i,t.push(g),++g}m.push(t)}const O=new Uint32Array(2*c*(l-1)*3);g=0;for(let d=0;d<l;d++)for(let e=0;e<c;e++){const t=m[d][e],i=m[d][e+1],r=m[d+1][e+1],a=m[d+1][e];0===d?(O[g++]=t,O[g++]=r,O[g++]=a):d===l-1?(O[g++]=t,O[g++]=i,O[g++]=r):(O[g++]=t,O[g++]=i,O[g++]=r,O[g++]=r,O[g++]=a,O[g++]=t)}const v=[[p["a"].POSITION,O],[p["a"].NORMAL,O]],y=[[p["a"].POSITION,{size:3,data:u,exclusive:!0}],[p["a"].NORMAL,{size:3,data:b,exclusive:!0}]];return r.uv&&(y.push([p["a"].UV0,{size:2,data:f,exclusive:!0}]),v.push([p["a"].UV0,O])),r.offset&&(v[0][0]=p["a"].OFFSET,y[0][0]=p["a"].OFFSET,v.push([p["a"].POSITION,new Uint32Array(O.length)]),y.push([p["a"].POSITION,{size:3,data:Float64Array.from(r.offset),exclusive:!0}])),new d["a"](y,v)}function i(e,t,i){const r=e;let a,n;if(i)a=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const e=r*(1+Math.sqrt(5))/2;a=[-r,e,0,r,e,0,-r,-e,0,r,-e,0,0,-r,e,0,r,e,0,-r,-e,0,r,-e,e,0,-r,e,0,r,-e,0,-r,-e,0,r],n=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let d=0;d<a.length;d+=3)b.scale(a,d,e/b.length(a,d));let s={};function o(t,i){t>i&&([t,i]=[i,t]);const r=t.toString()+"."+i.toString();if(s[r])return s[r];let n=a.length;return a.length+=3,b.add(a,3*t,a,3*i,a,n),b.scale(a,n,e/b.length(a,n)),n/=3,s[r]=n,n}for(let d=0;d<t;d++){const e=n.length,t=new Uint32Array(4*e);for(let i=0;i<e;i+=3){const e=n[i],r=n[i+1],a=n[i+2],s=o(e,r),c=o(r,a),l=o(a,e),d=4*i;t[d]=e,t[d+1]=s,t[d+2]=l,t[d+3]=r,t[d+4]=c,t[d+5]=s,t[d+6]=a,t[d+7]=l,t[d+8]=c,t[d+9]=s,t[d+10]=c,t[d+11]=l}n=t,s={}}const c=new Float32Array(a);for(let d=0;d<c.length;d+=3)b.normalize(c,d);const l=[[p["a"].POSITION,n],[p["a"].NORMAL,n]],h=[[p["a"].POSITION,{size:3,data:new Float32Array(a),exclusive:!0}],[p["a"].NORMAL,{size:3,data:c,exclusive:!0}]];return new d["a"](h,l)}function r(e,t,i,r,a,n,s){const o=t?[t[0],t[1],t[2]]:[0,0,0],c=e?[e[0],e[1],e[2]]:[0,0,1];n=n||[0,0];const h=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],u=null!=r&&2===r.length?r:[1,1],b=[[p["a"].POSITION,{size:3,data:o,exclusive:!0}],[p["a"].NORMAL,{size:3,data:c,exclusive:!0}],[p["a"].UV0,{size:n.length,data:n}],[p["a"].COLOR,{size:4,data:h,exclusive:!0}],[p["a"].SIZE,{size:2,data:u}]];if(null!=a){const e=new Float32Array([a[0],a[1],a[2],a[3]]);b.push([p["a"].AUXPOS1,{size:4,data:e}])}if(null!=s){const e=new Float32Array([s[0],s[1],s[2],s[3]]);b.push([p["a"].AUXPOS2,{size:4,data:e}])}return new d["a"](b,null,l["f"].Point)}function O(e,t,i,r,a,n,s,o){if(null!=e){const{data:t}=o.getMutableAttribute(p["a"].NORMAL);t[0]=e[0],t[1]=e[1],t[2]=e[2]}if(null!=t){const{data:e}=o.getMutableAttribute(p["a"].POSITION);e[0]=t[0],e[1]=t[1],e[2]=t[2]}if(null!=i){const{data:e}=o.getMutableAttribute(p["a"].COLOR);e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3]}if(null!=r){const{data:e}=o.getMutableAttribute(p["a"].SIZE);e[0]=r[0],e[1]=r[1]}if(null!=a){const{data:e}=o.getMutableAttribute(p["a"].AUXPOS1);e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3]}if(null!=n){const{data:e}=o.getMutableAttribute(p["a"].UV0);e[0]=n[0],e[1]=n[1]}if(null!=s){const{data:e}=o.getMutableAttribute(p["a"].AUXPOS2);e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3]}}function _(e,t){const i=new Float32Array(3*e.length),r=new Float32Array(t?3*e.length:3),a=new Uint32Array(e.length),n=new Uint32Array(e.length);for(let l=0;l<e.length;l++)i[3*l]=e[l][0],i[3*l+1]=e[l][1],i[3*l+2]=e[l][2],t&&(r[3*l]=t[l][0],r[3*l+1]=t[l][1],r[3*l+2]=t[l][2]),a[l]=l,n[l]=0;t||(r[0]=0,r[1]=1,r[2]=0);const s=[0,0],o=[[p["a"].POSITION,a],[p["a"].NORMAL,t?a:n],[p["a"].UV0,n]],c=[[p["a"].POSITION,{size:3,data:i,exclusive:!0}],[p["a"].NORMAL,{size:3,data:r,exclusive:!0}],[p["a"].UV0,{size:2,data:s,exclusive:!0}]];return new d["a"](c,o,l["f"].Point)}function j(){const e=[0,0,0,0,0,100,100,0,0],t=new Uint16Array([0,1,2]),i=[0,1,0],r=new Uint16Array([0,0,0]),a=[0,0],n=new Uint16Array([0,0,0]),s=[[p["a"].POSITION,t],[p["a"].NORMAL,r],[p["a"].UV0,n]],o=[[p["a"].POSITION,{size:3,data:e,exclusive:!0}],[p["a"].NORMAL,{size:3,data:i,exclusive:!0}],[p["a"].UV0,{size:2,data:a,exclusive:!0}]];return new d["a"](o,s)}e.createBoxGeometry=f.createGeometry,e.createDiamondGeometry=m.createGeometry,e.createTetrahedronGeometry=g.createGeometry,e.createSphereGeometry=t,e.createPolySphereGeometry=i,e.createPointGeometry=r,e.updatePointGeometry=O,e.createPointArrayGeometry=_,e.createTriangleGeometry=j;const x=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function S(e=x){const t=new Array(12);for(let l=0;l<4;l++)for(let i=0;i<3;i++)t[3*l+i]=e[l][i];const i=new Uint32Array([0,1,2,2,3,0]),r=[0,0,1],a=new Uint32Array([0,0,0,0,0,0]),n=[0,0,1,0,1,1,0,1],s=[255,255,255,255],o=[[p["a"].POSITION,i],[p["a"].NORMAL,a],[p["a"].UV0,i],[p["a"].COLOR,a]],c=[[p["a"].POSITION,{size:3,data:t,exclusive:!0}],[p["a"].NORMAL,{size:3,data:r,exclusive:!0}],[p["a"].UV0,{size:2,data:n,exclusive:!0}],[p["a"].COLOR,{size:4,data:s,exclusive:!0}]];return new d["a"](c,o)}function T(e,t,i,r,a=!0,s=!0){let o=0;const c=t,l=e;let h=Object(n["c"])(0,o,0),u=Object(n["c"])(0,o+l,0),b=Object(n["c"])(0,-1,0),f=Object(n["c"])(0,1,0);r&&(o=l,u=Object(n["c"])(0,0,0),h=Object(n["c"])(0,o,0),b=Object(n["c"])(0,1,0),f=Object(n["c"])(0,-1,0));const m=[u,h],g=[b,f],O=i+2,v=Math.sqrt(l*l+c*c);if(r)for(let d=i-1;d>=0;d--){const e=d*(2*Math.PI/i),t=Object(n["c"])(Math.cos(e)*c,o,Math.sin(e)*c);m.push(t);const r=Object(n["c"])(l*Math.cos(e)/v,-c/v,l*Math.sin(e)/v);g.push(r)}else for(let d=0;d<i;d++){const e=d*(2*Math.PI/i),t=Object(n["c"])(Math.cos(e)*c,o,Math.sin(e)*c);m.push(t);const r=Object(n["c"])(l*Math.cos(e)/v,c/v,l*Math.sin(e)/v);g.push(r)}const y=new Uint32Array(2*(i+2)*3),_=new Uint32Array(2*(i+2)*3);let j=0,x=0;if(a){for(let e=3;e<m.length;e++)y[j++]=1,y[j++]=e-1,y[j++]=e,_[x++]=0,_[x++]=0,_[x++]=0;y[j++]=m.length-1,y[j++]=2,y[j++]=1,_[x++]=0,_[x++]=0,_[x++]=0}if(s){for(let e=3;e<m.length;e++)y[j++]=e,y[j++]=e-1,y[j++]=0,_[x++]=e,_[x++]=e-1,_[x++]=1;y[j++]=0,y[j++]=2,y[j++]=m.length-1,_[x++]=1,_[x++]=2,_[x++]=g.length-1}const S=new Float32Array(3*O);for(let n=0;n<O;n++)S[3*n]=m[n][0],S[3*n+1]=m[n][1],S[3*n+2]=m[n][2];const T=new Float32Array(3*O);for(let n=0;n<O;n++)T[3*n]=g[n][0],T[3*n+1]=g[n][1],T[3*n+2]=g[n][2];const w=[[p["a"].POSITION,y],[p["a"].NORMAL,_]],C=[[p["a"].POSITION,{size:3,data:S,exclusive:!0}],[p["a"].NORMAL,{size:3,data:T,exclusive:!0}]];return new d["a"](C,w)}function w(e,t,i,r,s,o){const c=r?Object(n["a"])(r):Object(n["c"])(1,0,0),l=s?Object(n["a"])(s):Object(n["c"])(0,0,0);o=null==o||o;const h=Object(n["b"])();Object(a["r"])(h,c);const u=Object(n["b"])();Object(a["k"])(u,h,Math.abs(e));const b=Object(n["b"])();Object(a["k"])(b,u,-.5),Object(a["e"])(b,b,l);const f=Object(n["c"])(0,1,0);Math.abs(1-Object(a["i"])(h,f))<.2&&Object(a["w"])(f,0,0,1);const m=Object(n["b"])();Object(a["j"])(m,h,f),Object(a["r"])(m,m),Object(a["j"])(f,m,h);const g=2*i+(o?2:0),O=i+(o?2:0),v=new Float32Array(3*g),y=new Float32Array(3*O),_=new Float32Array(2*g),j=new Uint32Array(3*i*(o?4:2)),x=new Uint32Array(3*i*(o?4:2));o&&(v[3*(g-2)+0]=b[0],v[3*(g-2)+1]=b[1],v[3*(g-2)+2]=b[2],_[2*(g-2)]=0,_[2*(g-2)+1]=0,v[3*(g-1)+0]=v[3*(g-2)+0]+u[0],v[3*(g-1)+1]=v[3*(g-2)+1]+u[1],v[3*(g-1)+2]=v[3*(g-2)+2]+u[2],_[2*(g-1)]=1,_[2*(g-1)+1]=1,y[3*(O-2)+0]=-h[0],y[3*(O-2)+1]=-h[1],y[3*(O-2)+2]=-h[2],y[3*(O-1)+0]=h[0],y[3*(O-1)+1]=h[1],y[3*(O-1)+2]=h[2]);const S=(e,t,i)=>{j[e]=t,x[e]=i};let T=0;const w=Object(n["b"])(),C=Object(n["b"])();for(let n=0;n<i;n++){const e=n*(2*Math.PI/i);Object(a["k"])(w,f,Math.sin(e)),Object(a["k"])(C,m,Math.cos(e)),Object(a["e"])(w,w,C),y[3*n+0]=w[0],y[3*n+1]=w[1],y[3*n+2]=w[2],Object(a["k"])(w,w,t),Object(a["e"])(w,w,b),v[3*n+0]=w[0],v[3*n+1]=w[1],v[3*n+2]=w[2],_[2*n+0]=n/i,_[2*n+1]=0,v[3*(n+i)+0]=v[3*n+0]+u[0],v[3*(n+i)+1]=v[3*n+1]+u[1],v[3*(n+i)+2]=v[3*n+2]+u[2],_[2*(n+i)+0]=n/i,_[2*n+1]=1;const r=(n+1)%i;S(T++,n,n),S(T++,n+i,n),S(T++,r,r),S(T++,r,r),S(T++,n+i,n),S(T++,r+i,r)}if(o){for(let e=0;e<i;e++){const t=(e+1)%i;S(T++,g-2,O-2),S(T++,e,O-2),S(T++,t,O-2)}for(let e=0;e<i;e++){const t=(e+1)%i;S(T++,e+i,O-1),S(T++,g-1,O-1),S(T++,t+i,O-1)}}const A=[[p["a"].POSITION,j],[p["a"].NORMAL,x],[p["a"].UV0,j]],P=[[p["a"].POSITION,{size:3,data:v,exclusive:!0}],[p["a"].NORMAL,{size:3,data:y,exclusive:!0}],[p["a"].UV0,{size:2,data:_,exclusive:!0}]];return new d["a"](P,A)}function C(t,i,r,a,n){r=r||10,a=null==a||a,Object(u["a"])(t.length>1);const s=[[0,0,0]],o=[],c=[];for(let e=0;e<r;e++){o.push([0,-e-1,-(e+1)%r-1]);const t=e/r*2*Math.PI;c.push([Math.cos(t)*i,Math.sin(t)*i])}return e.createPathExtrusionGeometry(c,t,s,o,a,n)}function A(e,t,i,r,l,h=Object(n["c"])(0,0,0)){const u=e.length,b=new Float32Array(t.length*u*3+(6*i.length||0)),f=new Float32Array(t.length*u*3+(i?6:0)),m=(t.length-1)*u*6+3*r.length*2,g=new Uint32Array(m),O=new Uint32Array(m);let y=0,_=0,j=0,x=0;const S=Object(n["b"])(),T=Object(n["b"])(),w=Object(n["b"])(),C=Object(n["b"])(),A=Object(n["b"])(),P=Object(n["b"])(),R=Object(n["b"])(),E=Object(s["f"])(),I=Object(n["b"])(),M=Object(n["b"])(),L=Object(n["b"])(),N=Object(n["b"])(),F=Object(n["b"])(),z=Object(o["d"])();Object(a["w"])(I,0,1,0),Object(a["f"])(T,t[1],t[0]),Object(a["r"])(T,T),l?(Object(a["e"])(E,t[0],h),Object(a["r"])(w,E)):Object(a["w"])(w,0,0,1),D(T,w,I,I,A,w,v),Object(a["g"])(C,w),Object(a["g"])(N,A);for(let n=0;n<i.length;n++)Object(a["k"])(P,A,i[n][0]),Object(a["k"])(E,w,i[n][2]),Object(a["e"])(P,P,E),Object(a["e"])(P,P,t[0]),b[y++]=P[0],b[y++]=P[1],b[y++]=P[2];f[_++]=-T[0],f[_++]=-T[1],f[_++]=-T[2];for(let a=0;a<r.length;a++)g[j++]=r[a][0]>0?r[a][0]:-r[a][0]-1+i.length,g[j++]=r[a][1]>0?r[a][1]:-r[a][1]-1+i.length,g[j++]=r[a][2]>0?r[a][2]:-r[a][2]-1+i.length,O[x++]=0,O[x++]=0,O[x++]=0;let G=i.length;const V=i.length-1;for(let n=0;n<t.length;n++){let i=!1;n>0&&(Object(a["g"])(S,T),n<t.length-1?(Object(a["f"])(T,t[n+1],t[n]),Object(a["r"])(T,T)):i=!0,Object(a["e"])(M,S,T),Object(a["r"])(M,M),Object(a["e"])(L,t[n-1],C),Object(o["g"])(t[n],M,z),Object(o["m"])(z,Object(c["g"])(L,S),E)?(Object(a["f"])(E,E,t[n]),Object(a["r"])(w,E),Object(a["j"])(A,M,w),Object(a["r"])(A,A)):D(M,C,N,I,A,w,v),Object(a["g"])(C,w),Object(a["g"])(N,A)),l&&(Object(a["e"])(E,t[n],h),Object(a["r"])(F,E));for(let r=0;r<u;r++)if(Object(a["k"])(P,A,e[r][0]),Object(a["k"])(E,w,e[r][1]),Object(a["e"])(P,P,E),Object(a["r"])(R,P),f[_++]=R[0],f[_++]=R[1],f[_++]=R[2],Object(a["e"])(P,P,t[n]),b[y++]=P[0],b[y++]=P[1],b[y++]=P[2],!i){const e=(r+1)%u;g[j++]=G+r,g[j++]=G+u+r,g[j++]=G+e,g[j++]=G+e,g[j++]=G+u+r,g[j++]=G+u+e;for(let t=0;t<6;t++)O[x++]=g[j-6+t]-V}G+=u}const U=t[t.length-1];for(let n=0;n<i.length;n++)Object(a["k"])(P,A,i[n][0]),Object(a["k"])(E,w,i[n][1]),Object(a["e"])(P,P,E),Object(a["e"])(P,P,U),b[y++]=P[0],b[y++]=P[1],b[y++]=P[2];const B=_/3;f[_++]=T[0],f[_++]=T[1],f[_++]=T[2];const k=G-u;for(let a=0;a<r.length;a++)g[j++]=r[a][0]>=0?G+r[a][0]:-r[a][0]-1+k,g[j++]=r[a][2]>=0?G+r[a][2]:-r[a][2]-1+k,g[j++]=r[a][1]>=0?G+r[a][1]:-r[a][1]-1+k,O[x++]=B,O[x++]=B,O[x++]=B;const H=[[p["a"].POSITION,g],[p["a"].NORMAL,O]],W=[[p["a"].POSITION,{size:3,data:b,exclusive:!0}],[p["a"].NORMAL,{size:3,data:f,exclusive:!0}]];return new d["a"](W,H)}function P(e,t,i){Object(u["a"])(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Object(u["a"])(3===e[0].length,"createPolylineGeometry(): malformed vertex"),Object(u["a"])(null==t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),Object(u["a"])(null==t||3===t[0].length,"createPolylineGeometry(): malformed normal");const r=new Float64Array(3*e.length),a=new Uint32Array(2*(e.length-1));let n=0,s=0;for(let l=0;l<e.length;l++){for(let t=0;t<3;t++)r[n++]=e[l][t];l>0&&(a[s++]=l-1,a[s++]=l)}const o=[],c=[];if(o.push([p["a"].POSITION,a]),c.push([p["a"].POSITION,{size:3,data:r,exclusive:!0}]),t){const i=new Float32Array(3*t.length);let r=0;for(let a=0;a<e.length;a++)for(let e=0;e<3;e++)i[r++]=t[a][e];o.push([p["a"].NORMAL,a]),c.push([p["a"].NORMAL,{size:3,data:i,exclusive:!0}])}return i&&(c.push([p["a"].COLOR,{size:4,data:i}]),o.push([p["a"].COLOR,Object(h["d"])(i.length/4)])),new d["a"](c,o,l["f"].Line)}function R(e,t,i,r,a=0){const n=new Array(18),s=[[-t,a,r/2],[i,a,r/2],[0,e+a,r/2],[-t,a,-r/2],[i,a,-r/2],[0,e+a,-r/2]],o=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let c=0;c<6;c++)n[3*c]=s[c][0],n[3*c+1]=s[c][1],n[3*c+2]=s[c][2];return new d["a"]([[p["a"].POSITION,{size:3,data:n,exclusive:!0}]],[[p["a"].POSITION,o]])}function E(e,t){const i=e.getMutableAttribute(p["a"].POSITION).data;for(let r=0;r<i.length;r+=3){const e=i[r],n=i[r+1],s=i[r+2];Object(a["w"])(y,e,n,s),Object(a["q"])(y,y,t),i[r]=y[0],i[r+1]=y[1],i[r+2]=y[2]}}function I(e,t=e){const i=e.vertexAttributes,r=i.get(p["a"].POSITION).data,a=i.get(p["a"].NORMAL).data;if(a){const e=t.getMutableAttribute(p["a"].NORMAL).data;for(let t=0;t<a.length;t+=3){const i=a[t+1];e[t+1]=-a[t+2],e[t+2]=i}}if(r){const e=t.getMutableAttribute(p["a"].POSITION).data;for(let t=0;t<r.length;t+=3){const i=r[t+1];e[t+1]=-r[t+2],e[t+2]=i}}return t}function M(e,t,i,r,n){return!(Math.abs(Object(a["i"])(t,e))>n)&&(Object(a["j"])(i,e,t),Object(a["r"])(i,i),Object(a["j"])(r,i,e),Object(a["r"])(r,r),!0)}function D(e,t,i,r,a,n,s){return M(e,t,a,n,s)||M(e,i,a,n,s)||M(e,r,a,n,s)}e.createSquareGeometry=S,e.createConeGeometry=T,e.createCylinderGeometry=w,e.createTubeGeometry=C,e.createPathExtrusionGeometry=A,e.createPolylineGeometry=P,e.createExtrudedTriangle=R,e.transformInPlace=E,e.cgToGIS=I,e.makeOrthoBasisDirUp=M,e.makeOrthoBasisDirUpFallback=D}(O||(O={}));const v=.99619469809,y=Object(n["b"])(),_=O},ce76:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("b50f"),a=i("b2b2"),n=i("8a44"),s=i("4637");class o{constructor(e=9,t){this.compareMinX=h,this.compareMinY=u,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),y.prune(),_.prune(),j.prune(),x.prune()}all(e){this._all(this.data,e)}search(e,t){let i=this.data;const r=this._toBBox;if(O(e,i))for(y.clear();i;){for(let a=0,n=i.children.length;a<n;a++){const n=i.children[a],s=i.leaf?r(n):n;O(e,s)&&(i.leaf?t(n):g(e,s)?this._all(n,t):y.push(n))}i=y.pop()}}collides(e){let t=this.data;const i=this._toBBox;if(!O(e,t))return!1;for(y.clear();t;){for(let r=0,a=t.children.length;r<a;r++){const a=t.children[r],n=t.leaf?i(a):a;if(O(e,n)){if(t.leaf||g(e,n))return!0;y.push(a)}}t=y.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}let t=this._build(e.slice(0,e.length),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=new w([]),this}remove(e){if(!e)return this;let t,i=this.data,n=null,s=0,o=!1;const c=this._toBBox(e);for(j.clear(),x.clear();i||j.length>0;){var l;if(i||(i=Object(a["c"])(j.pop()),n=j.data[j.length-1],s=null!=(l=x.pop())?l:0,o=!0),i.leaf&&(t=Object(r["e"])(i.children,e,i.children.length,i.indexHint),-1!==t))return i.children.splice(t,1),j.push(i),this._condense(j),this;o||i.leaf||!g(i,c)?n?(s++,i=n.children[s],o=!1):i=null:(j.push(i),x.push(s),s=0,n=i,i=i.children[0])}return this}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){let i=e;for(_.clear();i;){var r;if(!0===i.leaf)for(const e of i.children)t(e);else _.pushArray(i.children);i=null!=(r=_.pop())?r:null}}_build(e,t,i,r){const a=i-t+1;let n=this._maxEntries;if(a<=n){const r=new w(e.slice(t,i+1));return c(r,this._toBBox),r}r||(r=Math.ceil(Math.log(a)/Math.log(n)),n=Math.ceil(a/n**(r-1)));const s=new C([]);s.height=r;const o=Math.ceil(a/n),l=o*Math.ceil(Math.sqrt(n));v(e,t,i,l,this.compareMinX);for(let c=t;c<=i;c+=l){const t=Math.min(c+l-1,i);v(e,c,t,o,this.compareMinY);for(let i=c;i<=t;i+=o){const a=Math.min(i+o-1,t);s.children.push(this._build(e,i,a,r-1))}}return c(s,this._toBBox),s}_chooseSubtree(e,t,i,r){for(;r.push(t),!0!==t.leaf&&r.length-1!==i;){let i,r=1/0,a=1/0;for(let n=0,s=t.children.length;n<s;n++){const s=t.children[n],o=p(s),c=f(e,s)-o;c<a?(a=c,r=o<r?o:r,i=s):c===a&&o<r&&(r=o,i=s)}t=i||t.children[0]}return t}_insert(e,t,i){const r=this._toBBox,a=i?e:r(e);j.clear();const n=this._chooseSubtree(a,this.data,t,j);for(n.children.push(e),d(n,a);t>=0&&j.data[t].children.length>this._maxEntries;)this._split(j,t),t--;this._adjustParentBBoxes(a,j,t)}_split(e,t){const i=e.data[t],r=i.children.length,a=this._minEntries;this._chooseSplitAxis(i,a,r);const n=this._chooseSplitIndex(i,a,r);if(!n)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const s=i.children.splice(n,i.children.length-n),o=i.leaf?new w(s):new C(s);o.height=i.height,c(i,this._toBBox),c(o,this._toBBox),t?e.data[t-1].children.push(o):this._splitRoot(i,o)}_splitRoot(e,t){this.data=new C([e,t]),this.data.height=e.height+1,c(this.data,this._toBBox)}_chooseSplitIndex(e,t,i){let r,a,n;r=a=1/0;for(let s=t;s<=i-t;s++){const t=l(e,0,s,this._toBBox),o=l(e,s,i,this._toBBox),c=m(t,o),d=p(t)+p(o);c<r?(r=c,n=s,a=d<a?d:a):c===r&&d<a&&(a=d,n=s)}return n}_chooseSplitAxis(e,t,i){const r=e.leaf?this.compareMinX:h,a=e.leaf?this.compareMinY:u;this._allDistMargin(e,t,i,r)<this._allDistMargin(e,t,i,a)&&e.children.sort(r)}_allDistMargin(e,t,i,r){e.children.sort(r);const a=this._toBBox,n=l(e,0,t,a),s=l(e,i-t,i,a);let o=b(n)+b(s);for(let c=t;c<i-t;c++){const t=e.children[c];d(n,e.leaf?a(t):t),o+=b(n)}for(let c=i-t-1;c>=t;c--){const t=e.children[c];d(s,e.leaf?a(t):t),o+=b(s)}return o}_adjustParentBBoxes(e,t,i){for(let r=i;r>=0;r--)d(t.data[r],e)}_condense(e){for(let t=e.length-1;t>=0;t--){const i=e.data[t];if(0===i.children.length)if(t>0){const a=e.data[t-1],n=a.children;n.splice(Object(r["e"])(n,i,n.length,a.indexHint),1)}else this.clear();else c(i,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function c(e,t){l(e,0,e.children.length,t,e)}function l(e,t,i,r,a){a||(a=new w([])),a.minX=1/0,a.minY=1/0,a.maxX=-1/0,a.maxY=-1/0;for(let n,s=t;s<i;s++)n=e.children[s],d(a,e.leaf?r(n):n);return a}function d(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function h(e,t){return e.minX-t.minX}function u(e,t){return e.minY-t.minY}function p(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function b(e){return e.maxX-e.minX+(e.maxY-e.minY)}function f(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function m(e,t){const i=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),a=Math.min(e.maxX,t.maxX),n=Math.min(e.maxY,t.maxY);return Math.max(0,a-i)*Math.max(0,n-r)}function g(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function O(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function v(e,t,i,r,n){const o=[t,i];for(;o.length;){const t=Object(a["c"])(o.pop()),i=Object(a["c"])(o.pop());if(t-i<=r)continue;const c=i+Math.ceil((t-i)/r/2)*r;Object(s["a"])(e,c,i,t,n),o.push(i,c,c,t)}}const y=new n["a"],_=new n["a"],j=new n["a"],x=new n["a"]({deallocator:void 0});class S{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class T extends S{constructor(){super(...arguments),this.height=1,this.indexHint=new r["a"]}}class w extends T{constructor(e){super(),this.children=e,this.leaf=!0}}class C extends T{constructor(e){super(),this.children=e,this.leaf=!1}}},d017:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return u}));i("0b2d");var r=i("501b"),a=i("fd48"),n=i("1fe9"),s=i("79a1"),o=i("3886"),c=i("62ae"),l=i("52b2");class d extends c["a"]{constructor(e,t,i,r){switch(t){case l["a"].Pass:return void super(e,"mat4",t,(t,r,a)=>t.setUniformMatrix4fv(e,i(r,a)),r);case l["a"].Draw:return void super(e,"mat4",t,(t,r,a)=>t.setUniformMatrix4fv(e,i(r,a)),r)}}}var h=i("6a3c");o["a"];function u(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new d("shadowMapMatrix",l["a"].Pass,(e,t)=>t.shadowMap.getShadowMapMatrices(e.origin),4)),b(e))}function p(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new d("shadowMapMatrix",l["a"].Draw,(e,t)=>t.shadowMap.getShadowMapMatrices(e.origin),4)),b(e))}function b(e){const t=e.fragment;t.include(r["a"]),t.uniforms.add([new h["a"]("shadowMapTex",(e,t)=>t.shadowMap.depthTexture),new s["a"]("numCascades",(e,t)=>t.shadowMap.numCascades),new a["a"]("cascadeDistances",(e,t)=>t.shadowMap.cascadeDistances),new n["a"]("depthHalfPixelSz",(e,t)=>.5/t.shadowMap.textureSize)]),t.code.add(o["b"]`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)}},d047:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("501b"),a=i("3886");function n(e){e.include(r["a"]),e.code.add(a["b"]`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}},d0cb:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return n}));var r,a=i("17b0");!function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(r||(r={}));var n,s=i("2f98"),o=i("8e97"),c=i("fd48"),l=i("1fe9"),d=i("3886"),h=i("85b3"),u=i("6a3c"),p=i("b7bd");function b(e,t){e.include(s["a"]),e.attributes.add(p["a"].POSITION,"vec3"),e.attributes.add(p["a"].NORMAL,"vec3"),e.attributes.add(p["a"].AUXPOS1,"vec4");const i=e.vertex;Object(o["b"])(e,t),Object(o["a"])(i,t),i.uniforms.add([new c["a"]("viewport",(e,t)=>t.camera.fullViewport),new l["a"]("polygonOffset",e=>e.shaderPolygonOffset),new l["a"]("cameraGroundRelative",(e,t)=>t.camera.aboveGround?1:-1),new l["a"]("renderTransparentlyOccludedHUD",(e,t)=>t.renderTransparentlyOccludedHUD===r.Occluded?1:t.renderTransparentlyOccludedHUD===r.NotOccluded?0:.75),new u["a"]("hudVisibilityTexture",(e,t)=>t.hudVisibilityTexture)]),t.hasVerticalOffset&&Object(a["b"])(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(d["b"]`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(d["b"]`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped&&!t.hasVerticalOffset||i.uniforms.add(new h["a"]("viewNormal",(e,t)=>t.camera.viewInverseTransposeMatrix)),t.isDraped||(i.uniforms.add(new l["a"]("perDistancePixelRatio",(e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2))),i.code.add(d["b"]`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),t.screenCenterOffsetUnitsEnabled===n.Screen&&i.uniforms.add(new l["a"]("pixelRatio",(e,t)=>t.camera.pixelRatio)),t.hasScreenSizePerspective&&Object(s["c"])(i),i.code.add(d["b"]`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===n.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?d["b"]`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==n.Screen?d["b"]`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===n.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===n.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.code.add(d["b"]`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}!function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"}(n||(n={}))},d18f:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return d})),i.d(t,"f",(function(){return h})),i.d(t,"g",(function(){return c}));i("b50f");var r=i("2119"),a=i("e431"),n=i("0b2d"),s=i("7361");function o(e){return e?{origin:Object(n["d"])(e.origin),direction:Object(n["d"])(e.direction)}:{origin:Object(n["f"])(),direction:Object(n["f"])()}}function c(e,t){const i=f.get();return i.origin=e,i.direction=t,i}function l(e,t=o()){return h(e.origin,e.direction,t)}function d(e,t,i=o()){return Object(a["g"])(i.origin,e),Object(a["f"])(i.direction,t,e),i}function h(e,t,i=o()){return Object(a["g"])(i.origin,e),Object(a["g"])(i.direction,t),i}function u(e,t){const i=Object(a["j"])(s["d"].get(),Object(a["r"])(s["d"].get(),e.direction),Object(a["f"])(s["d"].get(),t,e.origin));return Object(a["i"])(i,i)}function p(e,t,i){const r=Object(a["i"])(e.direction,Object(a["f"])(i,t,e.origin));return Object(a["e"])(i,e.origin,Object(a["k"])(i,e.direction,r)),i}function b(){return{origin:null,direction:null}}const f=new r["a"](b)},d272:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i("b2b2"),a=i("d791"),n=i("afe1"),s=i("e431"),o=i("0b2d"),c=i("35f0"),l=(i("ea32"),i("3886"));l["a"];function d(e,t){h(e,t,[new c["a"]("slicePlaneOrigin",(e,i)=>f(t,e,i)),new c["a"]("slicePlaneBasis1",(e,i)=>{var a;return m(t,e,i,null==(a=Object(r["r"])(i.slicePlane))?void 0:a.basis1)}),new c["a"]("slicePlaneBasis2",(e,i)=>{var a;return m(t,e,i,null==(a=Object(r["r"])(i.slicePlane))?void 0:a.basis2)})])}function h(e,t,i){if(!t.hasSlicePlane){const i=l["b"]`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(i),void e.fragment.code.add(i)}e.extensions.add("GL_OES_standard_derivatives"),t.hasSliceInVertexProgram&&e.vertex.uniforms.add(i),e.fragment.uniforms.add(i);const r=l["b"]`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,a=l["b"]`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.hasSliceHighlight?l["b"]`
        ${a}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:l["b"]`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(r),e.fragment.code.add(r),e.fragment.code.add(n)}function u(e,t,i){return e.instancedDoublePrecision?Object(s["w"])(g,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function p(e,t){return Object(r["k"])(e)?Object(s["f"])(O,t.origin,e):t.origin}function b(e,t,i){return e.hasSliceTranslatedView?Object(r["k"])(t)?Object(a["j"])(y,i.camera.viewMatrix,t):i.camera.viewMatrix:null}function f(e,t,i){if(Object(r["j"])(i.slicePlane))return o["c"];const a=u(e,t,i),n=p(a,i.slicePlane),c=b(e,a,i);return Object(r["k"])(c)?Object(s["q"])(O,n,c):n}function m(e,t,i,a){if(Object(r["j"])(a)||Object(r["j"])(i.slicePlane))return o["c"];const n=u(e,t,i),c=p(n,i.slicePlane),l=b(e,n,i);return Object(r["k"])(l)?(Object(s["e"])(v,a,c),Object(s["q"])(O,c,l),Object(s["q"])(v,v,l),Object(s["f"])(v,v,O)):a}const g=Object(o["f"])(),O=Object(o["f"])(),v=Object(o["f"])(),y=Object(n["d"])()},d359:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return m})),i.d(t,"c",(function(){return b})),i.d(t,"d",(function(){return g})),i.d(t,"e",(function(){return y})),i.d(t,"f",(function(){return v}));var r,a,n=i("2119"),s=i("d791"),o=i("e431"),c=i("0b2d"),l=i("7577"),d=i("0fc4"),h=i("4f8b"),u=i("7289"),p=i("7361");function b(e){return e?[Object(u["d"])(e[0]),Object(u["d"])(e[1]),Object(u["d"])(e[2]),Object(u["d"])(e[3]),Object(u["d"])(e[4]),Object(u["d"])(e[5])]:[Object(u["d"])(),Object(u["d"])(),Object(u["d"])(),Object(u["d"])(),Object(u["d"])(),Object(u["d"])()]}function f(){return[Object(c["f"])(),Object(c["f"])(),Object(c["f"])(),Object(c["f"])(),Object(c["f"])(),Object(c["f"])(),Object(c["f"])(),Object(c["f"])()]}function m(e,t){for(let i=0;i<_.NUM;i++)Object(u["c"])(e[i],t[i])}function g(e,t,i,r=S){const a=Object(s["m"])(p["a"].get(),t,e);Object(s["a"])(a,a);for(let n=0;n<j.NUM;++n){const e=Object(l["m"])(p["e"].get(),x[n],a);Object(o["w"])(r[n],e[0]/e[3],e[1]/e[3],e[2]/e[3])}O(i,r)}function O(e,t){Object(u["f"])(t[a.FAR_BOTTOM_LEFT],t[a.NEAR_BOTTOM_LEFT],t[a.NEAR_TOP_LEFT],e[r.LEFT]),Object(u["f"])(t[a.NEAR_BOTTOM_RIGHT],t[a.FAR_BOTTOM_RIGHT],t[a.FAR_TOP_RIGHT],e[r.RIGHT]),Object(u["f"])(t[a.FAR_BOTTOM_LEFT],t[a.FAR_BOTTOM_RIGHT],t[a.NEAR_BOTTOM_RIGHT],e[r.BOTTOM]),Object(u["f"])(t[a.NEAR_TOP_LEFT],t[a.NEAR_TOP_RIGHT],t[a.FAR_TOP_RIGHT],e[r.TOP]),Object(u["f"])(t[a.NEAR_BOTTOM_LEFT],t[a.NEAR_BOTTOM_RIGHT],t[a.NEAR_TOP_RIGHT],e[r.NEAR]),Object(u["f"])(t[a.FAR_BOTTOM_RIGHT],t[a.FAR_BOTTOM_LEFT],t[a.FAR_TOP_LEFT],e[r.FAR])}function v(e,t){for(let i=0;i<_.NUM;i++){const r=e[i];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function y(e,t){for(let i=0;i<_.NUM;i++){const r=e[i];if(!Object(u["b"])(r,t))return!1}return!0}!function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"}(r||(r={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(a||(a={}));a.FAR_BOTTOM_RIGHT,a.NEAR_BOTTOM_RIGHT,a.NEAR_BOTTOM_LEFT,a.FAR_BOTTOM_LEFT,a.NEAR_BOTTOM_LEFT,a.NEAR_BOTTOM_RIGHT,a.NEAR_TOP_RIGHT,a.NEAR_TOP_LEFT,a.FAR_BOTTOM_RIGHT,a.FAR_BOTTOM_LEFT,a.FAR_TOP_LEFT,a.FAR_TOP_RIGHT,a.NEAR_BOTTOM_RIGHT,a.FAR_BOTTOM_RIGHT,a.FAR_TOP_RIGHT,a.NEAR_TOP_RIGHT,a.FAR_BOTTOM_LEFT,a.NEAR_BOTTOM_LEFT,a.NEAR_TOP_LEFT,a.FAR_TOP_LEFT,a.FAR_TOP_LEFT,a.NEAR_TOP_LEFT,a.NEAR_TOP_RIGHT,a.FAR_TOP_RIGHT;var _,j;!function(e){e[e.NUM=6]="NUM"}(_||(_={})),function(e){e[e.NUM=8]="NUM"}(j||(j={}));const x=[Object(d["g"])(-1,-1,-1,1),Object(d["g"])(1,-1,-1,1),Object(d["g"])(1,1,-1,1),Object(d["g"])(-1,1,-1,1),Object(d["g"])(-1,-1,1,1),Object(d["g"])(1,-1,1,1),Object(d["g"])(1,1,1,1),Object(d["g"])(-1,1,1,1)],S=(new n["a"](h["a"]),f())},d36e:function(e,t,i){"use strict";i.d(t,"a",(function(){return w}));var r=i("0fc4"),a=i("a05b"),n=i("b7c2"),s=i("d7f7"),o=i("b061"),c=i("35b3"),l=i("7438"),d=i("badc"),h=i("8675"),u=i("7c51"),p=i("c3a4"),b=i("ca98"),f=i("fa1e"),m=i("c829"),g=i("87b7"),O=i("1962"),v=i("189c");class y extends b["a"]{initializeProgram(e){const t=y.shader.get().build(this.configuration);return new m["a"](e.rctx,t,f["a"])}_createPipeline(e,t){const i=this.configuration,r=e===n["i"].NONE,s=e===n["i"].FrontFace;return Object(v["f"])({blending:i.output!==a["a"].Color&&i.output!==a["a"].Alpha||!i.transparent?null:r?l["d"]:Object(l["f"])(e),culling:Object(v["b"])(i.cullFace),depthTest:{func:Object(l["g"])(e)},depthWrite:r||s?i.writeDepth&&v["d"]:null,colorWrite:v["c"],stencilWrite:i.hasOccludees?g["h"]:null,stencilTest:i.hasOccludees?t?g["d"]:g["c"]:null,polygonOffset:r||s?i.polygonOffset&&_:Object(l["e"])(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}y.shader=new p["a"](O["a"],()=>i.e("chunk-2d0de726").then(i.bind(null,"864f")));const _={factor:1,units:1};var j=i("a4ee"),x=i("da35"),S=i("6d35");class T extends S["a"]{constructor(){super(...arguments),this.output=a["a"].Color,this.cullFace=n["b"].None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=n["i"].NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}Object(j["a"])([Object(x["b"])({count:a["a"].COUNT})],T.prototype,"output",void 0),Object(j["a"])([Object(x["b"])({count:n["b"].COUNT})],T.prototype,"cullFace",void 0),Object(j["a"])([Object(x["b"])()],T.prototype,"hasSlicePlane",void 0),Object(j["a"])([Object(x["b"])()],T.prototype,"hasVertexColors",void 0),Object(j["a"])([Object(x["b"])()],T.prototype,"transparent",void 0),Object(j["a"])([Object(x["b"])()],T.prototype,"polygonOffset",void 0),Object(j["a"])([Object(x["b"])()],T.prototype,"enableOffset",void 0),Object(j["a"])([Object(x["b"])()],T.prototype,"writeDepth",void 0),Object(j["a"])([Object(x["b"])()],T.prototype,"hasOccludees",void 0),Object(j["a"])([Object(x["b"])({count:n["i"].COUNT})],T.prototype,"transparencyPassType",void 0),Object(j["a"])([Object(x["b"])()],T.prototype,"hasMultipassTerrain",void 0),Object(j["a"])([Object(x["b"])()],T.prototype,"cullAboveGround",void 0);class w extends c["a"]{constructor(e){super(e,new A),this.supportsEdges=!0,this._configuration=new T}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<l["b"],this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,i,r,a,n,s){Object(u["e"])(e,t,r,a,n,void 0,s)}requiresSlot(e,t){return e===d["a"].DRAPED_MATERIAL||(Object(o["b"])(t)===a["a"].Highlight?e===d["a"].OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?d["a"].TRANSPARENT_MATERIAL:d["a"].TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:d["a"].OPAQUE_MATERIAL))}createGLMaterial(e){return e.output===a["a"].Color||e.output===a["a"].Alpha||e.output===a["a"].Highlight||e.output===a["a"].Depth&&this.parameters.writeLinearDepth?new C(e):null}createBufferWriter(){return new h["a"](h["b"])}}class C extends s["a"]{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==a["a"].Color&&this._output!==a["a"].Alpha||this._updateOccludeeState(e),this.ensureTechnique(y,e)}}class A extends c["b"]{constructor(){super(...arguments),this.color=r["b"],this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=n["b"].None,this.hasOccludees=!1}}},d3cf:function(e,t,i){"use strict";i.d(t,"a",(function(){return v})),i.d(t,"b",(function(){return p})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return l}));var r=i("8d60"),a=(i("c120"),i("7ffa")),n=i("b2b2"),s=i("a21b"),o=i("a9ab"),c=i("1a54");function l(e){return"declaredClass"in e}function d(e){return"declaredClass"in e}function h(e){return"declaredClass"in e}function u(e,t){if(!e)return null;if(h(e))return e;const i=new r["a"]({layer:t,sourceLayer:t});return i.visible=e.visible,i.symbol=Object(a["a"])(e.symbol),i.attributes=Object(a["a"])(e.attributes),i.geometry=p(e.geometry),i}function p(e){return Object(n["j"])(e)?null:l(e)?e:Object(o["a"])(b(e))}function b(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:i,y:r,z:a,m:n}=e;return{x:i,y:r,z:a,m:n,spatialReference:t}}case"polygon":{const{rings:i,hasZ:r,hasM:a}=e;return{rings:f(i),hasZ:r,hasM:a,spatialReference:t}}case"polyline":{const{paths:i,hasZ:r,hasM:a}=e;return{paths:f(i),hasZ:r,hasM:a,spatialReference:t}}case"extent":{const{xmin:i,xmax:r,ymin:a,ymax:n,zmin:s,zmax:o,mmin:c,mmax:l,hasZ:d,hasM:h}=e;return{xmin:i,xmax:r,ymin:a,ymax:n,zmin:s,zmax:o,mmin:c,mmax:l,hasZ:d,hasM:h,spatialReference:t}}case"multipoint":{const{points:i,hasZ:r,hasM:a}=e;return{points:O(i)?m(i):i,hasZ:r,hasM:a,spatialReference:t}}default:return}}function f(e){return g(e)?e.map(e=>m(e)):e}function m(e){return e.map(e=>Object(s["n"])(e))}function g(e){for(const t of e)if(0!==t.length)return O(t);return!1}function O(e){return e.length&&(Object(s["d"])(e[0])||Object(s["e"])(e[0]))}function v(e,t){if(!e)return null;let i;if(d(e)){if(null==t)return e.clone();if(d(t))return t.copy(e)}return null!=t?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=null,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=Object(c["g"])(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}},d408:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return y})),i.d(t,"c",(function(){return _})),i.d(t,"d",(function(){return x})),i.d(t,"e",(function(){return L}));i("c120");var r,a=i("b2b2"),n=i("a21b"),s=i("3349"),o=i("e431"),c=i("0b2d"),l=i("8188"),d=i("f694"),h=i("1666"),u=i("3c9c"),p=i("ed70"),b=i("2e0f"),f=i("7585"),m=i("b7c2"),g=i("0278"),O=i("b7bd"),v=i("a6b6");function y(e){const t=[],i=[];S(e,i,t);const r=i[0][1].data,a=t[0][1].length,n=new Uint16Array(a);return T(e,i,t),w(e,i,t,n),A(e,i,t,n),C(e,i,t,n),P(e,i,t,n),R(e,i,t,n),E(e,i,t,r),new g["a"](i,t,m["f"].Line)}function _(e,t,i,r){const a="polygon"===e.type?h["a"].CCW_IS_HOLE:h["a"].NONE,n="polygon"===e.type?e.rings:e.paths,{position:s,outlines:o}=Object(h["b"])(n,e.hasZ,a),c=new Float64Array(s.length),l=Object(b["d"])(s,e.spatialReference,0,c,0,s,0,s.length/3,t,i,r),d=null!=l;return{lines:d?j(o,s,c):[],projectionSuccess:d,sampledElevation:l}}function j(e,t,i){const r=new Array;for(const{index:a,count:n}of e){if(n<=1)continue;const e=3*a,s=e+3*n;r.push({position:t.subarray(e,s),mapPosition:i?i.subarray(e,s):void 0})}return r}function x(e,t){const i="polygon"===e.type?h["a"].CCW_IS_HOLE:h["a"].NONE,r="polygon"===e.type?e.rings:e.paths,{position:a,outlines:n}=Object(h["b"])(r,!1,i),s=Object(l["l"])(a,e.spatialReference,0,a,t,0,a.length/3);for(let o=2;o<a.length;o+=3)a[o]=f["a"];return{lines:s?j(n,a):[],projectionSuccess:s}}function S(e,t,i){const{attributeData:{position:a},removeDuplicateStartEnd:s}=e,o=I(a)&&s===r.REMOVE,c=a.length/3-(o?1:0),l=new Uint32Array(2*(c-1)),d=o?Object(n["m"])(a,0,a.length-3):a;let h=0;for(let r=0;r<c-1;r++)l[h++]=r,l[h++]=r+1;t.push([O["a"].POSITION,{size:3,data:d,exclusive:o}]),i.push([O["a"].POSITION,l])}function T(e,t,i){const r=e.attributeData.mapPosition;Object(a["j"])(r)||(i.push([O["a"].MAPPOS,i[0][1]]),t.push([O["a"].MAPPOS,{size:3,data:r}]))}function w(e,t,i,r){if(Object(a["k"])(e.attributeData.colorFeature))return;const n=e.attributeData.color;t.push([O["a"].COLOR,{size:4,data:Object(a["s"])(n,p["c"])}]),i.push([O["a"].COLOR,r])}function C(e,t,i,r){const n=e.attributeData.colorFeature;Object(a["j"])(n)||(t.push([O["a"].COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),i.push([O["a"].COLOR,r]))}function A(e,t,i,r){if(Object(a["k"])(e.attributeData.sizeFeature))return;const n=e.attributeData.size;t.push([O["a"].SIZE,{size:1,data:[Object(a["s"])(n,1)]}]),i.push([O["a"].SIZE,r])}function P(e,t,i,r){const n=e.attributeData.sizeFeature;Object(a["j"])(n)||(t.push([O["a"].SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),i.push([O["a"].SIZEFEATUREATTRIBUTE,r]))}function R(e,t,i,r){const n=e.attributeData.opacityFeature;Object(a["j"])(n)||(t.push([O["a"].OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),i.push([O["a"].OPACITYFEATUREATTRIBUTE,r]))}function E(e,t,i,r){if(Object(a["j"])(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==u["a"].Global||!e.overlayInfo.spatialReference.isGeographic)return;const n=new Float64Array(r.length),c=Object(d["e"])(e.overlayInfo.spatialReference);for(let a=0;a<n.length;a+=3)Object(l["i"])(r,a,n,a,c);const h=r.length/3,p=new Float32Array(h+1);let b=M,f=D,m=0,g=0;Object(o["w"])(b,n[g++],n[g++],n[g++]),p[0]=0;for(let a=1;a<h+1;++a)a===h&&(g=0),Object(o["w"])(f,n[g++],n[g++],n[g++]),m+=Object(s["d"])(b,f),p[a]=m,[b,f]=[f,b];t.push([O["a"].DISTANCETOSTART,{size:1,data:p}]),i.push([O["a"].DISTANCETOSTART,i[0][1]])}function I(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}!function(e){e[e.KEEP=0]="KEEP",e[e.REMOVE=1]="REMOVE"}(r||(r={}));const M=Object(c["f"])(),D=Object(c["f"])();function L(e){switch(e){case"butt":return v["a"].BUTT;case"square":return v["a"].SQUARE;case"round":return v["a"].ROUND;default:return null}}},d539:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r=i("e431"),a=i("0b2d"),n=i("a05b"),s=i("6a21"),o=i("35f0"),c=i("3886"),l=i("85b3"),d=i("b7bd"),h=i("9cc4");function u(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(d["a"].MODELORIGINHI,"vec3"),e.attributes.add(d["a"].MODELORIGINLO,"vec3"),e.attributes.add(d["a"].MODEL,"mat3"),e.attributes.add(d["a"].MODELNORMAL,"mat3"));const i=e.vertex;t.instancedDoublePrecision&&(i.include(s["a"],t),i.uniforms.add(new o["a"]("viewOriginHi",(e,t)=>Object(h["b"])(Object(r["w"])(p,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]),p))),i.uniforms.add(new o["a"]("viewOriginLo",(e,t)=>Object(h["c"])(Object(r["w"])(p,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]),p)))),i.code.add(c["b"]`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),i.code.add(c["b"]`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?c["b"]`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),i.code.add(c["b"]`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),t.output===n["a"].Normal&&(i.uniforms.add(new l["a"]("viewNormal",(e,t)=>t.camera.viewInverseTransposeMatrix)),i.code.add(c["b"]`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),t.hasVertexTangents&&i.code.add(c["b"]`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}const p=Object(a["f"])()},d56e:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("a05b"),a=i("3886"),n=i("1956");function s(e,t){const i=a["b"]`
  /*
  *  ${t.name}
  *  ${t.output===r["a"].Color?"RenderOutput: Color":t.output===r["a"].Depth?"RenderOutput: Depth":t.output===r["a"].Shadow?"RenderOutput: Shadow":t.output===r["a"].Normal?"RenderOutput: Normal":t.output===r["a"].Highlight?"RenderOutput: Highlight":""}
  */
  `;Object(n["c"])()&&(e.fragment.code.add(i),e.vertex.code.add(i))}},d5f7:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return u}));var r=i("fa1e"),a=i("b7bd"),n=i("d17d"),s=i("3f3e");new s["a"](a["a"].POSITION,3,n["k"].FLOAT,0,12),new s["a"](a["a"].POSITION,3,n["k"].FLOAT,0,20),new s["a"](a["a"].UV0,2,n["k"].FLOAT,12,20),new s["a"](a["a"].POSITION,3,n["k"].FLOAT,0,32),new s["a"](a["a"].NORMAL,3,n["k"].FLOAT,12,32),new s["a"](a["a"].UV0,2,n["k"].FLOAT,24,32),new s["a"](a["a"].POSITION,3,n["k"].FLOAT,0,16),new s["a"](a["a"].COLOR,4,n["k"].UNSIGNED_BYTE,12,16);const o=[new s["a"](a["a"].POSITION,2,n["k"].FLOAT,0,8)],c=[new s["a"](a["a"].POSITION,2,n["k"].FLOAT,0,16),new s["a"](a["a"].UV0,2,n["k"].FLOAT,8,16)];var l=i("7ce4"),d=i("a1ff"),h=i("0fa6");function u(e,t=o,i=r["a"],a=-1,s=1){let d=null;return d=t===c?new Float32Array([a,a,0,0,s,a,1,0,a,s,0,1,s,s,1,1]):new Float32Array([a,a,s,a,a,s,s,s]),new h["a"](e,i,{geometry:t},{geometry:l["a"].createVertex(e,n["D"].STATIC_DRAW,d)})}function p(e){return new d["a"](e,{target:n["A"].TEXTURE_2D,pixelFormat:n["p"].RGBA,dataType:n["q"].UNSIGNED_BYTE,samplingMode:n["z"].NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}},d7f7:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("b7c2");class a{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}ensureTechnique(e,t,i=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(i,t),this._technique),this._technique}ensureResources(e){return r["g"].LOADED}}},d8a4:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae"),a=i("52b2");class n extends r["a"]{constructor(e,t){super(e,"vec2",a["a"].Pass,(i,r,a)=>i.setUniform2fv(e,t(r,a)))}}},d981:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a}));var r=i("3886");function a(e){e.fragment.code.add(r["b"]`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function n(e){e.fragment.code.add(r["b"]`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},da1c:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return h}));var r=i("38a4");i("3c9c");function a(e){return Math.abs(e*e*e)}function n(e,t,i){const r=i.parameters,n=i.paddingPixelsOverride;return u.scale=Math.min(r.divisor/(t-r.offset),1),u.factor=a(e),u.minPixelSize=r.minPixelSize,u.paddingPixels=n,u}function s(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function o(e,t){return Math.max(Object(r["l"])(e*t.scale,e,t.factor),s(e,t))}function c(e,t,i){const r=n(e,t,i);return r.minPixelSize=0,r.paddingPixels=0,o(1,r)}function l(e,t,i,r){r.scale=c(e,t,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function d(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,s(e[1],t)/Math.max(1e-5,e[1])),1);return i[0]=e[0]*r,i[1]=e[1]*r,i}function h(e,t,i,r){return o(e,n(t,i,r))}Object(r["g"])(10),Object(r["g"])(12),Object(r["g"])(70),Object(r["g"])(40);const u={scale:0,factor:0,minPixelSize:0,paddingPixels:0}},da35:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return a}));class r{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,t={key:this.key};for(const i of e)t[i]=this[i];return t}}function a(e={}){return(t,i)=>{var r;if(t._parameterNames=null!=(r=t._parameterNames)?r:[],t._parameterNames.push(i),null!=e.constValue)Object.defineProperty(t,i,{get:()=>e.constValue});else{var a;const r=t._parameterNames.length-1,n=e.count||2,s=Math.ceil(Math.log2(n)),o=null!=(a=t._parameterBits)?a:[0];let c=0;for(;o[c]+s>16;)c++,c>=o.length&&o.push(0);t._parameterBits=o;const l=o[c],d=(1<<s)-1<<l;o[c]+=s,Object.defineProperty(t,i,{get(){return this[r]},set(e){if(this[r]!==e&&(this[r]=e,this._keyDirty=!0,this._parameterBits[c]=this._parameterBits[c]&~d|+e<<l&d,"number"!=typeof e&&"boolean"!=typeof e))throw"Configuration value for "+i+" must be boolean or number, got "+typeof e}})}}}},dae5:function(e,t,i){"use strict";function r(){return[1,0,0,0,1,0,0,0,1]}function a(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function n(e,t,i,r,a,n,s,o,c){return[e,t,i,r,a,n,s,o,c]}function s(e,t){return new Float64Array(e,t,9)}i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return r}));Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:a,fromValues:n,createView:s},Symbol.toStringTag,{value:"Module"}))},db7b:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("62ae");class a extends r["a"]{constructor(e){super(e,"vec4")}}},dbad:function(e,t,i){"use strict";i.d(t,"a",(function(){return E})),i.d(t,"b",(function(){return F}));var r=i("b2b2"),a=i("e431"),n=i("0b2d"),s=i("3c9c"),o=i("fc00"),c=i("a05b"),l=i("c332"),d=i("aab5"),h=i("a7d7"),u=i("b7c2"),p=i("e93d"),b=i("35b3"),f=i("7438"),m=i("614d"),g=i("badc"),O=i("b7bd"),v=i("89bf"),y=i("5957"),_=i("7c51"),j=i("e1cb"),x=i("a4ee"),S=i("dfaf"),T=i("da35"),w=i("6d35");class C extends w["a"]{constructor(){super(...arguments),this.output=c["a"].Color,this.alphaDiscardMode=u["a"].Opaque,this.doubleSidedMode=d["b"].None,this.pbrMode=h["a"].Disabled,this.cullFace=u["b"].None,this.transparencyPassType=u["i"].NONE,this.normalType=l["b"].Attribute,this.textureCoordinateType=S["b"].None,this.customDepthTest=u["c"].Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1}}Object(x["a"])([Object(T["b"])({count:c["a"].COUNT})],C.prototype,"output",void 0),Object(x["a"])([Object(T["b"])({count:u["a"].COUNT})],C.prototype,"alphaDiscardMode",void 0),Object(x["a"])([Object(T["b"])({count:d["b"].COUNT})],C.prototype,"doubleSidedMode",void 0),Object(x["a"])([Object(T["b"])({count:h["a"].COUNT})],C.prototype,"pbrMode",void 0),Object(x["a"])([Object(T["b"])({count:u["b"].COUNT})],C.prototype,"cullFace",void 0),Object(x["a"])([Object(T["b"])({count:u["i"].COUNT})],C.prototype,"transparencyPassType",void 0),Object(x["a"])([Object(T["b"])({count:l["b"].COUNT})],C.prototype,"normalType",void 0),Object(x["a"])([Object(T["b"])({count:S["b"].COUNT})],C.prototype,"textureCoordinateType",void 0),Object(x["a"])([Object(T["b"])({count:u["c"].COUNT})],C.prototype,"customDepthTest",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"spherical",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"hasVertexColors",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"hasSymbolColors",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"hasVerticalOffset",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"hasSlicePlane",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"hasSliceHighlight",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"hasColorTexture",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"hasMetalnessAndRoughnessTexture",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"hasEmissionTexture",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"hasOcclusionTexture",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"hasNormalTexture",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"hasScreenSizePerspective",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"hasVertexTangents",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"hasOccludees",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"hasMultipassTerrain",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"hasModelTransformation",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"offsetBackfaces",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"vvSize",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"vvColor",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"receiveShadows",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"receiveAmbientOcclusion",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"textureAlphaPremultiplied",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"instanced",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"instancedColor",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"instancedDoublePrecision",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"doublePrecisionRequiresObfuscation",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"writeDepth",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"transparent",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"enableOffset",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"cullAboveGround",void 0),Object(x["a"])([Object(T["b"])()],C.prototype,"snowCover",void 0),Object(x["a"])([Object(T["b"])({constValue:!0})],C.prototype,"hasVvInstancing",void 0),Object(x["a"])([Object(T["b"])({constValue:!1})],C.prototype,"useCustomDTRExponentForWater",void 0),Object(x["a"])([Object(T["b"])({constValue:!1})],C.prototype,"supportsTextureAtlas",void 0),Object(x["a"])([Object(T["b"])({constValue:!0})],C.prototype,"useFillLights",void 0);var A=i("c3a4"),P=i("b0ab");class R extends j["c"]{initializeConfiguration(e,t){super.initializeConfiguration(e,t),t.hasMetalnessAndRoughnessTexture=!1,t.hasEmissionTexture=!1,t.hasOcclusionTexture=!1,t.hasNormalTexture=!1,t.hasModelTransformation=!1,t.normalType=l["b"].Attribute,t.doubleSidedMode=d["b"].WindingOrder,t.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,R.shader)}}R.shader=new A["a"](P["a"],()=>i.e("chunk-2d22ce29").then(i.bind(null,"f4af")));class E extends b["a"]{constructor(e){super(e,D),this.supportsEdges=!0,this.techniqueConfig=new C,this.vertexBufferLayout=N(this.parameters),this.instanceBufferLayout=e.instanced?F(this.parameters):null}isVisibleInPass(e){return e!==m["a"].MATERIAL_DEPTH_SHADOWMAP_ALL&&e!==m["a"].MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&e!==m["a"].MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||0===e.layerOpacity)return!1;const{instanced:t,hasVertexColors:i,hasSymbolColors:a,vvColorEnabled:n}=e,s=Object(r["k"])(t)&&t.includes("color"),o="replace"===e.colorMixMode,c=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0;return i&&(s||n||a)?!!o||c:i?o?l:c:s||n||a?!!o||c:o?l:c}getConfiguration(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.hasVertexTangents=this.parameters.hasVertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.hasVerticalOffset=Object(r["k"])(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=Object(r["k"])(this.parameters.screenSizePerspective),this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasSliceHighlight=this.parameters.hasSliceHighlight,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalType="screenDerivative"===this.parameters.normals?l["b"].ScreenDerivative:l["b"].Attribute,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,Object(r["k"])(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest),this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.cullFace=this.parameters.hasSlicePlane?u["b"].None:this.parameters.cullFace,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig.hasModelTransformation=Object(r["k"])(this.parameters.modelTransformation),e!==c["a"].Color&&e!==c["a"].Alpha||(this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=d["b"].WindingOrder:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?d["b"].View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?d["b"].WindingOrder:d["b"].None,this.techniqueConfig.instancedColor=Object(r["k"])(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!t.ssaoHelper.ready&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?h["a"].Schematic:h["a"].Normal:h["a"].Disabled,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<f["b"],this.techniqueConfig.snowCover=this.hasSnowCover(t)),this.techniqueConfig}hasSnowCover(e){return Object(r["k"])(e.weather)&&e.weatherVisible&&"snowy"===e.weather.type&&"enabled"===e.weather.snowCover}intersect(e,t,i,n,o,c,l){if(Object(r["k"])(this.parameters.verticalOffset)){const e=n.camera;Object(a["w"])(k,i[12],i[13],i[14]);let t=null;switch(n.viewingMode){case s["a"].Global:t=Object(a["r"])(U,k);break;case s["a"].Local:t=Object(a["g"])(U,V)}let r=0;const l=Object(a["f"])(H,k,e.eye),d=Object(a["p"])(l),h=Object(a["k"])(l,l,1/d);let u=null;this.parameters.screenSizePerspective&&(u=Object(a["i"])(t,h)),r+=Object(_["h"])(e,d,this.parameters.verticalOffset,u,this.parameters.screenSizePerspective),Object(a["k"])(t,t,r),Object(a["x"])(B,t,n.transform.inverseRotation),o=Object(a["f"])(z,o,B),c=Object(a["f"])(G,c,B)}Object(_["e"])(e,t,n,o,c,Object(v["c"])(n.verticalOffset),l)}requiresSlot(e){return e===(this.parameters.transparent?this.parameters.writeDepth?g["a"].TRANSPARENT_MATERIAL:g["a"].TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:g["a"].OPAQUE_MATERIAL)||e===g["a"].DRAPED_MATERIAL}createGLMaterial(e){return e.output===c["a"].Color||e.output===c["a"].Alpha||e.output===c["a"].Depth||e.output===c["a"].Normal||e.output===c["a"].Shadow||e.output===c["a"].Highlight?new I(e):null}createBufferWriter(){return new L(this.vertexBufferLayout,this.instanceBufferLayout)}}class I extends p["a"]{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){const t=this._material.parameters;this.updateTexture(t.textureId);const i=e.camera.viewInverseTransposeMatrix;return Object(a["w"])(t.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(t.treeRendering?R:j["c"],e)}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==c["a"].Color&&this._output!==c["a"].Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this._updateParameters(e)}}class M extends j["b"]{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const D=new M;class L{constructor(e,t){this.vertexBufferLayout=e,this.instanceBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(O["a"].POSITION).length}write(e,t,i,r){Object(y["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r)}}function N(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,i=Object(o["a"])().vec3f(O["a"].POSITION).vec3f(O["a"].NORMAL);return e.hasVertexTangents&&i.vec4f(O["a"].TANGENT),t&&i.vec2f(O["a"].UV0),e.hasVertexColors&&i.vec4u8(O["a"].COLOR),e.hasSymbolColors&&i.vec4u8(O["a"].SYMBOLCOLOR),i}function F(e){let t=Object(o["a"])();return t=e.instancedDoublePrecision?t.vec3f(O["a"].MODELORIGINHI).vec3f(O["a"].MODELORIGINLO).mat3f(O["a"].MODEL).mat3f(O["a"].MODELNORMAL):t.mat4f(O["a"].MODEL).mat4f(O["a"].MODELNORMAL),Object(r["k"])(e.instanced)&&e.instanced.includes("color")&&(t=t.vec4f(O["a"].INSTANCECOLOR)),Object(r["k"])(e.instanced)&&e.instanced.includes("featureAttribute")&&(t=t.vec4f(O["a"].INSTANCEFEATUREATTRIBUTE)),t}const z=Object(n["f"])(),G=Object(n["f"])(),V=Object(n["h"])(0,0,1),U=Object(n["f"])(),B=Object(n["f"])(),k=Object(n["f"])(),H=Object(n["f"])()},dee7:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r,a=i("a4ee"),n=i("9ef0"),s=i("6a0e"),o=i("b2b2"),c=i("59b2"),l=(i("b50f"),i("c120"),i("cea0"),i("d386")),d=i("88da");let h=r=class extends s["a"]{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=Object(o["k"])(e)?e.get(this):null;if(i)return i;const a=new r(this.clonePropertiesWithDeduplication(t));return Object(o["k"])(e)&&e.set(this,a),a}clonePropertiesWithDeduplication(e){return{color:Object(o["k"])(this.color)?this.color.clone():null,colorTexture:Object(o["k"])(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:Object(o["k"])(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};Object(a["a"])([Object(c["b"])({type:n["a"],json:{write:!0}})],h.prototype,"color",void 0),Object(a["a"])([Object(c["b"])({type:d["a"],json:{write:!0}})],h.prototype,"colorTexture",void 0),Object(a["a"])([Object(c["b"])({type:d["a"],json:{write:!0}})],h.prototype,"normalTexture",void 0),Object(a["a"])([Object(c["b"])({nonNullable:!0,json:{write:!0}})],h.prototype,"alphaMode",void 0),Object(a["a"])([Object(c["b"])({nonNullable:!0,json:{write:!0}})],h.prototype,"alphaCutoff",void 0),Object(a["a"])([Object(c["b"])({nonNullable:!0,json:{write:!0}})],h.prototype,"doubleSided",void 0),h=r=Object(a["a"])([Object(l["a"])("esri.geometry.support.MeshMaterial")],h);const u=h},df77:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return d}));var r=i("afe1"),a=i("d047"),n=i("d8a4"),s=i("1fe9"),o=i("3886"),c=i("85b3"),l=i("6a3c");function d(e,t){const i=e.fragment.uniforms;i.add(new n["a"]("nearFar",(e,t)=>t.camera.nearFar)),i.add(new l["a"]("depthMap",(e,t)=>t.linearDepthTexture)),i.add(new c["a"]("view",(e,t)=>t.ssr.camera.viewMatrix)),i.add(new c["a"]("proj",(e,t)=>t.ssr.camera.projectionMatrix)),i.add(new s["a"]("invResolutionHeight",(e,t)=>1/t.ssr.camera.height)),i.add(new l["a"]("lastFrameColorMap",(e,t)=>t.ssr.lastFrameColorTexture)),i.add(new c["a"]("reprojectionMatrix",(e,t)=>t.ssr.reprojectionMatrix)),e.fragment.include(a["a"]),e.fragment.code.add(o["b"]`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class h{constructor(){this.reprojectionMatrix=Object(r["d"])()}}},dfaf:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return r}));var r,a=i("6c97"),n=i("3886"),s=i("b7bd");function o(e,t){switch(t.textureCoordinateType){case r.Default:return e.attributes.add(s["a"].UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(n["b"]`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case r.Atlas:return e.attributes.add(s["a"].UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(s["a"].UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(n["b"]`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);case r.None:return void e.vertex.code.add(n["b"]`void forwardTextureCoordinates() {}`);default:Object(a["a"])(t.textureCoordinateType);case r.COUNT:return}}!function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.COUNT=3]="COUNT"}(r||(r={}))},e1cb:function(e,t,i){"use strict";i.d(t,"a",(function(){return S})),i.d(t,"b",(function(){return x})),i.d(t,"c",(function(){return T}));var r=i("dae5"),a=i("0b2d"),n=i("0fc4"),s=i("3c9c"),o=i("a05b"),c=i("dfaf"),l=i("7d11"),d=i("3976"),h=i("6a21"),u=i("c3a4"),p=i("ca98"),b=i("b7c2"),f=i("fa1e"),m=i("35b3"),g=i("7438"),O=i("c829"),v=i("87b7"),y=i("0310"),_=i("d17d"),j=i("189c");class x extends l["c"]{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Object(a["h"])(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=b["b"].Back,this.emissiveFactor=Object(a["h"])(0,0,0),this.instancedDoublePrecision=!1,this.normals="default",this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Object(a["h"])(.2,.2,.2),this.diffuse=Object(a["h"])(.8,.8,.8),this.externalColor=Object(n["g"])(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=Object(a["f"])(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Object(r["b"])(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=b["c"].Less,this.textureAlphaMode=b["a"].Blend,this.textureAlphaCutoff=d["a"],this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=m["c"].Occlude}}class S extends l["b"]{constructor(){super(...arguments),this.origin=Object(a["f"])(),this.slicePlaneLocalOrigin=this.origin}}class T extends p["a"]{initializeConfiguration(e,t){t.spherical=e.viewingMode===s["a"].Global,t.doublePrecisionRequiresObfuscation=Object(h["b"])(e.rctx),t.textureCoordinateType=t.hasColorTexture||t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture||t.hasNormalTexture?c["b"].Default:c["b"].None}initializeProgram(e){return this._initializeProgram(e,T.shader)}_initializeProgram(e,t){const i=t.get().build(this.configuration);return new O["a"](e.rctx,i,f["a"])}_convertDepthTestFunction(e){return e===b["c"].Lequal?_["h"].LEQUAL:_["h"].LESS}_setPipeline(e,t){const i=this.configuration,r=e===b["i"].NONE,a=e===b["i"].FrontFace;return Object(j["f"])({blending:i.output!==o["a"].Color&&i.output!==o["a"].Alpha||!i.transparent?null:r?g["d"]:Object(g["f"])(e),culling:w(i)&&Object(j["b"])(i.cullFace),depthTest:{func:Object(g["g"])(e,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:r||a?i.writeDepth&&j["d"]:null,colorWrite:j["c"],stencilWrite:i.hasOccludees?v["h"]:null,stencilTest:i.hasOccludees?t?v["d"]:v["c"]:null,polygonOffset:r||a?null:Object(g["e"])(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0),this._setPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}function w(e){return e.cullFace!==b["b"].None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}T.shader=new u["a"](y["a"],()=>i.e("chunk-2d0cb6c5").then(i.bind(null,"4a35")))},e2e8:function(e,t,i){"use strict";i.r(t),i.d(t,"getGeometryServiceURL",(function(){return v})),i.d(t,"projectGeometry",(function(){return y}));var r=i("1325"),a=i("ce50"),n=i("0224"),s=i("2eab"),o=i("cea0"),c=i("a9ab"),l=i("bb72");function d(e,t,i){const r=Object(c["b"])(t);return e.map(e=>{const t=r.fromJSON(e);return t.spatialReference=i,t})}var h=i("a4ee"),u=i("6a0e"),p=i("59b2"),b=(i("b50f"),i("c120"),i("d386"));let f=class extends u["a"]{constructor(e){super(e),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(e=>e.toJSON()),t=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:Object(c["c"])(t),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(i.transformForward=this.transformForward),i}};Object(h["a"])([Object(p["b"])()],f.prototype,"geometries",void 0),Object(h["a"])([Object(p["b"])({json:{read:{source:"outSR"}}})],f.prototype,"outSpatialReference",void 0),Object(h["a"])([Object(p["b"])()],f.prototype,"transformation",void 0),Object(h["a"])([Object(p["b"])()],f.prototype,"transformForward",void 0),f=Object(h["a"])([Object(b["a"])("esri.rest.support.ProjectParameters")],f);const m=f,g=Object(o["m"])(m);async function O(e,t,i){t=g(t);const r=Object(l["c"])(e),a={...r.query,f:"json",...t.toJSON()},n=t.outSpatialReference,o=Object(c["c"])(t.geometries[0]),h=Object(l["a"])(a,i);return Object(s["default"])(r.path+"/project",h).then(({data:{geometries:e}})=>d(e,o,n))}async function v(e=null,t){var i,s;if(r["a"].geometryServiceUrl)return r["a"].geometryServiceUrl;if(!e)throw new a["a"]("internal:geometry-service-url-not-configured");let o;o="portal"in e?e.portal||n["a"].getDefault():e,await o.load({signal:t});const c=null==(i=o.helperServices)||null==(s=i.geometry)?void 0:s.url;if(!c)throw new a["a"]("internal:geometry-service-url-not-configured");return c}async function y(e,t,i=null,r){const n=await v(i,r),s=new m;s.geometries=[e],s.outSpatialReference=t;const o=await O(n,s,{signal:r});if(o&&Array.isArray(o)&&1===o.length)return o[0];throw new a["a"]("internal:geometry-service-projection-failed")}},e550:function(e,t,i){"use strict";i.d(t,"a",(function(){return S}));var r=i("d981"),a=i("3886");function n(e){e.fragment.code.add(a["b"]`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var s=i("5d5f"),o=i("df77"),c=i("38a4"),l=i("b2b2"),d=i("3349"),h=i("02f1"),u=i("2255"),p=i("7bf3"),b=i("2ca8"),f=i("d8a4"),m=i("ea32"),g=i("1fe9"),O=i("85b3"),v=i("62ae"),y=i("52b2");class _ extends v["a"]{constructor(e,t){super(e,"samplerCube",y["a"].Pass,(i,r,a)=>i.bindTexture(e,t(r,a)))}}function j(e){const t=e.fragment;t.uniforms.add([new O["a"]("rotationMatrixClouds",(e,t)=>t.clouds.parallax.transform),new O["a"]("rotationMatrixCloudsCrossFade",(e,t)=>t.clouds.parallaxNew.transform),new m["a"]("anchorPosition",(e,t)=>t.clouds.parallax.anchorPointClouds),new m["a"]("anchorPositionCrossFade",(e,t)=>t.clouds.parallaxNew.anchorPointClouds),new f["a"]("cloudVariables",(e,t)=>Object(l["k"])(t.clouds.data)?Object(d["a"])(x,t.clouds.data.coverage,t.clouds.data.absorption):h["b"]),new g["a"]("cloudsHeight",(e,t)=>t.clouds.parallax.cloudsHeight),new g["a"]("radiusCurvatureCorrectionFactor",(e,t)=>t.clouds.parallax.radiusCurvatureCorrectionFactor),new g["a"]("totalFadeInOut",(e,t)=>t.clouds.fadeInOut.stage===p["b"].FINISHED?t.clouds.fadeInOutHeight.factor+Math.max(Object(c["e"])(t.clouds.fadeIn.factor,0,1)):t.clouds.fadeInOutHeight.factor+Math.max(Object(c["e"])(t.clouds.fadeInOut.factor,0,1))),new g["a"]("crossFadeAnchorFactor",(e,t)=>Object(c["e"])(t.clouds.crossFade.factor,0,1)),new _("cubeMap",(e,t)=>Object(l["k"])(t.clouds.data)?t.clouds.data.cubeMap.colorTexture:null),new b["a"]("crossFade",(e,t)=>t.clouds.crossFade.enabled)]),t.constants.add("planetRadius","float",u["a"].radius),t.code.add(a["b"]`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(a["b"]`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(a["b"]`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),t.uniforms.add([new m["a"]("lightingMainDirection",(e,t)=>t.lighting.lightingMainDirection),new m["a"]("lightingMainIntensity",(e,t)=>t.lighting.mainLight.intensity)]),t.code.add(a["b"]`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(a["b"]`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),t.code.add(a["b"]`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(a["b"]`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(a["b"]`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}const x=Object(h["c"])();function S(e,t){e.include(s["a"],t),e.include(n),e.include(r["a"]),t.hasCloudsReflections&&e.include(j,t),t.hasScreenSpaceReflections&&e.include(o["b"],t);const i=e.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(a["b"]`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add([new g["a"]("lightingSpecularStrength",(e,t)=>t.lighting.mainLight.specularStrength),new g["a"]("lightingEnvironmentStrength",(e,t)=>t.lighting.mainLight.environmentStrength)]),i.code.add(a["b"]`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&i.code.add(a["b"]`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?i.code.add(a["b"]`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):i.code.add(a["b"]`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?i.code.add(a["b"]`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(a["b"]`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(a["b"]`return waterRenderedColor;
}`)}},e6aa:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var r=i("ea32"),a=i("76a8"),n=i("1fe9"),s=i("955a"),o=i("3886"),c=i("b7bd"),l=i("02a0");const d=8;function h(e,t){const i=e.vertex;i.uniforms.add(new n["a"]("intrinsicWidth",e=>e.width)),t.vvSize?(e.attributes.add(c["a"].SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new r["a"]("vvSizeMinSize",e=>e.vvSizeMinSize)),i.uniforms.add(new r["a"]("vvSizeMaxSize",e=>e.vvSizeMaxSize)),i.uniforms.add(new r["a"]("vvSizeOffset",e=>e.vvSizeOffset)),i.uniforms.add(new r["a"]("vvSizeFactor",e=>e.vvSizeFactor)),i.code.add(o["b"]`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(c["a"].SIZE,"float"),i.code.add(o["b"]`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(c["a"].OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add([new s["a"]("vvOpacityValues",e=>e.vvOpacityValues,d),new s["a"]("vvOpacityOpacities",e=>e.vvOpacityOpacities,d)]),i.code.add(o["b"]`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(o["b"]`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(c["a"].COLORFEATUREATTRIBUTE,"float"),i.constants.add("vvColorNumber","int",l["b"]),i.uniforms.add(new s["a"]("vvColorValues",e=>e.vvColorValues,l["b"])),i.uniforms.add(new a["a"]("vvColorColors",e=>e.vvColorColors,l["b"])),i.code.add(o["b"]`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(c["a"].COLOR,"vec4"),i.code.add(o["b"]`vec4 getColor(){
return applyOpacity(color);
}`))}},e93d:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return l}));var r=i("b2b2"),a=i("f4cc"),n=i("3886"),s=i("b7c2"),o=i("d7f7");class c extends o["a"]{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,e=>this._texture=e),this._acquire(e.normalTextureId,e=>this._textureNormal=e),this._acquire(e.emissiveTextureId,e=>this._textureEmissive=e),this._acquire(e.occlusionTextureId,e=>this._textureOcclusion=e),this._acquire(e.metallicRoughnessTextureId,e=>this._textureMetallicRoughness=e)}dispose(){this._texture=Object(r["p"])(this._texture),this._textureNormal=Object(r["p"])(this._textureNormal),this._textureEmissive=Object(r["p"])(this._textureEmissive),this._textureOcclusion=Object(r["p"])(this._textureOcclusion),this._textureMetallicRoughness=Object(r["p"])(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return 0===this._numLoading?s["g"].LOADED:s["g"].LOADING}get textureBindParameters(){return new l(Object(r["k"])(this._texture)?this._texture.glTexture:null,Object(r["k"])(this._textureNormal)?this._textureNormal.glTexture:null,Object(r["k"])(this._textureEmissive)?this._textureEmissive.glTexture:null,Object(r["k"])(this._textureOcclusion)?this._textureOcclusion.glTexture:null,Object(r["k"])(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){(Object(r["j"])(this._texture)||e!==this._texture.id)&&(this._texture=Object(r["p"])(this._texture),this._textureId=e,this._acquire(this._textureId,e=>this._texture=e))}_acquire(e,t){if(Object(r["j"])(e))return void t(null);const i=this._textureRepository.acquire(e);if(Object(a["l"])(i))return++this._numLoading,void i.then(e=>{if(this._disposed)return Object(r["p"])(e),void t(null);t(e)}).finally(()=>--this._numLoading);t(i)}}class l extends n["a"]{constructor(e=null,t=null,i=null,r=null,a=null){super(),this.texture=e,this.textureNormal=t,this.textureEmissive=i,this.textureOcclusion=r,this.textureMetallicRoughness=a}}},e9d6:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return u})),i.d(t,"f",(function(){return d})),i.d(t,"g",(function(){return p}));var r=i("e92d"),a=i("d3cf"),n=i("82fa");const s=r["a"].getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function o(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}async function c(e,t,i){const r=e&&e.expression;if("string"!=typeof r)return null;const a=f(r);if(null!=a)return{cachedResult:a};const s=await Object(n["e"])(),o=s.arcadeUtils,c=o.createSyntaxTree(r);return o.dependsOnView(c)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(c),context:o.createExecContext(null,{sr:t}),modules:s}}}function l(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function d(e,t){if(null!=e&&!b(e)){if(!t||!e.arcade)return void s.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=Object(a["b"])(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function h(e){if(null!=e){if(b(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0}function u(e,t=!1){let i=e&&e.featureExpressionInfo;const r=i&&i.expression;return t||"0"===r||(i=null),i}const p={cachedResult:0};function b(e){return null!=e.cachedResult}function f(e){return"0"===e?0:null}},ea32:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae"),a=i("52b2");class n extends r["a"]{constructor(e,t){super(e,"vec3",a["a"].Pass,(i,r,a)=>i.setUniform3fv(e,t(r,a)))}}},ea44:function(e,t,i){"use strict";i.d(t,"a",(function(){return P})),i.d(t,"b",(function(){return A}));var r=i("bd75"),a=i("a05b"),n=i("d272"),s=i("4db9"),o=i("6a07"),c=i("2906"),l=i("c76b"),d=i("c6d7"),h=i("040b"),u=i("a7d7"),p=i("d017"),b=i("e550"),f=i("33e2"),m=i("3976"),g=i("4377"),O=i("8e97"),v=i("ea32"),y=i("fd48"),_=i("db7b"),j=i("1fe9"),x=i("3886"),S=i("3853"),T=i("690a"),w=i("b7c2"),C=i("b7bd");function A(e){const t=new T["a"],{vertex:i,fragment:A}=t,P=Object(O["b"])(t,e);return t.include(s["a"]),t.attributes.add(C["a"].POSITION,"vec3"),t.attributes.add(C["a"].UV0,"vec2"),i.uniforms.add(new y["a"]("waterColor",e=>e.color)),e.output!==a["a"].Color&&e.output!==a["a"].Alpha||(t.include(h["a"],e),t.include(r["a"],e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),A.uniforms.add(P),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.code.add(x["b"]`
      void main(void) {
        if (waterColor.a < ${x["b"].float(m["b"])}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===a["a"].Color?"forwardLinearDepth();":""}
      }
    `)),t.include(d["b"],e),e.output===a["a"].Alpha&&(t.include(n["a"],e),A.uniforms.add(new _["a"]("waterColor")),A.code.add(x["b"]`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),e.output===a["a"].Color&&(t.include(l["a"],{isGround:!1}),t.include(c["a"],{pbrMode:u["a"].Disabled,lightingSphericalHarmonicsOrder:2}),t.include(f["a"]),t.include(n["a"],e),t.include(p["a"],e),t.include(b["a"],e),A.uniforms.add([new _["a"]("waterColor"),new v["a"]("lightingMainDirection",(e,t)=>t.lighting.lightingMainDirection),new v["a"]("lightingMainIntensity",(e,t)=>t.lighting.mainLight.intensity),new j["a"]("timeElapsed",e=>e.timeElapsed),new S["a"]("view")]),Object(O["a"])(A,e),A.include(g["a"]),A.code.add(x["b"]`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?x["b"]`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===w["i"].Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output===a["a"].Normal&&(t.include(h["a"],e),t.include(f["a"],e),t.include(n["a"],e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i.code.add(x["b"]`
        void main(void) {
          if (waterColor.a < ${x["b"].float(m["b"])}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),A.uniforms.add(new j["a"]("timeElapsed",e=>e.timeElapsed)),A.code.add(x["b"]`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),e.output===a["a"].Draped&&(t.varyings.add("vpos","vec3"),i.code.add(x["b"]`
        void main(void) {
          if (waterColor.a < ${x["b"].float(m["b"])}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),A.uniforms.add(new _["a"]("waterColor")),A.code.add(x["b"]`void main() {
gl_FragColor = waterColor;
}`)),e.output===a["a"].Highlight&&(t.include(o["a"]),t.varyings.add("vpos","vec3"),i.code.add(x["b"]`
      void main(void) {
        if (waterColor.a < ${x["b"].float(m["b"])}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(n["a"],e),A.code.add(x["b"]`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const P=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}))},ea4b:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var r=i("2906"),a=i("7088"),n=i("c76b"),s=i("5d5f"),o=i("a7d7"),c=i("c51b"),l=i("2ca8"),d=i("ea32"),h=i("1fe9"),u=i("3886"),p=i("2245");function b(e,t){const i=e.fragment;e.include(a["a"],t),t.pbrMode!==o["a"].Disabled&&e.include(s["a"],t),e.include(r["a"],t),i.constants.add("ambientBoostFactor","float",p["b"]),e.include(c["a"]),i.code.add(u["b"]`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===o["a"].Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),i.uniforms.add(new d["a"]("lightingMainDirection",(e,t)=>t.lighting.lightingMainDirection)),i.code.add(u["b"]`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?u["b"]`normalize(vPosWorld)`:u["b"]`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),i.uniforms.add([new h["a"]("lightingGlobalFactor",(e,t)=>t.lighting.globalFactor),new d["a"]("lightingMainIntensity",(e,t)=>t.lighting.mainLight.intensity)]),i.code.add(u["b"]`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`),t.pbrMode===o["a"].Disabled||t.pbrMode===o["a"].WaterOnIntegratedMesh?(e.include(n["a"],t),i.code.add(u["b"]`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`)):t.pbrMode!==o["a"].Normal&&t.pbrMode!==o["a"].Schematic||(i.code.add(u["b"]`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(u["b"]`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?i.uniforms.add(new l["a"]("hasFillLights",(e,t)=>t.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(u["b"]`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add([new h["a"]("lightingSpecularStrength",(e,t)=>t.lighting.mainLight.specularStrength),new h["a"]("lightingEnvironmentStrength",(e,t)=>t.lighting.mainLight.environmentStrength)]),i.code.add(u["b"]`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(u["b"]`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode===o["a"].Schematic?u["b"]`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:u["b"]`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `))}},ebd5:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i("3976"),a=i("3886");function n(e){e.fragment.code.add(a["b"]`
    #define discardOrAdjustAlpha(color) { if (color.a < ${a["b"].float(r["b"])}) { discard; } }
  `)}var s=i("62ae");i("52b2");s["a"];var o=i("1fe9"),c=i("b7c2");function l(e,t){d(e,t,new o["a"]("textureAlphaCutoff",e=>e.textureAlphaCutoff))}function d(e,t,i){const r=e.fragment;switch(t.alphaDiscardMode!==c["a"].Mask&&t.alphaDiscardMode!==c["a"].MaskBlend||r.uniforms.add(i),t.alphaDiscardMode){case c["a"].Blend:return e.include(n);case c["a"].Opaque:r.code.add(a["b"]`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case c["a"].Mask:r.code.add(a["b"]`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case c["a"].MaskBlend:e.fragment.code.add(a["b"]`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}},ed70:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return s}));var r=i("0fc4");const a=1.2,n=r["b"],s=r["a"]},f0ba:function(e,t,i){"use strict";i.d(t,"a",(function(){return g}));var r,a=i("a4ee"),n=i("6a0e"),s=i("7ffa"),o=i("e92d"),c=i("59b2"),l=i("1a3e"),d=i("d386"),h=i("cea0"),u=i("dee7"),p=i("83fa"),b=i("f5e7");const f=o["a"].getLogger("esri.geometry.support.MeshComponent");let m=r=class extends n["a"]{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return Object(h["d"])(r,e)}castFaces(e){return Object(b["b"])(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},f)}castMaterial(e){return Object(h["d"])(e&&"object"==typeof e&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?p["a"]:u["a"],e)}clone(){return new r({faces:Object(s["a"])(this.faces),shading:this.shading,material:Object(s["a"])(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const i={faces:Object(s["a"])(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new r(i)}};Object(a["a"])([Object(c["b"])({json:{write:!0}})],m.prototype,"faces",void 0),Object(a["a"])([Object(l["a"])("faces")],m.prototype,"castFaces",null),Object(a["a"])([Object(c["b"])({type:u["a"],json:{write:!0}})],m.prototype,"material",void 0),Object(a["a"])([Object(l["a"])("material")],m.prototype,"castMaterial",null),Object(a["a"])([Object(c["b"])({type:String,json:{write:!0}})],m.prototype,"shading",void 0),Object(a["a"])([Object(c["b"])({type:Boolean})],m.prototype,"trustSourceNormals",void 0),m=r=Object(a["a"])([Object(d["a"])("esri.geometry.support.MeshComponent")],m);const g=m},f5e7:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return b}));var r,a=i("a4ee"),n=i("6a0e"),s=i("7ffa"),o=i("e92d"),c=i("59b2"),l=i("1a3e"),d=i("d386");const h=o["a"].getLogger("esri.geometry.support.MeshVertexAttributes");let u=r=class extends n["a"]{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return b(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},h)}castPosition(e){return e&&e instanceof Float32Array&&h.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),b(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},h)}castUv(e){return b(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},h)}castNormal(e){return b(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},h)}castTangent(e){return b(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},h)}clone(){const e={position:Object(s["a"])(this.position),uv:Object(s["a"])(this.uv),normal:Object(s["a"])(this.normal),tangent:Object(s["a"])(this.tangent),color:Object(s["a"])(this.color)};return new r(e)}clonePositional(){const e={position:Object(s["a"])(this.position),normal:Object(s["a"])(this.normal),tangent:Object(s["a"])(this.tangent),uv:this.uv,color:this.color};return new r(e)}};function p(e,t,i,r){const{loggerTag:a,stride:n}=t;return e.length%n!=0?(r.error(a,"Invalid array length, expected a multiple of "+n),new i([])):e}function b(e,t,i,r,a){if(!e)return e;if(e instanceof t)return p(e,r,t,a);for(const n of i)if(e instanceof n)return p(new t(e),r,t,a);if(Array.isArray(e))return p(new t(e),r,t,a);{const r=i.map(e=>`'${e.name}'`);return a.error(`Failed to set property, expected one of ${r}, but got ${e.constructor.name}`),new t([])}}function f(e,t,i){t[i]=m(e)}function m(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}Object(a["a"])([Object(c["b"])({json:{write:f}})],u.prototype,"color",void 0),Object(a["a"])([Object(l["a"])("color")],u.prototype,"castColor",null),Object(a["a"])([Object(c["b"])({nonNullable:!0,json:{write:f}})],u.prototype,"position",void 0),Object(a["a"])([Object(l["a"])("position")],u.prototype,"castPosition",null),Object(a["a"])([Object(c["b"])({json:{write:f}})],u.prototype,"uv",void 0),Object(a["a"])([Object(l["a"])("uv")],u.prototype,"castUv",null),Object(a["a"])([Object(c["b"])({json:{write:f}})],u.prototype,"normal",void 0),Object(a["a"])([Object(l["a"])("normal")],u.prototype,"castNormal",null),Object(a["a"])([Object(c["b"])({json:{write:f}})],u.prototype,"tangent",void 0),Object(a["a"])([Object(l["a"])("tangent")],u.prototype,"castTangent",null),u=r=Object(a["a"])([Object(d["a"])("esri.geometry.support.MeshVertexAttributes")],u)},f643:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("0b2d");class a{constructor(e,t){this.vec3=e,this.id=t}}function n(e,t,i,n){return new a(Object(r["h"])(e,t,i),n)}},f895:function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return g})),i.d(t,"c",(function(){return m})),i.d(t,"d",(function(){return j})),i.d(t,"e",(function(){return S})),i.d(t,"f",(function(){return x})),i.d(t,"g",(function(){return P})),i.d(t,"h",(function(){return V})),i.d(t,"i",(function(){return k})),i.d(t,"j",(function(){return v}));i("c120");var r=i("e92d"),a=i("38a4"),n=i("b2b2"),s=i("d791"),o=i("e431"),c=i("0b2d"),l=i("7577"),d=i("0fc4"),h=i("3a35"),u=i("d18f"),p=i("a1b1"),b=i("7361");const f=r["a"].getLogger("esri.geometry.support.sphere");function m(){return Object(d["e"])()}function g(e,t=m()){return Object(l["c"])(t,e)}function O(e,t){return Object(d["g"])(e[0],e[1],e[2],t)}function v(e){return e}function y(e){e[0]=e[1]=e[2]=e[3]=0}function _(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function j(e){return e[3]}function x(e){return e}function S(e,t,i,r){return Object(d["g"])(e,t,i,r)}function T(e,t,i){return e!==i&&Object(o["g"])(i,e),i[3]=e[3]+t,i}function w(e,t,i){return f.error("sphere.setExtent is not yet supported"),e===i?i:g(e,i)}function C(e,t,i){if(Object(n["j"])(t))return!1;const{origin:r,direction:a}=t,s=A;s[0]=r[0]-e[0],s[1]=r[1]-e[1],s[2]=r[2]-e[2];const o=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],c=2*(a[0]*s[0]+a[1]*s[1]+a[2]*s[2]),l=c*c-4*o*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-e[3]*e[3]);if(l<0)return!1;const d=Math.sqrt(l);let h=(-c-d)/(2*o);const u=(-c+d)/(2*o);return(h<0||u<h&&u>0)&&(h=u),!(h<0)&&(i&&(i[0]=r[0]+a[0]*h,i[1]=r[1]+a[1]*h,i[2]=r[2]+a[2]*h),!0)}const A=Object(c["f"])();function P(e,t){return C(e,t,null)}function R(e,t,i){if(C(e,t,i))return i;const r=E(e,t,b["d"].get());return Object(o["e"])(i,t.origin,Object(o["k"])(b["d"].get(),t.direction,Object(o["m"])(t.origin,r)/Object(o["p"])(t.direction))),i}function E(e,t,i){const r=b["d"].get(),a=b["a"].get();Object(o["j"])(r,t.origin,t.direction);const n=j(e);Object(o["j"])(i,r,t.origin),Object(o["k"])(i,i,1/Object(o["p"])(i)*n);const c=L(e,t.origin),l=Object(p["a"])(t.origin,i);return Object(s["d"])(a,l+c,r),Object(o["q"])(i,i,a),i}function I(e,t,i){return C(e,t,i)?i:(Object(u["a"])(t,x(e),i),M(e,i,i))}function M(e,t,i){const r=Object(o["f"])(b["d"].get(),t,x(e)),a=Object(o["k"])(b["d"].get(),r,e[3]/Object(o["p"])(r));return Object(o["e"])(i,a,x(e))}function D(e,t){const i=Object(o["f"])(b["d"].get(),t,x(e)),r=Object(o["t"])(i),a=e[3]*e[3];return Math.sqrt(Math.abs(r-a))}function L(e,t){const i=Object(o["f"])(b["d"].get(),t,x(e)),r=Object(o["p"])(i),n=j(e),s=n+Math.abs(n-r);return Object(a["b"])(n/s)}const N=Object(c["f"])();function F(e,t,i,r){const n=Object(o["f"])(N,t,x(e));switch(i){case h["a"].X:{const e=Object(a["d"])(n,N)[2];return Object(o["w"])(r,-Math.sin(e),Math.cos(e),0)}case h["a"].Y:{const e=Object(a["d"])(n,N),t=e[1],i=e[2],s=Math.sin(t);return Object(o["w"])(r,-s*Math.cos(i),-s*Math.sin(i),Math.cos(t))}case h["a"].Z:return Object(o["r"])(r,n);default:return}}function z(e,t){const i=Object(o["f"])(U,t,x(e));return Object(o["p"])(i)-e[3]}function G(e,t,i,r){const a=z(e,t),n=F(e,t,h["a"].Z,U),s=Object(o["k"])(U,n,i-a);return Object(o["e"])(r,t,s)}function V(e,t){const i=Object(o["h"])(x(e),t),r=j(e);return i<=r*r}const U=Object(c["f"])(),B=m(),k=Object.freeze(Object.defineProperty({__proto__:null,create:m,copy:g,fromCenterAndRadius:O,wrap:v,clear:y,fromRadius:_,getRadius:j,getCenter:x,fromValues:S,elevate:T,setExtent:w,intersectRay:C,intersectsRay:P,intersectRayClosestSilhouette:R,closestPointOnSilhouette:E,closestPoint:I,projectPoint:M,distanceToSilhouette:D,angleToSilhouette:L,axisAt:F,altitudeAt:z,setAltitudeAt:G,containsPoint:V,tmpSphere:B},Symbol.toStringTag,{value:"Module"}))},f9d0:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(e,t){var i;return null==(i=this._outer.get(e))?void 0:i.get(t)}set(e,t,i){const r=this._outer.get(e);r?r.set(t,i):this._outer.set(e,new Map([[t,i]]))}delete(e,t){const i=this._outer.get(e);i&&(i.delete(t),0===i.size&&this._outer.delete(e))}forEach(e){this._outer.forEach((t,i)=>e(t,i))}}},fa1e:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("b7bd");const a=new Map([[r["a"].POSITION,0],[r["a"].NORMAL,1],[r["a"].UV0,2],[r["a"].COLOR,3],[r["a"].SIZE,4],[r["a"].TANGENT,4],[r["a"].AUXPOS1,5],[r["a"].SYMBOLCOLOR,5],[r["a"].AUXPOS2,6],[r["a"].FEATUREATTRIBUTE,6],[r["a"].INSTANCEFEATUREATTRIBUTE,6],[r["a"].INSTANCECOLOR,7],[r["a"].MODEL,8],[r["a"].MODELNORMAL,12],[r["a"].MODELORIGINHI,11],[r["a"].MODELORIGINLO,15]])},fd48:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae"),a=i("52b2");class n extends r["a"]{constructor(e,t){super(e,"vec4",a["a"].Pass,(i,r,a)=>i.setUniform4fv(e,t(r,a)))}}}}]);
//# sourceMappingURL=chunk-6c8783d0.ea62759a.js.map