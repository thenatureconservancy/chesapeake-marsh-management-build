(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-01ef3c89","chunk-21ca0ed8","chunk-57398abb","chunk-1900908c","chunk-2d0d6f6b"],{"003f":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("f2e0");class n{constructor(){this.id=Object(r["a"])()}unload(){}}},"0278":function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var r=i("b2b2"),n=i("b7c2"),a=i("8a44"),s=i("e431"),o=i("0b2d"),c=i("1153");class l{constructor(e,t,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.indices=i,this.position=r,this.center=Object(o["f"])(),Object(c["a"])(e.length>=1),Object(c["a"])(i.length%this._numIndexPerPrimitive==0),Object(c["a"])(i.length>=e.length*this._numIndexPerPrimitive),Object(c["a"])(3===r.size||4===r.size);const{data:n,size:a}=r,l=e.length;let d=a*i[this._numIndexPerPrimitive*e[0]];h.clear(),h.push(d),this.bbMin=Object(o["h"])(n[d],n[d+1],n[d+2]),this.bbMax=Object(o["d"])(this.bbMin);for(let s=0;s<l;++s){const t=this._numIndexPerPrimitive*e[s];for(let e=0;e<this._numIndexPerPrimitive;++e){d=a*i[t+e],h.push(d);let r=n[d];this.bbMin[0]=Math.min(r,this.bbMin[0]),this.bbMax[0]=Math.max(r,this.bbMax[0]),r=n[d+1],this.bbMin[1]=Math.min(r,this.bbMin[1]),this.bbMax[1]=Math.max(r,this.bbMax[1]),r=n[d+2],this.bbMin[2]=Math.min(r,this.bbMin[2]),this.bbMax[2]=Math.max(r,this.bbMax[2])}}Object(s["l"])(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let u=this.radius*this.radius;for(let s=0;s<h.length;++s){d=h.getItemAt(s);const e=n[d]-this.center[0],t=n[d+1]-this.center[1],i=n[d+2]-this.center[2],r=e*e+t*t+i*i;if(r<=u)continue;const a=Math.sqrt(r),o=.5*(a-this.radius);this.radius=this.radius+o,u=this.radius*this.radius;const c=o/a;this.center[0]+=e*c,this.center[1]+=t*c,this.center[2]+=i*c}h.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(Object(s["h"])(this.bbMin,this.bbMax)>1){const e=Object(s["l"])(Object(o["f"])(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,i=new Uint8Array(t),r=new Array(8);for(let s=0;s<8;++s)r[s]=0;const{data:n,size:a}=this.position;for(let s=0;s<t;++s){let t=0;const o=this._numIndexPerPrimitive*this.primitiveIndices[s];let c=a*this.indices[o],l=n[c],h=n[c+1],d=n[c+2];for(let e=1;e<this._numIndexPerPrimitive;++e){c=a*this.indices[o+e];const t=n[c],i=n[c+1],r=n[c+2];t<l&&(l=t),i<h&&(h=i),r<d&&(d=r)}l<e[0]&&(t|=1),h<e[1]&&(t|=2),d<e[2]&&(t|=4),i[s]=t,++r[t]}let c=0;for(let s=0;s<8;++s)r[s]>0&&++c;if(c<2)return;const h=new Array(8);for(let s=0;s<8;++s)h[s]=r[s]>0?new Uint32Array(r[s]):void 0;for(let s=0;s<8;++s)r[s]=0;for(let s=0;s<t;++s){const e=i[s];h[e][r[e]++]=this.primitiveIndices[s]}this._children=new Array(8);for(let s=0;s<8;++s)void 0!==h[s]&&(this._children[s]=new l(h[s],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){h.prune()}}const h=new a["a"]({deallocator:null});var d=i("003f"),u=i("2765"),p=i("1038"),b=i("b7bd");class f extends d["a"]{constructor(e,t=[],i=n["f"].Triangle,r=-1){super(),this._primitiveType=i,this.edgeIndicesLength=r,this.type=u["a"].Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[n,a]of e)a&&this._vertexAttributes.set(n,{...a});if(null==t||0===t.length){const e=g(this._vertexAttributes),t=Object(p["d"])(e);this.edgeIndicesLength=this.edgeIndicesLength<0?e:this.edgeIndicesLength;for(const i of this._vertexAttributes.keys())this._indices.set(i,t)}else for(const[n,a]of t)a&&(this._indices.set(n,O(a)),n===b["a"].POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(n).length:this.edgeIndicesLength))}cloneShallow(){const e=new f([],void 0,this._primitiveType,void 0),{_vertexAttributes:t,_indices:i}=e;return this._vertexAttributes.forEach((e,i)=>{t.set(i,e)}),this._indices.forEach((e,t)=>{i.set(t,e)}),e.screenToWorldRatio=this.screenToWorldRatio,e._boundingInfo=this._boundingInfo,e}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){const t=this._vertexAttributes.get(e);return t&&!t.exclusive&&(t.data=Array.from(t.data),t.exclusive=!0),t}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return Object(r["j"])(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return this.primitiveType===n["f"].Triangle?this._computeAttachmentOriginTriangles(e):this._computeAttachmentOriginPoints(e)}_computeAttachmentOriginTriangles(e){const t=this.indices.get(b["a"].POSITION),i=this.vertexAttributes.get(b["a"].POSITION);return Object(p["c"])(i,t,e)}_computeAttachmentOriginPoints(e){const t=this.indices.get(b["a"].POSITION),i=this.vertexAttributes.get(b["a"].POSITION);return Object(p["b"])(i,t,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(b["a"].POSITION);if(0===e.length)return null;const t=this.primitiveType===n["f"].Triangle?3:1;Object(c["a"])(e.length%t==0,"Indexing error: "+e.length+" not divisible by "+t);const i=Object(p["d"])(e.length/t),r=this.vertexAttributes.get(b["a"].POSITION);return new l(i,t,e,r)}}function g(e){const t=e.values().next().value;return null==t?0:t.data.length/t.size}function O(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}},"02a0":function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o}));var r=i("dae5"),n=i("0b2d"),a=i("35b3");class s extends a["b"]{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=Object(n["h"])(1,1,1),this.vvSizeMaxSize=Object(n["h"])(100,100,100),this.vvSizeOffset=Object(n["h"])(0,0,0),this.vvSizeFactor=Object(n["h"])(1,1,1),this.vvSizeValue=Object(n["h"])(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Object(r["b"])()}}const o=8},"037a":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("62ae"),n=i("52b2");class a extends r["a"]{constructor(e,t){super(e,"mat3",n["a"].Draw,(i,r,n)=>i.setUniformMatrix3fv(e,t(r,n)))}}},"040b":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e,t){t.spherical?e.vertex.code.add(r["b"]`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(r["b"]`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(r["b"]`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(r["b"]`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},"04f0":function(e,t,i){"use strict";i.d(t,"a",(function(){return _})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return v})),i.d(t,"d",(function(){return N})),i.d(t,"e",(function(){return y})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return V})),i.d(t,"h",(function(){return h}));var r=i("dae5"),n=i("b139"),a=i("0b2d"),s=i("4212"),o=i("e431"),c=i("7577");function l(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function h(e,t,i){i*=.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function d(e,t){const i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>s["a"]?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i}function u(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=i[0],c=i[1],l=i[2],h=i[3];return e[0]=r*h+s*o+n*l-a*c,e[1]=n*h+s*c+a*o-r*l,e[2]=a*h+s*l+r*c-n*o,e[3]=s*h-r*o-n*c-a*l,e}function p(e,t,i){i*=.5;const r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(i),c=Math.cos(i);return e[0]=r*c+s*o,e[1]=n*c+a*o,e[2]=a*c-n*o,e[3]=s*c-r*o,e}function b(e,t,i){i*=.5;const r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(i),c=Math.cos(i);return e[0]=r*c-a*o,e[1]=n*c+s*o,e[2]=a*c+r*o,e[3]=s*c-n*o,e}function f(e,t,i){i*=.5;const r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(i),c=Math.cos(i);return e[0]=r*c+n*o,e[1]=n*c-r*o,e[2]=a*c+s*o,e[3]=s*c-a*o,e}function g(e,t){const i=t[0],r=t[1],n=t[2];return e[0]=i,e[1]=r,e[2]=n,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e}function O(e,t,i,r){const n=t[0],a=t[1],o=t[2],c=t[3];let l,h,d,u,p,b=i[0],f=i[1],g=i[2],O=i[3];return h=n*b+a*f+o*g+c*O,h<0&&(h=-h,b=-b,f=-f,g=-g,O=-O),1-h>s["a"]?(l=Math.acos(h),d=Math.sin(l),u=Math.sin((1-r)*l)/d,p=Math.sin(r*l)/d):(u=1-r,p=r),e[0]=u*n+p*b,e[1]=u*a+p*f,e[2]=u*o+p*g,e[3]=u*c+p*O,e}function m(e){const t=Object(s["b"])(),i=Object(s["b"])(),r=Object(s["b"])(),n=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*i),e[1]=n*Math.cos(2*Math.PI*i),e[2]=a*Math.sin(2*Math.PI*r),e[3]=a*Math.cos(2*Math.PI*r),e}function v(e,t){const i=t[0],r=t[1],n=t[2],a=t[3],s=i*i+r*r+n*n+a*a,o=s?1/s:0;return e[0]=-i*o,e[1]=-r*o,e[2]=-n*o,e[3]=a*o,e}function _(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function j(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);const n=(i+1)%3,a=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*n+n]-t[3*a+a]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*n+a]-t[3*a+n])*r,e[n]=(t[3*n+i]+t[3*i+n])*r,e[a]=(t[3*a+i]+t[3*i+a])*r}return e}function y(e,t,i,r){const n=.5*Math.PI/180;t*=n,i*=n,r*=n;const a=Math.sin(t),s=Math.cos(t),o=Math.sin(i),c=Math.cos(i),l=Math.sin(r),h=Math.cos(r);return e[0]=a*c*h-s*o*l,e[1]=s*o*h+a*c*l,e[2]=s*c*l-a*o*h,e[3]=s*c*h+a*o*l,e}function x(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const S=c["c"],T=c["l"],w=c["a"],M=u,A=c["b"],E=c["d"],R=c["j"],P=c["e"],C=P,D=c["f"],I=D,L=c["k"],N=c["g"],z=c["h"];function V(e,t,i){const r=Object(o["i"])(t,i);return r<-.999999?(Object(o["j"])(F,G,t),Object(o["y"])(F)<1e-6&&Object(o["j"])(F,k,t),Object(o["r"])(F,F),h(e,F,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Object(o["j"])(F,t,i),e[0]=F[0],e[1]=F[1],e[2]=F[2],e[3]=1+r,L(e,e))}const F=Object(a["f"])(),G=Object(a["h"])(1,0,0),k=Object(a["h"])(0,1,0);function U(e,t,i,r,n,a){return O(H,t,n,a),O(B,i,r,a),O(e,H,B,2*a*(1-a)),e}const H=Object(n["b"])(),B=Object(n["b"])();function W(e,t,i,r){const n=q;return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],L(e,j(e,n))}const q=Object(r["b"])();Object.freeze(Object.defineProperty({__proto__:null,identity:l,setAxisAngle:h,getAxisAngle:d,multiply:u,rotateX:p,rotateY:b,rotateZ:f,calculateW:g,slerp:O,random:m,invert:v,conjugate:_,fromMat3:j,fromEuler:y,str:x,copy:S,set:T,add:w,mul:M,scale:A,dot:E,lerp:R,length:P,len:C,squaredLength:D,sqrLen:I,normalize:L,exactEquals:N,equals:z,rotationTo:V,sqlerp:U,setAxes:W},Symbol.toStringTag,{value:"Module"}))},"0bde":function(e,t,i){"use strict";i.d(t,"a",(function(){return F}));var r=i("b2b2"),n=i("ecd7"),a=i("8a44"),s=i("e431"),o=i("0b2d"),c=i("d359"),l=i("d18f"),h=i("f895"),d=i("1153");class u{constructor(e,t){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new p,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),p.clearPool(),T[0]=null,P.prune(),z.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const i=p.acquire();for(let r=0;r<t;r++){const t=e[r];this._isDegenerate(t)?this._degenerateObjects.add(t):(i.init(this._root),this._add(t,i))}p.release(i)}remove(e,t=null){this._objectCount-=e.length;const i=p.acquire();for(const n of e){const e=Object(r["k"])(t)?t:Object(h["b"])(this._objectToBoundingSphere(n),C);j(e[3])?(i.init(this._root),this._remove(n,e,i)):this._degenerateObjects.delete(n)}p.release(i),this._shrink()}update(e,t){if(!j(t[3])&&this._isDegenerate(e))return;const i=w(e);this.remove(i,t),this.add(i)}forEachAlongRay(e,t,i){const r=Object(l["g"])(e,t);this._forEachNode(this._root,e=>{if(!this._intersectsNode(r,e))return!1;const t=e.node;return t.terminals.forAll(e=>{this._intersectsObject(r,e)&&i(e)}),null!==t.residents&&t.residents.forAll(e=>{this._intersectsObject(r,e)&&i(e)}),!0})}forEachAlongRayWithVerticalOffset(e,t,i,r){const n=Object(l["g"])(e,t);this._forEachNode(this._root,e=>{if(!this._intersectsNodeWithOffset(n,e,r))return!1;const t=e.node;return t.terminals.forAll(e=>{this._intersectsObjectWithOffset(n,e,r)&&i(e)}),null!==t.residents&&t.residents.forAll(e=>{this._intersectsObjectWithOffset(n,e,r)&&i(e)}),!0})}forEach(e){this._forEachNode(this._root,t=>{const i=t.node;return i.terminals.forAll(e),null!==i.residents&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,i,r=(()=>!0),n=1/0){let a=1/0,o=1/0,l=null;const d=v(e,t),u=s=>{if(--n,!r(s))return;const d=this._objectToBoundingSphere(s);if(!Object(c["f"])(i,d))return;const u=_(e,t,Object(h["f"])(d)),p=u-d[3],b=u+d[3];p<a&&(a=p,o=b,l=s)};return this._forEachNodeDepthOrdered(this._root,r=>{if(n<=0||!Object(c["f"])(i,r.bounds))return!1;if(Object(s["k"])(A,d,r.halfSize),Object(s["e"])(A,A,r.bounds),_(e,t,A)>o)return!1;const a=r.node;return a.terminals.forAll(e=>u(e)),null!==a.residents&&a.residents.forAll(e=>u(e)),!0},e,t),l}forEachInDepthRange(e,t,i,r,n,a,o){let l=-1/0,d=1/0;const p={setRange:e=>{i===u.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,e.near),d=Math.min(d,e.far)):(l=Math.max(l,-e.far),d=Math.min(d,-e.near))}};p.setRange(r);const b=_(t,i,e),f=v(t,i),g=v(t,-i),O=e=>{if(!o(e))return;const r=this._objectToBoundingSphere(e),s=Object(h["f"])(r),u=_(t,i,s)-b,f=u-r[3],g=u+r[3];f>d||g<l||!Object(c["f"])(a,r)||n(e,p)};this._forEachNodeDepthOrdered(this._root,e=>{if(!Object(c["f"])(a,e.bounds))return!1;if(Object(s["k"])(A,f,e.halfSize),Object(s["e"])(A,A,e.bounds),_(t,i,A)-b>d)return!1;if(Object(s["k"])(A,g,e.halfSize),Object(s["e"])(A,A,e.bounds),_(t,i,A)-b<l)return!1;const r=e.node;return r.terminals.forAll(e=>O(e)),null!==r.residents&&r.residents.forAll(e=>O(e)),!0},t,i)}forEachNode(e){this._forEachNode(this._root,t=>e(t.node,t.bounds,t.halfSize))}forEachNeighbor(e,t){const i=Object(h["d"])(t),r=Object(h["f"])(t),n=t=>{const n=this._objectToBoundingSphere(t),a=Object(h["d"])(n),o=i+a;Object(s["h"])(Object(h["f"])(n),r)-o*o<=0&&e(t)};this._forEachNode(this._root,e=>{const t=Object(h["d"])(e.bounds),a=i+t;if(Object(s["h"])(Object(h["f"])(e.bounds),r)-a*a>0)return!1;const o=e.node;return o.terminals.forAll(e=>n(e)),null!==o.residents&&o.residents.forAll(e=>n(e)),!0}),this.forEachDegenerateObject(n)}_intersectsNode(e,t){return g(t.bounds,2*-t.halfSize,E),g(t.bounds,2*t.halfSize,R),Object(d["h"])(e.origin,e.direction,E,R)}_intersectsNodeWithOffset(e,t,i){return g(t.bounds,2*-t.halfSize,E),g(t.bounds,2*t.halfSize,R),i.applyToMinMax(E,R),Object(d["h"])(e.origin,e.direction,E,R)}_intersectsObject(e,t){const i=this._objectToBoundingSphere(t);return!(i[3]>0)||Object(h["g"])(i,e)}_intersectsObjectWithOffset(e,t,i){const r=this._objectToBoundingSphere(t);return!(r[3]>0)||Object(h["g"])(i.applyToBoundingSphere(r),e)}_forEachNode(e,t){let i=p.acquire().init(e);const r=[i];for(;0!==r.length;){if(i=r.pop(),t(i)&&!i.isLeaf())for(let e=0;e<i.node.children.length;e++)i.node.children[e]&&r.push(p.acquire().init(i).advance(e));p.release(i)}}_forEachNodeDepthOrdered(e,t,i,r=u.DepthOrder.FRONT_TO_BACK){let n=p.acquire().init(e);const a=[n];for(m(i,r,V);0!==a.length;){if(n=a.pop(),t(n)&&!n.isLeaf())for(let e=7;e>=0;--e){const t=V[e];n.node.children[t]&&a.push(p.acquire().init(n).advance(t))}p.release(n)}}_remove(e,t,i){P.clear();const r=i.advanceTo(t,(e,t)=>{P.push(e.node),P.push(t)})?i.node.terminals:i.node.residents;if(r.removeUnordered(e),0===r.length)for(let n=P.length-2;n>=0;n-=2){const e=P.data[n],t=P.data[n+1];if(!this._purge(e,t))break}}_nodeIsEmpty(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}_purge(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new a["a"]({shrink:!0})),!0)}_add(e,t){t.advanceTo(this._objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let i=0;i<t.length;i++){const r=p.acquire().init(e);this._add(t.getItemAt(i),r),p.release(r)}}_grow(e,t){if(0!==t&&(O(e,t,e=>this._objectToBoundingSphere(e),D),j(D[3])&&!this._fitsInsideTree(D)))if(this._nodeIsEmpty(this._root.node))Object(h["b"])(D,this._root.bounds),this._root.halfSize=1.25*D[3];else{const e=this._rootBoundsForRootAsSubNode(D);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(D,e):this._growRootAsSubNode(e),p.release(e)}}_rebuildTree(e,t){Object(s["g"])(I,t.bounds),I[3]=t.halfSize,O([e,I],2,e=>e,L);const i=p.acquire().init(this._root);this._root.initFrom(null,L,1.25*L[3]),this._forEachNode(i,e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0)),p.release(i)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,e=>(i=Math.max(i,e.depth),i+t<=this._maximumDepth)),i+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],i=e;let r=-1/0;const n=this._root.bounds,a=this._root.halfSize;for(let s=0;s<3;s++){const e=n[s]-a-(i[s]-t),o=i[s]+t-(n[s]+a),c=Math.max(0,Math.ceil(e/(2*a))),l=Math.max(0,Math.ceil(o/(2*a)))+1,h=2**Math.ceil(Math.log(c+l)*Math.LOG2E);r=Math.max(r,h),N[s].min=c,N[s].max=l}for(let s=0;s<3;s++){let e=N[s].min,t=N[s].max;const i=(r-(e+t))/2;e+=Math.ceil(i),t+=Math.floor(i);const o=n[s]-a-e*a*2;M[s]=o+(t+e)*a}return M[3]=r*a*S,p.acquire().initFrom(null,M,r*a,0)}_growRootAsSubNode(e){const t=this._root.node;Object(s["g"])(D,this._root.bounds),D[3]=this._root.halfSize,this._root.init(e),e.advanceTo(D,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let i=0,r=0;for(;r<t.length&&null==e;)i=r++,e=t[i];for(;r<t.length;)if(t[r++])return-1;return i}_isDegenerate(e){return!j(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=t[0]-i&&e[0]<=t[0]+i&&e[1]>=t[1]-i&&e[1]<=t[1]+i&&e[2]>=t[2]-i&&e[2]<=t[2]+i}}class p{constructor(){this.bounds=Object(h["c"])(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,i,n=this.depth){return this.node=Object(r["k"])(e)?e:p.createEmptyNode(),Object(r["k"])(t)&&Object(h["b"])(t,this.bounds),this.halfSize=i,this.depth=n,this}advance(e){let t=this.node.children[e];t||(t=p.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const i=y[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.bounds[3]=this.halfSize*S,this}advanceTo(e,t,i=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!i)return t&&t(this,-1),!1;this.node.residents=null}const r=this._childIndex(e);t&&t(this,r),this.advance(r)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new a["a"]({shrink:!0}),residents:new a["a"]({shrink:!0})}}static acquire(){return p._pool.acquire()}static release(e){p._pool.release(e)}static clearPool(){p._pool.prune()}}function b(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function f(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function g(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function O(e,t,i,r){if(1===t){const t=i(e[0]);Object(h["b"])(t,r)}else{E[0]=1/0,E[1]=1/0,E[2]=1/0,R[0]=-1/0,R[1]=-1/0,R[2]=-1/0;for(let r=0;r<t;r++){const t=i(e[r]);j(t[3])&&(b(E,t),f(R,t))}Object(s["l"])(r,E,R,.5),r[3]=Math.max(R[0]-E[0],R[1]-E[1],R[2]-E[2])/2}}function m(e,t,i){if(!z.length)for(let r=0;r<8;++r)z.push({index:0,distance:0});for(let r=0;r<8;++r){const i=y[r];z.data[r].index=r,z.data[r].distance=_(e,t,i)}z.sort((e,t)=>e.distance-t.distance);for(let r=0;r<8;++r)i[r]=z.data[r].index}function v(e,t){let i=1/0,r=null;for(let n=0;n<8;++n){const a=_(e,t,x[n]);a<i&&(i=a,r=x[n])}return r}function _(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function j(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}p._pool=new n["a"](p),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(u||(u={}));const y=[Object(o["h"])(-1,-1,-1),Object(o["h"])(1,-1,-1),Object(o["h"])(-1,1,-1),Object(o["h"])(1,1,-1),Object(o["h"])(-1,-1,1),Object(o["h"])(1,-1,1),Object(o["h"])(-1,1,1),Object(o["h"])(1,1,1)],x=[Object(o["h"])(-1,-1,-1),Object(o["h"])(-1,-1,1),Object(o["h"])(-1,1,-1),Object(o["h"])(-1,1,1),Object(o["h"])(1,-1,-1),Object(o["h"])(1,-1,1),Object(o["h"])(1,1,-1),Object(o["h"])(1,1,1)],S=Math.sqrt(3),T=[null];function w(e){return T[0]=e,T}const M=Object(h["c"])(),A=Object(o["f"])(),E=Object(o["f"])(),R=Object(o["f"])(),P=new a["a"],C=Object(h["c"])(),D=Object(h["c"])(),I=Object(h["c"])(),L=Object(h["c"])(),N=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],z=new a["a"],V=[0,0,0,0,0,0,0,0],F=u},"0cb9":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s}));var r=i("b2b2"),n=i("84f4");class a{constructor(e,t=null,i=0){this.array=e,this.spatialReference=t,this.offset=i}}function s(e){return"array"in e}function o(e,t,i="ground"){if(Object(n["a"])(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(s(t)){let n=t.offset;return e.getElevation(t.array[n++],t.array[n++],t.array[n]||0,Object(r["s"])(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}},"0d96":function(e,t,i){"use strict";i.d(t,"a",(function(){return L})),i.d(t,"b",(function(){return R})),i.d(t,"c",(function(){return C}));var r=i("b2b2"),n=i("3349"),a=i("02f1"),s=i("0fc4"),o=i("a6c9"),c=i("a05b"),l=i("d272"),h=i("7c1d"),d=i("d0cb"),u=i("7079"),p=i("6a07"),b=i("be24"),f=i("3976"),g=i("4377"),O=i("501b"),m=i("2f98"),v=i("d8a4"),_=i("fd48"),j=i("76a8"),y=i("1fe9"),x=i("955a"),S=i("3886"),T=i("690a"),w=i("6a3c"),M=i("b7c2"),A=i("b7bd"),E=i("02a0");function R(e){const t=new T["a"],i=e.signedDistanceFieldEnabled;if(t.include(h["a"]),t.include(d["a"],e),t.include(l["a"],e),e.output===c["a"].Occlusion)return t.include(u["a"],e),t;const{vertex:R,fragment:D}=t;t.include(m["a"]),D.include(O["a"]),D.include(g["a"]),t.include(b["a"],e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),R.uniforms.add([new _["a"]("viewport",(e,t)=>t.camera.fullViewport),new v["a"]("screenOffset",(e,t)=>Object(n["a"])(I,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio)),new v["a"]("anchorPosition",e=>C(e)),new _["a"]("materialColor",e=>e.color),new y["a"]("pixelRatio",(e,t)=>t.camera.pixelRatio)]),i&&(R.uniforms.add(new _["a"]("outlineColor",e=>e.outlineColor)),D.uniforms.add([new _["a"]("outlineColor",e=>P(e)?e.outlineColor:s["b"]),new y["a"]("outlineSize",e=>P(e)?e.outlineSize:0)])),e.hasScreenSizePerspective&&(Object(m["b"])(R),Object(m["c"])(R)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(A["a"].UV0,"vec2"),t.attributes.add(A["a"].COLOR,"vec4"),t.attributes.add(A["a"].SIZE,"vec2"),t.attributes.add(A["a"].AUXPOS2,"vec4"),R.code.add(S["b"]`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?S["b"]`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:S["b"]`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const L=S["b"]`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,N=e.pixelSnappingEnabled?i?S["b"]`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:S["b"]`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:S["b"]`posProj += quadOffset;`;e.vvColor&&R.uniforms.add([new j["a"]("vvColorColors",e=>e.vvColorColors,E["b"]),new x["a"]("vvColorValues",e=>e.vvColorValues,E["b"])]),R.uniforms.add(new v["a"]("textureCoordinateScaleFactor",e=>Object(r["k"])(e.texture)&&Object(r["k"])(e.texture.descriptor.textureCoordinateScaleFactor)?e.texture.descriptor.textureCoordinateScaleFactor:a["a"])),R.code.add(S["b"]`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${L}
    ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${S["b"].float(f["b"])};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${S["b"].float(f["b"])};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${N}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?S["b"]`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),D.uniforms.add(new w["a"]("tex",e=>e.texture));const z=e.debugDrawLabelBorder?S["b"]`(isBorder > 0.0 ? 0.0 : ${S["b"].float(f["a"])})`:S["b"].float(f["a"]),V=S["b"]`
    ${e.debugDrawLabelBorder?S["b"]`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?S["b"]`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${S["b"].float(o["b"])};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${z} ||
          fillPixelColor.a + outlinePixelColor.a < ${S["b"].float(f["b"])}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${z}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:S["b"]`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${z}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?S["b"]`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===c["a"].Alpha&&D.code.add(S["b"]`
      void main() {
        ${V}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===c["a"].Color&&D.code.add(S["b"]`
    void main() {
      ${V}
      ${e.transparencyPassType===M["i"].FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===c["a"].Highlight&&(t.include(p["a"]),D.code.add(S["b"]`
    void main() {
      ${V}
      ${e.binaryHighlightOcclusionEnabled?S["b"]`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function P(e){return e.outlineColor[3]>0&&e.outlineSize>0}function C(e,t=I){return e.textureIsSignedDistanceField?D(e.anchorPosition,e.distanceFieldBoundingBox,t):Object(n["c"])(t,e.anchorPosition),t}function D(e,t,i){Object(r["k"])(t)?Object(n["a"])(i,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):Object(n["a"])(i,0,0)}const I=Object(a["c"])(),L=Object.freeze(Object.defineProperty({__proto__:null,build:R,calculateAnchorPosForRendering:C},Symbol.toStringTag,{value:"Module"}))},"0d9f":function(e,t,i){"use strict";i.d(t,"a",(function(){return _})),i.d(t,"b",(function(){return ne})),i.d(t,"c",(function(){return m})),i.d(t,"d",(function(){return N})),i.d(t,"e",(function(){return y})),i.d(t,"f",(function(){return w})),i.d(t,"g",(function(){return I})),i.d(t,"h",(function(){return M})),i.d(t,"i",(function(){return H})),i.d(t,"j",(function(){return U})),i.d(t,"k",(function(){return x}));i("c120");var r=i("e92d"),n=i("38a4"),a=i("2119"),s=i("d791"),o=i("afe1"),c=i("e431"),l=i("0b2d"),h=i("3a35"),d=i("bd7e"),u=i("7289"),p=i("d18f"),b=i("a1b1"),f=i("7361");const g=r["a"].getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class O{constructor(){this.plane=Object(u["d"])(),this.origin=Object(l["f"])(),this.basis1=Object(l["f"])(),this.basis2=Object(l["f"])()}}function m(e=$){return{plane:Object(u["d"])(e.plane),origin:Object(l["d"])(e.origin),basis1:Object(l["d"])(e.basis1),basis2:Object(l["d"])(e.basis2)}}function v(e,t,i){const r=ee.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=Object(u["v"])(0,0,0,0),x(r),r}function _(e,t=m()){return y(e.origin,e.basis1,e.basis2,t)}function j(e,t){Object(c["g"])(t.origin,e.origin),Object(c["g"])(t.basis1,e.basis1),Object(c["g"])(t.basis2,e.basis2),Object(u["c"])(t.plane,e.plane)}function y(e,t,i,r=m()){return Object(c["g"])(r.origin,e),Object(c["g"])(r.basis1,t),Object(c["g"])(r.basis2,i),x(r),X(r,"fromValues()"),r}function x(e){Object(u["i"])(e.basis2,e.basis1,e.origin,e.plane)}function S(e,t,i){e!==i&&_(e,i);const r=Object(c["k"])(f["d"].get(),H(e),t);return Object(c["e"])(i.origin,i.origin,r),i.plane[3]-=t,i}function T(e,t,i){return w(t,i),S(i,V(e,e.origin),i),i}function w(e,t=m()){const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return Object(c["w"])(t.origin,e[0]+i,e[1]+r,0),Object(c["w"])(t.basis1,i,0,0),Object(c["w"])(t.basis2,0,r,0),Object(u["h"])(0,0,1,0,t.plane),t}function M(e,t,i){return!!Object(u["m"])(e.plane,t,i)&&W(e,i)}function A(e,t,i){if(M(e,t,i))return i;const r=E(e,t,f["d"].get());return Object(c["e"])(i,t.origin,Object(c["k"])(f["d"].get(),t.direction,Object(c["m"])(t.origin,r)/Object(c["p"])(t.direction))),i}function E(e,t,i){const r=Q.get();Y(e,t,r,Q.get());let a=Number.POSITIVE_INFINITY;for(const s of te){const o=Z(e,s,J.get()),l=f["d"].get();if(Object(u["k"])(r,o,l)){const e=Object(c["v"])(f["d"].get(),t.origin,l),r=Math.abs(Object(n["b"])(Object(c["i"])(t.direction,e)));r<a&&(a=r,Object(c["g"])(i,l))}}return a===Number.POSITIVE_INFINITY?R(e,t,i):i}function R(e,t,i){if(M(e,t,i))return i;const r=Q.get(),n=Q.get();Y(e,t,r,n);let a=Number.POSITIVE_INFINITY;for(const s of te){const o=Z(e,s,J.get()),l=f["d"].get();if(Object(u["l"])(r,o,l)){const e=Object(p["d"])(t,l);if(!Object(u["o"])(n,l))continue;e<a&&(a=e,Object(c["g"])(i,l))}}return D(e,t.origin)<a&&P(e,t.origin,i),i}function P(e,t,i){const r=Object(u["r"])(e.plane,t,f["d"].get()),n=Object(d["j"])(q(e,e.basis1),r,-1,1,f["d"].get()),a=Object(d["j"])(q(e,e.basis2),r,-1,1,f["d"].get());return Object(c["f"])(i,Object(c["e"])(f["d"].get(),n,a),e.origin),i}function C(e,t,i){const{origin:r,basis1:n,basis2:a}=e,s=Object(c["f"])(f["d"].get(),t,r),o=Object(b["d"])(n,s),l=Object(b["d"])(a,s),h=Object(b["d"])(H(e),s);return Object(c["w"])(i,o,l,h)}function D(e,t){const i=C(e,t,f["d"].get()),{basis1:r,basis2:n}=e,a=Object(c["p"])(r),s=Object(c["p"])(n),o=Math.max(Math.abs(i[0])-a,0),l=Math.max(Math.abs(i[1])-s,0),h=i[2];return o*o+l*l+h*h}function I(e,t){return Math.sqrt(D(e,t))}function L(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of te){const n=Z(e,r,J.get()),a=Object(d["e"])(n,t);a>i&&(i=a)}return Math.sqrt(i)}function N(e,t){return Object(u["o"])(e.plane,t)&&W(e,t)}function z(e,t,i,r){return B(e,i,r)}function V(e,t){const i=-e.plane[3];return Object(b["d"])(H(e),t)-i}function F(e,t,i,r){const n=V(e,t),a=Object(c["k"])(K,H(e),i-n);return Object(c["e"])(r,t,a),r}function G(e,t){return Object(c["o"])(e.basis1,t.basis1)&&Object(c["o"])(e.basis2,t.basis2)&&Object(c["o"])(e.origin,t.origin)}function k(e,t,i){return e!==i&&_(e,i),Object(s["a"])(ie,t),Object(s["t"])(ie,ie),Object(c["q"])(i.basis1,e.basis1,ie),Object(c["q"])(i.basis2,e.basis2,ie),Object(c["q"])(Object(u["q"])(i.plane),Object(u["q"])(e.plane),ie),Object(c["q"])(i.origin,e.origin,t),Object(u["t"])(i.plane,i.plane,i.origin),i}function U(e,t,i,r){return e!==r&&_(e,r),Object(s["d"])(re,t,i),Object(c["q"])(r.basis1,e.basis1,re),Object(c["q"])(r.basis2,e.basis2,re),x(r),r}function H(e){return Object(u["q"])(e.plane)}function B(e,t,i){switch(t){case h["a"].X:Object(c["g"])(i,e.basis1),Object(c["r"])(i,i);break;case h["a"].Y:Object(c["g"])(i,e.basis2),Object(c["r"])(i,i);break;case h["a"].Z:Object(c["g"])(i,H(e))}return i}function W(e,t){const i=Object(c["f"])(f["d"].get(),t,e.origin),r=Object(c["t"])(e.basis1),n=Object(c["t"])(e.basis2),a=Object(c["i"])(e.basis1,i),s=Object(c["i"])(e.basis2,i);return-a-r<0&&a-r<0&&-s-n<0&&s-n<0}function q(e,t){const i=J.get();return Object(c["g"])(i.origin,e.origin),Object(c["g"])(i.vector,t),i}function Z(e,t,i){const{basis1:r,basis2:n,origin:a}=e,s=Object(c["k"])(f["d"].get(),r,t.origin[0]),o=Object(c["k"])(f["d"].get(),n,t.origin[1]);Object(c["e"])(i.origin,s,o),Object(c["e"])(i.origin,i.origin,a);const l=Object(c["k"])(f["d"].get(),r,t.direction[0]),h=Object(c["k"])(f["d"].get(),n,t.direction[1]);return Object(c["k"])(i.vector,Object(c["e"])(l,l,h),2),i}function X(e,t){Math.abs(Object(c["i"])(e.basis1,e.basis2)/(Object(c["p"])(e.basis1)*Object(c["p"])(e.basis2)))>1e-6&&g.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Object(c["i"])(e.basis1,H(e)))>1e-6&&g.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Object(c["i"])(H(e),e.origin)-e.plane[3])>1e-6&&g.warn(t,"Plane offset is not consistent with plane origin")}function Y(e,t,i,r){const n=H(e);Object(u["i"])(n,t.direction,t.origin,i),Object(u["i"])(Object(u["q"])(i),n,t.origin,r)}const $={plane:Object(u["d"])(),origin:Object(l["h"])(0,0,0),basis1:Object(l["h"])(1,0,0),basis2:Object(l["h"])(0,1,0)},Q=new a["a"](u["d"]),J=new a["a"](d["d"]),K=Object(l["f"])(),ee=new a["a"](()=>({origin:null,basis1:null,basis2:null,plane:null})),te=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],ie=Object(o["d"])(),re=Object(o["d"])(),ne=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:O,create:m,wrap:v,copy:_,copyWithoutVerify:j,fromValues:y,updateUnboundedPlane:x,elevate:S,setExtent:T,fromAABoundingRect:w,intersectRay:M,intersectRayClosestSilhouette:A,closestPointOnSilhouette:E,closestPoint:R,projectPoint:P,projectPointLocal:C,distance2:D,distance:I,distanceToSilhouette:L,extrusionContainsPoint:N,axisAt:z,altitudeAt:V,setAltitudeAt:F,equals:G,transform:k,rotate:U,normal:H,UP:$},Symbol.toStringTag,{value:"Module"}))},"0eb9":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("b2b2"),n=i("8076"),a=i("e9d6");class s{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=Object(n["a"])(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const i=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?i:e+i}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return null!=i&&(t+=Object(a["d"])(i)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=Object(n["c"])(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=Object(r["s"])(e.offset,0)}updateFeatureExpressionInfoContext(e,t,i){if(Object(r["j"])(e))return void(this._featureExpressionInfoContext=null);const n=e&&e.arcade;n&&Object(r["k"])(t)&&Object(r["k"])(i)?(this._featureExpressionInfoContext=Object(a["a"])(e),Object(a["f"])(this._featureExpressionInfoContext,Object(a["c"])(n.modules,t,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new s;return Object(r["k"])(e)&&t.setFromElevationInfo(e),t}}},"0f2e":function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var r=i("b2b2"),n=i("b66e"),a=(i("e06a"),i("f315")),s=i("ea51"),o=i("8188"),c=i("40b6"),l=i("41ef"),h=i("5996");function d(e){const{spatialReference:t}=e;return Object(l["a"])(t,u,p,b,e)}function u(e){return Object(a["b"])(Math.abs(Object(c["b"])([e],"square-meters")[0]),"square-meters")}function p(e){try{return Object(a["b"])(Math.abs(Object(s["geodesicArea"])(e,"square-meters")),"square-meters")}catch(t){return null}}function b(e){const t=[];return Object(o["s"])(e,t)?Object(a["b"])(Math.abs(Object(c["b"])([{type:"polygon",rings:t,spatialReference:h["a"].WGS84}],"square-meters")[0]),"square-meters"):null}function f(e,t,i=Object(n["a"])()){if(t){const t=d(e);return Object(r["k"])(t)?t:Object(n["b"])(e,i)}return Object(n["c"])(e,i)}},1038:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return d})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return h}));var r=i("e431"),n=i("0b2d"),a=i("579f");let s=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const o=new Uint16Array([0]),c=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function l(e){if(1===e)return o;if(e<c.length)return new Uint16Array(c.buffer,0,e);if(e>s.length){const t=Math.max(2*s.length,e);s=new Uint32Array(t);for(let e=0;e<s.length;e++)s[e]=e}return new Uint32Array(s.buffer,0,e)}function h(e){if(1===e)return new Uint16Array(o);if(e<c.length)return new Uint16Array(c.slice(0,e));if(e>s.length){const t=new Uint32Array(e);for(let e=0;e<t.length;e++)t[e]=e;return t}return new Uint32Array(s.slice(0,e))}function d(e,t,i){if(!e)return!1;const{size:n,data:s}=e;Object(r["w"])(i,0,0,0),Object(r["w"])(O,0,0,0);let o=0,c=0;for(let l=0;l<t.length-2;l+=3){const e=t[l+0]*n,h=t[l+1]*n,d=t[l+2]*n;Object(r["w"])(b,s[e+0],s[e+1],s[e+2]),Object(r["w"])(f,s[h+0],s[h+1],s[h+2]),Object(r["w"])(g,s[d+0],s[d+1],s[d+2]);const u=Object(a["b"])(b,f,g);u?(Object(r["e"])(b,b,f),Object(r["e"])(b,b,g),Object(r["k"])(b,b,1/3*u),Object(r["e"])(i,i,b),o+=u):(Object(r["e"])(O,O,b),Object(r["e"])(O,O,f),Object(r["e"])(O,O,g),c+=3)}return(0!==c||0!==o)&&(0!==o?(Object(r["k"])(i,i,1/o),!0):0!==c&&(Object(r["k"])(i,O,1/c),!0))}function u(e,t,i){if(!e||!t)return!1;const{size:n,data:a}=e;Object(r["w"])(i,0,0,0);let s=-1,o=0;for(let r=0;r<t.length;r++){const e=t[r]*n;s!==e&&(i[0]+=a[e+0],i[1]+=a[e+1],i[2]+=a[e+2],o++),s=e}return o>1&&Object(r["k"])(i,i,1/o),o>0}function p(e,t,i,n){if(!e)return!1;const{size:a,data:s}=e;Object(r["w"])(n,0,0,0),Object(r["w"])(O,0,0,0);let o=0,c=0;const l=t?t.length-1:s.length/a-1,h=l+(i?2:0);for(let d=0;d<h;d+=2){const e=d<l?d:l,i=d<l?d+1:0,h=(t?t[e]:e)*a,u=(t?t[i]:i)*a;b[0]=s[h+0],b[1]=s[h+1],b[2]=s[h+2],f[0]=s[u+0],f[1]=s[u+1],f[2]=s[u+2],Object(r["k"])(b,Object(r["e"])(b,b,f),.5);const p=Object(r["n"])(b,f);p>0?(Object(r["e"])(n,n,Object(r["k"])(b,b,p)),o+=p):(Object(r["e"])(O,O,b),c++)}return 0!==o?(Object(r["k"])(n,n,1/o),!0):0!==c&&(Object(r["k"])(n,O,1/c),!0)}const b=Object(n["f"])(),f=Object(n["f"])(),g=Object(n["f"])(),O=Object(n["f"])()},"157c":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(e,t,i,r){this.helper=e,this.dx=t,this.dy=i,this.dz=r}_move(e,t,i,r){this.helper.addDelta(e.pos,t,i,r)}apply(e){this._move(e,this.dx,this.dy,this.dz)}undo(e){this._move(e,-this.dx,-this.dy,-this.dz)}canAccumulate(e){return e instanceof r}accumulate(e,t){this._move(e,t.dx,t.dy,t.dz)}accumulateParams(e){this.dx+=e.dx,this.dy+=e.dy,this.dz+=e.dz}}},1666:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return o}));var r,n=i("9812"),a=i("32ed"),s=i("8c4b");function o(e){const t=l(e.rings,e.hasZ,r.CCW_IS_HOLE),i=[];let a=0,o=0;for(const r of t.polygons){const e=r.count,s=r.index,c=new Float64Array(t.position.buffer,3*s*t.position.BYTES_PER_ELEMENT,3*e),l=r.holeIndices.map(e=>e-s),h=new Uint32Array(Object(n["a"])(c,l,3));i.push({position:c,faces:h}),a+=c.length,o+=h.length}const h=c(i,a,o),d=Object(s["a"])(h.position.buffer,6,{originalIndices:h.faces});return h.position=new Float64Array(d.buffer),h.faces=d.indices,h}function c(e,t,i){if(1===e.length)return e[0];const r=new Float64Array(t),n=new Uint32Array(i);let a=0,s=0,o=0;for(const c of e){for(let e=0;e<c.position.length;e++)r[a++]=c.position[e];for(let e=0;e<c.faces.length;e++)n[s++]=c.faces[e]+o;o=a/3}return{position:r,faces:n}}function l(e,t,i){const n=e.length,a=new Array(n),s=new Array(n),o=new Array(n);let c=0,l=0,u=0,p=0;for(let r=0;r<n;++r)p+=e[r].length;const b=new Float64Array(3*p);let f=0;for(let g=n-1;g>=0;g--){const p=e[g],O=i===r.CCW_IS_HOLE&&d(p);if(O&&1!==n)a[c++]=p;else{let e=p.length;for(let t=0;t<c;++t)e+=a[t].length;const i={index:f,pathLengths:new Array(c+1),count:e,holeIndices:new Array(c)};i.pathLengths[0]=p.length,p.length>0&&(o[u++]={index:f,count:p.length}),f=O?h(p,p.length-1,-1,b,f,p.length,t):h(p,0,1,b,f,p.length,t);for(let r=0;r<c;++r){const e=a[r];i.holeIndices[r]=f,i.pathLengths[r+1]=e.length,e.length>0&&(o[u++]={index:f,count:e.length}),f=h(e,0,1,b,f,e.length,t)}c=0,i.count>0&&(s[l++]=i)}}for(let r=0;r<c;++r){const e=a[r];e.length>0&&(o[u++]={index:f,count:e.length}),f=h(e,0,1,b,f,e.length,t)}return l<n&&(s.length=l),u<n&&(o.length=u),{position:b,polygons:s,outlines:o}}function h(e,t,i,r,n,a,s){n*=3;for(let o=0;o<a;++o){const a=e[t];r[n++]=a[0],r[n++]=a[1],r[n++]=s?a[2]:0,t+=i}return n/3}function d(e){return!Object(a["h"])(e,!1,!1)}!function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"}(r||(r={}))},"171c":function(e,t,i){"use strict";i.d(t,"a",(function(){return j}));var r=i("e92d"),n=i("38a4"),a=i("b2b2"),s=i("a915"),o=i("d791"),c=i("afe1"),l=i("3349"),h=i("02f1"),d=i("e431"),u=i("0b2d"),p=i("7577"),b=i("0fc4"),f=i("d359"),g=i("d18f"),O=i("a1b1"),m=i("3c9c"),v=i("1153");const _=r["a"].getLogger("esri.views.3d.webgl-engine.lib.Camera");class j{constructor(e=null,t=null,i=null){this._viewUp=Object(u["f"])(),this._viewForward=Object(u["f"])(),this._viewRight=Object(u["f"])(),this._ray=Object(g["c"])(),this._viewport=Object(b["g"])(0,0,1,1),this._padding=Object(b["g"])(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Object(h["g"])(1,1e3),this._viewDirty=!0,this._viewMatrix=Object(c["d"])(),this._projectionDirty=!0,this._projectionMatrix=Object(c["d"])(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Object(c["d"])(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Object(c["d"])(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=Object(f["c"])(),this._fullViewport=Object(b["e"])(),this._pixelRatio=1,this.relativeElevation=0,Object(a["k"])(e)&&Object(d["g"])(this._ray.origin,e),this._center=Object(a["k"])(t)?Object(u["d"])(t):Object(u["f"])(),this._up=Object(a["k"])(i)?Object(u["d"])(i):Object(u["h"])(0,0,1)}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center)}get ray(){return Object(d["f"])(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){Object(o["c"])(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get x(){return this._viewport[0]}set x(e){e+=this._padding[M.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(e){e+=this._padding[M.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[M.RIGHT]+this._padding[M.LEFT]}set fullWidth(e){this.width=e-(this._padding[M.RIGHT]+this._padding[M.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[M.TOP]+this._padding[M.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[M.TOP]+this._padding[M.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[M.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[M.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){this._padding[M.TOP]===e[M.TOP]&&this._padding[M.RIGHT]===e[M.RIGHT]&&this._padding[M.BOTTOM]===e[M.BOTTOM]&&this._padding[M.LEFT]===e[M.LEFT]||(this._viewport[0]+=e[M.LEFT]-this._padding[M.LEFT],this._viewport[1]+=e[M.BOTTOM]-this._padding[M.BOTTOM],this._viewport[2]-=e[M.RIGHT]+e[M.LEFT]-(this._padding[M.RIGHT]+this._padding[M.LEFT]),this._viewport[3]-=e[M.TOP]+e[M.BOTTOM]-(this._padding[M.TOP]+this._padding[M.BOTTOM]),Object(p["c"])(this._padding,e),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Object(o["m"])(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this.aspect;Object(o["l"])(this._projectionMatrix,-r*(1+2*this._padding[M.LEFT]/e),r*(1+2*this._padding[M.RIGHT]/e),-i*(1+2*this._padding[M.BOTTOM]/t),i*(1+2*this._padding[M.TOP]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}get inverseProjectionMatrix(){return Object(a["j"])(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=Object(c["d"])()),this._inverseProjectionDirty&&Object(o["a"])(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(e){Object(o["c"])(this._projectionMatrix,e),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(e){this._fov=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Object(v["b"])(this._fov,this.width,this.height)}set fovX(e){this._fov=Object(v["d"])(e,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Object(v["c"])(this._fov,this.width,this.height)}set fovY(e){this._fov=Object(v["e"])(e,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Object(d["m"])(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Object(o["a"])(this._viewInverseTransposeMatrix,this.viewMatrix),Object(o["t"])(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this._pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(e){Object(d["g"])(this._ray.origin,e.eye),Object(d["g"])(this._center,e.center),Object(d["g"])(this._up,e.up),Object(p["c"])(this._viewport,e.viewport),Object(p["c"])(this._padding,e.padding),Object(l["c"])(this._nearFar,e.nearFar),this._fov=e.fov,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||(Object(o["c"])(this._viewMatrix,e.viewMatrix),Object(d["g"])(this._viewRight,e.viewRight),Object(d["g"])(this._viewUp,e.viewUp),Object(d["g"])(this._viewForward,e.viewForward)),t._projectionDirty?this._projectionDirty=!0:(Object(o["c"])(this._projectionMatrix,e.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(Object(f["b"])(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Object(o["c"])(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Object(p["c"])(this._fullViewport,e.fullViewport),this._pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new j).copyFrom(this)}equals(e){return Object(d["o"])(this.eye,e.eye)&&Object(d["o"])(this._center,e.center)&&Object(d["o"])(this._up,e.up)&&Object(p["g"])(this._viewport,e.viewport)&&Object(p["g"])(this._padding,e.padding)&&Object(l["e"])(this._nearFar,e.nearFar)&&this._fov===e.fov&&this._pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){if(this._pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;const t=5e-4,i=1-1e-10;Object(d["z"])(S,e.eye,e.center),Object(d["z"])(T,this.eye,this._center);const r=Object(d["i"])(S,T),n=Object(d["A"])(S),a=Object(d["A"])(T);return r*r>=i*n*a&&Object(d["B"])(e.eye,this.eye)<Math.max(n,a)*t*t&&Object(p["i"])(e.padding,this._padding)<.5&&Object(p["i"])(e.viewport,this._viewport)<.5}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs(Object(O["d"])(this.viewForward,Object(d["f"])(S,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=Object(s["f"])()){return e[0]=(this.padding[M.LEFT]+this.width/2)/this._pixelRatio,e[1]=(this.padding[M.TOP]+this.height/2)/this._pixelRatio,e}getRenderCenter(e,t=.5,i=.5){return e[0]=this.padding[M.LEFT]+this.width*t,e[1]=this.padding[M.BOTTOM]+this.height*i,e[2]=.5,e}setGLViewport(e){const t=this.viewport,i=this.padding;e.setViewport(t[0]-i[3],t[1]-i[2],t[2]+i[1]+i[3],t[3]+i[0]+i[2])}applyProjection(e,t){e!==y&&Object(d["g"])(y,e),y[3]=1,Object(p["m"])(y,y,this.projectionMatrix);const i=Math.abs(y[3]);Object(d["k"])(y,y,1/i);const r=this.fullViewport;t[0]=Object(n["l"])(0,r[0]+r[2],.5+.5*y[0]),t[1]=Object(n["l"])(0,r[1]+r[3],.5+.5*y[1]),t[2]=.5*(y[2]+1),t[3]=i}unapplyProjection(e,t){const i=this.fullViewport;y[0]=(e[0]/(i[0]+i[2])*2-1)*e[3],y[1]=(e[1]/(i[1]+i[3])*2-1)*e[3],y[2]=(2*e[2]-1)*e[3],y[3]=e[3],Object(p["m"])(y,y,this.inverseProjectionMatrix),t[0]=y[0],t[1]=y[1],t[2]=y[2]}projectToScreen(e,t){this.projectToRenderScreen(e,w),this.renderToScreen(w,t)}projectToRenderScreen(e,t){if(y[0]=e[0],y[1]=e[1],y[2]=e[2],y[3]=1,Object(p["m"])(y,y,this.viewProjectionMatrix),0===y[3])return null;Object(d["k"])(y,y,1/Math.abs(y[3]));const i=this.fullViewport;return"x"in t?(t.x=Object(n["l"])(0,i[0]+i[2],.5+.5*y[0]),t.y=Object(n["l"])(0,i[1]+i[3],.5+.5*y[1])):(t[0]=Object(n["l"])(0,i[0]+i[2],.5+.5*y[0]),t[1]=Object(n["l"])(0,i[1]+i[3],.5+.5*y[1]),t.length>2&&(t[2]=.5*(y[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,w),t)}unprojectFromRenderScreen(e,t){if(Object(o["m"])(x,this.projectionMatrix,this.viewMatrix),!Object(o["a"])(x,x))return null;const i=this.fullViewport;return y[0]=2*(e[0]-i[0])/i[2]-1,y[1]=2*(e[1]-i[1])/i[3]-1,y[2]=2*e[2]-1,y[3]=1,Object(p["m"])(y,y,x),0===y[3]?null:(t[0]=y[0]/y[3],t[1]=y[1]/y[3],t[2]=y[2]/y[3],t)}constrainWindowSize(e,t,i,r=i){const n=e*this._pixelRatio,a=t*this._pixelRatio,s=Math.max(n-i/2,0),o=Math.max(this.fullHeight-a-r/2,0),c=-Math.min(n-i/2,0),l=-Math.min(this.fullHeight-a-r/2,0);return[s,o,i-c- -Math.min(this.fullWidth-n-i/2,0),r-l- -Math.min(a-r/2,0)]}computeUp(e){e===m["a"].Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const i=e[0]*this._pixelRatio,r=this.fullHeight-e[1]*this._pixelRatio;return t[0]=i,t[1]=r,t}renderToScreen(e,t){const i=e[0]/this._pixelRatio,r=(this.fullHeight-e[1])/this._pixelRatio;t[0]=i,t[1]=r}_computeUpGlobal(){Object(d["f"])(S,this.center,this.eye);const e=Object(d["p"])(this.center);e<1?(Object(d["w"])(this._up,0,0,1),this._markViewDirty()):Math.abs(Object(d["i"])(S,this.center))>.9999*Object(d["p"])(S)*e||(Object(d["j"])(this._up,S,this.center),Object(d["j"])(this._up,this._up,S),Object(d["r"])(this._up,this._up),this._markViewDirty())}_computeUpLocal(){Object(d["v"])(S,this.eye,this.center),Math.abs(S[2])<=.9999&&(Object(d["k"])(S,S,S[2]),Object(d["w"])(this._up,-S[0],-S[1],1-S[2]),Object(d["r"])(this._up,this._up),this._markViewDirty())}_compareAndSetView(e,t){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?Object(d["o"])(e,t)||(Object(d["g"])(t,e),this._markViewDirty()):_.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Object(f["d"])(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(Object(o["n"])(this._viewMatrix,this.eye,this._center,this._up),Object(d["w"])(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),Object(d["w"])(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),Object(d["w"])(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const y=Object(b["e"])(),x=Object(c["d"])(),S=Object(u["f"])(),T=Object(u["f"])(),w=Object(s["d"])();var M;!function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(M||(M={}))},"17b0":function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return d}));var r=i("7577"),n=i("0fc4"),a=i("2f98"),s=i("8e97"),o=i("fd48"),c=i("3886");function l(e,t){const i=e.vertex;t.hasVerticalOffset?(d(i),t.hasScreenSizePerspective&&(e.include(a["a"]),Object(a["c"])(i),Object(s["a"])(e.vertex,t)),i.code.add(c["b"]`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?c["b"]`vec3 worldNormal = normalize(worldPos + localOrigin);`:c["b"]`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?c["b"]`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:c["b"]`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(c["b"]`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const h=Object(n["e"])();function d(e){e.uniforms.add(new o["a"]("verticalOffset",(e,t)=>{const{minWorldLength:i,maxWorldLength:n,screenLength:a}=e.verticalOffset,s=Math.tan(.5*t.camera.fovY)/(.5*t.camera.fullViewport[3]),o=t.camera.pixelRatio||1;return Object(r["l"])(h,a*o,s,i,n)}))}},"189c":function(e,t,i){"use strict";i.d(t,"a",(function(){return k})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return d})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return c})),i.d(t,"f",(function(){return _})),i.d(t,"g",(function(){return s})),i.d(t,"h",(function(){return a}));var r=i("b7c2"),n=i("d17d");function a(e,t,i=n["c"].ADD,r=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function s(e,t,i,r,a=n["c"].ADD,s=n["c"].ADD,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:r,opRgb:a,opAlpha:s,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const o={face:n["n"].BACK,mode:n["j"].CCW},c={face:n["n"].FRONT,mode:n["j"].CCW},l=e=>e===r["b"].Back?o:e===r["b"].Front?c:null,h={zNear:0,zFar:1},d={r:!0,g:!0,b:!0,a:!0};function u(e){return x.intern(e)}function p(e){return T.intern(e)}function b(e){return M.intern(e)}function f(e){return E.intern(e)}function g(e){return P.intern(e)}function O(e){return D.intern(e)}function m(e){return L.intern(e)}function v(e){return z.intern(e)}function _(e){return F.intern(e)}class j{constructor(e,t){this.makeKey=e,this.makeRef=t,this.interns=new Map}intern(e){if(!e)return null;const t=this.makeKey(e),i=this.interns;return i.has(t)||i.set(t,this.makeRef(e)),i.get(t)}}function y(e){return"["+e.join(",")+"]"}const x=new j(S,e=>({__tag:"Blending",...e}));function S(e){return e?y([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const T=new j(w,e=>({__tag:"Culling",...e}));function w(e){return e?y([e.face,e.mode]):null}const M=new j(A,e=>({__tag:"PolygonOffset",...e}));function A(e){return e?y([e.factor,e.units]):null}const E=new j(R,e=>({__tag:"DepthTest",...e}));function R(e){return e?y([e.func]):null}const P=new j(C,e=>({__tag:"StencilTest",...e}));function C(e){return e?y([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const D=new j(I,e=>({__tag:"DepthWrite",...e}));function I(e){return e?y([e.zNear,e.zFar]):null}const L=new j(N,e=>({__tag:"ColorWrite",...e}));function N(e){return e?y([e.r,e.g,e.b,e.a]):null}const z=new j(V,e=>({__tag:"StencilWrite",...e}));function V(e){return e?y([e.mask]):null}const F=new j(G,e=>({blending:u(e.blending),culling:p(e.culling),polygonOffset:b(e.polygonOffset),depthTest:f(e.depthTest),stencilTest:g(e.stencilTest),depthWrite:O(e.depthWrite),colorWrite:m(e.colorWrite),stencilWrite:v(e.stencilWrite)}));function G(e){return e?y([S(e.blending),w(e.culling),A(e.polygonOffset),R(e.depthTest),C(e.stencilTest),I(e.depthWrite),N(e.colorWrite),V(e.stencilWrite)]):null}class k{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,t,i,r){return(i||e!==t)&&(r(e),this._pipelineInvalid=!0),e}}},1942:function(e,t,i){"use strict";var r,n;i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return n})),function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"}(r||(r={}));class a{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=n.ALL}}!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(n||(n={}))},1962:function(e,t,i){"use strict";i.d(t,"a",(function(){return _})),i.d(t,"b",(function(){return v}));var r=i("a05b"),n=i("d272"),a=i("4db9"),s=i("6d5b"),o=i("c2d1"),c=i("6a07"),l=i("c6d7"),h=i("3976"),d=i("4377"),u=i("8e97"),p=i("d8a4"),b=i("fd48"),f=i("3886"),g=i("690a"),O=i("b7c2"),m=i("b7bd");function v(e){const t=new g["a"],i=e.output===r["a"].Depth,v=e.hasMultipassTerrain&&(e.output===r["a"].Color||e.output===r["a"].Alpha);Object(u["b"])(t,e),t.include(a["a"],{hasModelTransformation:!1,linearDepth:i}),t.include(s["a"],e),t.attributes.add(m["a"].POSITION,"vec3"),t.varyings.add("vpos","vec3"),v&&t.varyings.add("depth","float");const{vertex:_,fragment:j}=t;return i&&(t.include(o["a"],e),_.uniforms.add(new p["a"]("nearFar",(e,t)=>t.camera.nearFar)),t.varyings.add("linearDepth","float")),_.code.add(f["b"]`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${v?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?f["b"]`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:f["b"]`transformPosition(proj, view, vpos);`}
    }
  `),t.include(n["a"],e),v&&t.include(l["b"],e),j.include(d["a"]),j.uniforms.add(new b["a"]("eColor",e=>e.color)),e.output===r["a"].Highlight&&t.include(c["a"]),j.code.add(f["b"]`
  void main() {
    discardBySlice(vpos);
    ${v?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${f["b"].float(h["b"])}) {
      discard;
    }

    ${e.output===r["a"].Alpha?f["b"]`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===r["a"].Color?f["b"]`gl_FragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===O["i"].Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===r["a"].Highlight?f["b"]`outputHighlight();`:""};
    ${e.output===r["a"].Depth?f["b"]`outputDepth(linearDepth);`:""};
  }
  `),t}const _=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},"1a54":function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return d})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return o})),i.d(t,"g",(function(){return l})),i.d(t,"h",(function(){return h}));i("f0b9"),i("c120");var r=i("b2b2"),n=(i("a21b"),i("f2e0"),i("5996"),i("4261")),a=i("9180");i("008c"),i("74e2"),i("a1f3"),i("3563");class s{constructor(e,t,i){this.uid=e,this.geometry=t,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}}function o(e){return Object(r["k"])(e.geometry)}class c{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function l(e,t,i,r){return{x:e,y:t,z:i,hasZ:null!=i,hasM:!1,spatialReference:r,type:"point"}}function h(e){if(Object(r["j"])(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function d(e,t){switch(Object(n["h"])(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)Object(n["l"])(t,e.paths[i],e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)Object(n["l"])(t,e.rings[i],e.hasZ);break;case"multipoint":Object(n["l"])(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function u(e,t){switch(Object(a["l"])(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)Object(a["o"])(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)Object(a["o"])(t,e.rings[i]);break;case"multipoint":Object(a["o"])(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function p(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}Object(n["f"])(),Object(a["k"])()},"1e2c":function(e,t,i){"use strict";i.d(t,"a",(function(){return se}));var r=i("6c97"),n=i("ce50"),a=i("ce6d"),s=i("38a4"),o=i("b2b2"),c=i("f4cc"),l=i("a21b"),h=i("e041"),d=i("2db0"),u=i("228a"),p=i("b7c2"),b=i("b2cd");function f(){if(Object(o["j"])(g)){const e=e=>Object(b["a"])("esri/libs/basisu/"+e);g=i.e("chunk-5ba1e7e0").then(i.bind(null,"a58f")).then(e=>e.b).then(({default:t})=>t({locateFile:e}).then(e=>(e.initializeBasis(),delete e.then,e)))}return g}let g;var O;!function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"}(O||(O={}));var m=i("d17d"),v=i("a1ff"),_=i("8539");let j=null,y=null;async function x(){return Object(o["j"])(y)&&(y=f(),j=await y),y}function S(e,t){if(Object(o["j"])(j))return e.byteLength;const i=new j.BasisFile(new Uint8Array(e)),r=M(i)?w(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),r}function T(e,t){if(Object(o["j"])(j))return e.byteLength;const i=new j.KTX2File(new Uint8Array(e)),r=A(i)?w(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),r}function w(e,t,i,r,n){const a=Object(_["b"])(t?m["i"].COMPRESSED_RGBA8_ETC2_EAC:m["i"].COMPRESSED_RGB8_ETC2),s=n&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*r*a*s)}function M(e){return e.getNumImages()>=1&&!e.isUASTC()}function A(e){return e.getFaces()>=1&&e.isETC1S()}async function E(e,t,i){Object(o["j"])(j)&&(j=await x());const r=new j.BasisFile(new Uint8Array(i));if(!M(r))return null;r.startTranscoding();const n=P(e,t,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(e,t)=>r.getImageTranscodedSizeInBytes(0,e,t),(e,t,i)=>r.transcodeImage(i,0,e,t,0,0));return r.close(),r.delete(),n}async function R(e,t,i){Object(o["j"])(j)&&(j=await x());const r=new j.KTX2File(new Uint8Array(i));if(!A(r))return null;r.startTranscoding();const n=P(e,t,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(e,t)=>r.getImageTranscodedSizeInBytes(e,0,0,t),(e,t,i)=>r.transcodeImage(i,e,0,0,t,0,-1,-1));return r.close(),r.delete(),n}function P(e,t,i,r,n,a,s,o){const{compressedTextureETC:c,compressedTextureS3TC:l}=e.capabilities,[h,d]=c?r?[O.ETC2_RGBA,m["i"].COMPRESSED_RGBA8_ETC2_EAC]:[O.ETC1_RGB,m["i"].COMPRESSED_RGB8_ETC2]:l?r?[O.BC3_RGBA,m["i"].COMPRESSED_RGBA_S3TC_DXT5_EXT]:[O.BC1_RGB,m["i"].COMPRESSED_RGB_S3TC_DXT1_EXT]:[O.RGBA32,m["p"].RGBA],u=t.hasMipmap?i:Math.min(1,i),p=[];for(let O=0;O<u;O++)p.push(new Uint8Array(s(O,h))),o(O,h,p[O]);const b=p.length>1,f=b?m["z"].LINEAR_MIPMAP_LINEAR:m["z"].LINEAR,g={...t,samplingMode:f,hasMipmap:b,internalFormat:d,width:n,height:a};return new v["a"](e,g,{type:"compressed",levels:p})}var C=i("003f"),D=i("2765"),I=i("e92d");const L=I["a"].getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),N=542327876,z=131072,V=4;function F(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function G(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const k=F("DXT1"),U=F("DXT3"),H=F("DXT5"),B=31,W=0,q=1,Z=2,X=3,Y=4,$=7,Q=20,J=21;function K(e,t,i){const{textureData:r,internalFormat:n,width:a,height:s}=ee(i,t.hasMipmap);return t.samplingMode=r.levels.length>1?m["z"].LINEAR_MIPMAP_LINEAR:m["z"].LINEAR,t.hasMipmap=r.levels.length>1,t.internalFormat=n,t.width=a,t.height=s,new v["a"](e,t,r)}function ee(e,t){const i=new Int32Array(e,0,B);if(i[W]!==N)return L.error("Invalid magic number in DDS header"),null;if(!(i[Q]&V))return L.error("Unsupported format, must contain a FourCC code"),null;const r=i[J];let n,a;switch(r){case k:n=8,a=m["i"].COMPRESSED_RGB_S3TC_DXT1_EXT;break;case U:n=16,a=m["i"].COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case H:n=16,a=m["i"].COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return L.error("Unsupported FourCC code:",G(r)),null}let o=1,c=i[Y],l=i[X];0==(3&c)&&0==(3&l)||(L.warn("Rounding up compressed texture size to nearest multiple of 4."),c=c+3&-4,l=l+3&-4);const h=c,d=l;let u,p;i[Z]&z&&!1!==t&&(o=Math.max(1,i[$])),1===o||Object(s["k"])(c)&&Object(s["k"])(l)||(L.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let b=i[q]+4;const f=[];for(let s=0;s<o;++s)p=(c+3>>2)*(l+3>>2)*n,u=new Uint8Array(e,b,p),f.push(u),b+=p,c=Math.max(1,c>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:f},internalFormat:a,width:h,height:d}}var te,ie=i("d5f7"),re=i("1153"),ne=i("d267"),ae=i("c514");class se extends C["a"]{constructor(e,t){super(),this.data=e,this.type=D["a"].Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new a["a"],this.params=t||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:m["B"].REPEAT,t:m["B"].REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||p["e"].STRETCH,this.estimatedTexMemRequired=se._estimateTexMemRequired(this.data,this.params),this._startPreload()}_startPreload(){const e=this.data;Object(o["j"])(e)||(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(Object(h["v"])(e.src)||"auto"===e.preload&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const t=!e.paused;if(e.src=e.src,t&&e.autoplay){const t=()=>{e.removeEventListener("canplay",t),e.play()};e.addEventListener("canplay",t)}}}_startPreloadImageElement(e){Object(h["w"])(e.src)||Object(h["v"])(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static _getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static _estimateTexMemRequired(e,t){if(Object(o["j"])(e))return 0;if(Object(l["c"])(e)||Object(l["k"])(e))return t.encoding===se.KTX2_ENCODING?T(e,t.mipmap):t.encoding===se.BASIS_ENCODING?S(e,t.mipmap):e.byteLength;const{width:i,height:r}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?se._getDataDimensions(e):t;return(t.mipmap?4/3:1)*i*r*(t.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(e){var t;return{target:m["A"].TEXTURE_2D,pixelFormat:m["p"].RGBA,dataType:m["q"].UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?m["z"].LINEAR_MIPMAP_LINEAR:m["z"].LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(t=this.params.maxAnisotropy)?t:this.params.mipmap?e.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(e,t){if(Object(o["k"])(this._glTexture))return this._glTexture;if(Object(o["k"])(this._loadingPromise))return this._loadingPromise;const i=this.data;return Object(o["j"])(i)?(this._glTexture=new v["a"](e,this._createDescriptor(e),null),this._glTexture):"string"==typeof i?this._loadFromURL(e,t,i):i instanceof Image?this._loadFromImageElement(e,t,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,t,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i,t):(Object(l["c"])(i)||Object(l["k"])(i))&&this.params.encoding===se.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(e,i)):(Object(l["c"])(i)||Object(l["k"])(i))&&this.params.encoding===se.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(e,i)):(Object(l["c"])(i)||Object(l["k"])(i))&&this.params.encoding===se.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(e,i)):Object(l["k"])(i)?this._loadFromPixelData(e,i):Object(l["c"])(i)?this._loadFromPixelData(e,new Uint8Array(i)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(e,t,i){if(!(this.data instanceof HTMLVideoElement)||Object(o["j"])(this._glTexture))return i;if(this.data.readyState<te.HAVE_CURRENT_DATA||i===this.data.currentTime)return i;if(Object(o["k"])(this._powerOfTwoStretchInfo)){const{framebuffer:i,vao:r,sourceTexture:n}=this._powerOfTwoStretchInfo;n.setData(this.data),this._drawStretchedTexture(e,t,i,r,n,this._glTexture)}else{const{videoWidth:e,videoHeight:t}=this.data,{width:i,height:r}=this._glTexture.descriptor;e!==i||t!==r?this._glTexture.updateData(0,0,0,Math.min(e,i),Math.min(t,r),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this.data.currentTime}_loadFromDDSData(e,t){return this._glTexture=K(e,this._createDescriptor(e),t),this._glTexture}_loadFromKTX2(e,t){return this._loadAsync(()=>R(e,this._createDescriptor(e),t).then(e=>(this._glTexture=e,e)))}_loadFromBasis(e,t){return this._loadAsync(()=>E(e,this._createDescriptor(e),t).then(e=>(this._glTexture=e,e)))}_loadFromPixelData(e,t){Object(re["a"])(this.params.width>0&&this.params.height>0);const i=this._createDescriptor(e);return i.pixelFormat=1===this.params.components?m["p"].LUMINANCE:3===this.params.components?m["p"].RGB:m["p"].RGBA,i.width=this.params.width,i.height=this.params.height,this._glTexture=new v["a"](e,i,t),this._glTexture}_loadFromURL(e,t,i){return this._loadAsync(async r=>{const n=await Object(d["a"])(i,{signal:r});return Object(c["p"])(r),this._loadFromImage(e,n,t)})}_loadFromImageElement(e,t,i){return i.complete?this._loadFromImage(e,i,t):this._loadAsync(async r=>{const n=await Object(u["b"])(i,i.src,!1,r);return Object(c["p"])(r),this._loadFromImage(e,n,t)})}_loadFromVideoElement(e,t,i){return i.readyState>=te.HAVE_CURRENT_DATA?this._loadFromImage(e,i,t):this._loadFromVideoElementAsync(e,t,i)}_loadFromVideoElementAsync(e,t,i){return this._loadAsync(r=>new Promise((a,s)=>{const l=()=>{i.removeEventListener("loadeddata",h),i.removeEventListener("error",d),Object(o["q"])(u)},h=()=>{i.readyState>=te.HAVE_CURRENT_DATA&&(l(),a(this._loadFromImage(e,i,t)))},d=e=>{l(),s(e||new n["a"]("Failed to load video"))};i.addEventListener("loadeddata",h),i.addEventListener("error",d);const u=Object(c["m"])(r,()=>d(Object(c["b"])()))}))}_loadFromImage(e,t,i){const r=se._getDataDimensions(t);this.params.width=r.width,this.params.height=r.height;const n=this._createDescriptor(e);return n.pixelFormat=3===this.params.components?m["p"].RGB:m["p"].RGBA,!this._requiresPowerOfTwo(e,n)||Object(s["k"])(r.width)&&Object(s["k"])(r.height)?(n.width=r.width,n.height=r.height,this._glTexture=new v["a"](e,n,t),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(e,t,r,n,i),this._glTexture)}_loadAsync(e){const t=new AbortController;this._loadingController=t;const i=e(t.signal);this._loadingPromise=i;const r=()=>{this._loadingController===t&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(r,r),i}_requiresPowerOfTwo(e,t){const i=m["B"].CLAMP_TO_EDGE,r="number"==typeof t.wrapMode?t.wrapMode===i:t.wrapMode.s===i&&t.wrapMode.t===i;return!Object(ae["a"])(e.gl)&&(t.hasMipmap||!r)}_makePowerOfTwoTexture(e,t,i,n,a){const{width:o,height:c}=i,l=Object(s["m"])(o),h=Object(s["m"])(c);let d;switch(n.width=l,n.height=h,this.params.powerOfTwoResizeMode){case p["e"].PAD:n.textureCoordinateScaleFactor=[o/l,c/h],d=new v["a"](e,n),d.updateData(0,0,0,o,c,t);break;case p["e"].STRETCH:case null:case void 0:d=this._stretchToPowerOfTwo(e,t,n,a());break;default:Object(r["a"])(this.params.powerOfTwoResizeMode)}return n.hasMipmap&&d.generateMipmap(),d}_stretchToPowerOfTwo(e,t,i,r){const n=new v["a"](e,i),a=new ne["a"](e,{colorTarget:m["y"].TEXTURE,depthStencilTarget:m["m"].NONE},n),s=new v["a"](e,{target:m["A"].TEXTURE_2D,pixelFormat:i.pixelFormat,dataType:m["q"].UNSIGNED_BYTE,wrapMode:m["B"].CLAMP_TO_EDGE,samplingMode:m["z"].LINEAR,flipped:!!i.flipped,maxAnisotropy:8,preMultiplyAlpha:i.preMultiplyAlpha},t),o=Object(ie["b"])(e),c=e.getBoundFramebufferObject();return this._drawStretchedTexture(e,r,a,o,s,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:o,sourceTexture:s,framebuffer:a}:(o.dispose(!0),s.dispose(),a.detachColorTexture(),a.dispose()),e.bindFramebuffer(c),n}_drawStretchedTexture(e,t,i,r,n,a){e.bindFramebuffer(i);const s=e.getViewport();e.setViewport(0,0,a.descriptor.width,a.descriptor.height);const o=e.bindTechnique(t);o.setUniform4f("uColor",1,1,1,1),o.bindTexture("tex",n),e.bindVAO(r),e.drawArrays(m["r"].TRIANGLE_STRIP,0,Object(_["f"])(r,"geometry")),e.bindFramebuffer(null),e.setViewport(s.x,s.y,s.width,s.height)}unload(){if(Object(o["k"])(this._powerOfTwoStretchInfo)){const{framebuffer:e,vao:t,sourceTexture:i}=this._powerOfTwoStretchInfo;t.dispose(!0),i.dispose(),e.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(Object(o["k"])(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),Object(o["k"])(this._loadingController)){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}}se.DDS_ENCODING="image/vnd-ms.dds",se.KTX2_ENCODING="image/ktx2",se.BASIS_ENCODING="image/x.basis",function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(te||(te={}))},"1f1c":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.visualizer=e.visualizer}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}}},"1f93":function(e,t,i){"use strict";i.d(t,"a",(function(){return C})),i.d(t,"b",(function(){return D}));var r=i("b0ea"),n=i("02f1"),a=i("0fc4"),s=i("a05b"),o=i("b2b2");class c{constructor(){this.enabled=!0,this._time=0}get time(){return Object(r["a"])(this._time)}advance(e){return Object(o["k"])(e.forcedTime)?this._time!==e.forcedTime&&(this._time=e.forcedTime,!0):!(!this.enabled||0===e.dt)&&(this._time+=e.dt,!0)}}var l=i("b061"),h=i("35b3"),d=i("7438"),u=i("badc"),p=i("b7c2"),b=i("d7f7"),f=i("a4ee"),g=i("3c9c"),O=i("a7d7"),m=i("6a21"),v=i("c3a4"),_=i("ca98"),j=i("da35"),y=i("fa1e"),x=i("c829"),S=i("6d35"),T=i("ea44"),w=i("189c");class M extends _["a"]{constructor(e,t,i){super(e,t,i),this._textureRepository=e.waterTextureRepository}initializeConfiguration(e,t){t.spherical=e.viewingMode===g["a"].Global,t.doublePrecisionRequiresObfuscation=Object(m["b"])(e.rctx)}initializeProgram(e){const t=M.shader.get().build(this.configuration);return new x["a"](e.rctx,t,y["a"])}bindPass(e,t){this.program.bindPass(e,t),this.configuration.output!==s["a"].Color&&this.configuration.output!==s["a"].Normal||this._textureRepository.bind(this.program)}_setPipelineState(e){const t=this.configuration,i=e===p["i"].NONE,r=e===p["i"].FrontFace;return Object(w["f"])({blending:t.output!==s["a"].Normal&&t.output!==s["a"].Highlight&&t.transparent?i?d["d"]:Object(d["f"])(e):null,depthTest:{func:Object(d["g"])(e)},depthWrite:i?t.writeDepth&&w["d"]:Object(d["h"])(e),colorWrite:w["c"],polygonOffset:i||r?null:Object(d["e"])(t.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}M.shader=new v["a"](T["a"],()=>i.e("chunk-2d0a5169").then(i.bind(null,"08e0")));class A extends S["a"]{constructor(){super(...arguments),this.output=s["a"].Color,this.transparencyPassType=p["i"].NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}Object(f["a"])([Object(j["b"])({count:s["a"].COUNT})],A.prototype,"output",void 0),Object(f["a"])([Object(j["b"])({count:p["i"].COUNT})],A.prototype,"transparencyPassType",void 0),Object(f["a"])([Object(j["b"])()],A.prototype,"spherical",void 0),Object(f["a"])([Object(j["b"])()],A.prototype,"receiveShadows",void 0),Object(f["a"])([Object(j["b"])()],A.prototype,"hasSlicePlane",void 0),Object(f["a"])([Object(j["b"])()],A.prototype,"transparent",void 0),Object(f["a"])([Object(j["b"])()],A.prototype,"enableOffset",void 0),Object(f["a"])([Object(j["b"])()],A.prototype,"writeDepth",void 0),Object(f["a"])([Object(j["b"])()],A.prototype,"hasScreenSpaceReflections",void 0),Object(f["a"])([Object(j["b"])()],A.prototype,"doublePrecisionRequiresObfuscation",void 0),Object(f["a"])([Object(j["b"])()],A.prototype,"hasCloudsReflections",void 0),Object(f["a"])([Object(j["b"])()],A.prototype,"isDraped",void 0),Object(f["a"])([Object(j["b"])()],A.prototype,"hasMultipassTerrain",void 0),Object(f["a"])([Object(j["b"])()],A.prototype,"cullAboveGround",void 0),Object(f["a"])([Object(j["b"])({constValue:O["a"].Water})],A.prototype,"pbrMode",void 0),Object(f["a"])([Object(j["b"])({constValue:!0})],A.prototype,"useCustomDTRExponentForWater",void 0),Object(f["a"])([Object(j["b"])({constValue:!0})],A.prototype,"highStepCount",void 0),Object(f["a"])([Object(j["b"])({constValue:!1})],A.prototype,"useFillLights",void 0);class E extends b["a"]{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const t=Object(o["k"])(e.clouds.data);t!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:t})}ensureResources(e){const t=this._techniqueRepository.constructionContext.waterTextureRepository;return t.resourceState===p["g"].NOT_LOADED&&t.loadTextures(e),t.resourceState}beginSlot(e){return this._output===s["a"].Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this.ensureTechnique(M,e)}}var R=i("8675"),P=i("7c51");class C extends h["a"]{constructor(e){super(e,new D),this._techniqueConfig=new A,this.animation=new c}getConfiguration(e,t){return this._techniqueConfig.output=e,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._techniqueConfig.hasCloudsReflections=this.parameters.hasCloudsReflections,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=t.transparencyPassType,this._techniqueConfig.enableOffset=t.camera.relativeElevation<d["b"],this._techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this._techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this._techniqueConfig}update(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<I;const i=this.animation.advance(e);return this.setParameters({timeElapsed:Object(r["b"])(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}intersect(e,t,i,r,n,a,s){Object(P["e"])(e,t,r,n,a,void 0,s)}requiresSlot(e,t){switch(Object(l["b"])(t)){case s["a"].Normal:return e===u["a"].DRAPED_WATER;case s["a"].Color:if(this.parameters.isDraped)return e===u["a"].DRAPED_MATERIAL;break;case s["a"].Highlight:return e===u["a"].OPAQUE_MATERIAL||e===u["a"].DRAPED_MATERIAL}let i=u["a"].OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?u["a"].TRANSPARENT_MATERIAL:u["a"].TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){if(e.output===s["a"].Color&&this.parameters.isDraped)return e.output=s["a"].Draped,new E(e);switch(e.output){case s["a"].Color:case s["a"].Normal:case s["a"].Highlight:case s["a"].Alpha:return new E(e)}return null}createBufferWriter(){return new R["a"](R["d"])}}class D extends h["b"]{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Object(n["g"])(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Object(a["g"])(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}}const I=35e3},"1fe9":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("62ae"),n=i("52b2");class a extends r["a"]{constructor(e,t){super(e,"float",n["a"].Pass,(i,r,n)=>i.setUniform1f(e,t(r,n)))}}},2119:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("2ab7");class n{constructor(e){this.allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&Object(r["a"])(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*a);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,a));e++)this._items.push(this.allocator())}}const a=1024},2245:function(e,t,i){"use strict";i.d(t,"a",(function(){return T})),i.d(t,"b",(function(){return S}));var r=i("e431"),n=i("0b2d"),a=i("2bc9"),s=i("38a4");function o(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t[r];return i}function c(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t;return i}function l(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]+t[r];return i}function h(e){return(e+1)*(e+1)}function d(e){return Object(s["e"])(Math.floor(Math.sqrt(e)-1),0,2)}function u(e,t,i){const r=e[0],n=e[1],a=e[2],s=i||[];return s.length=h(t),t>=0&&(s[0]=.28209479177),t>=1&&(s[1]=.4886025119*r,s[2]=.4886025119*a,s[3]=.4886025119*n),t>=2&&(s[4]=1.09254843059*r*n,s[5]=1.09254843059*n*a,s[6]=.31539156525*(3*a*a-1),s[7]=1.09254843059*r*a,s[8]=.54627421529*(r*r-n*n)),s}function p(e,t){const i=h(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let n=0;n<i;n++)r.r[n]=r.g[n]=r.b[n]=0;return r}function b(e,t){const i=d(t.r.length);for(const n of e)Object(r["s"])(y,n.direction),u(y,i,_),o(_,x),c(_,n.intensity[0],j),l(t.r,j),c(_,n.intensity[1],j),l(t.g,j),c(_,n.intensity[2],j),l(t.b,j);return t}function f(e,t){u(y,0,_);for(const i of e)t.r[0]+=_[0]*x[0]*i.intensity[0]*4*Math.PI,t.g[0]+=_[0]*x[0]*i.intensity[1]*4*Math.PI,t.b[0]+=_[0]*x[0]*i.intensity[2]*4*Math.PI;return t}function g(e,t,i,n){p(t,n),Object(r["w"])(i.intensity,0,0,0);let s=!1;const o=O,c=m,h=v;o.length=0,c.length=0,h.length=0;for(const l of e)l instanceof a["c"]&&!s?(Object(r["g"])(i.direction,l.direction),Object(r["g"])(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof a["c"]||l instanceof a["b"]?o.push(l):l instanceof a["a"]?c.push(l):l instanceof a["d"]&&h.push(l);b(o,n),f(c,n);for(const r of h)l(n.r,r.r),l(n.g,r.g),l(n.b,r.b)}const O=[],m=[],v=[],_=[0],j=[0],y=Object(n["f"])(),x=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],S=.4;class T{constructor(){this._shOrder=2,this._oldSunlight={direction:Object(n["f"])(),ambient:{color:Object(n["f"])(),intensity:1},diffuse:{color:Object(n["f"])(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new a["d"],this._mainLight={intensity:Object(n["f"])(),direction:Object(n["h"])(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}get lightingMainDirection(){return this._mainLight.direction}set(e){g(e,this._shOrder,this._mainLight,this._sphericalHarmonics),Object(r["g"])(this._oldSunlight.direction,this._mainLight.direction);const t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,Object(r["k"])(this._oldSunlight.diffuse.color,this._mainLight.intensity,t),Object(r["g"])(w,this._oldSunlight.diffuse.color),Object(r["k"])(w,w,S*this.globalFactor),Object(r["e"])(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,w)}get old(){return this._oldSunlight}}const w=Object(n["f"])()},2252:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("8e97"),n=i("1fe9"),a=i("3886");function s(e,t){if(!t.screenSizeEnabled)return;const i=e.vertex;Object(r["a"])(i,t),i.uniforms.add(new n["a"]("perScreenPixelRatio",(e,t)=>t.camera.perScreenPixelRatio)),i.uniforms.add(new n["a"]("screenSizeScale",e=>e.screenSizeScale)),i.code.add(a["b"]`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance * perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;
}`)}},2698:function(e,t,i){"use strict";function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,"a",(function(){return r}))},2765:function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Geometry=2]="Geometry",e[e.Material=3]="Material",e[e.Texture=4]="Texture",e[e.COUNT=5]="COUNT"}(r||(r={}))},2906:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i("e431"),n=i("0b2d"),a=i("7577"),s=i("0fc4"),o=i("a7d7"),c=i("ea32"),l=i("fd48"),h=i("3886");function d(e,t){const i=e.fragment,n=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===n?(i.uniforms.add(new c["a"]("lightingAmbientSH0",(e,t)=>Object(r["w"])(u,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0]))),i.code.add(h["b"]`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===n?(i.uniforms.add([new l["a"]("lightingAmbientSH_R",(e,t)=>Object(a["l"])(p,t.lighting.sh.r[0],t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3])),new l["a"]("lightingAmbientSH_G",(e,t)=>Object(a["l"])(p,t.lighting.sh.g[0],t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3])),new l["a"]("lightingAmbientSH_B",(e,t)=>Object(a["l"])(p,t.lighting.sh.b[0],t.lighting.sh.b[1],t.lighting.sh.b[2],t.lighting.sh.b[3]))]),i.code.add(h["b"]`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===n&&(i.uniforms.add([new c["a"]("lightingAmbientSH0",(e,t)=>Object(r["w"])(u,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0])),new l["a"]("lightingAmbientSH_R1",(e,t)=>Object(a["l"])(p,t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3],t.lighting.sh.r[4])),new l["a"]("lightingAmbientSH_G1",(e,t)=>Object(a["l"])(p,t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3],t.lighting.sh.g[4])),new l["a"]("lightingAmbientSH_B1",(e,t)=>Object(a["l"])(p,t.lighting.sh.b[1],t.lighting.sh.b[2],t.lighting.sh.b[3],t.lighting.sh.b[4])),new l["a"]("lightingAmbientSH_R2",(e,t)=>Object(a["l"])(p,t.lighting.sh.r[5],t.lighting.sh.r[6],t.lighting.sh.r[7],t.lighting.sh.r[8])),new l["a"]("lightingAmbientSH_G2",(e,t)=>Object(a["l"])(p,t.lighting.sh.g[5],t.lighting.sh.g[6],t.lighting.sh.g[7],t.lighting.sh.g[8])),new l["a"]("lightingAmbientSH_B2",(e,t)=>Object(a["l"])(p,t.lighting.sh.b[5],t.lighting.sh.b[6],t.lighting.sh.b[7],t.lighting.sh.b[8]))]),i.code.add(h["b"]`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==o["a"].Normal&&t.pbrMode!==o["a"].Schematic||i.code.add(h["b"]`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const u=Object(n["f"])(),p=Object(s["e"])()},"2aad":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("3886"),n=i("b7bd");function a(e,t=!0){e.attributes.add(n["a"].POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(r["b"]`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?r["b"]`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}},"2bc9":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return o}));var r=i("0b2d");class n{constructor(e=Object(r["f"])()){this.intensity=e}}class a{constructor(e=Object(r["f"])(),t=Object(r["h"])(.57735,.57735,.57735)){this.intensity=e,this.direction=t}}class s{constructor(e=Object(r["f"])(),t=Object(r["h"])(.57735,.57735,.57735),i=!0,n=1,a=1){this.intensity=e,this.direction=t,this.castShadows=i,this.specularStrength=n,this.environmentStrength=a}}class o{constructor(){this.r=[0],this.g=[0],this.b=[0]}}},"2c8f":function(e,t,i){"use strict";i.d(t,"a",(function(){return v}));var r=i("ce6d"),n=i("b2b2"),a=i("6ae9"),s=i("8bbe");class o{constructor(e,t,i){this.editGeometry=e,this.component=t,this.pos=i,this.addedVertex=null,this.originalEdge=null,this.left=null,this.right=null}apply(){let e="redo";Object(n["j"])(this.addedVertex)&&(e="apply",this.addedVertex=new a["d"](this.component));const t=this.component.getLastVertex();if(Object(n["j"])(t))this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,this.addedVertex.index=0;else{let e=null;t.rightEdge&&(this.originalEdge=t.rightEdge,e=this.originalEdge.rightVertex,this.component.edges.splice(this.component.edges.indexOf(this.originalEdge),1)),this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,Object(n["j"])(this.left)&&(this.left=new a["b"](this.component,t,this.addedVertex)),this.component.edges.push(this.left),t.rightEdge=this.left,Object(n["k"])(this.originalEdge)&&Object(n["k"])(e)&&(Object(n["j"])(this.right)&&(this.right=new a["b"](this.component,this.addedVertex,e)),this.component.edges.push(this.right),e.leftEdge=this.right),this.component.updateVertexIndex(this.addedVertex,t.index+1)}this.editGeometry.notifyChanges({operation:e,addedVertices:[this.addedVertex]})}undo(){if(Object(n["j"])(this.addedVertex))return null;this.component.vertices.splice(this.component.vertices.indexOf(this.addedVertex),1),Object(n["k"])(this.left)&&(this.component.edges.splice(this.component.edges.indexOf(this.left),1),this.left.leftVertex.rightEdge=null),Object(n["k"])(this.right)&&(this.component.edges.splice(this.component.edges.indexOf(this.right),1),this.right.rightVertex.leftEdge=null),Object(n["k"])(this.originalEdge)&&(this.component.edges.push(this.originalEdge),this.originalEdge.leftVertex.rightEdge=this.originalEdge,this.originalEdge.rightVertex.leftEdge=this.originalEdge),Object(n["k"])(this.left)?this.component.updateVertexIndex(this.left.leftVertex,this.left.leftVertex.index):this.component.updateVertexIndex(this.addedVertex,0),this.editGeometry.notifyChanges({operation:"undo",removedVertices:[this.addedVertex]})}accumulate(){return!1}}var c=i("34f2");class l{constructor(e,t,i=0){this.editGeometry=e,this.vertices=t,this.minNumberOfVertices=i,this.removedVertices=null}apply(){let e="redo";null==this.removedVertices?(this.removedVertices=[],this.vertices.forEach(e=>{const t=this._removeVertex(e);Object(n["k"])(t)&&this.removedVertices.push(t)}),e="apply"):this.removedVertices.forEach(e=>{this._removeVertex(e.removedVertex)}),this.editGeometry.notifyChanges({operation:e,removedVertices:this.vertices})}undo(){this.removedVertices.forEach(e=>{this._undoRemoveVertex(e)}),this.editGeometry.notifyChanges({operation:"undo",addedVertices:this.vertices})}accumulate(){return!1}_removeVertex(e){const t=e.component;if(t.vertices.length<=this.minNumberOfVertices)return null;const i={removedVertex:e,createdEdge:null},r=e.leftEdge,n=e.rightEdge;return t.vertices.splice(t.vertices.indexOf(e),1),r&&(t.edges.splice(t.edges.indexOf(r),1),r.leftVertex.rightEdge=null),n&&(t.edges.splice(t.edges.indexOf(n),1),n.rightVertex.leftEdge=null),0===e.index&&n&&this.vertices.length>0&&t.swapVertices(t.vertices.indexOf(n.rightVertex),0),r&&n&&(i.createdEdge=new a["b"](t,r.leftVertex,n.rightVertex),t.edges.push(i.createdEdge)),n&&t.updateVertexIndex(n.rightVertex,n.rightVertex.index-1),i}_undoRemoveVertex(e){const t=e.removedVertex,i=e.removedVertex.component,r=t.leftEdge,n=t.rightEdge;e.createdEdge&&i.edges.splice(i.edges.indexOf(e.createdEdge),1),i.vertices.push(t),r&&(i.edges.push(r),r.leftVertex.rightEdge=r),n&&(i.edges.push(n),n.rightVertex.leftEdge=n),i.updateVertexIndex(t,t.index)}}class h{constructor(e,t,i){this.editGeometry=e,this.edge=t,this.t=i,this.createdVertex=null,this.left=null,this.right=null}apply(){let e="redo";const t=this.edge,i=t.component,r=t.leftVertex,s=t.rightVertex;i.edges.splice(i.edges.indexOf(t),1),Object(n["j"])(this.createdVertex)&&(e="apply",this.createdVertex=new a["d"](t.component)),i.vertices.push(this.createdVertex),this.createdVertex.pos=this.editGeometry.coordinateHelper.lerp(t.leftVertex.pos,t.rightVertex.pos,this.t,this.editGeometry.coordinateHelper.createVector()),Object(n["j"])(this.left)&&(this.left=new a["b"](i,r,this.createdVertex)),this.left.leftVertex.leftEdge?i.edges.push(this.left):i.edges.unshift(this.left),r.rightEdge=this.left,Object(n["j"])(this.right)&&(this.right=new a["b"](i,this.createdVertex,s)),i.edges.push(this.right),s.leftEdge=this.right,i.updateVertexIndex(this.createdVertex,r.index+1),this.editGeometry.notifyChanges({operation:e,addedVertices:[this.createdVertex]})}undo(){if(Object(n["j"])(this.createdVertex)||Object(n["j"])(this.left)||Object(n["j"])(this.right))return null;const e=this.edge,t=e.component,i=this.createdVertex.leftEdge,r=this.createdVertex.rightEdge,a=i.leftVertex,s=r.rightVertex;t.vertices.splice(t.vertices.indexOf(this.createdVertex),1),t.edges.splice(t.edges.indexOf(this.left),1),t.edges.splice(t.edges.indexOf(this.right),1),this.edge.leftVertex.leftEdge?t.edges.push(this.edge):t.edges.unshift(this.edge),a.rightEdge=e,s.leftEdge=e,t.updateVertexIndex(a,a.index),this.editGeometry.notifyChanges({operation:"undo",removedVertices:[this.createdVertex]})}accumulate(){return!1}}class d{constructor(e,t,i){this.editGeometry=e,this.vertex=t,this.pos=i}apply(){const e=Object(n["j"])(this.originalPosition);e&&(this.originalPosition=this.vertex.pos),this._apply(e?"apply":"redo")}undo(){this.vertex.pos=Object(n["r"])(this.originalPosition),this.editGeometry.notifyChanges({operation:"undo",updatedVertices:[this.vertex]})}accumulate(e){return e instanceof d&&e.vertex===this.vertex&&(this.pos=e.pos,this._apply("apply"),!0)}_apply(e){this.vertex.pos=this.pos,this.editGeometry.components.forEach(e=>e.unnormalizeVertexPositions()),this.editGeometry.notifyChanges({operation:e,updatedVertices:[this.vertex]})}}var u=i("b50f");class p{constructor(e,t){this.editGeometry=e,this.component=t,this.createdEdge=null}apply(){let e="redo";if(Object(n["j"])(this.createdEdge)){e="apply";const t=this.component.getFirstVertex(),i=this.component.getLastVertex();if(this.component.isClosed()||this.component.vertices.length<3||Object(n["j"])(t)||Object(n["j"])(i))return;this.createdEdge=new a["b"](this.component,i,t)}this.createdEdge.leftVertex.rightEdge=this.createdEdge,this.createdEdge.rightVertex.leftEdge=this.createdEdge,this.component.edges.push(this.createdEdge),this.editGeometry.notifyChanges({operation:e})}undo(){Object(n["j"])(this.createdEdge)||(Object(u["h"])(this.component.edges,this.createdEdge),this.createdEdge.leftVertex.rightEdge=null,this.createdEdge.rightVertex.leftEdge=null,this.editGeometry.notifyChanges({operation:"undo"}))}accumulate(){return!1}}var b=i("157c"),f=i("5414"),g=i("e1e0"),O=i("fbd0");class m{constructor(){this.operations=[],this.closed=!1}close(){this.closed=!0}apply(){for(const e of this.operations)e.apply()}undo(){for(let e=this.operations.length-1;e>=0;e--)this.operations[e].undo()}accumulate(e){if(this.closed)return!1;const t=this.operations.length?this.operations[this.operations.length-1]:null;return t&&t.accumulate(e)||(this.operations.push(e),e.apply()),!0}}class v extends r["a"]{constructor(e){super(),this.data=e,this.undoStack=[],this.redoStack=[],this.listener=this.data.on("change",e=>{e.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:e.addedVertices,operation:e.operation}),e.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:e.removedVertices,operation:e.operation}),e.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:e.updatedVertices,operation:e.operation})})}destroy(){this.listener.remove()}splitEdge(e,t){return this._apply(new h(this.data,e,t))}updateVertices(e,t,i=s["a"].ACCUMULATE_STEPS){return this._apply(new c["b"](this.data,e,t),i)}moveVertices(e,t,i,r,n=s["a"].ACCUMULATE_STEPS){return this.updateVertices(e,new b["a"](this.data.coordinateHelper,t,i,r),n)}scaleVertices(e,t,i,r,n,a=s["a"].ACCUMULATE_STEPS,o=c["a"].CUMULATIVE){return this.updateVertices(e,new O["a"](t,i,r,n,o),a)}rotateVertices(e,t,i,r=s["a"].ACCUMULATE_STEPS,n=c["a"].CUMULATIVE){return this.updateVertices(e,new g["a"](t,i,n),r)}removeVertices(e){return this._apply(new l(this.data,e,this._minNumVerticesPerType))}appendVertex(e){return 0===this.data.components.length?null:this._apply(new o(this.data,this.data.components[0],e))}setVertexPosition(e,t){return this._apply(new d(this.data,e,t))}offsetEdge(e,t,i,r=s["a"].ACCUMULATE_STEPS){return this.updateVertices([t.leftVertex,t.rightVertex],new f["a"](this.data.coordinateHelper,e,t,i),r)}closeComponent(e){return this.data.components.includes(e)?this._apply(new p(this.data,e)):null}canRemoveVertex(){return this.data.components[0].vertices.length>this._minNumVerticesPerType}createUndoGroup(){const e=new m;return this._apply(e),{remove:()=>e.close()}}undo(){if(this.undoStack.length>0){const e=this.undoStack.pop();return e.undo(),this.redoStack.push(e),e}return null}redo(){if(this.redoStack.length>0){const e=this.redoStack.pop();return e.apply(),this.undoStack.push(e),e}return null}get canUndo(){return this.undoStack.length>0}get canRedo(){return this.redoStack.length>0}get lastOperation(){return this.undoStack.length>0?this.undoStack[this.undoStack.length-1]:null}get _minNumVerticesPerType(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}_apply(e,t=s["a"].ACCUMULATE_STEPS){return t!==s["a"].NEW_STEP&&!Object(n["j"])(this.lastOperation)&&this.lastOperation.accumulate(e)||(e.apply(),this.undoStack.push(e),this.redoStack=[]),e}static fromGeometry(e,t){return new v(a["c"].fromGeometry(e,t))}}},"2ca8":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("62ae"),n=i("52b2");class a extends r["a"]{constructor(e,t){super(e,"bool",n["a"].Pass,(i,r,n)=>i.setUniform1b(e,t(r,n)))}}},"2db0":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("2eab");async function n(e,t){const{data:i}=await Object(r["default"])(e,{responseType:"image",...t});return i}},"2df1":function(e,t,i){"use strict";i.d(t,"a",(function(){return X}));var r=i("38a4"),n=i("b2b2"),a=i("1c92"),s=i("dae5"),o=i("d791"),c=i("afe1"),l=i("3349"),h=i("02f1"),d=i("e431"),u=i("0b2d"),p=i("0fc4");function b(e){return e instanceof Float32Array&&e.length>=16}function f(e){return Array.isArray(e)&&e.length>=16}function g(e){return b(e)||f(e)}var O=i("9180"),m=i("fc00"),v=i("a05b"),_=i("d0cb"),j=i("1038"),y=i("e93d"),x=i("35b3"),S=i("badc"),T=i("da1c"),w=i("1153"),M=i("b7bd"),A=i("5957"),E=i("7c51"),R=i("b623"),P=i("0d96"),C=i("3c9c"),D=i("c3a4"),I=i("ca98"),L=i("b7c2"),N=i("fa1e"),z=i("7438"),V=i("c829"),F=i("d17d"),G=i("189c");class k extends I["a"]{initializeConfiguration(e,t){t.spherical=e.viewingMode===C["a"].Global}initializeProgram(e){const t=k.shader.get().build(this.configuration);return new V["a"](e.rctx,t,N["a"])}_setPipelineState(e){const t=this.configuration,i=e===L["i"].NONE,r=e===L["i"].FrontFace,n=this.configuration.hasPolygonOffset&&U,a=(i||r)&&t.output!==v["a"].Highlight?(t.depthEnabled||t.output===v["a"].Occlusion)&&G["d"]:null;return Object(G["f"])({blending:t.output===v["a"].Color||t.output===v["a"].Alpha||t.output===v["a"].Highlight?i?H:Object(z["f"])(e):null,depthTest:{func:F["h"].LEQUAL},depthWrite:a,colorWrite:G["c"],polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.output===v["a"].Occlusion?F["r"].POINTS:F["r"].TRIANGLES}}k.shader=new D["a"](P["a"],()=>i.e("chunk-2d0db7d8").then(i.bind(null,"6fa3")));const U={factor:0,units:-4},H=Object(G["h"])(F["b"].ONE,F["b"].ONE_MINUS_SRC_ALPHA);var B=i("a4ee"),W=i("da35"),q=i("6d35");class Z extends q["a"]{constructor(){super(...arguments),this.output=v["a"].Color,this.screenCenterOffsetUnitsEnabled=_["b"].World,this.transparencyPassType=L["i"].NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}Object(B["a"])([Object(W["b"])({count:v["a"].COUNT})],Z.prototype,"output",void 0),Object(B["a"])([Object(W["b"])({count:_["b"].COUNT})],Z.prototype,"screenCenterOffsetUnitsEnabled",void 0),Object(B["a"])([Object(W["b"])({count:L["i"].COUNT})],Z.prototype,"transparencyPassType",void 0),Object(B["a"])([Object(W["b"])()],Z.prototype,"spherical",void 0),Object(B["a"])([Object(W["b"])()],Z.prototype,"occlusionTestEnabled",void 0),Object(B["a"])([Object(W["b"])()],Z.prototype,"signedDistanceFieldEnabled",void 0),Object(B["a"])([Object(W["b"])()],Z.prototype,"vvSize",void 0),Object(B["a"])([Object(W["b"])()],Z.prototype,"vvColor",void 0),Object(B["a"])([Object(W["b"])()],Z.prototype,"hasVerticalOffset",void 0),Object(B["a"])([Object(W["b"])()],Z.prototype,"hasScreenSizePerspective",void 0),Object(B["a"])([Object(W["b"])()],Z.prototype,"debugDrawLabelBorder",void 0),Object(B["a"])([Object(W["b"])()],Z.prototype,"binaryHighlightOcclusionEnabled",void 0),Object(B["a"])([Object(W["b"])()],Z.prototype,"hasSlicePlane",void 0),Object(B["a"])([Object(W["b"])()],Z.prototype,"hasPolygonOffset",void 0),Object(B["a"])([Object(W["b"])()],Z.prototype,"depthEnabled",void 0),Object(B["a"])([Object(W["b"])()],Z.prototype,"pixelSnappingEnabled",void 0),Object(B["a"])([Object(W["b"])()],Z.prototype,"isDraped",void 0),Object(B["a"])([Object(W["b"])()],Z.prototype,"hasMultipassGeometry",void 0),Object(B["a"])([Object(W["b"])()],Z.prototype,"hasMultipassTerrain",void 0),Object(B["a"])([Object(W["b"])()],Z.prototype,"cullAboveGround",void 0),Object(B["a"])([Object(W["b"])({constValue:!0})],Z.prototype,"hasSliceInVertexProgram",void 0),Object(B["a"])([Object(W["b"])({constValue:!1})],Z.prototype,"hasVvInstancing",void 0);class X extends x["a"]{constructor(e){super(e,new Oe),this.techniqueConfig=new Z}getConfiguration(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasVerticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?_["b"].Screen:_["b"].World,this.techniqueConfig.hasPolygonOffset=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,e===v["a"].Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),e===v["a"].Highlight&&(this.techniqueConfig.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.hasMultipassGeometry=t.multipassGeometry.enabled,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,a,s,o,c,l){Object(n["k"])(l)?this._intersectDrapedHudGeometry(e,s,o,c,l):this._intersectHudGeometry(e,t,i,r,o,c)}_intersectDrapedHudGeometry(e,t,i,r,a){const s=e.vertexAttributes.get(M["a"].POSITION),o=e.vertexAttributes.get(M["a"].SIZE),c=this.parameters,l=Object(P["c"])(c);let h=1,d=1;if(Object(n["k"])(r)){const e=r(ue);h=e[0],d=e[5]}h*=e.screenToWorldRatio,d*=e.screenToWorldRatio;const u=be*e.screenToWorldRatio;for(let n=0;n<s.data.length/s.size;n++){const r=n*s.size,p=s.data[r],b=s.data[r+1],f=n*o.size;let g;fe[0]=o.data[f]*h,fe[1]=o.data[f+1]*d,c.textureIsSignedDistanceField&&(g=c.outlineSize*e.screenToWorldRatio/2),K(t,p,b,fe,u,g,c,l)&&i(a.dist,a.normal,-1,!1)}}_intersectHudGeometry(e,t,i,r,s,c){if(!r.options.selectionMode||!r.options.hud||Object(R["d"])(t))return;const l=this.parameters;let h=1,p=1;if(Object(a["f"])(oe,i),Object(n["k"])(c)){const e=c(ue);h=e[0],p=e[5],J(oe)}const b=e.vertexAttributes.get(M["a"].POSITION),f=e.vertexAttributes.get(M["a"].SIZE),g=e.vertexAttributes.get(M["a"].NORMAL),O=e.vertexAttributes.get(M["a"].AUXPOS1);Object(w["a"])(b.size>=3);const m=r.point,v=r.camera,_=Object(P["c"])(l);h*=v.pixelRatio,p*=v.pixelRatio;const j="screen"===this.parameters.centerOffsetUnits;for(let n=0;n<b.data.length/b.size;n++){const e=n*b.size;Object(d["w"])(ie,b.data[e],b.data[e+1],b.data[e+2]),Object(d["q"])(ie,ie,i);const t=n*f.size;fe[0]=f.data[t]*h,fe[1]=f.data[t+1]*p,Object(d["q"])(ie,ie,v.viewMatrix);const a=n*O.size;if(Object(d["w"])(he,O.data[a+0],O.data[a+1],O.data[a+2]),!j&&(ie[0]+=he[0],ie[1]+=he[1],0!==he[2])){const e=he[2];Object(d["r"])(he,ie),Object(d["f"])(ie,ie,Object(d["k"])(he,he,e))}const c=n*g.size;if(Object(d["w"])(re,g.data[c],g.data[c+1],g.data[c+2]),this._normalAndViewAngle(re,oe,v,de),this._applyVerticalOffsetTransformationView(ie,de,v,ee),v.applyProjection(ie,ne),ne[0]>-1){ne[0]=Math.floor(ne[0]),ne[1]=Math.floor(ne[1]),j&&(he[0]||he[1])&&(ne[0]+=he[0],0!==he[1]&&(ne[1]+=Object(T["b"])(he[1],ee.factorAlignment)),v.unapplyProjection(ne,ie)),ne[0]+=this.parameters.screenOffset[0],ne[1]+=this.parameters.screenOffset[1],Object(T["a"])(fe,ee.factor,fe);const e=pe*v.pixelRatio;let t;if(l.textureIsSignedDistanceField&&(t=l.outlineSize*v.pixelRatio/2),K(m,ne[0],ne[1],fe,e,t,l,_)){const e=r.ray;if(Object(d["q"])(se,ie,Object(o["a"])(le,v.viewMatrix)),ne[0]=m[0],ne[1]=m[1],v.unprojectFromRenderScreen(ne,ie)){const t=Object(u["f"])();Object(d["g"])(t,e.direction);const i=1/Object(d["p"])(t);Object(d["k"])(t,t,i),s(Object(d["m"])(e.origin,ie)*i,t,-1,!0,1,se)}}}}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;const r=i.get(M["a"].POSITION),n=e.indices.get(M["a"].POSITION);return Object(j["b"])(r,n,t)}createBufferWriter(){return new ve(this)}_normalAndViewAngle(e,t,i,r){return g(t)&&(t=Object(a["f"])(ce,t)),Object(d["x"])(r.normal,e,t),Object(d["q"])(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=Object(d["i"])(ae,ge),r}_updateScaleInfo(e,t,i){const r=this.parameters;Object(n["k"])(r.screenSizePerspective)?Object(T["c"])(i,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),Object(n["k"])(r.screenSizePerspectiveAlignment)?Object(T["c"])(i,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,t,i,r,n,a,s){const o=this._normalAndViewAngle(t,i,n,de);return this._applyVerticalGroundOffsetView(e,o,n,s),this._applyVerticalOffsetTransformationView(s,o,n,a),this._applyPolygonOffsetView(s,o,r[3],n,s),this._applyCenterOffsetView(s,r,s),s}applyShaderOffsetsNDC(e,t,i,r,a){return this._applyCenterOffsetNDC(e,t,i,r),Object(n["k"])(a)&&Object(d["g"])(a,r),this._applyPolygonOffsetNDC(r,t,i,r),r}_applyPolygonOffsetView(e,t,i,n,a){const s=n.aboveGround?1:-1;let o=Math.sign(i);0===o&&(o=s);const c=s*o;if(this.parameters.shaderPolygonOffset<=0)return Object(d["g"])(a,e);const l=Object(r["e"])(Math.abs(t.cosAngle),.01,1),h=1-Math.sqrt(1-l*l)/l/n.viewport[2];return Object(d["k"])(a,e,c>0?h:1/h),a}_applyVerticalGroundOffsetView(e,t,i,r){const n=Object(d["p"])(e),a=i.aboveGround?1:-1,s=.5*i.computeRenderPixelSizeAtDist(n),o=Object(d["k"])(ie,t.normal,a*s);return Object(d["e"])(r,e,o),r}_applyVerticalOffsetTransformationView(e,t,i,r){const a=this.parameters;if(!a.verticalOffset||!a.verticalOffset.screenLength){if(a.screenSizePerspective||a.screenSizePerspectiveAlignment){const i=Object(d["p"])(e);this._updateScaleInfo(r,i,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}const s=Object(d["p"])(e),o=Object(n["s"])(a.screenSizePerspectiveAlignment,a.screenSizePerspective),c=Object(E["h"])(i,s,a.verticalOffset,t.cosAngle,o);return this._updateScaleInfo(r,s,t.cosAngle),Object(d["k"])(t.normal,t.normal,c),Object(d["e"])(e,e,t.normal)}_applyCenterOffsetView(e,t,i){const r="screen"!==this.parameters.centerOffsetUnits;return i!==e&&Object(d["g"])(i,e),r&&(i[0]+=t[0],i[1]+=t[1],t[2]&&(Object(d["r"])(re,i),Object(d["e"])(i,i,Object(d["k"])(re,re,t[2])))),i}_applyCenterOffsetNDC(e,t,i,r){const n="screen"!==this.parameters.centerOffsetUnits;return r!==e&&Object(d["g"])(r,e),n||(r[0]+=t[0]/i.fullWidth*2,r[1]+=t[1]/i.fullHeight*2),r}_applyPolygonOffsetNDC(e,t,i,r){const n=this.parameters.shaderPolygonOffset;if(e!==r&&Object(d["g"])(r,e),n){const e=i.aboveGround?1:-1,a=e*Math.sign(t[3]);r[2]-=(a||e)*n}return r}requiresSlot(e){if(e===S["a"].DRAPED_MATERIAL)return!0;const{drawInSecondSlot:t,occlusionTest:i}=this.parameters;return e===(t?S["a"].LABEL_MATERIAL:S["a"].HUD_MATERIAL)||i&&e===S["a"].OCCLUSION_PIXELS}createGLMaterial(e){return e.output===v["a"].Color||e.output===v["a"].Alpha?new $(e):e.output===v["a"].Highlight?new Y(e):null}calculateRelativeScreenBounds(e,t,i=Object(O["k"])()){return Q(this.parameters,e,t,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}}class Y extends y["a"]{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(k,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}}class $ extends Y{_isOcclusionSlot(e){return e.slot===S["a"].OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&(this._output===v["a"].Color||this._output===v["a"].Alpha)}selectProgram(e){return this.ensureTechnique(k,e,this._isOcclusionSlot(e)?v["a"].Occlusion:this._output)}}function Q(e,t,i,r=te){return Object(l["c"])(r,e.anchorPosition),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i,r}function J(e){const t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],o=e[6],c=e[7],l=e[8],h=1/Math.sqrt(t*t+i*i+r*r),d=1/Math.sqrt(n*n+a*a+s*s),u=1/Math.sqrt(o*o+c*c+l*l);return e[0]=t*h,e[1]=i*h,e[2]=r*h,e[3]=n*d,e[4]=a*d,e[5]=s*d,e[6]=o*u,e[7]=c*u,e[8]=l*u,e}function K(e,t,i,r,a,s,o,c){let l=t-a-(c[0]>0?r[0]*c[0]:0),h=l+r[0]+2*a,d=i-a-(c[1]>0?r[1]*c[1]:0),u=d+r[1]+2*a;const p=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&Object(n["k"])(p)&&(l+=r[0]*p[0],d+=r[1]*p[1],h-=r[0]*(1-p[2]),u-=r[1]*(1-p[3]),l-=s,h+=s,d-=s,u+=s),e[0]>l&&e[0]<h&&e[1]>d&&e[1]<u}const ee={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},te=Object(h["c"])(),ie=Object(u["f"])(),re=Object(u["f"])(),ne=Object(p["e"])(),ae=Object(u["f"])(),se=Object(u["f"])(),oe=Object(s["b"])(),ce=Object(s["b"])(),le=Object(c["d"])(),he=Object(u["f"])(),de={normal:ae,cosAngle:0},ue=Object(c["d"])(),pe=1,be=2,fe=[0,0],ge=Object(u["h"])(0,0,1);class Oe extends y["b"]{constructor(){super(...arguments),this.renderOccluded=x["c"].Occlude,this.color=[1,1,1,1],this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Object(h["g"])(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=[1,1,1,1],this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.debugDrawLabelBorder=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const me=Object(m["a"])().vec3f(M["a"].POSITION).vec3f(M["a"].NORMAL).vec2f(M["a"].UV0).vec4u8(M["a"].COLOR).vec2f(M["a"].SIZE).vec4f(M["a"].AUXPOS1).vec4f(M["a"].AUXPOS2);class ve{constructor(e){this.material=e,this.vertexBufferLayout=me}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(M["a"].POSITION).length}write(e,t,i,r){Object(A["e"])(t.indices.get(M["a"].POSITION),t.vertexAttributes.get(M["a"].POSITION).data,e.transformation,i.position,r,6),Object(A["d"])(t.indices.get(M["a"].NORMAL),t.vertexAttributes.get(M["a"].NORMAL).data,e.invTranspTransformation,i.normal,r,6);{const e=t.vertexAttributes.get(M["a"].UV0).data;let n,a,s,o;if(null==e||e.length<4){const e=this.material.parameters;n=0,a=0,s=e.texCoordScale[0],o=e.texCoordScale[1]}else n=e[0],a=e[1],s=e[2],o=e[3];s=Math.min(1.99999,s+1),o=Math.min(1.99999,o+1);const c=t.indices.get(M["a"].POSITION).length,l=i.uv0;let h=r;for(let t=0;t<c;++t)l.set(h,0,n),l.set(h,1,a),h+=1,l.set(h,0,s),l.set(h,1,a),h+=1,l.set(h,0,s),l.set(h,1,o),h+=1,l.set(h,0,s),l.set(h,1,o),h+=1,l.set(h,0,n),l.set(h,1,o),h+=1,l.set(h,0,n),l.set(h,1,a),h+=1}Object(A["b"])(t.indices.get(M["a"].COLOR),t.vertexAttributes.get(M["a"].COLOR).data,4,i.color,r,6);{const e=t.indices.get(M["a"].SIZE),n=t.vertexAttributes.get(M["a"].SIZE).data,a=e.length,s=i.size;let o=r;for(let t=0;t<a;++t){const i=n[2*e[t]],r=n[2*e[t]+1];for(let e=0;e<6;++e)s.set(o,0,i),s.set(o,1,r),o+=1}}t.indices.get(M["a"].AUXPOS1)&&t.vertexAttributes.get(M["a"].AUXPOS1)&&Object(A["a"])(t.indices.get(M["a"].AUXPOS1),t.vertexAttributes.get(M["a"].AUXPOS1).data,i.auxpos1,r,6),t.indices.get(M["a"].AUXPOS2)&&t.vertexAttributes.get(M["a"].AUXPOS2)&&Object(A["a"])(t.indices.get(M["a"].AUXPOS2),t.vertexAttributes.get(M["a"].AUXPOS2).data,i.auxpos2,r,6)}}},"2e0f":function(e,t,i){"use strict";i.d(t,"a",(function(){return T})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return v})),i.d(t,"d",(function(){return p})),i.d(t,"e",(function(){return g})),i.d(t,"f",(function(){return f})),i.d(t,"g",(function(){return b})),i.d(t,"h",(function(){return O})),i.d(t,"i",(function(){return m}));var r,n=i("6c97"),a=i("b2b2"),s=i("d791"),o=i("afe1"),c=i("0b2d"),l=i("8188"),h=i("84f4"),d=i("ba58"),u=i("0cb9");function p(e,t,i,r,n,a,s,o,c,h,d){const u=w[d.mode];let p,b,f=0;if(Object(l["l"])(e,t,i,r,c.spatialReference,n,o))return u.requiresAlignment(d)?(f=u.applyElevationAlignmentBuffer(r,n,a,s,o,c,h,d),p=a,b=s):(p=r,b=n),Object(l["l"])(p,c.spatialReference,b,a,h.spatialReference,s,o)?f:void 0}function b(e,t,i,r,s){const o=(Object(h["a"])(e)?e.z:Object(u["c"])(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const i=Object(a["s"])(Object(u["b"])(t,e,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=i,void(s.z=i)}case"relative-to-ground":{const n=Object(a["s"])(Object(u["b"])(t,e,"ground"),0),c=i.geometryZWithOffset(o,r);return s.verticalDistanceToGround=c,s.sampledElevation=n,void(s.z=c+n)}case"relative-to-scene":{const n=Object(a["s"])(Object(u["b"])(t,e,"scene"),0),c=i.geometryZWithOffset(o,r);return s.verticalDistanceToGround=c,s.sampledElevation=n,void(s.z=c+n)}case"absolute-height":{const n=i.geometryZWithOffset(o,r),c=Object(a["s"])(Object(u["b"])(t,e,"ground"),0);return s.verticalDistanceToGround=n-c,s.sampledElevation=c,void(s.z=n)}default:return Object(n["a"])(i.mode),void(s.z=0)}}function f(e,t,i,r){return b(e,t,i,r,A),A.z}function g(e,t,i){return null==t||null==i?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===i?e.staysOnTheGround:t===i||"on-the-ground"!==t&&"on-the-ground"!==i?r.UPDATE:e.onTheGroundChanged}function O(e){return"relative-to-ground"===e||"relative-to-scene"===e}function m(e){return"absolute-height"!==e}function v(e,t,i,r,n){b(t,i,n,r,A),Object(d["h"])(e,A.verticalDistanceToGround);const a=A.sampledElevation,o=Object(s["c"])(M,e.transformation);return E[0]=t.x,E[1]=t.y,E[2]=A.z,Object(l["d"])(t.spatialReference,E,o,r.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),a}function _(e,t,i,r,n,s){let o=0;const c=s.spatialReference;t*=3,r*=3;for(let l=0;l<n;++l){const n=e[t+0],l=e[t+1],h=e[t+2],d=Object(a["s"])(s.getElevation(n,l,h,c,"ground"),0);o+=d,i[r+0]=n,i[r+1]=l,i[r+2]=d,t+=3,r+=3}return o/n}function j(e,t,i,r,n,s,o,c){let l=0;const h=c.calculateOffsetRenderUnits(o),d=c.featureExpressionInfoContext,u=s.spatialReference;t*=3,r*=3;for(let p=0;p<n;++p){const n=e[t+0],o=e[t+1],c=e[t+2],p=Object(a["s"])(s.getElevation(n,o,c,u,"ground"),0);l+=p,i[r+0]=n,i[r+1]=o,i[r+2]=null==d?c+p+h:p+h,t+=3,r+=3}return l/n}function y(e,t,i,r,n,s,o,c){let l=0;const h=c.calculateOffsetRenderUnits(o),d=c.featureExpressionInfoContext,u=s.spatialReference;t*=3,r*=3;for(let p=0;p<n;++p){const n=e[t+0],o=e[t+1],c=e[t+2],p=Object(a["s"])(s.getElevation(n,o,c,u,"scene"),0);l+=p,i[r+0]=n,i[r+1]=o,i[r+2]=null==d?c+p+h:p+h,t+=3,r+=3}return l/n}function x(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return 0!==t||null!=i}function S(e,t,i,r,n,a,s,o){const c=o.calculateOffsetRenderUnits(s),l=o.featureExpressionInfoContext;t*=3,r*=3;for(let h=0;h<n;++h){const n=e[t+0],a=e[t+1],s=e[t+2];i[r+0]=n,i[r+1]=a,i[r+2]=null==l?s+c:c,t+=3,r+=3}return 0}class T{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(r||(r={}));const w={"absolute-height":{applyElevationAlignmentBuffer:S,requiresAlignment:x},"on-the-ground":{applyElevationAlignmentBuffer:_,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:j,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:y,requiresAlignment:()=>!0}},M=Object(o["d"])(),A=new T,E=Object(c["f"])()},"2ebb":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("d17d"),n=i("3f3e");function a(e,t=0){const i=e.stride;return e.fieldNames.filter(t=>{const i=e.fields.get(t).optional;return!(i&&i.glPadding)}).map(r=>{const a=e.fields.get(r),o=a.constructor.ElementCount,c=s(a.constructor.ElementType),l=a.offset,h=!(!a.optional||!a.optional.glNormalized);return new n["a"](r,o,c,l,i,h,t)})}function s(e){const t=o[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const o={u8:r["k"].UNSIGNED_BYTE,u16:r["k"].UNSIGNED_SHORT,u32:r["k"].UNSIGNED_INT,i8:r["k"].BYTE,i16:r["k"].SHORT,i32:r["k"].INT,f32:r["k"].FLOAT}},"2f98":function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return l}));var r=i("7577"),n=i("0fc4"),a=i("fd48"),s=i("3886");function o(e){e.vertex.code.add(s["b"]`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(s["b"]`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(s["b"]`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(s["b"]`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(s["b"]`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(s["b"]`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(s["b"]`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function c(e){e.uniforms.add(new a["a"]("screenSizePerspective",e=>h(e.screenSizePerspective)))}function l(e){e.uniforms.add(new a["a"]("screenSizePerspectiveAlignment",e=>h(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function h(e){return Object(r["l"])(d,e.parameters.divisor,e.parameters.offset,e.parameters.minPixelSize,e.paddingPixelsOverride)}const d=Object(n["e"])()},3170:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return m})),i.d(t,"c",(function(){return b})),i.d(t,"d",(function(){return v})),i.d(t,"e",(function(){return f})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return d})),i.d(t,"h",(function(){return _})),i.d(t,"i",(function(){return g}));var r=i("b2b2"),n=i("f315"),a=i("8048"),s=i("e431"),o=i("0b2d"),c=i("8188"),l=i("7f83"),h=i("d245");function d(e){return p(e,"direct")}function u(e){return p(e,"horizontal")}function p(e,t){const{hasZ:i,spatialReference:s}=e,o=Object(h["a"])(s);let c=0;const l=Object(a["n"])(o);if(Object(r["j"])(l))return null;const d="direct"===t?m:v;for(const n of e.paths){if(n.length<2)continue;const e=n.length-1;for(let t=0;t<e;++t){const e=n[t];x[0]=e[0],x[1]=e[1],x[2]=i?e[2]:0;const a=n[t+1];S[0]=a[0],S[1]=a[1],S[2]=i?a[2]:0;const o=d(x,S,s);if(Object(r["j"])(o))return null;c+=o.value}}return Object(n["c"])(c,l)}function b(e,t){const{spatialReference:i}=e;return Object(l["d"])(i,t.spatialReference)?(x[0]=e.x,x[1]=e.y,x[2]=e.hasZ?e.z:0,S[0]=t.x,S[1]=t.y,S[2]=t.hasZ?t.z:0,m(x,S,i)):null}function f(e,t){const{spatialReference:i}=e;return Object(l["d"])(i,t.spatialReference)?(x[0]=e.x,x[1]=e.y,x[2]=e.hasZ?e.z:0,S[0]=t.x,S[1]=t.y,S[2]=t.hasZ?t.z:0,v(x,S,i)):null}function g(e,t){const{spatialReference:i}=e;return Object(l["d"])(i,t.spatialReference)?(x[0]=e.x,x[1]=e.y,x[2]=e.hasZ?e.z:0,S[0]=t.x,S[1]=t.y,S[2]=t.hasZ?t.z:0,_(x,S,i)):null}function O(e){return x[0]=e.x,x[1]=e.y,x[2]=e.hasZ?e.z:0,j(x,e.spatialReference)}function m(e,t,i){const a=y(e,t,i,"direct");return Object(r["k"])(a)?Object(n["c"])(a.direct,a.unit):null}function v(e,t,i){const a=y(e,t,i,"horizontal");return Object(r["k"])(a)?Object(n["c"])(a.horizontal,a.unit):null}function _(e,t,i){const a=y(e,t,i,"vertical");return Object(r["k"])(a)?Object(n["c"])(a.verticalSigned,a.unit):null}function j(e,t){const i=Object(a["z"])(t);return Object(r["k"])(i)?Object(n["c"])(e[2],i):null}function y(e,t,i,n){const o=Object(h["a"])(i),l=Object(a["n"])(o);if(Object(r["j"])(l))return null;const d=t[2]-e[2];if("vertical"===n)return{verticalSigned:d,unit:l};if(!Object(c["w"])(e,i,T,o)||!Object(c["w"])(t,i,w,o))return null;if("direct"===n)return{direct:Object(s["m"])(w,T),unit:l};if(Object(s["w"])(M,e[0],e[1],t[2]),!Object(c["w"])(M,i,M,o))return null;const u=Object(s["m"])(M,w);return"horizontal"===n?{horizontal:u,unit:l}:{direct:Object(s["m"])(w,T),horizontal:u,vertical:Math.abs(d),unit:l}}const x=Object(o["f"])(),S=Object(o["f"])(),T=Object(o["f"])(),w=Object(o["f"])(),M=Object(o["f"])()},3205:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return s}));var r,n=i("a4ee"),a=i("da35");!function(e){e[e.SSAO=0]="SSAO",e[e.Blur=1]="Blur",e[e.COUNT=2]="COUNT"}(r||(r={}));class s extends a["a"]{constructor(){super(...arguments),this.output=r.SSAO}}Object(n["a"])([Object(a["b"])({count:r.COUNT})],s.prototype,"output",void 0)},"33b0":function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return o})),i.d(t,"f",(function(){return c}));var r=i("38a4"),n=i("04f0"),a=i("b139"),s=i("e431");function o(e=b){return[e[0],e[1],e[2],e[3]]}function c(e,t,i=o()){return Object(s["g"])(h(i),e),i[3]=t,i}function l(e,t,i=o()){return Object(n["h"])(f,h(e),u(e)),Object(n["h"])(g,h(t),u(t)),Object(n["f"])(f,g,f),p(i,Object(r["o"])(Object(n["b"])(h(i),f)))}function h(e){return e}function d(e){return e[3]}function u(e){return Object(r["g"])(e[3])}function p(e,t){return e[3]=t,e}const b=[0,0,1,0],f=Object(a["b"])(),g=Object(a["b"])();o()},"33e2":function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r=i("3349"),n=i("02f1"),a=i("7577"),s=i("0fc4"),o=i("d981"),c=i("d8a4"),l=i("fd48"),h=i("3886"),d=i("5d7f");function u(e){e.fragment.uniforms.add(new d["a"]("texWaveNormal")),e.fragment.uniforms.add(new d["a"]("texWavePerturbation")),e.fragment.uniforms.add([new l["a"]("waveParams",e=>Object(a["l"])(p,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new c["a"]("waveDirection",e=>Object(r["a"])(b,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))]),e.include(o["b"]),e.fragment.code.add(h["b"]`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const p=Object(s["e"])(),b=Object(n["c"])()},"34f2":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));class r{constructor(e,t,i){this.editGeometry=e,this.vertices=t,this.operation=i,this.undone=!1}apply(){this.vertices.forEach(e=>this.operation.apply(e)),this.editGeometry.components.forEach(e=>e.unnormalizeVertexPositions()),this.editGeometry.notifyChanges({operation:this.undone?"redo":"apply",updatedVertices:this.vertices})}undo(){this.vertices.forEach(e=>this.operation.undo(e)),this.editGeometry.notifyChanges({operation:"undo",updatedVertices:this.vertices}),this.undone=!0}canAccumulate(e){if(this.undone||e.vertices.length!==this.vertices.length)return!1;for(let t=0;t<e.vertices.length;++t)if(e.vertices[t]!==this.vertices[t])return!1;return this.operation.canAccumulate(e.operation)}accumulate(e){return!!(e instanceof r&&this.canAccumulate(e))&&(this.vertices.forEach(t=>this.operation.accumulate(t,e.operation)),this.operation.accumulateParams(e.operation),this.editGeometry.components.forEach(e=>e.unnormalizeVertexPositions()),this.editGeometry.notifyChanges({operation:"apply",updatedVertices:this.vertices}),!0)}}var n;!function(e){e[e.CUMULATIVE=0]="CUMULATIVE",e[e.REPLACE=1]="REPLACE"}(n||(n={}))},3544:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return l}));var r=i("b2b2");const n={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},a={dash:n.dash,"dash-dot":[...n.dash,...n.dot],dot:n.dot,"long-dash":n["long-dash"],"long-dash-dot":[...n["long-dash"],...n.dot],"long-dash-dot-dot":[...n["long-dash"],...n.dot,...n.dot],none:null,"short-dash":n["short-dash"],"short-dash-dot":[...n["short-dash"],...n["short-dot"]],"short-dash-dot-dot":[...n["short-dash"],...n["short-dot"],...n["short-dot"]],"short-dot":n["short-dot"],solid:null},s=8;function o(e,t=2){return Object(r["j"])(e)?e:{pattern:e.slice(),pixelRatio:t}}function c(e,t=2){return{pattern:[e,e],pixelRatio:t}}function l(e){return Object(r["k"])(e)&&"style"===e.type?h(e.style):null}function h(e){return Object(r["k"])(e)?o(a[e],s):null}},3563:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));i("c120"),i("b2b2");function r(e,t){return!!n(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function n(e,t){return e===t||e&&t&&e.equals(t)}},"35b3":function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return r}));var r,n=i("b2b2"),a=i("3886"),s=i("003f"),o=i("2765"),c=i("fa1e"),l=i("7c51");class h extends s["a"]{constructor(e,t){super(),this.type=o["a"].Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=c["a"],this._parameters=Object(l["b"])(e,t),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,t=!0){Object(l["g"])(this._parameters,e)&&(this.validateParameters(this._parameters),t&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleInPass(e.pass)&&0!=(this.renderOccluded&e.renderOccludedMask)}isVisibleInPass(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){Object(n["k"])(this.repository)&&this.repository.materialChanged(this)}}!function(e){e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"}(r||(r={}));class d extends a["a"]{constructor(){super(...arguments),this.renderOccluded=r.Occlude}}},"35f0":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("62ae"),n=i("52b2");class a extends r["a"]{constructor(e,t){super(e,"vec3",n["a"].Draw,(i,r,n)=>i.setUniform3fv(e,t(r,n)))}}},"36df":function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return b}));var r=i("2aad"),n=i("d047"),a=i("58c2"),s=i("d8a4"),o=i("4d2d"),c=i("8a80"),l=i("3886"),h=i("690a"),d=i("5d7f"),u=i("3205");const p={samples:16,filterRadius:4};function b(e){const t=new h["a"],i=t.fragment;if(t.include(r["a"]),e.output===u["a"].Blur){const e=(p.filterRadius+1)/2,t=1/(2*e*e);i.include(n["a"]),i.uniforms.add([new d["a"]("normalMap"),new d["a"]("depthMap"),new d["a"]("tex"),new o["a"]("blurSize"),new c["a"]("projScale"),new s["a"]("nearFar",(e,t)=>t.camera.nearFar)]),i.code.add(l["b"]`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${l["b"].float(t)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),i.code.add(l["b"]`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${l["b"].int(p.filterRadius)}; r <= ${l["b"].int(p.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `)}return e.output===u["a"].SSAO&&(i.include(n["a"]),t.include(a["a"]),i.uniforms.add(new d["a"]("normalMap")),i.uniforms.add(new d["a"]("depthMap")),i.uniforms.add(new d["a"]("rnm")),i.uniforms.add(new c["a"]("intensity")),i.uniforms.add(new c["a"]("projScale")),i.uniforms.add(new c["a"]("radius")),i.uniforms.add(new s["a"]("nearFar",(e,t)=>t.camera.nearFar)),i.uniforms.add(new o["a"]("screenSize")),i.uniforms.add(new o["a"]("rnmScale")),i.code.add(l["b"]`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),i.code.add(l["b"]`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.fragment.uniforms.add(new s["a"]("zScale",(e,t)=>Object(a["b"])(t))),i.code.add(l["b"]`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${l["b"].int(p.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
          vec2 tcTap = tc / screenSize;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${l["b"].int(p.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `)),t}const f=Object.freeze(Object.defineProperty({__proto__:null,build:b},Symbol.toStringTag,{value:"Module"}))},3748:function(e,t,i){"use strict";i.d(t,"a",(function(){return G}));var r=i("e92d"),n=i("b2b2"),a=i("a915"),s=i("3349"),o=i("e431"),c=i("0b2d"),l=i("0fc4"),h=i("d359"),d=i("bd7e"),u=i("7289"),p=i("8190"),b=i("a05b"),f=i("1038"),g=i("d7f7"),O=i("35b3"),m=i("badc"),v=i("1153"),_=i("b7bd"),j=i("5957"),y=i("8675"),x=i("7c51"),S=i("b623"),T=i("c3a4"),w=i("ca98"),M=i("fa1e"),A=i("c829"),E=i("87b7"),R=i("713b"),P=i("d17d"),C=i("189c");class D extends w["a"]{constructor(e,t,i){super(e,t,i),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=e.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==b["a"].Highlight}initializeProgram(e){const t=D.shader.get().build(this.configuration);return new A["a"](e.rctx,t,M["a"])}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(this.program.bindPass(e,t),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.stippleEnabled){const{pixelSize:e,sdfNormalizer:t,pixels:i}=Object(n["k"])(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",t),this.program.setUniform1f("stipplePatternTextureSize",i),this.program.setUniform1f("stipplePatternPixelSize",e),this.program.setUniform1f("stipplePatternPixelSizeInv",1/e)}}initializePipeline(){const e=this.configuration,t=Object(C["g"])(P["b"].SRC_ALPHA,P["b"].ONE,P["b"].ONE_MINUS_SRC_ALPHA,P["b"].ONE_MINUS_SRC_ALPHA),i=(t,i=null,r=null)=>Object(C["f"])({blending:i,depthTest:E["b"],depthWrite:r,colorWrite:C["c"],stencilWrite:e.hasOccludees?E["h"]:null,stencilTest:e.hasOccludees?t?E["d"]:E["c"]:null});return e.output===b["a"].Color?(this._occludeePipelineState=i(!0,e.transparent||this.stippleEnabled?t:null,C["d"]),i(!1,e.transparent||this.stippleEnabled?t:null,C["d"])):i(!1)}get primitiveType(){return P["r"].LINES}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}D.shader=new T["a"](R["a"],()=>i.e("chunk-2d20f1b1").then(i.bind(null,"b1e1")));var I=i("a4ee"),L=i("da35"),N=i("6d35");class z extends N["a"]{constructor(){super(...arguments),this.output=b["a"].Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}Object(I["a"])([Object(L["b"])({count:b["a"].COUNT})],z.prototype,"output",void 0),Object(I["a"])([Object(L["b"])()],z.prototype,"hasSlicePlane",void 0),Object(I["a"])([Object(L["b"])()],z.prototype,"hasVertexColors",void 0),Object(I["a"])([Object(L["b"])()],z.prototype,"transparent",void 0),Object(I["a"])([Object(L["b"])()],z.prototype,"draped",void 0),Object(I["a"])([Object(L["b"])()],z.prototype,"stippleEnabled",void 0),Object(I["a"])([Object(L["b"])()],z.prototype,"stippleOffColorEnabled",void 0),Object(I["a"])([Object(L["b"])()],z.prototype,"stipplePreferContinuous",void 0),Object(I["a"])([Object(L["b"])()],z.prototype,"hasOccludees",void 0),Object(I["a"])([Object(L["b"])({constValue:!1})],z.prototype,"stippleRequiresClamp",void 0),Object(I["a"])([Object(L["b"])({constValue:!1})],z.prototype,"stippleScaleWithLineWidth",void 0),Object(I["a"])([Object(L["b"])({constValue:!1})],z.prototype,"stippleRequiresStretchMeasure",void 0);const V=r["a"].getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var F;!function(e){e[e.START=0]="START",e[e.END=1]="END"}(F||(F={}));class G extends O["a"]{constructor(e){super(e,new H),this._techniqueConfig=new z}getConfiguration(e,t){this._techniqueConfig.output=e,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=t.slot===m["a"].DRAPED_MATERIAL;const i=Object(n["k"])(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=i,this._techniqueConfig.stippleOffColorEnabled=i&&Object(n["k"])(this.parameters.stippleOffColor),this._techniqueConfig.hasOccludees=this.parameters.hasOccludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}intersect(e,t,i,r,a,s,o,c,l){Object(n["k"])(l)?Object(x["d"])(e,r,l,s,1,o):this._intersectLineGeometry(e,t,i,r,o)}_intersectLineGeometry(e,t,i,r,n){if(!r.options.selectionMode||Object(S["d"])(t))return;if(!Object(v["f"])(i))return void V.error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get(_["a"].POSITION).data,c=r.camera,l=ee;Object(s["c"])(l,r.point);const p=2;Object(o["w"])(te[0],l[0]-p,l[1]+p,0),Object(o["w"])(te[1],l[0]+p,l[1]+p,0),Object(o["w"])(te[2],l[0]+p,l[1]-p,0),Object(o["w"])(te[3],l[0]-p,l[1]-p,0);for(let s=0;s<4;s++)if(!c.unprojectFromRenderScreen(te[s],ie[s]))return;Object(u["f"])(c.eye,ie[0],ie[1],re),Object(u["f"])(c.eye,ie[1],ie[2],ne),Object(u["f"])(c.eye,ie[2],ie[3],ae),Object(u["f"])(c.eye,ie[3],ie[0],se);let b=Number.MAX_VALUE,f=0;for(let s=0;s<a.length-5;s+=3){if(B[0]=a[s]+i[12],B[1]=a[s+1]+i[13],B[2]=a[s+2]+i[14],W[0]=a[s+3]+i[12],W[1]=a[s+4]+i[13],W[2]=a[s+5]+i[14],Object(u["u"])(re,B)<0&&Object(u["u"])(re,W)<0||Object(u["u"])(ne,B)<0&&Object(u["u"])(ne,W)<0||Object(u["u"])(ae,B)<0&&Object(u["u"])(ae,W)<0||Object(u["u"])(se,B)<0&&Object(u["u"])(se,W)<0)continue;if(c.projectToRenderScreen(B,X),c.projectToRenderScreen(W,Y),X[2]<0&&Y[2]>0){Object(o["f"])(q,B,W);const e=c.frustum,t=-Object(u["u"])(e[h["a"].NEAR],B)/Object(o["i"])(q,Object(u["q"])(e[h["a"].NEAR]));Object(o["k"])(q,q,t),Object(o["e"])(B,B,q),c.projectToRenderScreen(B,X)}else if(X[2]>0&&Y[2]<0){Object(o["f"])(q,W,B);const e=c.frustum,t=-Object(u["u"])(e[h["a"].NEAR],W)/Object(o["i"])(q,Object(u["q"])(e[h["a"].NEAR]));Object(o["k"])(q,q,t),Object(o["e"])(W,W,q),c.projectToRenderScreen(W,Y)}else if(X[2]<0&&Y[2]<0)continue;X[2]=0,Y[2]=0;const e=Object(d["e"])(Object(d["f"])(X,Y,J),l);e<b&&(b=e,Object(o["g"])($,B),Object(o["g"])(Q,W),f=s/3)}const g=r.rayBegin,O=r.rayEnd;if(b<p*p){let e=Number.MAX_VALUE;if(Object(d["a"])(Object(d["f"])($,Q,J),Object(d["f"])(g,O,K),Z)){Object(o["f"])(Z,Z,g);const t=Object(o["p"])(Z);Object(o["k"])(Z,Z,1/t),e=t/Object(o["m"])(g,O)}n(e,Z,f,!1)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;const r=i.get(_["a"].POSITION);return Object(f["a"])(r,null,!1,t)}requiresSlot(e){return e===m["a"].OPAQUE_MATERIAL||e===m["a"].DRAPED_MATERIAL}createGLMaterial(e){return e.output===b["a"].Color||e.output===b["a"].Highlight?new k(e):null}createBufferWriter(){const e=this.parameters.hasVertexColors?y["b"]:y["c"];return Object(n["j"])(this.parameters.stipplePattern)?new y["a"](e):new U(e.clone().vec3f(_["a"].AUXPOS1).vec2f(_["a"].UV0))}}class k extends g["a"]{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===b["a"].Color&&this._updateOccludeeState(e),this.ensureTechnique(D,e)}}class U{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(_["a"].POSITION).length}write(e,t,i,r){Object(j["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r),this._writeAuxpos1(e,t,i,r),this._writeUV0(e,t,i,r)}_writeAuxpos1(e,t,i,r){const n=i.getField(_["a"].AUXPOS1,p["u"]),a=t.indices.get(_["a"].POSITION),s=t.vertexAttributes.get(_["a"].POSITION).data,o=e.transformation,c=n.typedBufferStride,l=n.typedBuffer;r*=c;for(let h=0;h<a.length-1;h+=2)for(const e of[1,0]){const t=3*a[h+e],i=s[t],n=s[t+1],d=s[t+2],u=o[0]*i+o[4]*n+o[8]*d+o[12],p=o[1]*i+o[5]*n+o[9]*d+o[13],b=o[2]*i+o[6]*n+o[10]*d+o[14];l[r]=u,l[r+1]=p,l[r+2]=b,r+=c}}_writeUV0(e,t,i,r){var n;const a=i.getField(_["a"].UV0,p["m"]),s=t.indices.get(_["a"].POSITION),c=t.vertexAttributes.get(_["a"].POSITION).data,l=null==(n=t.vertexAttributes.get(_["a"].DISTANCETOSTART))?void 0:n.data,h=e.transformation,d=a.typedBufferStride,u=a.typedBuffer;let b=0;u[r*=d]=F.START,u[r+1]=b,r+=d;const f=3*s[0],g=Object(o["w"])(B,c[f],c[f+1],c[f+2]);h&&Object(o["q"])(g,g,h);const O=W,m=s.length-1;let v=1;const j=l?(e,t,i)=>b=l[i]:(e,t,i)=>b+=Object(o["m"])(e,t);for(let p=1;p<m;p+=2){const e=3*s[p];Object(o["w"])(O,c[e],c[e+1],c[e+2]),h&&Object(o["q"])(O,O,h),j(g,O,v++);for(let t=0;t<2;++t)u[r]=1-t,u[r+1]=b,r+=d;Object(o["g"])(g,O)}const y=3*s[m];Object(o["w"])(O,c[y],c[y+1],c[y+2]),h&&Object(o["q"])(O,O,h),j(g,O,v),u[r]=F.END,u[r+1]=b}}class H extends O["b"]{constructor(){super(...arguments),this.color=l["a"],this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}const B=Object(c["f"])(),W=Object(c["f"])(),q=Object(c["f"])(),Z=Object(c["f"])(),X=Object(a["d"])(),Y=Object(a["d"])(),$=Object(c["f"])(),Q=Object(c["f"])(),J=Object(d["d"])(),K=Object(d["d"])(),ee=Object(c["f"])(),te=[Object(a["d"])(),Object(a["d"])(),Object(a["d"])(),Object(a["d"])()],ie=[Object(c["f"])(),Object(c["f"])(),Object(c["f"])(),Object(c["f"])()],re=Object(u["d"])(),ne=Object(u["d"])(),ae=Object(u["d"])(),se=Object(u["d"])()},3853:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae");class n extends r["a"]{constructor(e){super(e,"mat4")}}},3886:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));class r{}function n(e,...t){let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i}!function(e){function t(e){return Math.round(e).toString()}function i(e){return e.toPrecision(8)}e.int=t,e.float=i}(n||(n={}))},3976:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));const r=.1,n=.001},"3a35":function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(r||(r={}))},"3bd5":function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){var t,i;(t=e.Geometry||(e.Geometry={}))[t.ADD=1]="ADD",t[t.UPDATE=2]="UPDATE",t[t.REMOVE=4]="REMOVE",(i=e.State||(e.State={}))[i.VISIBILITIES=1]="VISIBILITIES",i[i.VERTEXATTRS=2]="VERTEXATTRS",i[i.TRANSFORMATION=4]="TRANSFORMATION",i[i.HIGHLIGHTS=8]="HIGHLIGHTS",i[i.OCCLUDEES=16]="OCCLUDEES"}(r||(r={}))},"3cde":function(e,t,i){"use strict";i.d(t,"a",(function(){return v}));var r=i("a4ee"),n=i("fc29"),a=i("ce6d"),s=i("b2b2"),o=i("477c"),c=i("a915"),l=i("59b2"),h=(i("b50f"),i("c120"),i("cea0"),i("d386")),d=i("3349"),u=i("e431"),p=i("0b2d"),b=i("8188"),f=i("f408"),g=i("a6c1"),O=i("fd14"),m=i("e94b");let v=class extends n["a"]{constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.events=new a["a"].EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}get elevationInfo(){const e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=Object(f["f"])(this.graphic),i=e?e.offset:0;return new O["a"]({mode:t,offset:i})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this.graphic;if(!1===t.visible)return null;const i=t.geometry;if(Object(s["j"])(i))return null;const r=this._get("focusedSymbol"),n=Object(s["k"])(r)?r:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,n):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),Object(s["k"])(this.layer)&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),Object(s["k"])(this.layer)&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=Object(o["f"])(()=>{var e;return null==(e=this.graphic)?void 0:e.symbol},e=>{Object(s["k"])(e)&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&Object(s["k"])(this.focusedSymbol)&&(this.graphic.symbol=this.focusedSymbol))},o["d"])}detachSymbolChanged(){Object(s["k"])(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&Object(s["k"])(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,i,r){if(r=r||Object(g["h"])(i),Object(s["j"])(r))return null;const n=1;let a=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==r.type)return Object(m["b"])(t,i,e)?n:null;if(Object(s["j"])(a)||!a.originalPoint.equals(i)){const t=i,n=e.spatialReference;if(Object(b["b"])(t.spatialReference,n)){const e=Object(b["j"])(t,n);a={originalPoint:t.clone(),mapPoint:e,radiusPx:Object(c["g"])(r.size)},this._circleCollisionCache=a}}if(Object(s["k"])(a)){const i=Object(c["i"])(t,j),s=e.toScreen(a.mapPoint),o=a.radiusPx,l=s.x+Object(c["g"])(r.xoffset),h=s.y-Object(c["g"])(r.yoffset);return Object(d["s"])(i,[l,h])<o*o?n:null}return null}_intersectDistance3D(e,t,i){const r=e.toMap(t,{include:[i]});return r&&Object(b["p"])(r,_,e.renderSpatialReference)?Object(u["m"])(_,e.state.camera.eye):null}};Object(r["a"])([Object(l["b"])({constructOnly:!0,nonNullable:!0})],v.prototype,"graphic",null),Object(r["a"])([Object(l["b"])()],v.prototype,"elevationInfo",null),Object(r["a"])([Object(l["b"])({constructOnly:!0,nonNullable:!0})],v.prototype,"view",void 0),Object(r["a"])([Object(l["b"])({value:null})],v.prototype,"focusedSymbol",null),Object(r["a"])([Object(l["b"])({constructOnly:!0})],v.prototype,"layer",void 0),Object(r["a"])([Object(l["b"])()],v.prototype,"interactive",void 0),Object(r["a"])([Object(l["b"])()],v.prototype,"selectable",void 0),Object(r["a"])([Object(l["b"])()],v.prototype,"grabbable",void 0),Object(r["a"])([Object(l["b"])({value:!1})],v.prototype,"grabbing",null),Object(r["a"])([Object(l["b"])()],v.prototype,"dragging",void 0),Object(r["a"])([Object(l["b"])()],v.prototype,"hovering",null),Object(r["a"])([Object(l["b"])({value:!1})],v.prototype,"selected",null),Object(r["a"])([Object(l["b"])()],v.prototype,"cursor",void 0),v=Object(r["a"])([Object(h["a"])("esri.views.interactive.GraphicManipulator")],v);const _=Object(p["f"])(),j=Object(c["f"])()},"3e44":function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c}));var r=i("2aad"),n=i("db7b"),a=i("3886"),s=i("690a"),o=i("5d7f");function c(){const e=new s["a"];return e.include(r["a"]),e.fragment.uniforms.add([new o["a"]("tex"),new n["a"]("uColor")]),e.fragment.code.add(a["b"]`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),e}const l=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}))},"41ef":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("40b6"),n=i("7f83");function a(e,t,i,a,...s){return Object(n["h"])(e)&&Object(r["f"])(e)?t.apply(void 0,s):Object(n["p"])(e)?i.apply(void 0,s):a.apply(void 0,s)}},4377:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){e.code.add(r["b"]`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},"438e":function(e,t,i){"use strict";i.r(t),i.d(t,"DrawGraphicTool3D",(function(){return kt})),i.d(t,"GraphicMoveTool",(function(){return jr})),i.d(t,"GraphicReshapeTool",(function(){return qr})),i.d(t,"GraphicTransformTool",(function(){return xn})),i.d(t,"ExtentTransformTool",(function(){return xs}));var r=i("a4ee"),n=i("c649"),a=i("b2b2"),s=i("477c"),o=i("59b2"),c=(i("b50f"),i("c120")),l=i("cea0"),h=i("d386"),d=i("f408"),u=i("fd14"),p=i("a915"),b=i("e92d"),f=(i("2dd4"),i("0b2d")),g=i("fc29"),O=i("f4cc"),m=i("7617"),v=i("8048"),_=i("3349"),j=i("02f1"),y=i("e431"),x=i("32ed"),S=i("6323");i("e6c2");let T=e=>({vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}),w=(e,t,i)=>{for(let r=0,n=t.length;r<n;r++){let n=t[r];Array.isArray(n)?w(e,n,i):null!=n&&!1!==n&&("string"==typeof n&&(n=T(n)),i.push(n))}};function M(e,t,i){if(Array.isArray(t))i=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||i&&("string"==typeof i||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let r,n;return i&&1===i.length&&"string"==typeof i[0]?r=i[0]:i&&(n=[],w(e,i,n),0===n.length&&(n=void 0)),{vnodeSelector:e,properties:t,children:n,text:""===r?void 0:r,domNode:null}}i("69e9");const A={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let E=class extends g["a"]{constructor(e){super(e),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this._backgroundColor="rgba(0, 0, 0, 0.6)",this._textColor="white",this._textShadowColor=[0,0,0],this._textShadowSize=1}get position(){return[this.x,this.y]}set position(e){this._set("x",e[0]),this._set("y",e[1])}get _textShadow(){const[e,t,i]=this._textColor;return`0 0 ${this._textShadowSize}px rgb(${e}, ${t}, ${i})`}get _padding(){return.5*this.fontSize}get _borderRadius(){return this._padding}render(){return M("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this._backgroundColor,color:this._textColor,padding:this._padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(e){if(!this.visible)return;const t=e.font.replace(/^(.*?)px/,"");e.font=`${this.fontSize}px ${t}`;const i=this._padding,r=this._borderRadius,n=e.measureText(this.text).width,a=this.fontSize,s=R[this.anchor];e.textAlign="center",e.textBaseline="middle";const o=n+2*i,c=a+2*i,l=this.x+s.x*o,h=this.y+s.y*c;this._roundedRect(e,l,h,o,c,r),e.fillStyle=this._backgroundColor,e.fill();const d=this.x+(s.x+.5)*o,u=this.y+(s.y+.5)*c;this._renderTextShadow(e,this.text,d,u),e.fillStyle=this._textColor,e.fillText(this.text,d,u)}_renderTextShadow(e,t,i,r){e.lineJoin="miter",e.fillStyle=`rgba(${this._textShadowColor[0]}, ${this._textShadowColor[1]}, ${this._textShadowColor[2]}, ${1/P.length})`;const n=this._textShadowSize;for(const[a,s]of P)e.fillText(t,i+n*a,r+n*s)}_roundedRect(e,t,i,r,n,a){e.beginPath(),e.moveTo(t,i+a),e.arcTo(t,i,t+a,i,a),e.lineTo(t+r-a,i),e.arcTo(t+r,i,t+r,i+a,a),e.lineTo(t+r,i+n-a),e.arcTo(t+r,i+n,t+r-a,i+n,a),e.lineTo(t+a,i+n),e.arcTo(t,i+n,t,i+n-a,a),e.closePath()}_cssClasses(){const e={"esri-text-overlay-item":!0};for(const t in A)e[A[t]]=this.anchor===t;return e}};Object(r["a"])([Object(o["b"])()],E.prototype,"x",void 0),Object(r["a"])([Object(o["b"])()],E.prototype,"y",void 0),Object(r["a"])([Object(o["b"])()],E.prototype,"position",null),Object(r["a"])([Object(o["b"])()],E.prototype,"text",void 0),Object(r["a"])([Object(o["b"])()],E.prototype,"fontSize",void 0),Object(r["a"])([Object(o["b"])()],E.prototype,"anchor",void 0),Object(r["a"])([Object(o["b"])()],E.prototype,"visible",void 0),Object(r["a"])([Object(o["b"])()],E.prototype,"_backgroundColor",void 0),Object(r["a"])([Object(o["b"])()],E.prototype,"_textColor",void 0),Object(r["a"])([Object(o["b"])()],E.prototype,"_textShadowColor",void 0),Object(r["a"])([Object(o["b"])()],E.prototype,"_textShadowSize",void 0),Object(r["a"])([Object(o["b"])()],E.prototype,"_textShadow",null),Object(r["a"])([Object(o["b"])()],E.prototype,"_padding",null),Object(r["a"])([Object(o["b"])()],E.prototype,"_borderRadius",null),E=Object(r["a"])([Object(h["a"])("esri.views.overlay.TextOverlayItem")],E);const R={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},P=[];{const e=16;for(let t=0;t<360;t+=360/e)P.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}const C=E;var D=i("be4a");const I=3025,L={default:15,far:25};let N=class extends g["a"]{constructor(e){super(e),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const e=Object(O["e"])(async e=>{const t=await Object(S["a"])("esri/core/t9n/Units");Object(O["p"])(e),this._messagesUnits=t}),t=()=>Object(a["b"])(this.context,e=>e.editGeometryOperations);this.own([Object(s["f"])(()=>[Object(a["k"])(this.context)&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits],()=>this._update()),...["vertex-add","vertex-update","vertex-remove"].map(e=>Object(s["b"])(t,e,()=>this._update())),Object(n["c"])(()=>e.abort())])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return Object(a["j"])(this._messagesUnits)}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map(e=>e.label.text)}}get _edgeDistancePixels(){return L[this.edgeDistance]}_update(){this._nextLabelIndex=0;const e=this.context;if(Object(a["j"])(e))return void this._destroyUnusedLabels();const{components:t,geometry:i,coordinateHelper:r}=e.editGeometryOperations.data;if(!i)return void this._destroyUnusedLabels();const n=t.length;for(let s=0;s<n;++s){const o=[];if(t[s].iterateVertices(e=>{o.push(r.toXYZ(e.pos))}),0===s&&Object(a["k"])(this.stagedVertex)&&o.push(r.toXYZ(this.stagedVertex)),o.length<2)continue;const c=o[0],l=o[o.length-1];"polygon"===i.type&&o.length>2&&!Object(y["D"])(c,l)&&o.push(c);const h=1===n&&!Object(x["h"])(o,!1,!1);let d=F,u=G;this.toScreenPointArray(e,c,d);for(let t=1;t<o.length;++t){const i=o[t-1],r=o[t];this.toScreenPointArray(e,r,u),this._addLabel(e,i,d,r,u,h),[d,u]=[u,d]}}this._destroyUnusedLabels()}_addLabel(e,t,i,r,n,s){const{label:o}=this._getOrCreateLabel(e);if(!this.visible||Object(_["s"])(i,n)<I)return void(o.visible=!1);const c=Object(a["k"])(e.graphicState)?e.graphicState.isDraped?"on-the-ground":"absolute-height":Object(d["d"])(e.editGeometryOperations.data.geometry,e.elevationInfo),{spatialReference:l}=e.editGeometryOperations.data,h=Object(D["a"])(t,r,l,c),u=this._messagesUnits,p=Object(v["e"])(e.view);o.text=Object(a["k"])(u)&&Object(a["k"])(h)?Object(m["c"])(u,h,p):"",o.visible=!0;const b=n[0]-i[0],f=n[1]-i[1];s?Object(_["a"])(z,-f,b):Object(_["a"])(z,f,-b),Object(_["i"])(z,z),Object(_["f"])(z,z,this._edgeDistancePixels),Object(_["l"])(V,i,n,.5),Object(_["b"])(V,V,z),o.position=[V[0],V[1]],Math.abs(z[0])>Math.abs(z[1])?o.anchor=z[0]>0?"left":"right":o.anchor=-z[1]<0?"top":"bottom"}_getOrCreateLabel(e){if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];const t=new C({fontSize:10,anchor:"center"});e.view.overlay.items.add(t);const i={label:t};return this._labelInfos.push(i),this._nextLabelIndex=this._labelInfos.length,i}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:e}){Object(a["b"])(this.context,t=>t.view.overlay.items.remove(e)),e.destroy()}};Object(r["a"])([Object(o["b"])()],N.prototype,"context",void 0),Object(r["a"])([Object(o["b"])()],N.prototype,"stagedVertex",void 0),Object(r["a"])([Object(o["b"])()],N.prototype,"visible",void 0),Object(r["a"])([Object(o["b"])()],N.prototype,"edgeDistance",void 0),Object(r["a"])([Object(o["b"])()],N.prototype,"updating",null),Object(r["a"])([Object(o["b"])()],N.prototype,"_messagesUnits",void 0),Object(r["a"])([Object(o["b"])()],N.prototype,"_edgeDistancePixels",null),N=Object(r["a"])([Object(h["a"])("esri.views.interactive")],N);const z=Object(j["c"])(),V=Object(j["c"])(),F=Object(p["f"])(),G=Object(p["f"])();var k=i("d33d");let U=class extends N{getCameraOrExtent({view:e}){return e.state.camera}toScreenPointArray({view:e,elevationInfo:t,editGeometryOperations:i},r,n=Object(p["f"])()){const{spatialReference:a}=i.data.coordinateHelper;return Object(k["d"])(r,a,t,e,H),e.state.camera.projectToScreen(H,n),n}};U=Object(r["a"])([Object(h["a"])("esri.views.3d.interactive.SegmentLabels3D")],U);const H=Object(f["f"])();var B=i("9ef0"),W=i("af40"),q=i("7577"),Z=i("5ef2"),X=i("4f8b"),Y=i("d359"),$=i("bd7e"),Q=i("d18f"),J=i("647b"),K=i("d791"),ee=i("afe1"),te=i("f53a"),ie=i("b7c2"),re=i("5a22"),ne=i("748f");class ae extends te["a"]{constructor(e){super(e.view),this._resources=null,this._transform=Object(ee["d"])()}get object(){return Object(a["k"])(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(e){Object(K["c"])(this._transform,e),Object(a["k"])(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(Object(a["j"])(this._resources))return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new ne["a"]({isPickable:!1,updatePolicy:ie["j"].SYNC});e.add(t);const i=new re["a"]({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial(t=>e.add(t)),e.add(i),t.add(i),this.visible||i.setVisible(!1),this._resources={layer:t,object:i}}destroyResources(){const e=this.view._stage;!Object(a["j"])(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial(t=>{e.remove(t),t.dispose()}),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){Object(a["j"])(this._resources)||this._resources.object.setVisible(e)}}var se=i("caf7"),oe=i("35b3"),ce=i("b7bd"),le=i("86ba");class he extends ae{constructor(e){super(e),this._ray=Object(Q["c"])(),this._externalResources=null,this._handles=new W["a"],this._isWorldDown=!1,this._start=Object(f["f"])(),this._end=Object(f["h"])(1,0,0),this._width=1,this._color=Object(Z["c"])(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=Object(Z["c"])(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=fe.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=oe["c"].OccludeAndTransparent,this._fadedExtensions=Oe,this.applyProps(e)}createExternalResources(){const e=new le["a"](this.materialParameters);this._handles.add(Object(s["f"])(()=>this.view.state.camera,()=>{this._updateGeometry()}));const t=new J["a"]({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:t}}destroyExternalResources(){Object(a["k"])(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(e){Object(a["k"])(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const t=[Object(f["f"])(),Object(f["f"])()],i=this.extensionType===fe.FADED;i&&t.push(Object(f["f"])(),Object(f["f"])());const r=i?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,n=se["a"].createPolylineGeometry(t,null,r);e.addGeometry(n,Object(a["r"])(this._externalResources).material),this._updateVertices(e)}updateVisibility(e){super.updateVisibility(e),Object(a["k"])(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,Object(y["g"])(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),Object(y["f"])(this._end,e,this._end),Object(Q["e"])(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,Object(y["o"])(this._start,e)||(Object(y["g"])(this._start,e),Object(Q["e"])(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,Object(y["o"])(this._end,e)||(Object(y["g"])(this._end,e),Object(Q["e"])(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){Object(q["g"])(e,this._color)||(Object(q["c"])(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(q["g"])(e,this._innerColor)||(Object(q["c"])(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=Object(a["k"])(e)!==Object(a["k"])(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(Object(a["j"])(e)||Object(a["j"])(this._stippleOffColor)||!Object(q["g"])(e,this._stippleOffColor))&&(this._stippleOffColor=Object(a["k"])(e)?Object(Z["a"])(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this._updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&Object(a["k"])(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,Object(a["k"])(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,Object(a["k"])(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,Object(a["k"])(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=Object(a["s"])(e,Oe),this.recreateGeometry()}_updateMaterial(){Object(a["j"])(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateGeometry(){Object(a["k"])(this.object)&&this._updateVertices(this.object)}_updateVertices(e){const t=this._extensionType===fe.FADED?this._updateLineSegmentFinite(be):this._updateLineSegmentInfinite(this._extensionType,be);this._updateVertexAttributes(e,t),Object(a["k"])(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}_updateLineSegmentFinite(e){return Object($["f"])(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch(Object(X["c"])(this._ray,de),e){case fe.LINE:de.c0=-Number.MAX_VALUE;break;case fe.RAY:case fe.GROUND_RAY:{const e=this._ray.origin,t=Object(a["s"])(this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&Object(y["s"])(de.ray.direction,de.ray.direction),this._extensionType===fe.GROUND_RAY&&null!=t&&(de.c1=Math.abs(i-t));break}}if(!Object(Y["e"])(i.frustum,de))return Object($["f"])(this._start,this._end,t);const r=Object(X["e"])(de,ue),n=Object(X["d"])(de,pe);return Object($["f"])(r,n,t)}_updateVertexAttributes(e,t){const i=e.geometries[0].getMutableAttribute(ce["a"].POSITION).data;if(this.extensionType===fe.FADED){const e=Object($["h"])(t,-this.fadedExtensions.start,ue);i[0]=e[0],i[1]=e[1],i[2]=e[2];const r=Object($["h"])(t,0,ue);i[3]=r[0],i[4]=r[1],i[5]=r[2];const n=Object($["h"])(t,1,ue);i[6]=n[0],i[7]=n[1],i[8]=n[2];const a=Object($["h"])(t,1+this.fadedExtensions.end,ue);i[9]=a[0],i[10]=a[1],i[11]=a[2]}else{const e=Object($["h"])(t,0,ue);i[0]=e[0],i[1]=e[1],i[2]=e[2];const r=Object($["h"])(t,1,ue);i[3]=r[0],i[4]=r[1],i[5]=r[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}}const de=Object(X["a"])(),ue=Object(f["f"])(),pe=Object(f["f"])(),be=Object($["d"])();var fe;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(fe||(fe={}));const ge=1/3,Oe={start:ge,end:ge};class me extends ae{constructor(e){super(e),this._handles=new W["a"],this._location=Object(f["f"])(),this._direction=Object(f["h"])(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=Object(Z["c"])(1,0,1,1),this._renderOccluded=oe["c"].OccludeAndTransparent,this.applyProps(e)}get location(){return this._location}set location(e){Object(y["o"])(this._location,e)||(Object(y["g"])(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){Object(y["o"])(this._direction,e)||(Object(y["g"])(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){Object(y["r"])(this._direction,Object(y["f"])(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){Object(q["g"])(e,this._color)||(Object(q["c"])(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}createExternalResources(){const e=new le["a"](this.materialParameters);this._handles.add(Object(s["f"])(()=>this.view.state.camera,()=>{this._updateGeometry()})),this._externalResources={material:e}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(e){const t=se["a"].createPolylineGeometry([Object(f["f"])(),Object(f["f"])()]),i=se["a"].createPolylineGeometry([Object(f["f"])(),Object(f["f"])()]),r=Object(a["r"])(this._externalResources).material;e.addGeometry(t,r),e.addGeometry(i,r),this._updateVertices(e)}forEachExternalMaterial(e){Object(a["k"])(this._externalResources)&&e(this._externalResources.material)}_updateMaterial(){Object(a["j"])(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){const e=this.object;Object(a["j"])(e)||this._updateVertices(e)}_updateVertices(e){const t=this.view.state.camera;t.projectToScreen(this.location,_e),Object(y["e"])(ve,this.location,this.direction),t.projectToScreen(ve,je),Object(_["i"])(je,Object(_["g"])(je,je,_e)),this._updateVertexAttributes(t,e,0,_e,je,1),this._updateVertexAttributes(t,e,1,_e,je,-1)}_updateVertexAttributes(e,t,i,r,n,a){const s=t.geometryRecords[i],o=s.geometry.getMutableAttribute(ce["a"].POSITION).data,c=Object(_["f"])(ye,Object(_["a"])(ye,n[1]*a,n[0]*-a),this.offset+this.width/2),l=Object(_["b"])(xe,Object(_["b"])(xe,Object(_["b"])(xe,r,Object(_["f"])(xe,n,this.length/2)),c),c),h=Object(_["b"])(Se,l,Object(_["f"])(Se,n,-this.length));e.unprojectFromScreen(l,ve),o[0]=ve[0],o[1]=ve[1],o[2]=ve[2],e.unprojectFromScreen(h,ve),o[3]=ve[0],o[4]=ve[1],o[5]=ve[2],t.geometryVertexAttrsUpdated(s)}}const ve=Object(f["f"])(),_e=Object(p["f"])(),je=Object(p["f"])(),ye=Object(p["f"])(),xe=Object(p["f"])(),Se=Object(p["f"])();var Te=i("38a4"),we=i("0fc4"),Me=i("8188"),Ae=i("4261"),Ee=i("7361"),Re=i("2765"),Pe=i("1e2c");class Ce{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return Object(a["k"])(this._resources)?this._resources.object:null}get resources(){return Object(a["k"])(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this.resourceFactory.recreateGeometry)return void this.recreate();const e=this.resourceFactory.view._stage;if(Object(a["j"])(this._resources)||!e)return;const t=this._resources.object;this._resources.external.forEach(t=>{t.type===Re["a"].Geometry&&e.remove(t)}),t.removeAllGeometries();const i=this.resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer);e.addMany(i)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this.resourceFactory,t=e.view,i=t._stage;if(!i)return;const r=new ne["a"]({isPickable:!1,updatePolicy:ie["j"].SYNC});i.add(r);const n=new re["a"]({castShadow:!1}),a=e.createResources(n,r);a.forEach(e=>{i.add(e),e instanceof Pe["a"]&&i.loadImmediate(e)}),i.add(n),r.add(n);const o=e.cameraChanged?Object(s["f"])(()=>t.state.camera,t=>e.cameraChanged(t),s["a"]):null;this._resources={layer:r,object:n,external:a,cameraHandle:o},this._syncVisible()}_destroyResources(){if(Object(a["j"])(this._resources))return;const e=this.resourceFactory.view._stage;null!=e&&e.remove(this._resources.object),null!=e&&e.remove(this._resources.layer),this._resources.external.forEach(t=>{null!=e&&e.remove(t),"dispose"in t&&t.dispose()}),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}_syncVisible(){Object(a["j"])(this._resources)||this._resources.object.setVisible(this._visible)}}var De=i("2e0f"),Ie=i("0eb9"),Le=i("a6c9"),Ne=i("2df1");class ze{constructor(e){this.view=null,this._geometry=null,this._size=3,this._color=Object(we["g"])(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=Object(we["g"])(1,1,1,1),this._elevationInfo=null,this.resources=new Ce({view:e.view,createResources:e=>this._createResources(e),recreateGeometry:(e,t)=>(e.geometry=this._recreateGeometry(t,e.material),Object(a["k"])(e.geometry)?[e.geometry]:[])});let t=!0;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy()}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e}get attached(){return this.resources.attached}set attached(e){this.resources.attached=e}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?Object(a["k"])(this.resources)&&this.resources.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){Object(q["g"])(e,this._color)||(Object(q["c"])(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,Object(a["k"])(this.resources)&&this.resources.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(q["g"])(e,this._outlineColor)||(Object(q["c"])(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()}_updateMaterial(){const e=this.resources.resources;Object(a["j"])(e)||e.material.setParameters(this._materialParameters(e.texture.id))}_updateSizeAttribute(){const e=this.resources.resources,t=this.resources.object;if(Object(a["j"])(e)||Object(a["j"])(t))return;const i=e.geometry;if(Object(a["j"])(i))return;const r=i.getMutableAttribute(ce["a"].SIZE).data,n=this.geometrySize;r[0]=n,r[1]=n,t.geometryVertexAttrsUpdated(t.geometryRecords[0])}_materialParameters(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:Fe,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get geometrySize(){return this._size/Ve}_recreateGeometry(e,t){const i=this._createRenderGeometry();return Object(a["k"])(i)&&e.addGeometry(i,t),i}_createResources(e){const t=Object(Le["c"])(this._primitive,this.preferredTextureSize),i=new Ne["a"](this._materialParameters(t.id)),r=this._recreateGeometry(e,i);return{material:i,texture:t,geometry:r,forEach(e){e(t),e(i),Object(a["k"])(this.geometry)&&e(this.geometry)}}}get preferredTextureSize(){return Object(Te["e"])(Object(Te["m"])(2*this.geometrySize),16,128)}calculateMapBounds(e){if(Object(a["j"])(this.resources.resources)||Object(a["j"])(this.resources.resources.geometry))return!1;const t=this.resources.resources.geometry.vertexAttributes.get(ce["a"].POSITION);return Object(Me["w"])(t.data,this.view.renderCoordsHelper.spatialReference,Ge,this.view.spatialReference),Object(Ae["k"])(e,Ge),!0}_createRenderGeometry(){const e=this.geometry;if(Object(a["j"])(e))return null;const{renderCoordsHelper:t,elevationProvider:i}=this.view,r=Object(De["f"])(e,i,Ie["a"].fromElevationInfo(this.elevationInfo),t),n=Object(y["w"])(Ee["d"].get(),e.x,e.y,r),s=Ee["d"].get();Object(Me["w"])(n,e.spatialReference,s,t.spatialReference);const o=this.geometrySize;return se["a"].createPointGeometry(null,s,null,[o,o],[0,0,0,1])}}const Ve=Le["a"],Fe=[Ve/2,Ve/2,1-Ve/2,1-Ve/2],Ge=Object(f["f"])();var ke=i("0278"),Ue=i("d36e");class He extends ae{constructor(e){super(e),this._handles=new W["a"],this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=Object(f["f"])(),this._up=Object(f["f"])(),this._right=Object(f["f"])(),this._renderOccluded=oe["c"].OccludeAndTransparent,this._color=Object(Z["c"])(1,0,0,1),this._outlineColor=Object(Z["c"])(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=oe["c"].Opaque,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){Object(q["c"])(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(q["c"])(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min(Object(y["m"])(t,e),Object(y["m"])(t,i))/3,Object(y["r"])(this._up,Object(y["f"])(this._up,e,t)),Object(y["r"])(this._right,Object(y["f"])(this._right,i,t)),Object(y["g"])(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new Ue["a"](this.quadMaterialParameters),this._outlineMaterial=new le["a"](this.outlineMaterialParameters),this._handles.add(Object(s["f"])(()=>this.view.state.camera,()=>this._updateTransform()))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=Object(y["e"])(Ee["d"].get(),this._up,this._right),i=se["a"].createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(e=this.object){const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),r=Math.min(this._maxSize,i);Object(K["f"])(Be,this._position),Object(K["h"])(Be,Be,[r,r,r]),Object(a["k"])(e)&&(e.transformation=Be)}_quadGeometryData(e,t){const i=Object(y["e"])(Ee["d"].get(),e,t);return new ke["a"]([[ce["a"].POSITION,{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[[ce["a"].POSITION,new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameters(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameters(this.outlineMaterialParameters)}}const Be=Object(ee["d"])();var We=i("c9fb"),qe=i("6706"),Ze=i("65a7");class Xe extends Ze["a"]{visualizeIntersectionPoint(e,t){const{coordinateHelper:i,view:r}=t;return Object(n["a"])(new ze({view:r,primitive:"circle",geometry:i.vectorToPoint(e.intersectionPoint),elevationInfo:Object(a["s"])(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:B["a"].toUnitRGBA(We["a"].orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{coordinateHelper:i,view:r}=t;return Object(n["a"])(new ze({view:r,primitive:"circle",geometry:i.vectorToPoint(e.point),elevationInfo:Object(a["s"])(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:B["a"].toUnitRGBA(We["a"].orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{coordinateHelper:i,view:r}=t;return Object(n["a"])(this._createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,i,Object(a["s"])(e.elevationInfo,t.elevationInfo),r,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{coordinateHelper:i,view:r}=t,s=Object(a["s"])(e.elevationInfo,t.elevationInfo),o=Object(k["a"])(e.lineStart,i,s,t.view),c=Object(k["a"])(e.lineEnd,i,s,t.view),l=Object(y["l"])(c,o,c,.5),h=new me({view:r,attached:!1,offset:We["a"].parallelLineHintOffset,length:We["a"].parallelLineHintLength,width:We["a"].parallelLineHintWidth,color:B["a"].toUnitRGBA(We["a"].orange),location:l,renderOccluded:oe["c"].Opaque});return h.setDirectionFromPoints(o,l),h.attached=!0,Object(n["a"])(h)}visualizeRightAngleQuad(e,t){const{coordinateHelper:i,view:r}=t,s=Object(a["s"])(e.elevationInfo,t.elevationInfo);return Object(n["a"])(new He({view:r,attached:!0,color:B["a"].toUnitRGBA(We["a"].orange),renderOccluded:oe["c"].Transparent,outlineRenderOccluded:oe["c"].Opaque,outlineColor:B["a"].toUnitRGBA(We["a"].orange),outlineSize:We["a"].rightAngleHintOutlineSize,size:We["a"].rightAngleHintSize,geometry:{previous:Object(k["a"])(e.previousVertex,i,s,r),center:Object(k["a"])(e.centerVertex,i,s,r),next:Object(k["a"])(e.nextVertex,i,s,r)}}))}_createLineSegmentHintFromMap(e,t,i,r,n,a,s=!0,o=!0){const c=Object(f["f"])(),l=Object(f["f"])();return Object(k["c"])(t,i,r,n,a,c,l),this._createLineSegmentHint(e,a,c,l,s,o)}_createLineSegmentHint(e,t,i,r,n=!0,a=!0){const s=new he({view:t,extensionType:fe.FADED,start:i,end:r,color:B["a"].toUnitRGBA(We["a"].orange),renderOccluded:oe["c"].Opaque});switch(e){case qe["a"].TARGET:s.width=We["a"].lineHintWidthTarget,s.fadedExtensions={start:0,end:We["a"].lineHintFadedExtensions};break;case qe["a"].REFERENCE_EXTENSION:s.width=We["a"].lineHintWidthReference,s.fadedExtensions={start:0,end:0};break;case qe["a"].REFERENCE:s.width=We["a"].lineHintWidthReference,s.fadedExtensions={start:n?We["a"].lineHintFadedExtensions:0,end:a?We["a"].lineHintFadedExtensions:0}}return s.attached=!0,s}}var Ye=i("d329"),$e=i("3544");const Qe={main:new B["a"]([255,127,0]),selected:new B["a"]([255,255,255]),staged:new B["a"]([12,207,255]),outline:new B["a"]([0,0,0,.5]),selectedOutline:new B["a"]([255,255,255])},Je=.3;function Ke(e,t){const i=e.clone();return i.a*=t,i}function et(e,t){const i=e.clone(),r=Object(Ye["b"])(i);r.s*=t;const n=Object(Ye["e"])(r);return i.r=n.r,i.g=n.g,i.b=n.b,i}function tt(e,t){if(t)for(const i in t)e[i]=t[i]}class it{constructor(e){this.color=Qe.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=oe["c"].Opaque,tt(this,e)}}class rt{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=Qe.main,this.outlineColor=Qe.outline,this.renderOccluded=oe["c"].Opaque,this.hoverOutlineColor=Qe.selectedOutline,tt(this,e)}apply(e,t){const i=this[e];t.setParameters({color:bt(i),transparent:"color"!==e||i.a<1,renderOccluded:this.renderOccluded})}}class nt{constructor(e){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=Ke(Qe.main,.5),this.hoverColor=Qe.main,this.renderOccluded=oe["c"].Transparent,this.minSquaredEdgeLength=900,tt(this,e)}apply(e,t){const i=this[e];t.setParameters({color:bt(i),transparent:i.a<1,renderOccluded:this.renderOccluded})}}class at{constructor(e){this.vertex=new rt({color:Qe.main,outlineColor:Qe.outline}),this.edge=new rt({color:et(Ke(Qe.main,2/3),.5),outlineColor:Ke(Qe.outline,.5),size:8,collisionPadding:8}),this.selected=new rt({color:Qe.selected,outlineColor:Qe.outline}),this.edgeOffset=new nt,tt(this,e)}}class st{constructor(e){this.color=Qe.selected,this.width=1.5,this.stipplePattern=Object($e["a"])(5),this.stippleOffColor=Qe.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=Qe.selected,this.renderOccluded=oe["c"].OccludeAndTransparent,tt(this,e)}apply(e){e.color=bt(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=bt(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=bt(this.innerColor),e.renderOccluded=this.renderOccluded}}class ot{constructor(e){this.color=Qe.selected,this.size=4,this.outlineSize=1,this.outlineColor=Qe.outline,this.shape="square",tt(this,e)}apply(e){e.color=bt(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=bt(this.outlineColor),e.primitive=this.shape}}class ct{constructor(e){this.innerColor=Qe.selected,this.innerWidth=1,this.glowColor=Qe.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=Je,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=Qe.main,tt(this,e)}apply(e,t=1){const i={glowColor:B["a"].toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:B["a"].toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}class lt{constructor(e){this.outline=new st({color:Qe.outline,renderOccluded:oe["c"].OccludeAndTransparentStencil,stippleOffColor:Qe.selected,stipplePattern:Object($e["a"])(5),width:1.5,innerWidth:0}),this.staged=new st({color:Qe.selected,renderOccluded:oe["c"].OccludeAndTransparentStencil,innerColor:Qe.staged,stippleOffColor:Qe.outline,stipplePattern:Object($e["a"])(5),width:1.5}),this.shadowStyle=new ct({globalAlpha:Je,glowColor:Qe.main,glowFalloff:8,glowWidth:8,innerColor:Qe.selected,innerWidth:1}),tt(this,e)}}class ht{constructor(e){this.outline=new ot({color:Qe.selected,outlineColor:Qe.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new ct({globalAlpha:Je,glowColor:Qe.main,glowFalloff:1.5,glowWidth:6,innerColor:Qe.selected,innerWidth:1,radius:2}),tt(this,e)}}class dt extends st{constructor(e){super(),this.extensionType=fe.GROUND_RAY,tt(this,e)}}class ut{constructor(e){this.lineGraphics=new lt,this.pointGraphics=new ht,this.heightPlane=new ct({globalAlpha:Je,glowColor:Qe.main,glowFalloff:8,glowWidth:8,innerColor:Qe.selected,innerWidth:1}),this.heightBox=new ct({globalAlpha:Je,glowColor:Qe.main,glowFalloff:8,glowWidth:8,innerColor:Qe.selected,innerWidth:0,heightFillColor:Qe.main}),this.zVerticalLine=new dt({color:Ke(Qe.main,5*Je/3),falloff:2,innerColor:Ke(Qe.selected,0),renderOccluded:oe["c"].OccludeAndTransparent,stipplePattern:null,width:5,extensionType:fe.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,tt(this,e)}}class pt{constructor(e){this.visualElements=new ut,this.reshapeManipulators=new at,this.zManipulator=new it,tt(this,e)}colorToVec4(e){return bt(e)}}function bt(e){return Object(we["d"])(B["a"].toUnitRGBA(e))}const ft=new pt;var gt=i("ce6d"),Ot=i("1a54"),mt=i("a5d8"),vt=i("648c"),_t=i("3bd5");class jt{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get resources(){return Object(a["k"])(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){this.resourceFactory.recreateGeometry?Object(a["j"])(this._resources)||(this._ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?Object(a["j"])(this._resources)&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const t=this.resourceFactory.createResources(),i=new yt({view:this.resourceFactory.view}),r=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;this._resources={layerView:new yt({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},r&&(this._resources.drapeSourceRenderer=r.registerGeometryDrapeSource(i)),this._syncGeometriesToRenderer()}_destroyResources(){var e;if(Object(a["j"])(this._resources))return;this._ensureRenderGeometriesRemoved();const t=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){Object(a["j"])(this._resources)||Object(a["j"])(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,_t["a"].Geometry.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){Object(a["j"])(this._resources)||Object(a["j"])(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,_t["a"].Geometry.UPDATE),this._resources.geometriesAdded=!0)}}let yt=class extends(Object(mt["a"])(g["a"])){constructor(e){super(e),this.drapeSourceType=vt["a"].Features,this.updatePolicy=ie["j"].SYNC}};Object(r["a"])([Object(o["b"])({constructOnly:!0})],yt.prototype,"view",void 0),Object(r["a"])([Object(o["b"])({readOnly:!0})],yt.prototype,"drapeSourceType",void 0),yt=Object(r["a"])([Object(h["a"])("DrapedVisualElementLayerView")],yt);var xt=i("d408"),St=i("1038"),Tt=i("6061");class wt{constructor(e){this.view=null,this._attachmentOrigin=Object(Ot["g"])(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new gt["a"],this._isDraped=!1,this._geometry=null,this._width=1,this._color=Object(Z["c"])(1,0,1,1),this._innerWidth=0,this._innerColor=Object(Z["c"])(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=oe["c"].OccludeAndTransparentStencil,this.resources=new Ce({view:e.view,createResources:e=>this._createResources(e),recreateGeometry:(e,t)=>(e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries),e.geometries)}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this.drapedResources=new jt({view:e.view,createResources:()=>this._createDrapedResources(),recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()}});let t=!0;this._laserline=new J["a"]({view:e.view});for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this._updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}get laserlineAttached(){return this.attached&&this.visible&&Object(a["k"])(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}get attached(){return this.resources.attached||this.drapedResources.attached}set attached(e){this._updateAttached(e)}_updateAttached(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){Object(q["g"])(e,this._color)||(Object(q["c"])(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(q["g"])(e,this._innerColor)||(Object(q["c"])(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=Object(a["k"])(e)!==Object(a["k"])(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&Object(q["g"])(e,this._stippleOffColor)||(this._stippleOffColor=e?Object(Z["a"])(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,Object(a["k"])(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=Object(a["k"])(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;Object(y["w"])(Et,0,0,0);let t=0;for(const i of e){const e=i.vertexAttributes.get(ce["a"].POSITION),r=i.indices.get(ce["a"].POSITION),n=Object(a["r"])(this.resources.resources).material.isClosed(e.data,r);Object(St["a"])(e,r,n,At)&&(Object(y["e"])(Et,Et,At),t++)}return 0===t?null:(Object(y["k"])(Et,Et,1/t),this.view.renderCoordsHelper.fromRenderCoords(Et,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){Object(a["k"])(this.resources.resources)&&this.resources.resources.material.setParameters(this.materialParameters),Object(a["k"])(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameters(this.materialParameters)}get isClosed(){return Object(a["k"])(this.geometry)&&"polygon"===this.geometry.type}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}get normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===oe["c"].OccludeAndTransparentStencil?oe["c"].OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,i){const r=this._createRenderGeometries();for(const n of r)e.addGeometry(n,t),i.push(n);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createResources(e){const t=new le["a"](this.materialParameters),i=[];return this._recreateGeometry(e,t,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_createDrapedResources(){const e=new le["a"](this.materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const t=this.geometry;if(Object(a["j"])(t))return[];const i=Object(xt["d"])(t,this.view.basemapTerrain.spatialReference),r=[];for(const{position:n}of i.lines){const t={overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:n},removeDuplicateStartEnd:this.isClosed?xt["a"].REMOVE:xt["a"].KEEP},i=new Tt["a"](Object(xt["b"])(t),e),a=Object(Ae["h"])(Mt);Object(Ae["k"])(a,n),Object(q["l"])(i.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),r.push(i)}return r}calculateMapBounds(e){if(Object(a["j"])(this.resources.resources))return!1;const t=this.view.renderCoordsHelper;for(const i of this.resources.resources.geometries){const r=i.vertexAttributes.get(ce["a"].POSITION),n=new Float64Array(r.data.length);Object(Me["l"])(r.data,t.spatialReference,0,n,this.view.spatialReference,0,r.data.length/3),Object(Ae["k"])(e,n)}return!0}_createRenderGeometries(){var e;const t=this.geometry;if(Object(a["j"])(t))return[];const i=Object(xt["c"])(t,this.view.elevationProvider,this.view.renderCoordsHelper,Ie["a"].fromElevationInfo(null!=(e=this.elevationInfo)?e:new u["a"]({mode:Object(d["d"])(t,null)}))),r=[],n=[];for(const{position:a,mapPosition:s}of i.lines){const e={overlayInfo:null,attributeData:{position:a,mapPosition:s},removeDuplicateStartEnd:this.isClosed?xt["a"].REMOVE:xt["a"].KEEP};r.push(Object(xt["b"])(e)),n.push(a)}return this._laserline.pathVerticalPlane=n,r}}const Mt=Object(Ae["f"])(),At=Object(f["f"])(),Et=Object(f["f"])();var Rt=i("5241"),Pt=i("9360");class Ct extends ae{constructor(e){super(e),this.view=null,this._renderOccluded=oe["c"].OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=ft.colorToVec4(ft.reshapeManipulators.vertex.color),this._size=ft.reshapeManipulators.vertex.size,this._outlineColor=ft.colorToVec4(ft.reshapeManipulators.vertex.outlineColor),this._outlineSize=ft.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){Object(q["g"])(e,this._color)||(Object(q["c"])(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(q["g"])(e,this._outlineColor)||(Object(q["c"])(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this.vertexMaterial.setParameters(this.vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this.vertexOutlineMaterial.setParameters(this.vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(Object(a["j"])(e)||0===e.length)return[];const t=.5,i=.5,r=Object(Rt["c"])(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,Ie["a"].fromElevationInfo(this.elevationInfo)),n=[],s=r.numVertices,o=r.position;for(let a=0;a<s;++a){const e=Object(y["w"])(Dt,o[3*a+0],o[3*a+1],o[3*a+2]),r=It(t,e),s=It(i,e);n.push({vertexGeometry:r,vertexOutlineGeometry:s})}return n}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:r}of t)e.addGeometry(i,this.vertexMaterial),e.addGeometry(r,this.vertexOutlineMaterial)}createExternalResources(){this.vertexMaterial=new Pt["a"]({...this.vertexMaterialParameters,writeDepth:!0,cullFace:ie["b"].Back,screenSizeEnabled:!0}),this.vertexOutlineMaterial=new Pt["a"]({...this.vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:ie["b"].Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}const Dt=Object(f["f"])();function It(e,t){return se["a"].createSphereGeometry(e,16,16,{offset:t})}let Lt=class extends gt["a"].EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};Object(r["a"])([Object(o["b"])({constructOnly:!0})],Lt.prototype,"graphic",void 0),Object(r["a"])([Object(o["b"])()],Lt.prototype,"tracking",void 0),Object(r["a"])([Object(o["b"])()],Lt.prototype,"displaying",void 0),Object(r["a"])([Object(o["b"])()],Lt.prototype,"isDraped",void 0),Lt=Object(r["a"])([Object(h["a"])("esri.views.3d.layers.graphics.GraphicState")],Lt);var Nt=i("ae3c"),zt=i("e7e3"),Vt=i("5bab"),Ft=i("bd72"),Gt=i("5aed");let kt=class extends Nt["a"]{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this.geometryType=null,this.labelOptions=new Ft["a"],this.tooltipOptions=new Gt["a"],this.type="draw-3d"}initialize(){const{mode:e,offset:t}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new u["a"]({mode:e,offset:t})}normalizeCtorArgs(e){if(!e.elevationInfo){var t;const i=null==(t=e.hasZ)||t;return{...e,elevationInfo:{mode:i?"absolute-height":"on-the-ground",offset:0}}}return e}initializeGraphic(e){const t=this._createGraphicState=new Lt({graphic:e});return Object(n["b"])([this.view.maskOccludee(e),this.view.trackGraphicState(t),Object(s["f"])(()=>({element:this._outlineVisualElement,isDraped:t.isDraped}),({element:e,isDraped:t})=>{Object(a["b"])(e,e=>e.isDraped=t)},s["a"])])}makeDrawOperation(){const{geometryType:e}=this,t="circle"!==e&&"rectangle"!==e;return new zt["a"]({view:this.view,manipulators:this.manipulators,geometryType:Object(Nt["b"])(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new Vt["c"](this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new Vt["a"](this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new Xe,segmentLabels:t?new U:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:Object(a["k"])(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Object(d["c"])(this.hasZ,this.elevationInfo)})}onActiveVertexChanged(e){return Object(a["k"])(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[e],null):(this._activeVertexVisualElement=new Ct({view:this.view,spatialReference:this.view.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:ft.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=ft.colorToVec4(ft.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,Object(n["c"])(()=>{this._activeVertexVisualElement=Object(a["d"])(this._activeVertexVisualElement)}))}onOutlineChanged(e){if(Object(a["k"])(this._outlineVisualElement))return this._outlineVisualElement.geometry=e,null;const t=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new wt({view:this.view,geometry:e,elevationInfo:t,isDraped:Object(a["k"])(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Object(d["c"])(this.hasZ,t),attached:!1}),ft.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),ft.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,Object(n["c"])(()=>{this._outlineVisualElement=Object(a["d"])(this._outlineVisualElement)})}onRegularVerticesChanged(e){return Object(a["k"])(this._verticesVisualElement)?(this._verticesVisualElement.vertices=e,null):(this._verticesVisualElement=new Ct({view:this.view,spatialReference:this.view.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:ft.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,Object(n["c"])(()=>{this._verticesVisualElement=Object(a["d"])(this._verticesVisualElement)}))}};Object(r["a"])([Object(o["b"])({constructOnly:!0})],kt.prototype,"elevationInfo",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0})],kt.prototype,"geometryType",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,type:Ft["a"]})],kt.prototype,"labelOptions",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,type:Gt["a"]})],kt.prototype,"tooltipOptions",void 0),Object(r["a"])([Object(o["b"])()],kt.prototype,"type",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0})],kt.prototype,"view",void 0),kt=Object(r["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],kt);var Ut,Ht=i("2c4f"),Bt=i("9096"),Wt=i("74af"),qt=i("ca62");function Zt(e,t=Object(d["e"])(e)){return"on-the-ground"!==t.mode&&!(Object(a["j"])(e.geometry)||!e.geometry.hasZ)}!function(e){e[e.TRANSLATE_Z=0]="TRANSLATE_Z",e[e.TRANSLATE_XY=1]="TRANSLATE_XY",e[e.SCALE=2]="SCALE",e[e.ROTATE=3]="ROTATE",e[e.SCALE_ROTATE=4]="SCALE_ROTATE"}(Ut||(Ut={}));var Xt,Yt=i("4e73");!function(e){e[e.NONE=0]="NONE",e[e.ANY=1]="ANY",e[e.Z=2]="Z",e[e.XY=4]="XY"}(Xt||(Xt={}));class $t{constructor(){this.grabbingState=Xt.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=Xt.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((e,t)=>{if(t===Ut.TRANSLATE_Z&&(this.zManipulator=e),e instanceof Yt["a"]&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),Object(a["j"])(this.firstGrabbedXY)&&e.grabbing&&t===Ut.TRANSLATE_XY&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=Xt.ANY,t){case Ut.TRANSLATE_Z:this.grabbingState|=Xt.Z;break;case Ut.TRANSLATE_XY:this.grabbingState|=Xt.XY}})}}function Qt(e){const{view:t,graphic:i}=e,r=new Lt({graphic:i}),a=Jt(e,r),s=[a,Kt(e,a.visualElement,r),t.maskOccludee(i),t.trackGraphicState(r)];return{visualElement:a.visualElement,remove:()=>Object(n["b"])(s).remove()}}function Jt(e,t){const{view:i,graphic:r}=e,a=new wt({view:i,geometry:ii(r)?r.geometry:null,elevationInfo:Object(d["e"])(r),attached:!1});ft.visualElements.lineGraphics.shadowStyle.apply(a);const o=()=>{a.attached=t.displaying};ft.visualElements.lineGraphics.outline.apply(a);const c=[Object(s["f"])(()=>t.displaying,o),Object(s["f"])(()=>t.isDraped,e=>{a.isDraped=e}),t.on("changed",()=>a.geometry=ii(r)?r.geometry:null),Object(n["a"])(a)];return o(),{visualElement:a,remove:()=>Object(n["b"])(c).remove()}}function Kt(e,t,i){const{graphic:r,view:a}=e,o=[],c=Object(d["e"])(r),l="on-the-ground"===c.mode||!c.offset&&"absolute-height"!==c.mode,h=new $t,u=new he({view:a,extensionType:ft.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:oe["c"].OccludeAndTransparent});ft.visualElements.pointGraphics.shadowStyle.apply(u);const p=Object(Te["g"])(ft.visualElements.heightPlaneAngleCutoff),b=new J["a"]({view:a,attached:!1,angleCutoff:p});ft.visualElements.heightPlane.apply(b);let f=1,g=1;const O=()=>{if(h.update(e),!i.displaying||l&&(i.isDraped||!ii(r)||!r.geometry.hasZ))return t.laserlineEnabled=!1,u.attached=!1,void(b.attached=!1);t.laserlineEnabled=!0;{const e=h.grabbingState&Xt.XY?ft.visualElements.laserlineAlphaMultiplier:1;e!==f&&(f=e,ft.visualElements.lineGraphics.shadowStyle.apply(t,e),ft.visualElements.pointGraphics.shadowStyle.apply(u,e))}{const e=h.grabbingState&Xt.Z?ft.visualElements.laserlineAlphaMultiplier:1;e!==g&&(g=e,ft.visualElements.heightPlane.apply(b,e))}ei(u,h),ti(e,t,b,h)};ft.visualElements.zVerticalLine.apply(u),o.push(i.on("changed",O),Object(s["f"])(()=>i.displaying,O),t.events.on("attachment-origin-changed",O),Object(n["a"])(u),Object(n["a"])(b));const m=[],v=()=>{Object(n["b"])(m).remove(),m.length=0,e.forEachManipulator(e=>m.push(e.events.on("grab-changed",O))),e.forEachManipulator(e=>m.push(e.events.on("select-changed",O))),O()};return v(),o.push(e.onManipulatorsChanged(v),Object(n["d"])(()=>Object(n["b"])(m))),Object(n["b"])(o)}function ei(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&Object(a["k"])(t.firstGrabbedXY)?t.firstGrabbedXY:null;Object(a["k"])(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1}function ti(e,t,i,r){if(r.numSelected>0){Object(y["w"])(ri,0,0,0);let t=0;e.forEachManipulator((e,i)=>{i===Ut.TRANSLATE_XY&&e.selected&&e instanceof Yt["a"]&&(Object(y["e"])(ri,ri,e.renderLocation),t++)}),t>0?(i.heightManifoldTarget=Object(y["k"])(ri,ri,1/t),i.attached=!0):i.attached=!1}else{const r=t.attachmentOrigin;Object(a["k"])(r)&&e.view.renderCoordsHelper.toRenderCoords(r,ri)?(i.heightManifoldTarget=ri,i.attached=!0):i.attached=!1}}function ii(e){return Object(a["k"])(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const ri=Object(f["f"])();var ni=i("9180");function ai(e){const{view:t,graphic:i}=e,r=new Lt({graphic:i}),a=[],s=oi(e,r,a);return si(e,r,a,s),a.push(t.trackGraphicState(r)),{visualElement:s,remove(){Object(n["b"])(a).remove()}}}function si(e,t,i,r){const{view:o,graphic:c}=e,l=new he({view:o,extensionType:ft.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:oe["c"].OccludeAndTransparent});ft.visualElements.zVerticalLine.apply(l);const h=new J["a"]({view:o,intersectsLineInfinite:!0,attached:!1});ft.visualElements.pointGraphics.shadowStyle.apply(h);const u=Object(Te["g"])(ft.visualElements.heightPlaneAngleCutoff),p=new J["a"]({view:o,attached:!1,angleCutoff:u});ft.visualElements.heightPlane.apply(p);const b=Object(d["e"])(e.graphic),f=Ie["a"].fromElevationInfo(b),g="on-the-ground"===b.mode||!b.offset&&"absolute-height"!==b.mode,O=new $t;let m=1,v=1;const _=()=>{O.update(e);const i=ci(c),n=g&&(t.isDraped||Object(a["j"])(i)||!i.hasZ);let s=!0;if(!n&&Object(a["k"])(i)){const e=Object(De["f"])(i,o.elevationProvider,f,o.renderCoordsHelper);Object(y["w"])(ui,i.x,i.y,e),Object(Me["w"])(ui,i.spatialReference,ui,o.renderCoordsHelper.spatialReference),l.setStartEndFromWorldDownAtLocation(ui),h.intersectsWorldUpAtLocation=ui}else s=!1;const d=O.grabbingState&Xt.Z?ft.visualElements.laserlineAlphaMultiplier:1;d!==m&&(m=d,ft.visualElements.heightPlane.apply(p,d));const u=Object(Ae["h"])(pi);!n&&t.displaying&&r.calculateMapBounds(u)&&Object(Me["w"])(Object(Ae["q"])(u,ui),o.spatialReference,ui,o.renderCoordsHelper.spatialReference)?(p.heightManifoldTarget=ui,p.attached=!0):p.attached=!1;const b=O.grabbingState&Xt.XY?ft.visualElements.laserlineAlphaMultiplier:1;b!==v&&(v=b,ft.visualElements.pointGraphics.shadowStyle.apply(h,b));const _=s&&t.displaying&&!n;h.attached=_,l.attached=_};i.push(Object(s["f"])(()=>[t.displaying,t.isDraped],_),t.on("changed",_)),e.forEachManipulator(e=>{i.push(e.events.on("grab-changed",_))}),i.push(Object(n["a"])(h)),i.push(Object(n["a"])(l)),i.push(Object(n["a"])(p)),_()}function oi(e,t,i){const{view:r,graphic:a}=e,s=new ze({view:r,geometry:ci(a),elevationInfo:Object(d["e"])(a),attached:!1});return li(e,s,t,i),i.push(Object(n["a"])(s)),s}function ci(e){const t=e.geometry;return Object(a["j"])(t)?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}function li(e,t,i,r){const n=()=>t.attached=i.displaying;hi(e,t,i,r),ft.visualElements.pointGraphics.outline.apply(t),r.push(Object(s["f"])(()=>i.displaying,n,s["a"]))}function hi(e,t,i,r){const{view:s,graphic:o}=e;let c=null;const l=e=>{Object(a["k"])(c)&&(c.remove(),c=null),i.isDraped&&Object(a["k"])(e)&&(c=di(s,e,()=>{t.geometry=e}))},h=()=>{const e=ci(o);l(e),t.geometry=e};r.push(i.on("changed",h),Object(n["d"])(()=>c)),h()}function di(e,t,i){const r=e.elevationProvider.spatialReference;Object(Me["p"])(t,ui,r);const n=ui[0],a=ui[1];return e.elevationProvider.on("elevation-change",e=>{Object(ni["i"])(e.extent,n,a)&&i()})}const ui=Object(f["f"])(),pi=Object(Ae["f"])();function bi(e){switch(Object(a["r"])(e.graphic.geometry).type){case"point":case"mesh":return ai(e);case"polygon":case"polyline":return Qt(e);default:return null}}const fi=[1,.5,0],gi=128,Oi=70,mi=80,vi=.02,_i=54,ji=100,yi=Math.ceil(Oi/3*2),xi=160,Si=.5,Ti=24,wi=9,Mi=xi+30,Ai=xi+53,Ei=60,Ri=23,Pi=5*Math.PI/12,Ci=1*Math.PI/3,Di=10,Ii=.2,Li=30,Ni=53,zi=.2,Vi=.3,Fi=200,Gi=3,ki=1e6;class Ui{constructor(){this._available=!0}set location(e){this._forEachManipulator3D(t=>t.location=e)}set elevationAlignedLocation(e){this._forEachManipulator3D(t=>t.elevationAlignedLocation=e)}set elevationInfo(e){this._forEachManipulator3D(t=>t.elevationInfo=e)}get renderLocation(){let e;return this._forEachManipulator3D(t=>{e||(e=t.renderLocation)}),e}get available(){return this._available}set available(e){this._available=e,this._forEachManipulator3D(t=>t.available=e)}get hovering(){return this.someManipulator(e=>e.hovering)}get grabbing(){return this.someManipulator(e=>e.grabbing)}get dragging(){return this.someManipulator(e=>e.dragging)}hasManipulator(e){return this.someManipulator(t=>t===e)}someManipulator(e){let t=!1;return this.forEachManipulator(i=>{!t&&e(i)&&(t=!0)}),t}_forEachManipulator3D(e){this.forEachManipulator((t,i)=>{t instanceof Yt["a"]&&e(t,i)})}}var Hi=i("b4a5"),Bi=i("c20d");function Wi(e,t,i,r){const n=e.graphic,a=(e,i)=>t({action:e,graphic:n,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY});return i((e,t,i)=>{const s=t.next(e=>("start"===e.action&&a("start",e),e)).next(Object(Bi["g"])(n,r)).next(e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&a("update",e);break;case"end":a("end",e)}return e});return i.next(Object(Bi["i"])(n)).next(()=>{a("end",{screenDeltaX:0,screenDeltaY:0})}),s})}function qi(e){if(Object(a["j"])(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;const i=t[0],r=t[1];return Math.atan2(r[1]-i[1],r[0]-i[0])}var Zi=i("7298");class Xi extends Ui{constructor(e){super(),this._handles=new W["a"],this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),this._angle=0,this._scale=1,this._radius=Oi,this._updateAfterDrag=!1,this.events=new gt["a"],this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}set orthogonalAvailable(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._handles=Object(a["d"])(this._handles),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(const{manipulator:t}of this._arrowManipulatorInfos)e(t,Ut.TRANSLATE_XY)}createGraphicDragPipeline(e,t,i){const r=t.graphic,n=Object(d["e"])(r),s=Object(a["r"])(r.geometry).spatialReference;return Wi(t,i,t=>this.createDragPipeline((i,r,n,a,s)=>t(i,e(i,r,n,a,s),n),n,s,r),this._view.state.viewingMode)}createDragPipeline(e,t,i,r){return Object(n["b"])(this._arrowManipulatorInfos.map(({manipulator:n},a)=>Object(Bi["e"])(n,(n,s,o,c,l)=>{const h=s.next(e=>({...e,manipulatorType:Ut.TRANSLATE_XY})).next(Object(Bi["f"])(this._view,n.elevationAlignedLocation)).next(Object(Hi["e"])(this._view,n.elevationAlignedLocation,t,i,r)).next(Object(Bi["d"])(n.location,this.angle+(a+1)*Math.PI*.5)).next(Object(Bi["c"])());e(n,h,o,c,l)})))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},i){const r=this._radius/Oi,n=_i*r,a=n*Math.sqrt(3)/2,s=se["a"].createExtrudedTriangle(a,n/2,n/2,vi);se["a"].transformInPlace(s,Object(K["f"])(Ee["a"].get(),Object(y["w"])(Ee["d"].get(),0,-a/3,0))),e.renderObjects=[{geometry:s,material:this._opaqueMaterial,stateMask:Zi["c"].Focused},{geometry:s,material:this._transparentMaterial,stateMask:Zi["c"].Unfocused}],e.radius=a/3*2*1.2;const o=Object(K["b"])(Ee["a"].get(),i*Math.PI/2),c=Object(K["f"])(Ee["a"].get(),Object(y["w"])(Ee["d"].get(),0,ji*r,0));Object(K["m"])(t,o,c)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=Object(K["d"])(Ee["a"].get(),e,Object(f["h"])(0,0,1));if(Object(a["j"])(t))return;const i=Object(K["u"])(Ee["a"].get(),Object(y["w"])(Ee["d"].get(),this.displayScale,this.displayScale,this.displayScale)),r=Object(K["m"])(Ee["a"].get(),i,t);for(const n of this._arrowManipulatorInfos){const e=Object(K["m"])(Ee["a"].get(),r,n.transform);n.manipulator.modelTransform=e}}_createArrowManipulator(e){const t=new Yt["a"]({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(f["h"])(0,0,1)}}),i={manipulator:t,transform:Object(ee["d"])()};return this._updateArrowManipulator(i,e),this._handles.add(t.events.on("drag",e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),i}_createMaterial(e=1){const t=B["a"].toUnitRGBA(Qe.main);return t[3]*=e,new Ue["a"]({color:t,transparent:1!==e,cullFace:ie["b"].Back,renderOccluded:oe["c"].Transparent})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map(({manipulator:e})=>e)}}}class Yi{constructor(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new Bi["a"],this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&Object(a["k"])(this.lastDragEvent)){const t=this.lastDragEvent.mapEnd,i=this._snap(this.lastDragEvent.screenEnd);if(Object(a["k"])(i)){const r={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(r)}}this._enabled=e}_snap(e){const t=Object(a["k"])(this.view)?this.view.toMap(e,{exclude:[]}):null;return Object(a["k"])(t)&&Object(a["k"])(this.view)&&(t.z=Object(d["g"])(t,this.view,this.elevationInfo)),t}createDragEventPipelineStep(e,t){return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,e=>{if(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this._snap(e.screenEnd);return Object(a["k"])(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}class $i extends Ui{constructor(e){super(),this._snapToScene=new Yi,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=Oi,this._view=e.view,this._tool=e.tool,null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,Ut.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t,i){const r=t.graphic,n=Object(d["e"])(r),s=Object(a["r"])(r.geometry).spatialReference;return Wi(t,i,t=>this.createDragPipeline((i,r,n,a,s)=>t(i,e(i,r,n,a,s),n),n,s,r),this._view.state.viewingMode)}createDragPipeline(e,t,i,r){const n=this._view;return Object(Bi["e"])(this._manipulator,(a,s,o,c,l)=>{const h=s.next(Object(Bi["f"])(n,a.elevationAlignedLocation)).next(Object(Hi["e"])(n,a.elevationAlignedLocation,t,i,r)).next(this._snapToScene.createDragEventPipelineStep(n,t),this._snapToScene.next).next(e=>({...e,manipulatorType:Ut.TRANSLATE_XY})).next(Object(Bi["c"])());e(a,h,o,c,l)})}_updateManipulatorTransform(){const e=Object(K["u"])(Ee["a"].get(),Object(y["w"])(Ee["d"].get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new Yt["a"]({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(f["h"])(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=se["a"].createCylinderGeometry(vi,1,gi,Object(f["h"])(0,0,1),Object(f["h"])(0,0,0)),t=Object(K["u"])(Object(ee["d"])(),Object(f["h"])(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:Zi["c"].Focused},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:Zi["c"].Unfocused}],this._manipulator.radius=mi*(this._radius/Oi)}_createMaterial(e=1){const t=B["a"].toUnitRGBA(Qe.main);return t[3]*=e,new Ue["a"]({color:t,transparent:1!==e,cullFace:ie["b"].Back,renderOccluded:oe["c"].Transparent})}get test(){return{discManipulator:this._manipulator}}}class Qi extends Ui{constructor(e){super(),this._radius=Oi,this.events=new gt["a"],this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()})}forEachManipulator(e){e(this._manipulator,Ut.TRANSLATE_Z)}createGraphicDragPipeline(e,t,i){const r=Object(a["r"])(t.graphic.geometry).spatialReference;return Wi(t,i,t=>this.createDragPipeline((i,r,n,a,s)=>t(i,e(i,r,n,a,s),n),r),this._view.state.viewingMode)}createDragPipeline(e,t){const i=this._view;return Object(Bi["e"])(this._manipulator,(r,n,a,s,o)=>{const c=n.next(e=>({...e,manipulatorType:Ut.TRANSLATE_Z})).next(Object(Hi["j"])(i,r.renderLocation,t)).next(Object(Bi["c"])());e(r,c,a,s,o)})}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}_updateManipulator(){const e=this._radius/Oi,t=ft.zManipulator.height*e,i=ft.zManipulator.coneHeight*e,r=ft.zManipulator.coneWidth*e,n=ft.zManipulator.width*e,a=[Object(f["h"])(0,0,0),Object(f["h"])(0,0,t)],s=se["a"].createTubeGeometry(a,n/2,16,!1),o=se["a"].createConeGeometry(i,r/2,16,!1),c=[Object(f["h"])(0,0,0),Object(f["h"])(0,0,t+i)],l=e=>{const i=Object(ee["d"])();if(Object(K["j"])(i,i,[0,0,t]),Object(K["r"])(i,i,Math.PI/2),e){const t=1+2*e/r;Object(K["h"])(i,i,[t,t,t])}return i},h=l(0),d=(e,t)=>{const i=Object(Ye["a"])(ft.zManipulator.color,t);return[i.r/255,i.g/255,i.b/255,ft.zManipulator.color.a*e]},u=Object(Wt["c"])(d(1,.25),oe["c"].Occlude),p=Object(Wt["c"])(d(1,0),oe["c"].Occlude),b=Object(Wt["c"])(d(.7,0),ft.zManipulator.renderOccluded),g=Object(Wt["c"])(d(.85,0),ft.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:o,transform:h,material:u,stateMask:Zi["c"].Unfocused},{geometry:s,material:u,stateMask:Zi["c"].Unfocused},{geometry:o,transform:h,material:p,stateMask:Zi["c"].Focused},{geometry:s,material:p,stateMask:Zi["c"].Focused},{geometry:o,transform:h,material:b,stateMask:Zi["c"].Unfocused},{geometry:s,material:b,stateMask:Zi["c"].Unfocused},{geometry:o,transform:h,material:g,stateMask:Zi["c"].Focused},{geometry:s,material:g,stateMask:Zi["c"].Focused}],this._manipulator.radius=n/2+2,this._manipulator.collisionType={type:"line",paths:[c]}}_createManipulator(){const e=new Yt["a"]({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});e.applyObjectTransform=e=>{const t=this._view.state.camera,i=Ji;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const r=Object(y["n"])(t.eye,i),n=t.computeRenderPixelSizeAtDist(r),a=Object(y["f"])(Ki,i,t.eye);Object(y["r"])(a,a);const s=er;this._view.renderCoordsHelper.worldUpAtPosition(Ji,s);const o=Math.abs(Object(y["i"])(a,s)),c=Object(y["j"])(Ki,a,s),l=Object(y["j"])(Ki,c,s),h=Object(Te["e"])(o,.01,1),d=1-Math.sqrt(1-h*h)/h/t.fullWidth,u=this._radius/Oi,p=ft.zManipulator.width*u;Object(y["k"])(l,Object(y["r"])(l,l),(1/d-1)*r+n*p),e[12]-=Ki[0],e[13]-=Ki[1],e[14]-=Ki[2]},this._manipulator=e,this._updateManipulator()}get test(){return{manipulator:this._manipulator}}}const Ji=Object(f["f"])(),Ki=Object(f["f"])(),er=Object(f["f"])();class tr extends Ui{constructor(e){super(),this._handles=new W["a"],this._angleDeferred=null,this._interactive=!0;const{tool:t,view:i,snapToScene:r,radius:n}=e;this._view=i,this.xyManipulation=new $i({tool:t,view:i,snapToScene:r,radius:n}),this.xyAxisManipulation=new Xi({tool:t,view:i,radius:n}),this.zManipulation=new Qi({tool:t,view:i,radius:n}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this._autoHideXYAxis(),this.forEachManipulator(e=>{this._handles.add(e.events.on("grab-changed",()=>this._updateManipulatorInteractivity()))})}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t,i){return Object(n["b"])([this.xyManipulation.createGraphicDragPipeline((t,i,r,n,a)=>e(rr.XY,t,i,r,n,a),t,i),this.xyAxisManipulation.createGraphicDragPipeline((t,i,r,n,a)=>e(rr.XY_AXIS,t,i,r,n,a),t,i),this.zManipulation.createGraphicDragPipeline((t,i,r,n,a)=>e(rr.Z,t,i,r,n,a),t,i)])}createDragPipeline(e,t,i,r){return Object(n["b"])([this.xyManipulation.createDragPipeline((t,i,r,n,a)=>e(rr.XY,t,i,r,n,a),t,i,r),this.xyAxisManipulation.createDragPipeline((t,i,r,n,a)=>e(rr.XY_AXIS,t,i,r,n,a),t,i,r),this.zManipulation.createDragPipeline((t,i,r,n,a)=>e(rr.Z,t,i,r,n,a),i)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}set angleDeferred(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator(t=>e(t,Ut.TRANSLATE_XY)),this.xyAxisManipulation.forEachManipulator(t=>e(t,Ut.TRANSLATE_XY)),this.zManipulation.forEachManipulator(t=>e(t,Ut.TRANSLATE_Z))}get xyAxisVisible(){const e=this.xyManipulation.someManipulator(e=>e.focused)||this.xyAxisManipulation.someManipulator(e=>e.focused);return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}_autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if(Object(c["a"])("esri-mobile"))return;const i=[];t.forEachManipulator(e=>i.push(e)),e.forEachManipulator(e=>i.push(e));const r=()=>{const t=[];this.xyAxisVisible?Object(a["k"])(this._angleDeferred)&&(this.angle=this._angleDeferred()):e.forEachManipulator(e=>t.push(e.disableDisplay())),this._handles.remove(ir),this._handles.add(t,ir)};for(const n of i)this._handles.add(n.events.on("focus-changed",r));this._view.inputManager&&this._handles.add(Object(s["g"])(()=>{var e;return null==(e=this._view.inputManager)?void 0:e.latestPointerType},r)),r()}_updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator(t=>{t.interactive=!e&&this._interactive||t.grabbing})}static radiusForSymbol(e){const t=Object(a["k"])(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some(e=>"icon"===e.type)?yi:Oi}}const ir="disable-xy-axis-display";var rr;!function(e){e[e.XY=0]="XY",e[e.XY_AXIS=1]="XY_AXIS",e[e.Z=2]="Z"}(rr||(rr={}));var nr=i("3cde");class ar extends Ui{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,Ut.TRANSLATE_XY)}createGraphicDragPipeline(e){return Wi(this._graphicState,e,e=>this.createDragPipeline(e),this._view.state.viewingMode)}createDragPipeline(e){const t=this._view,i=this._graphicState.graphic,r=Object(a["k"])(i.geometry)?i.geometry.spatialReference:null;return Object(Bi["e"])(this._manipulator,(n,a,s,o,c)=>{const l=a.next(Object(Hi["f"])(c,t,i,r)).next(Object(Bi["b"])()).next(Object(Bi["c"])());e(n,l,s,o,c)})}_createManipulator(){const e=this._view,t=this._graphicState.graphic;this._manipulator=new nr["a"]({graphic:t,view:e,selectable:!0,cursor:"move"})}}var sr=i("243f"),or=i("4772"),cr=i("2c8f"),lr=i("1f1c"),hr=i("8a19"),dr=i("4492"),ur=i("f315"),pr=i("cfb5");let br=class extends pr["a"]{constructor(e){super(e),this.type="translate-graphic",this.distance=ur["f"]}};Object(r["a"])([Object(o["b"])()],br.prototype,"type",void 0),Object(r["a"])([Object(o["b"])()],br.prototype,"distance",void 0),br=Object(r["a"])([Object(h["a"])("esri.views.interactive.tooltip.TranslateGraphicTooltipInfo")],br);let fr=class extends pr["a"]{constructor(e){super(e),this.type="translate-z",this.distance=ur["f"]}};Object(r["a"])([Object(o["b"])()],fr.prototype,"type",void 0),Object(r["a"])([Object(o["b"])()],fr.prototype,"distance",void 0),fr=Object(r["a"])([Object(h["a"])("esri.views.interactive.tooltip.TranslateZTooltipInfo")],fr);let gr=class extends pr["a"]{constructor(e){super(e),this.type="translate-vertex",this.distance=ur["f"],this.elevation=null,this.area=null,this.totalLength=null}};Object(r["a"])([Object(o["b"])()],gr.prototype,"type",void 0),Object(r["a"])([Object(o["b"])()],gr.prototype,"distance",void 0),Object(r["a"])([Object(o["b"])()],gr.prototype,"elevation",void 0),Object(r["a"])([Object(o["b"])()],gr.prototype,"area",void 0),Object(r["a"])([Object(o["b"])()],gr.prototype,"totalLength",void 0),gr=Object(r["a"])([Object(h["a"])("esri.views.interactive.tooltip.TranslateVertexTooltipInfo")],gr);var Or=i("3170");class mr{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class vr{constructor(e,t,i){this.dx=e,this.dy=t,this.allGraphics=i,this.type="graphic-move"}}class _r{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}let jr=class extends(Object(Bt["b"])(gt["a"].EventedMixin(or["a"]))){constructor(e){super(e),this.graphics=new Ht["a"],this.enableZ=!0,this.tooltipOptions=new Gt["a"],this.type="move-3d",this._snappingPipeline=new hr["a"],this._tooltip=null}initialize(){const{graphics:e,view:t}=this;this.own([e.on("change",()=>this._refreshManipulators()),Object(s["f"])(()=>this.tooltipOptions.enabled,e=>{this._tooltip=e?new dr["a"]({view:t}):Object(a["d"])(this._tooltip)},s["e"])]),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._tooltip=Object(a["d"])(this._tooltip),this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const e=this.graphics.toArray().filter(e=>Object(sr["a"])(e)===qt["a"].SUPPORTED).map(e=>new yr(e));e.length&&(this._createManipulators(e),this._createVisualElements(e),this.handles.add(e.map(e=>this.view.trackGraphicState(e.state))),this._updateMoveManipulation(e))}_createManipulators(e){for(const t of e){const i=t.state;t.manipulationXY=new ar({tool:this,view:this.view,graphicState:i}),t.manipulationXY.forEachManipulator(e=>this.handles.add([e.events.on("immediate-click",e=>{this.emit("immediate-click",{...e,graphic:i.graphic}),e.stopPropagation()}),e.events.on("grab-changed",({action:e})=>{const{tooltipOptions:t,_tooltip:i}=this;Object(a["j"])(i)||("focus"===e?i.info=new br({tooltipOptions:t}):i.clear())})])),this.handles.add(t.manipulationXY.createDragPipeline((t,i,r,n)=>this._buildDragEventPipeline(e,rr.XY,t,i,r,n)))}this._createMoveManipulation(e)}_createMoveManipulation(e){const t=new tr({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?tr.radiusForSymbol(e[0].graphic.symbol):Oi});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator((e,i)=>{this.handles.add(e.events.on("immediate-click",i=>{t.zManipulation.hasManipulator(e)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.getItemAt(0)}),i.stopPropagation()})),i===Ut.TRANSLATE_XY&&this.handles.add(e.events.on("focus-changed",({action:e})=>{const{tooltipOptions:t,_tooltip:i}=this;Object(a["j"])(i)||("focus"===e?i.info=new br({tooltipOptions:t}):i.clear())})),i===Ut.TRANSLATE_Z&&this.handles.add(e.events.on("focus-changed",({action:e})=>{const{tooltipOptions:t,_tooltip:i}=this;Object(a["j"])(i)||("focus"===e?i.info=new fr({tooltipOptions:t}):i.clear())}))});const i=()=>this._updateMoveManipulation(e);for(const n of e)this.handles.add([n.state.on("changed",i),Object(s["f"])(()=>n.state.displaying,i)]);const r=e[e.length-1];this.handles.add(r.state.on("changed",()=>this._updateMoveManipulationAngle(r))),this.handles.add(t.createDragPipeline((t,i,r,n,a)=>this._buildDragEventPipeline(e,t,i,r,n,a),Object(d["e"])(r.graphic),Object(a["r"])(r.graphic.geometry).spatialReference,r.graphic)),this._updateMoveManipulationAngle(r)}_createVisualElements(e){for(const t of e){const i=t.graphic,r=bi({view:this.view,graphic:i,forEachManipulator:e=>{t.manipulationXY.forEachManipulator(e),this._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:()=>Object(n["c"])()});Object(a["j"])(r)||(t.geometryRepresentation=r.visualElement,t.geometryRepresentation instanceof wt&&this.handles.add([t.geometryRepresentation.events.on("attachment-origin-changed",()=>{t.state.isDraped||this._updateMoveManipulation(e)}),Object(s["f"])(()=>t.state.isDraped,()=>this._updateMoveManipulation(e))]),this.handles.add(r))}}_updateMoveManipulationAngle(e){this._moveManipulation.angleDeferred=()=>qi(e.graphic.geometry)}_updateMoveManipulation(e){const t=Object(Ot["g"])(0,0,0,this.view.spatialReference);let i=0,r=!1;const n=this._moveManipulation;for(const s of e){if(!s.state.displaying)continue;const e=s.state.graphic;this.enableZ&&Zt(e)&&(r=!0);const n=s.geometryRepresentation instanceof wt&&!s.state.isDraped?s.geometryRepresentation.attachmentOrigin:Object(Wt["f"])(this.view,e);Object(a["k"])(n)&&(t.x+=n.x,t.y+=n.y,t.z+=n.z,i++)}i>0?(t.x/=i,t.y/=i,t.z/=i,n.location=t,n.xyManipulation.available=!0,n.xyAxisManipulation.available=!0,n.zManipulation.available=r):n.available=!1}_buildDragEventPipeline(e,t,i,r,n,a){const s=[],o=[];let c=null,l=null;const h=()=>{for(const e of s)e.dragging=!1;s.length=0,o.length=0,c=null,l=null,this._moveManipulation.interactive=!0};if(1===e.length&&t===rr.XY){const t=e[0].graphic;r=this._buildSnappingPipelineSteps(t,Object(d["e"])(t),r,n,a)}const u=r.next(t=>{if("start"===t.action){s.length=0,o.length=0;for(const t of e)t.dragging||!t.manipulationXY.hasManipulator(i)&&t.manipulationXY.grabbing||(s.push(t),o.push(t.graphic),t.dragging=!0);if(0!==o.length&&(this._moveManipulation.interactive=!1,c=Object(Bi["h"])(o,this.view.state.viewingMode),l=Object(Bi["j"])(o),this.emit("graphic-move-start",new mr(o)),this.destroyed))return null}return 0!==o.length?t:null}).next(e=>c(e)).next(i=>this._updateMoveTooltip(i,t,e)).next(e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),i=this.view.toScreen(e.mapEnd),r=i.x-t.x,n=i.y-t.y;if(this.emit("graphic-move",new vr(r,n,o)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new _r(o)),this.destroyed)return null;h()}});return n.next(e=>l(e)).next(()=>{if(this.emit("graphic-move-stop",new _r(o)),this.destroyed)return null;h()}),u}_updateMoveTooltip(e,t,i){const{tooltipOptions:r,_tooltip:n}=this;if(Object(a["j"])(n))return e;if(n.clear(),t===rr.XY||t===rr.XY_AXIS)if("end"===e.action)n.info=new br({tooltipOptions:r});else{const t=0===i.length?"absolute-height":i[0].state.isDraped?"on-the-ground":"absolute-height",s=Object(D["c"])(e.mapStart,e.mapEnd,t);Object(a["k"])(s)&&(n.info=new br({tooltipOptions:r,distance:s}))}return t===rr.Z&&("end"===e.action?n.info=new fr({tooltipOptions:r}):Object(a["b"])(Object(Or["i"])(e.mapStart,e.mapEnd),e=>{n.info=new fr({tooltipOptions:r,distance:e})})),e}_buildSnappingPipelineSteps(e,t,i,r,n){const s=e.geometry;if(Object(a["j"])(s)||"point"!==s.type&&"mesh"!==s.type)return i;const o=("point"===s.type?s:s.anchor).clone(),c=new lr["a"]({elevationInfo:t,pointer:n,editGeometryOperations:cr["a"].fromGeometry(o,this.view.state.viewingMode),visualizer:new Xe,excludeFeature:e}),l=this.snappingManager;return i.next(t=>(o.z=Object(d["a"])(this.view,o,Object(d["e"])(e),{mode:"absolute-height",offset:0}),{...t,snapOrigin:c.coordinateHelper.pointToVector(o)})).next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:c,snappingManager:l,cancel:r,updatingHandles:this.updatingHandles}),this._snappingPipeline.next)}get test(){return{tooltip:this._tooltip}}};Object(r["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],jr.prototype,"view",void 0),Object(r["a"])([Object(o["b"])()],jr.prototype,"graphics",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],jr.prototype,"enableZ",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,type:Gt["a"]})],jr.prototype,"tooltipOptions",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0})],jr.prototype,"snappingManager",void 0),Object(r["a"])([Object(o["b"])()],jr.prototype,"type",void 0),Object(r["a"])([Object(o["b"])()],jr.prototype,"updating",null),jr=Object(r["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],jr);class yr{constructor(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Lt({graphic:e})}get graphic(){return this.state.graphic}}var xr=i("240c"),Sr=i("521c"),Tr=i("7289"),wr=i("ac8e"),Mr=i("5414");function Ar(e,t,i){const r="on-the-ground"===i.mode?Mr["b"].XY:Mr["b"].XYZ;return new Mr["a"](e,r,t,0)}function Er(e,t,i){const r=Object(f["f"])();if(!e.renderCoordsHelper.toRenderCoords(t,r))return null;const n=Rr(e,t,Object(Tr["q"])(i.plane)),s=Rr(e,t,i.edgeDirection);if(Object(a["j"])(n)||Object(a["j"])(s))return null;const o=Object(y["j"])(Object(f["f"])(),n,s);return Object(Tr["g"])(r,o,Object(Tr["d"])())}function Rr(e,t,i){const r=Object(Ot["g"])(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),n=Object(f["f"])(),a=Object(f["f"])();return e.renderCoordsHelper.toRenderCoords(t,n)&&e.renderCoordsHelper.toRenderCoords(r,a)?Object(y["v"])(a,n,a):null}function Pr(e,t,i){const r=Object(Tr["q"])(e),n=Object(y["v"])(Object(f["f"])(),t,i),a=Object(y["j"])(Object(f["f"])(),n,r),s=Object(y["j"])(Object(f["f"])(),n,a);return Object(ee["e"])(n[0],n[1],n[2],0,a[0],a[1],a[2],0,s[0],s[1],s[2],0,0,0,0,1)}function Cr(e,t,i){const r=i.projectToRenderScreen(e,Object(p["d"])()),n=i.projectToRenderScreen(t,Object(p["d"])());return Object(a["k"])(r)&&Object(a["k"])(n)?Object(y["t"])(Object(y["f"])(r,r,n)):0}var Dr=i("fe4f"),Ir=i("8bbe");let Lr=class extends pr["a"]{constructor(e){super(e),this.type="reshape-edge-offset",this.distance=ur["f"]}};Object(r["a"])([Object(o["b"])()],Lr.prototype,"type",void 0),Object(r["a"])([Object(o["b"])()],Lr.prototype,"distance",void 0),Lr=Object(r["a"])([Object(h["a"])("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],Lr);var Nr=i("0f2e"),zr=i("5dd2");let Vr=class extends(gt["a"].EventedMixin(Bt["a"])){constructor(e){super(e),this._vertexManipulatorMaterial=Object(Wt["c"])(ft.colorToVec4(ft.reshapeManipulators.vertex.color),ft.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=Object(Wt["d"])(ft.colorToVec4(ft.reshapeManipulators.vertex.outlineColor),ft.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=Object(Wt["d"])(ft.colorToVec4(ft.reshapeManipulators.vertex.hoverOutlineColor),ft.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=Object(Wt["c"])(ft.colorToVec4(ft.reshapeManipulators.edge.color),ft.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=Object(Wt["d"])(ft.colorToVec4(ft.reshapeManipulators.edge.outlineColor),ft.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=Object(Wt["c"])(ft.colorToVec4(ft.reshapeManipulators.edgeOffset.color),ft.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=Object(Wt["c"])(ft.colorToVec4(ft.reshapeManipulators.edgeOffset.hoverColor),ft.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=Object(Wt["c"])(ft.colorToVec4(ft.reshapeManipulators.selected.color),ft.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=Object(Wt["d"])(ft.colorToVec4(ft.reshapeManipulators.selected.outlineColor),ft.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=Object(Wt["d"])(ft.colorToVec4(ft.reshapeManipulators.selected.hoverOutlineColor),ft.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._edgeOffsetManipulatorGeometryInside=null,this._edgeOffsetManipulatorGeometryOutside=null,this._manipulatorHandles=new W["a"],this._manipulatorInfos=[],this._editGeometryOperations=null,this._graphicMoveManipulation=null,this._moveManipulation=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=Br.NONE,this._outlineVisualElement=null,this._segmentLabels=null,this.outputGeometry=null,this._snappingPipeline=new hr["a"],this._snappingPipelineHandle=new hr["a"],this._vertexLaserLineVisualElement=null}initialize(){const{graphic:e,view:t}=this,i=this._graphicState=new Lt({graphic:e});this._tooltip=new dr["a"]({view:t}),this.own([Object(s["f"])(()=>i.displaying,e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e}),Object(s["f"])(()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset}),({labels:e,enabled:t,edgeOffsetEnabled:i})=>{Object(a["k"])(e)&&(e.visible=t,e.edgeDistance=i?"far":"default")},s["a"]),Object(s["g"])(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),s["a"]),this.view.trackGraphicState(i)])}destroy(){this._segmentLabels=Object(a["d"])(this._segmentLabels),this._tooltip=Object(a["d"])(this._tooltip),this._editGeometryOperations=Object(a["d"])(this._editGeometryOperations),this._moveManipulation=Object(a["d"])(this._moveManipulation),this._graphicMoveManipulation=Object(a["d"])(this._graphicMoveManipulation),this._manipulatorHandles=Object(a["d"])(this._manipulatorHandles),this.manipulators.removeAll(),this._manipulatorInfos=[],this._resetGrabbingDragging()}get inputGeometry(){return Object(a["k"])(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(e){this._recreateEditGeometryAndManipulators(e)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}removeSelectedVertices(){const e=this._manipulatorInfos.filter(e=>e.manipulator.selected&&"vertex"===e.type);this._removeVertices(e)}manipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._moveManipulation=Object(a["d"])(this._moveManipulation),this._graphicMoveManipulation=Object(a["d"])(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[]}_resetGrabbingDragging(){this._numGrabbing=0,this._numDragging=0}_createManipulators(){if(Object(a["j"])(this._editGeometryOperations))return;const e=Object(d["e"])(this.graphic);for(const t of this._editGeometryOperations.data.components){for(const i of t.vertices)this._createVertexOrEdgeManipulator(i,e);for(const i of t.edges)this._createVertexOrEdgeManipulator(i,e)}this._createGraphicMoveManipulators(e)}get canRedo(){return Object(a["k"])(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return Object(a["k"])(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if(Object(a["j"])(this._editGeometryOperations))return null;const e=this._editGeometryOperations.redo();return Object(a["k"])(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}undo(){if(Object(a["j"])(this._editGeometryOperations))return null;this.emit("undo");const e=this._editGeometryOperations.undo();return Object(a["k"])(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}_recreateManipulators(){this._removeManipulators(),this._resetGrabbingDragging(),this._tooltip.clear(),this._createManipulators()}_recreateEditGeometryAndManipulators(e=this.inputGeometry){this._removeManipulators(),this._resetGrabbingDragging(),this._tooltip.clear(),Object(a["j"])(e)||(Object(a["d"])(this._editGeometryOperations),this._editGeometryOperations=cr["a"].fromGeometry(e,this.view.state.viewingMode),this._createManipulators(),Object(a["d"])(this._segmentLabels),this._segmentLabels=new U({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:Object(d["e"])(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled}))}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return t;let i=0;const r=[],n=this._manipulatorInfos.some(e=>"vertex"===e.type&&e.manipulator.selected),a=e===Wr.SELECTED_OR_ALL&&n;for(const s of this._manipulatorInfos)"vertex"===s.type&&(s.manipulator.grabbing||a&&!s.manipulator.selected||r.push(s),i++);if(0===r.length)return t;if(this._moveVertices(r,t),r.length===i){if(this._updateEventState(Br.MOVING),this.destroyed)return t;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(Br.RESHAPING),this.destroyed)return t;this.emit("reshape",{type:"reshape",mover:this.graphic})}return t}_isMultiVertexSelection(){let e=0;for(const t of this._manipulatorInfos)"vertex"===t.type&&t.manipulator.selected&&e++;return e>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(Br.RESHAPING),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:r}=e;if(!t&&!i&&!r)return;const n=[];for(const a of this._manipulatorInfos)"vertex"===a.type&&(a.manipulator.selected&&!a.manipulator.grabbing||a===e.info)&&n.push(a);this._moveVertices(n,e,Ir["a"].ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case Br.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case Br.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case Br.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case Br.MOVING:switch(this._reshapeEventState){case Br.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case Br.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case Br.RESHAPING:switch(this._reshapeEventState){case Br.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case Br.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulators(e){const{graphic:t,handles:i,tool:r,view:n}=this,o=this._graphicState;if(this._graphicMoveManipulation=new ar({tool:r,view:n,graphicState:o}),this.enableMoveGraphic){let e=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((t,i,r)=>{i.next(e=>this._trackNumDragging(e)).next(t=>("start"===t.action&&(e=Object(a["r"])(this._editGeometryOperations).createUndoGroup()),t)).next(e=>this._perGraphicManipulatorDragAction(Wr.ALL,e)).next(e=>(this._updateTranslateGraphicTooltip(rr.XY,e),e)).next(t=>{"end"===t.action&&(this._tooltip.clear(),e=Object(a["q"])(e))}),r.next(this._cancelDragOperation(()=>e=Object(a["q"])(e)))}))}else this._graphicMoveManipulation.forEachManipulator(e=>{e.grabbable=!1,e.cursor=null});this._graphicMoveManipulation.forEachManipulator(e=>this._manipulatorHandles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",e=>{this._manipulatorInfos.some(e=>e.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()})])),this._moveManipulation=new tr({tool:r,view:n,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&Zt(t),snapToScene:!1,radius:tr.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator((e,r)=>{i.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",i=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some(e=>e.manipulator.selected)||this.emit("immediate-click",{...i,graphic:t}),i.stopPropagation()})]),i.add(e.events.on("focus-changed",({action:e})=>{"focus"===e&&this._tooltipOptions.enabled?this._updateTranslateTooltip(r===Ut.TRANSLATE_Z?rr.Z:rr.XY):this._tooltip.clear()}))}),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const c=Object(a["r"])(t.geometry).spatialReference;i.add([this._moveManipulation.createDragPipeline((i,n,s,o,c)=>{const l=s.next(e=>this._trackNumDragging(e)).next(e=>{const t=this._manipulatorInfos.filter(e=>"vertex"===e.type&&e.manipulator.selected);return e.manipulatorType===Ut.TRANSLATE_XY&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:{...e,info:null}}).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:e=>!!e.info,cancel:o,snappingManager:r.snappingManager,snappingContext:new lr["a"]({editGeometryOperations:Object(a["r"])(this._editGeometryOperations),elevationInfo:e,pointer:c,excludeFeature:t,visualizer:new Xe}),updatingHandles:this.updatingHandles}),this._snappingPipelineHandle.next).next(Object(Bi["b"])()).next(e=>this._perGraphicManipulatorDragAction(Wr.SELECTED_OR_ALL,e)).next(e=>(this._updateTranslateTooltip(i,e),e));return o.next(this._cancelDragOperation()),l},e,c,t),Object(s["f"])(()=>null==o?void 0:o.displaying,()=>{this._updateMoveManipulationPosition()},s["a"]),o.on("changed",()=>this._updateMoveManipulationPosition()),Object(s["f"])(()=>null==o?void 0:o.isDraped,e=>{const t="align-move-manipulation";e?i.add(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),t):i.remove(t)},s["a"])]),this._updateMoveManipulationPosition();const l=bi({view:n,graphic:t,forEachManipulator:e=>{if(!this.destroyed){Object(a["k"])(this._graphicMoveManipulation)&&this._graphicMoveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,Ut.TRANSLATE_XY);this._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});Object(a["k"])(l)&&(this._outlineVisualElement=l.visualElement instanceof wt?l.visualElement:null),Object(a["k"])(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",()=>{o.isDraped||this._updateMoveManipulationPosition()}),Object(s["f"])(()=>o.isDraped,()=>this._updateMoveManipulationPosition())]),this._manipulatorHandles.add(l)}_createEdgeOffsetManipulator(e,t=Object(d["e"])(this.graphic)){const i=ft.reshapeManipulators.edgeOffset,r=i.size/2,s=r+i.collisionPadding;if(Object(a["j"])(this._edgeOffsetManipulatorGeometryInside)||Object(a["j"])(this._edgeOffsetManipulatorGeometryOutside)){const e=r/s,t=e*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=se["a"].createExtrudedTriangle(t,e/2,e/2,i.height,i.offset),this._edgeOffsetManipulatorGeometryOutside=se["a"].createExtrudedTriangle(-t,e/2,e/2,i.height,-i.offset)}const o=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:Zi["c"].Unfocused},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:Zi["c"].Focused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:Zi["c"].Unfocused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:Zi["c"].Focused}],c=new Yt["a"]({view:this.view,renderObjects:o,elevationInfo:"on-the-ground"!==t.mode||Object(wr["i"])(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:s,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:Object(f["h"])(0,0,1)},collisionPriority:1}),l=new Yt["a"]({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default"}),h={manipulator:c,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:l,elevationInfo:t,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(h,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(h);const u=this._getManipulatorInfoFromHandle(h.handle.leftVertex).manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(h)),p=this._getManipulatorInfoFromHandle(h.handle.rightVertex).manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(h));h.locationUpdateHandle=Object(n["b"])([u,p]),this._manipulatorHandles.add(h.locationUpdateHandle,c),this._manipulatorHandles.add([this._watchAndUpdateGrabState(c,!0),this._watchAndUpdateGrabState(l,!0)],c),this._manipulatorHandles.add(Object(Bi["e"])(c,this._createEdgeOffsetPipeline(h,t)),c),this._manipulatorHandles.add(Object(Bi["e"])(l,(e,i,r,n)=>{if("touch"===n)this._createEdgeOffsetPipeline(h,t)(e,i,r);else if(this.enableMoveGraphic){const n=this.graphic,s=Object(a["k"])(n.geometry)?n.geometry.spatialReference:null;i.next(e=>this._trackNumDragging(e)).next(Object(Bi["f"])(this.view,e.elevationAlignedLocation)).next(Object(Hi["e"])(this.view,e.elevationAlignedLocation,t,s,n)).next(Object(Bi["c"])()).next(Object(Bi["b"])()).next(e=>this._perGraphicManipulatorDragAction(Wr.ALL,e)).next(e=>(this._updateTranslateGraphicTooltip(rr.XY,e),e)).next(e=>{"end"===e.action&&this._tooltip.clear()}),r.next(this._cancelDragOperation())}}),c);const b=e=>{this._manipulatorInfos.some(e=>e.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()};return this._manipulatorHandles.add([c.events.on("immediate-click",b),l.events.on("immediate-click",b),c.events.on("focus-changed",({action:e})=>{const t=this._tooltipOptions;"focus"===e&&t.enabled?this._tooltip.info=new Lr({tooltipOptions:t}):this._tooltip.clear()})],c),this._manipulatorInfos.push(h),this.manipulators.add(c),this.manipulators.add(l),this.emit("manipulators-changed"),h}_autoHideEdgeOffsetManipulator(e,t){const i=e.manipulator,r=e.edgeManipulator,s=()=>{Object(a["q"])(e.visibilityHandle);const s=Cr(this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,this.view.state.camera)<t;(!i.focused&&!r.focused||s)&&(i.grabbable=!s,r.grabbable=!s,e.visibilityHandle=Object(n["b"])([i.disableDisplay(),{remove:()=>{i.grabbable=!0,r.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([i.events.on("focus-changed",s),r.events.on("focus-changed",s),{remove:()=>{Object(a["q"])(e.visibilityHandle),this.manipulators.remove(r)}}],i),s()}_updateEdgeOffsetManipulator(e){this._updateManipulatorPosition(e);const t=Object(a["r"])(this._editGeometryOperations).data.coordinateHelper,i=Er(this.view,e.manipulator.elevationAlignedLocation,Ar(t,e.handle,Object(a["r"])(e.manipulator.elevationInfo))),r=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,n=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,s=Object(a["k"])(i)?Pr(i,r,n):ee["a"];e.manipulator.modelTransform=s,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=s;const o=Object(y["p"])(Object(y["f"])(Ur,r,n))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-o,0,0],[o,0,0]]]}}_createEdgeOffsetPipeline(e,t){return(i,r,n)=>{this._clearSelection();const{step:s,cleanup:o}=this._initializeEdgeOffset(e,t);r.next(e=>this._trackNumDragging(e)).next(Object(Bi["f"])(this.view,i.elevationAlignedLocation)).next(s).next(Object(Hi["i"])(this.view)).next(Object(Hi["b"])(this.view,Object(a["r"])(this._editGeometryOperations).data.spatialReference)).next(Object(Bi["b"])()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(e)).next(this._showEdgeOffsetTooltip()).next(e=>{"end"===e.action&&o()}),n.next(e=>(o(),e)).next(e=>(this._tooltip.clear(),e)).next(this._cancelDragOperation())}}_initializeEdgeOffset(e,t){const i=Object(a["r"])(this._editGeometryOperations),r=Ar(i.data.coordinateHelper,e.handle,t),o=i.createUndoGroup(),c=Er(this.view,e.manipulator.elevationAlignedLocation,r);r.requiresSplitEdgeLeft&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge),1),r.requiresSplitEdgeRight&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge),0);const l=()=>new Sr["a"]({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:Object(a["r"])(this._editGeometryOperations).data.spatialReference}),h=new wt({view:this.view,isDraped:this._graphicState.isDraped,geometry:l(),elevationInfo:e.elevationInfo,width:ft.visualElements.lineGraphics.outline.width,color:ft.colorToVec4(Qe.main),attached:!0});let d;const u=()=>{this._cleanEdgeOffsetCollapsedEdges(e),d=Object(a["q"])(d)},p=this.on("undo",u);return d=Object(n["b"])([Object(n["a"])(h),Object(s["f"])(()=>this._graphicState.isDraped,e=>h.isDraped=e),this._graphicState.on("changed",()=>h.geometry=l()),o,p]),{step:e=>Object(a["j"])(r)||Object(a["j"])(c)?(u(),null):{...e,operation:r,plane:c},cleanup:u}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||Object(a["j"])(t.operation))return t;this._updateEventState(Br.RESHAPING);const{mapDeltaX:i,mapDeltaY:r,mapDeltaZ:n}=t;return(i||r||n)&&(this._offsetEdge(e,t),this.emit("reshape",{type:"reshape",mover:this.graphic})),t}}_applyComputeEdgeOffsetDistanceStep(){return e=>{const{operation:t,mapEnd:i}=e;if(Object(a["j"])(t)||Object(a["j"])(i))return e;const r=t.signedDistanceToPoint(i);return{...e,signedDistance:r}}}_showEdgeOffsetTooltip(){return e=>{const{mapEnd:t,signedDistance:i,operation:r}=e,n=this._tooltip,s=this._tooltipOptions;if(!s.enabled||Object(a["j"])(i))return n.clear(),e;const o=Gr(this._graphicState.isDraped,-i,t,r.plane,Object(a["r"])(this._editGeometryOperations).data.coordinateHelper);return Object(a["j"])(n.info)||"reshape-edge-offset"!==n.info.type?n.info=new Lr({tooltipOptions:s,distance:o}):n.info.distance=o,e}}_cleanEdgeOffsetCollapsedEdges(e){var t,i;const r=null==(t=e.handle.leftVertex.leftEdge)?void 0:t.leftVertex,n=e.handle.leftVertex,s=null==(i=e.handle.rightVertex.rightEdge)?void 0:i.rightVertex,o=e.handle.rightVertex,c=Object(a["r"])(this._editGeometryOperations).data.coordinateHelper,l=1e-6,h=[];r&&c.distance(r.pos,n.pos)<l&&h.push(this._getManipulatorInfoFromHandle(n)),(c.distance(n.pos,o.pos)<l||s&&c.distance(s.pos,o.pos)<l)&&h.push(this._getManipulatorInfoFromHandle(o)),h.length&&this._removeVertices(h)}_computeVertexManipulatorSizeAndOutline(e){const t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}_createVertexOrEdgeManipulator(e,t=Object(d["e"])(this.graphic)){if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(Object(a["j"])(this._vertexManipulatorGeometry)||Object(a["j"])(this._vertexManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(ft.reshapeManipulators.vertex);this._vertexManipulatorGeometry=se["a"].createSphereGeometry(e,16,16),this._vertexManipulatorOutlineGeometry=se["a"].createSphereGeometry(t,16,16)}if(Object(a["j"])(this._edgeManipulatorGeometry)||Object(a["j"])(this._edgeManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(ft.reshapeManipulators.edge);this._edgeManipulatorGeometry=se["a"].createSphereGeometry(e,16,16),this._edgeManipulatorOutlineGeometry=se["a"].createSphereGeometry(t,16,16)}const i=Object(a["k"])(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:Hr.Vertex|Zi["c"].Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:Hr.Vertex|Zi["c"].Unfocused|Zi["c"].Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:Hr.Vertex|Zi["c"].Focused|Zi["c"].Unselected},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:Zi["c"].Selected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:Zi["c"].Selected|Zi["c"].Unfocused},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:Zi["c"].Selected|Zi["c"].Focused}];this.enableMidpoints&&i.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:Hr.Edge|Zi["c"].Focused|Zi["c"].Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:Hr.Edge|Zi["c"].Focused|Zi["c"].Unselected},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:Hr.Edge|Zi["c"].Unfocused|Zi["c"].Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:Hr.Edge|Zi["c"].Unfocused|Zi["c"].Unselected});const r=new Yt["a"]({view:this.view,renderObjects:i,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(r,e,t);const s="edge"===e.type?{manipulator:r,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:r,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(s),this.manipulators.add(r),this._updateManipulatorPosition(s),"edge"===s.type){const e=this._getManipulatorInfoFromHandle(s.handle.leftVertex).manipulator.events.on("location-update",()=>this._updateManipulatorPosition(s)),t=this._getManipulatorInfoFromHandle(s.handle.rightVertex).manipulator.events.on("location-update",()=>this._updateManipulatorPosition(s));s.locationUpdateHandle=Object(n["b"])([e,t]),this._manipulatorHandles.add(s.locationUpdateHandle,r)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(r,!0),r);const o=Object(Bi["e"])(r,(e,i,r,n)=>{let o=null;i.next(e=>this._trackNumDragging(e)).next(e=>{if("start"===e.action&&(o=Object(a["r"])(this._editGeometryOperations).createUndoGroup()),"edge"===s.type){const t=this._splitEdgeManipulator(s);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:s,snapOrigin:s.handle.pos}}).next(Object(Bi["f"])(this.view,e.elevationAlignedLocation)).next(Object(Hi["g"])(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),cancel:r,snappingManager:this.tool.snappingManager,snappingContext:new lr["a"]({editGeometryOperations:Object(a["r"])(this._editGeometryOperations),elevationInfo:t,pointer:n,excludeFeature:this.graphic,visualizer:new Xe}),updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next(Object(Bi["b"])()).next(t=>{this._perVertexManipulatorDragAction(t),"end"===t.action&&(o=Object(a["q"])(o)),this._updateTranslateVertexTooltip(e,rr.XY,t)}),r.next(this._cancelDragOperation(()=>o=Object(a["q"])(o)))});return this._manipulatorHandles.add([o,r.events.on("immediate-click",e=>this._manipulatorClickCallback(e,s)),r.events.on("select-changed",()=>{s.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()}),r.events.on("focus-changed",({action:e})=>{"focus"===e&&"edge"!==s.type?this._updateTranslateVertexTooltip(r,rr.XY):this._tooltip.clear()})],r),this.emit("manipulators-changed"),s}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_cancelDragOperation(e){return()=>{switch(this._numDragging--,this.undo(),this.outputGeometry=Object(a["k"])(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null,Object(a["k"])(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case Br.NONE:break;case Br.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case Br.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}e&&e(),this.destroyed||this._updateEventState(Br.NONE)}}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=Hr.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=ft.reshapeManipulators.vertex.size/2+ft.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i,e.interactive=Object(a["k"])(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":e.state=Hr.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=ft.reshapeManipulators.edge.size/2+ft.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"!==i.mode||Object(wr["i"])(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",i=>this._onGrabStateChanged(e,t,i.action,i.pointerType))}_onGrabStateChanged(e,t,i,r="mouse"){if("start"===i)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(Br.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==r||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach(e=>{e.manipulator.interactive=!this._numGrabbing&&Object(a["k"])(this.graphic.geometry)&&"point"!==this.graphic.geometry.type,"edgeManipulator"in e&&(e.edgeManipulator.interactive=!this._numGrabbing)}),Object(a["r"])(this._graphicMoveManipulation).forEachManipulator(e=>e.interactive=!this._numGrabbing))}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){e&&(e.manipulator.grabbing&&this._onGrabStateChanged(e.manipulator,!1,"end"),this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(!e)return;const t=Object(a["r"])(this._editGeometryOperations);if("vertex"===e.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,kr),e.manipulator.grabbing&&Object(a["k"])(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.type){const i=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator,r=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator;if(Object(a["k"])(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){const n=i.location,a=r.location,s=.5,o=n.x+s*(a.x-n.x),c=n.y+s*(a.y-n.y),l=n.hasZ&&a.hasZ?0:void 0;e.manipulator.location=Object(Ot["g"])(o,c,l,t.data.spatialReference)}else Object(y["l"])(Ur,i.renderLocation,r.renderLocation,.5),e.manipulator.renderLocation=Ur}}_splitEdgeManipulator(e,t=.5){const i=Object(a["r"])(this._editGeometryOperations),r=Object(a["r"])(i.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;const n=Object(d["e"])(this.graphic);let s;this.enableEdgeOffset?(this._removeManipulator(e),s=this._createVertexOrEdgeManipulator(r)):(s=e,s.handle=r,s.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,n)),r.leftEdge&&this._createVertexOrEdgeManipulator(r.leftEdge),r.rightEdge&&this._createVertexOrEdgeManipulator(r.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(s),this.enableEdgeOffset||this._updateTranslateVertexTooltip(s.manipulator,rr.XY),this._updateSelection(e.manipulator);const o=this._updateEventState(Br.RESHAPING),c=i.data.coordinateHelper.vectorToArray(s.handle.pos),l=i.data.components.indexOf(r.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:c,componentIndex:l,vertexIndex:Object(a["r"])(r.index)}],added:c}),o&&this._updateEventState(Br.NONE),s}_updateMoveManipulationPosition(){const e=Object(y["w"])(Ur,0,0,0);let t=0,i=!1,r=null,n=null;for(const s of this._manipulatorInfos)"vertex"===s.type&&(s.manipulator.selected?(t++,Object(y["e"])(e,e,s.manipulator.renderLocation),Object(a["j"])(r)||s.selectedIndex>r.selectedIndex?(n=r,r=s):(Object(a["j"])(n)||s.selectedIndex>n.selectedIndex)&&(n=s)):i=!0);if(0!==t){const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&Zt(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t}else{const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&Zt(this.graphic)}if(0!==t){let e=0;if(Object(a["k"])(r)){const t=r.handle.pos,i=Object(a["k"])(n)?n.handle.pos:r.handle.leftEdge&&r.handle.leftEdge.leftVertex?r.handle.leftEdge.leftVertex.pos:null,s=Object(a["j"])(n)&&r.handle.rightEdge&&r.handle.rightEdge.rightVertex?r.handle.rightEdge.rightVertex.pos:null;i&&s?this._moveManipulation.xyAxisManipulation.available=!1:i?e=Fr(i,t):s&&(e=Fr(t,s))}this._moveManipulation.angle=e,this._moveManipulation.radius=yi}else this._moveManipulation.angleDeferred=()=>qi(Object(a["r"])(this.graphic.geometry)),this._moveManipulation.radius=tr.radiusForSymbol(this.graphic.symbol);0!==t&&i?(Object(y["k"])(e,e,1/t),kr.spatialReference=Object(a["r"])(this._editGeometryOperations).data.spatialReference,kr.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,kr),this._moveManipulation.elevationAlignedLocation=kr):Object(a["k"])(this._outlineVisualElement)&&!this._graphicState.isDraped&&Object(a["k"])(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:Object(Wt["g"])(this.view,this._moveManipulation,this.graphic)}_removeVertices(e){const t=[],i=Object(a["r"])(this._editGeometryOperations);for(const r of e)if("vertex"===r.type&&i.canRemoveVertex()){t.push(r.handle),this._removeManipulator(r),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.rightEdge));const e=Object(a["r"])(i.removeVertices([r.handle]).removedVertices[0].createdEdge);e&&this._createVertexOrEdgeManipulator(e)}if(t.length>0){const e=t.map(e=>{const t=i.data.components.indexOf(e.component);return{coordinates:i.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:Object(a["r"])(e.index)}});this.outputGeometry=i.data.geometry;const r=this._updateEventState(Br.RESHAPING);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map(e=>e.coordinates),vertices:e}),this.destroyed)return;if(r&&(this._updateEventState(Br.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(e,t,i=("start"===t.action?Ir["a"].NEW_STEP:Ir["a"].ACCUMULATE_STEPS)){const r=Object(a["r"])(this._editGeometryOperations);r.moveVertices(e.map(e=>e.handle),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=r.data.geometry;for(const n of e)this._updateManipulatorPosition(n)}_offsetEdge(e,t){if(Object(a["j"])(t.operation)||Object(a["j"])(t.signedDistance))return;const i=Object(a["r"])(this._editGeometryOperations),r=t.operation.clone();r.distance=t.signedDistance,i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],r),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.type&&(t.manipulator.selected=!t.manipulator.selected,e.button===Dr["a"].Right&&this._removeVertices([t])),"edge"===t.type&&e.button===Dr["a"].Left&&this._splitEdgeManipulator(t),e.stopPropagation()}_updateTranslateTooltip(e,t){const i=this._manipulatorInfos.filter(e=>"vertex"===e.type&&e.manipulator.selected);1===i.length?this._updateTranslateVertexTooltip(i[0].manipulator,e,t):this._updateTranslateGraphicTooltip(e,t)}_updateTranslateGraphicTooltip(e,t){const i=this._tooltipOptions;if(!i.enabled)return;const r=e===rr.Z,n=r?new fr({tooltipOptions:i}):new br({tooltipOptions:i});if(Object(a["k"])(t)&&"end"!==t.action){const{mapStart:e,mapEnd:i}=t,s=r?Object(Or["i"])(e,i):Object(D["c"])(e,i,this._graphicState.isDraped?"on-the-ground":"absolute-height");n.distance=Object(a["k"])(s)?s:ur["f"]}this._tooltip.info=n}_updateTranslateVertexTooltip(e,t,i){const r=this._tooltipOptions;if(!r.enabled)return;const n=t===rr.Z,s=new gr({tooltipOptions:r});if(Object(a["k"])(i)&&"end"!==i.action){const{mapStart:e,mapEnd:t}=i,r=n?Object(Or["i"])(e,t):Object(D["c"])(e,t,this._graphicState.isDraped?"on-the-ground":"absolute-height");s.distance=Object(a["k"])(r)?r:ur["f"]}const o=Object(Or["a"])(e.elevationAlignedLocation);Object(a["k"])(o)&&(s.elevation={mode:"absolute-height",...o});const{geometry:c}=this.graphic;Object(a["k"])(c)&&!n&&(s.area="polygon"===c.type?Object(Nr["a"])(c,this._graphicState.isDraped):null,s.totalLength="polyline"===c.type?Object(D["d"])(c,this._graphicState.isDraped?"on-the-ground":"absolute-height"):null),this._tooltip.info=s}get test(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function Fr(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function Gr(e,t,i,r,n){if(e){const e=n.toXYZ(n.pointToVector(i)),s=Object(Tr["r"])(r,e,Ee["d"].get()),o=Object(zr["a"])(s,e,n.spatialReference);if(Object(a["k"])(o))return Object(ur["c"])(o.value*Math.sign(t),o.unit)}return Object(ur["c"])(t*Object(v["f"])(i.spatialReference),"meters")}Object(r["a"])([Object(o["b"])()],Vr.prototype,"_segmentLabels",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0})],Vr.prototype,"tool",void 0),Object(r["a"])([Object(o["b"])()],Vr.prototype,"_tooltip",void 0),Object(r["a"])([Object(o["b"])()],Vr.prototype,"inputGeometry",null),Object(r["a"])([Object(o["b"])()],Vr.prototype,"outputGeometry",void 0),Object(r["a"])([Object(o["b"])({readOnly:!0})],Vr.prototype,"updating",null),Object(r["a"])([Object(o["b"])()],Vr.prototype,"manipulators",null),Object(r["a"])([Object(o["b"])()],Vr.prototype,"view",null),Object(r["a"])([Object(o["b"])()],Vr.prototype,"graphic",null),Object(r["a"])([Object(o["b"])()],Vr.prototype,"enableZShape",null),Object(r["a"])([Object(o["b"])()],Vr.prototype,"enableZVertex",null),Object(r["a"])([Object(o["b"])()],Vr.prototype,"enableMoveGraphic",null),Object(r["a"])([Object(o["b"])()],Vr.prototype,"enableMidpoints",null),Object(r["a"])([Object(o["b"])()],Vr.prototype,"enableEdgeOffset",null),Object(r["a"])([Object(o["b"])()],Vr.prototype,"_labelOptions",null),Object(r["a"])([Object(o["b"])()],Vr.prototype,"_tooltipOptions",null),Vr=Object(r["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],Vr);const kr=Object(Ot["g"])(0,0,null,null),Ur=Object(f["f"])();var Hr,Br,Wr;!function(e){e.Vertex=Zi["b"].Custom1,e.Edge=Zi["b"].Custom2}(Hr||(Hr={})),function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(Br||(Br={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(Wr||(Wr={}));let qr=class extends(gt["a"].EventedMixin(or["a"])){constructor(e){super(e),this._handles=new W["a"],this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new Ft["a"],this.tooltipOptions=new Gt["a"],this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const e=this._reshapeOperation=new Vr({tool:this});this.own([e.on("reshape",e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)}),e.on("move",e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)}),e.on("vertex-add",e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)}),e.on("vertex-remove",e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)}),e.on("immediate-click",e=>this.emit("immediate-click",e)),this.view.on("pointer-down",["Shift"],e=>{e.stopPropagation()}),Object(s["f"])(()=>this.graphic,()=>this._updateGraphic(),s["e"])]),this.finishToolCreation()}destroy(){this._handles=Object(a["d"])(this._handles),this._reshapeOperation=Object(a["d"])(this._reshapeOperation)}get updating(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.updating)&&e}_updateGeometry(){const e=Object(xr["a"])(this.graphic);this._reshapeOperation.inputGeometry=Object(a["k"])(e)?e.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),Object(xr["b"])(this.graphic)!==qt["a"].SUPPORTED)return;const e=Object(s["f"])(()=>{var e;return null==(e=this.graphic)?void 0:e.geometry},()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()},s["d"]);this._handles.add(e,"onGraphicGeometryChange")}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}_updateGeometryInternally(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){Object(a["j"])(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canUndo(){var e;return null!=(e=this._reshapeOperation.canUndo)&&e}undo(){Object(a["k"])(this.snappingManager)&&this.snappingManager.doneSnapping(),Object(a["k"])(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canRedo(){var e;return null!=(e=this._reshapeOperation.canRedo)&&e}redo(){Object(a["k"])(this.snappingManager)&&this.snappingManager.doneSnapping(),Object(a["k"])(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};Object(r["a"])([Object(o["b"])()],qr.prototype,"_reshapeOperation",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],qr.prototype,"view",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0})],qr.prototype,"graphic",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],qr.prototype,"enableZShape",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],qr.prototype,"enableZVertex",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],qr.prototype,"enableMoveGraphic",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],qr.prototype,"enableMidpoints",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],qr.prototype,"enableEdgeOffset",void 0),Object(r["a"])([Object(o["b"])()],qr.prototype,"type",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,type:Ft["a"]})],qr.prototype,"labelOptions",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,type:Gt["a"]})],qr.prototype,"tooltipOptions",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0})],qr.prototype,"snappingManager",void 0),Object(r["a"])([Object(o["b"])()],qr.prototype,"updating",null),Object(r["a"])([Object(o["b"])()],qr.prototype,"automaticManipulatorSelection",void 0),qr=Object(r["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],qr);var Zr=i("4ae5"),Xr=i("3c9c"),Yr=i("eb69"),$r=i("5815");let Qr=class extends pr["a"]{constructor(e){super(e),this.type="transform-rotate",this.rotationType="geographic"}};Object(r["a"])([Object(o["b"])()],Qr.prototype,"type",void 0),Object(r["a"])([Object(o["b"])()],Qr.prototype,"rotation",void 0),Object(r["a"])([Object(o["b"])()],Qr.prototype,"rotationPrecision",void 0),Object(r["a"])([Object(o["b"])()],Qr.prototype,"orientation",void 0),Object(r["a"])([Object(o["b"])()],Qr.prototype,"orientationPrecision",void 0),Object(r["a"])([Object(o["b"])()],Qr.prototype,"rotationType",void 0),Qr=Object(r["a"])([Object(h["a"])("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],Qr);let Jr=class extends pr["a"]{constructor(e){super(e),this.type="transform-scale",this.sizeUnit=null,this.sizePrecision=null}};Object(r["a"])([Object(o["b"])()],Jr.prototype,"type",void 0),Object(r["a"])([Object(o["b"])()],Jr.prototype,"scale",void 0),Object(r["a"])([Object(o["b"])()],Jr.prototype,"size",void 0),Object(r["a"])([Object(o["b"])()],Jr.prototype,"sizeUnit",void 0),Object(r["a"])([Object(o["b"])()],Jr.prototype,"sizePrecision",void 0),Jr=Object(r["a"])([Object(h["a"])("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],Jr);let Kr=class extends pr["a"]{constructor(e){super(e),this.type="transform-absolute",this.orientationEnabled=!0,this.orientationPrecision=null,this.rotationType="geographic",this.sizeUnit=null,this.sizeEnabled=!0,this.sizePrecision=null}};var en,tn;Object(r["a"])([Object(o["b"])()],Kr.prototype,"type",void 0),Object(r["a"])([Object(o["b"])()],Kr.prototype,"orientation",void 0),Object(r["a"])([Object(o["b"])()],Kr.prototype,"orientationEnabled",void 0),Object(r["a"])([Object(o["b"])()],Kr.prototype,"orientationPrecision",void 0),Object(r["a"])([Object(o["b"])()],Kr.prototype,"rotationType",void 0),Object(r["a"])([Object(o["b"])()],Kr.prototype,"size",void 0),Object(r["a"])([Object(o["b"])()],Kr.prototype,"sizeUnit",void 0),Object(r["a"])([Object(o["b"])()],Kr.prototype,"sizeEnabled",void 0),Object(r["a"])([Object(o["b"])()],Kr.prototype,"sizePrecision",void 0),Kr=Object(r["a"])([Object(h["a"])("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],Kr),function(e){e.ScaleIn=Zi["b"].Custom2,e.ScaleOut=Zi["b"].Custom3,e.RotateLeft=Zi["b"].Custom4,e.RotateRight=Zi["b"].Custom5,e.Unlocked=Zi["b"].Custom7,e.DelayedFocused=Zi["b"].Custom8,e.TouchInput=Zi["b"].Custom12}(en||(en={}));class rn{constructor({adapter:e,tooltipOptions:t,mode:i,tool:r}){this.mode=null,this._handles=new W["a"],this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new gt["a"],this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>Object(a["k"])(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this.adapter.scale:1,this.tool=r,this.mode=i,this.adapter=e,this._tooltipOptions=t,this._tooltip=new dr["a"]({view:r.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add(Object(s["g"])(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),s["a"]))}get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(e){this._ringManipulator.location=e}set elevationAlignedLocation(e){this._ringManipulator.elevationAlignedLocation=e}get grabbing(){return this._ringManipulator.grabbing}set interactive(e){this._ringManipulator.interactive=e}destroy(){Object(a["k"])(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=Object(a["d"])(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=Object(a["d"])(this._tooltip)}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=Object($r["a"])({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){Object(a["k"])(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=Object(a["d"])(this._activeAnimation))}forEachManipulator(e){e(this._ringManipulator,Ut.SCALE_ROTATE)}_createManipulator(){const e=this._createRingManipulator();this._ringManipulator=e,this.tool.manipulators.add(e);const t=this.tool.graphicState.graphic,i=Object(Bi["e"])(e,(e,i,r)=>{this._scaleRotateDragData=null;const n=this.adapter.startInteraction(),s={mode:"none",origin:Object(f["d"])(e.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=s,this._updateDragState();const o=Ee["d"].get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,o),i.next(Object(Hi["h"])(this.tool.view,Object(Tr["g"])(e.renderLocation,o,Object(Tr["d"])()))).next(e=>{const i=Object(Tr["q"])(e.plane),r=Object(Wt["a"])(e.renderStart,e.renderEnd,s.origin,i),o=Yr["b"].shortestSignedDiff(s.angle,r);s.angleDir=Object(Te["e"])(s.angleDir+o,-Vi,Vi),s.angle=r;const c=nn(s,e),l=c-this.adapter.scale;if(s.scaleDir=Object(Te["e"])(s.scaleDir+l,-zi,zi),this._onScaleChanged(),"none"===s.mode){const i=this.mode||an(e,e.plane,s.origin,this.tool.view.state.camera);if(Object(a["k"])(i)){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:0}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()})}s.mode=i}}switch(s.mode){case"rotate":n.state.angle=s.initialAngle+r;break;case"scale":n.state.scale=c,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),e.action){case"start":case"update":switch(s.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:Object(Te["o"])(s.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,xScale:c,yScale:c})}break;case"end":switch(s.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:Object(Te["o"])(s.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:c,yScale:c})}}return"end"===e.action&&(this.startAnimation(on(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState(),n.done()),e}).next(this._updateTooltipPipelineStep(s)),r.next(()=>{if(n.cancel(),Object(a["k"])(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:1,yScale:1})}this.startAnimation(on(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()})});this._handles.add([i,e.events.on("focus-changed",e=>{"focus"===e.action?this.startAnimation(cn(this,()=>this._updateDelayedFocusedState())):this._updateDelayedFocusedState()}),e.events.on("immediate-click",e=>{e.stopPropagation()}),Object(s["f"])(()=>{var e;return null==(e=this.tool.graphicState)?void 0:e.displaying},e=>this._ringManipulator.available=e,s["a"])])}_updateTooltipPipelineStep(e){return t=>{const i=this._tooltipOptions;if(!i.enabled)return t;if("end"===t.action)return this._updateFocusTooltip(),t;const r=this._tooltip,n=this._tooltipOptions.visualVariables,s=Object(a["k"])(n)?n.size:null,o=Object(a["k"])(n)?n.rotation:null;switch(e.mode){case"scale":r.info=new Jr({tooltipOptions:i,scale:{value:this.adapter.scale},size:Object(ur["c"])(Object(a["s"])(this.adapter.size,-1),"meters"),sizeUnit:Object(a["k"])(s)?s.unit:null,sizePrecision:Object(a["k"])(s)?ln(s.valueType):null});break;case"rotate":{const e=Object(a["k"])(o)?ln(o.valueType):null,t=Object(a["k"])(o)?o.rotationType:"geographic";r.info=new Qr({tooltipOptions:i,rotation:Object(ur["a"])(Object(a["s"])(-this.adapter.relativeAngle,0),"radians","geographic"),rotationPrecision:e,orientation:Object(ur["a"])(-this.adapter.angle,"radians","geographic"),orientationPrecision:e,rotationType:t})}}return t}}_updateFocusTooltip(){if(this._tooltipOptions.enabled)if(this.getFocused()){const e=this._tooltipOptions.visualVariables,t=Object(a["k"])(e)?e.rotation:null,i=Object(a["k"])(e)?e.size:null;this._tooltip.info=new Kr({tooltipOptions:this._tooltipOptions,orientation:Object(ur["a"])(-this.adapter.angle,"radians","geographic"),orientationEnabled:null==this.mode||"rotate"===this.mode,orientationPrecision:Object(a["k"])(t)?ln(t.valueType):null,rotationType:Object(a["k"])(t)?t.rotationType:"geographic",size:Object(ur["c"])(Object(a["s"])(this.adapter.size,-1),"meters"),sizeUnit:Object(a["k"])(i)?i.unit:null,sizeEnabled:null==this.mode||"scale"===this.mode,sizePrecision:Object(a["k"])(i)?ln(i.valueType):null})}else this._tooltip.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(en.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(en.Unlocked,!(Object(a["k"])(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),Object(a["k"])(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(en.ScaleIn|en.ScaleOut,!1),this._ringManipulator.updateStateEnabled(en.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(en.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(en.RotateLeft|en.RotateRight,!1),this._ringManipulator.updateStateEnabled(en.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(en.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(en.ScaleIn|en.ScaleOut|en.RotateLeft|en.RotateRight,!1)}_updateManipulatorTransform(){const e=Object(K["d"])(Ee["a"].get(),this.adapter.angle,Object(f["h"])(0,0,1));if(Object(a["j"])(e))return;const t=this.getScale(),i=Object(K["u"])(Ee["a"].get(),Object(y["w"])(Ee["d"].get(),t,t,t));this._ringManipulator.modelTransform=Object(K["m"])(Ee["a"].get(),i,e)}_createRingManipulator(){const e=(e,t,i)=>{const r=[],n=Math.ceil(gi*(t-e)/(2*Math.PI));for(let a=0;a<n+1;a++){const s=e+a*(t-e)/n;r.push(Object(f["h"])(i*Math.cos(s),i*Math.sin(s),0))}return r},t=t=>e(0,2*Math.PI,t),i=e=>[[-e/2,0],[e/2,0],[e/2,Si/2],[-e/2,Si/2]],r=(e,t)=>se["a"].createPathExtrusionGeometry(i(t),e,[],[],!1),n=t(xi),a=r(n,Ti),s={left:[],right:[]},o=[];for(let d=0;d<2;d++){const t=d*Math.PI-Math.PI/4,i=Math.PI/2-Pi,n=t+i,a=t+Math.PI/2-i,c=e(n,a,Mi),l=r(c,wi);o.push(c),o.push(e(n,a,Ai-Ti/2)),s.left.push(l),s.right.push(l);for(let e=0;e<2;e++){const t=0===e,i=Object(ee["d"])();if(t){Object(K["h"])(i,i,[1,-1,1]),Object(K["e"])(i,i,-n,[0,0,1]);const e=Math.round(Ii*(c.length-1));i[12]=c[e][0],i[13]=c[e][1],i[14]=c[e][2]}else{Object(K["e"])(i,i,a,[0,0,1]);const e=Math.round((1-Ii)*(c.length-1));i[12]=c[e][0],i[13]=c[e][1],i[14]=c[e][2]}const r=se["a"].createExtrudedTriangle(Ei,0,Ri,Si);se["a"].transformInPlace(r,i),(t?s.left:s.right).push(r)}}const c=[];for(let d=0;d<2;d++){const t=d*Math.PI-Math.PI/4,i=Math.PI/2-Ci,n=t+i,a=t+Math.PI/2-i,s=e(n,a,Ai);c.push(r(s,wi))}const l=t(xi+Li),h=t(xi+Ni),u=r(l,wi),p=r(h,wi),b=t(xi-Li),g=t(xi-Ni),O=r(b,wi),m=r(g,wi),v=this._createMaterial(),_=this._createMaterial(.66),j=this._createMaterial(.5),y=this._createMaterial(.33);let x=[{geometry:a,material:v,stateMask:en.DelayedFocused},{geometry:a,material:j,stateMask:Zi["c"].None}];this.mode&&"scale"!==this.mode||(x=x.concat([{geometry:c,material:v,stateMask:en.DelayedFocused|en.Unlocked},{geometry:u,material:_,stateMask:en.DelayedFocused|en.ScaleIn},{geometry:p,material:y,stateMask:en.DelayedFocused|en.ScaleIn},{geometry:O,material:_,stateMask:en.DelayedFocused|en.ScaleOut},{geometry:m,material:y,stateMask:en.DelayedFocused|en.ScaleOut}])),this.mode&&"rotate"!==this.mode||(x=x.concat([{geometry:s.right,material:v,stateMask:en.DelayedFocused|en.Unlocked},{geometry:s.left,material:v,stateMask:en.DelayedFocused|en.RotateLeft},{geometry:s.right,material:v,stateMask:en.DelayedFocused|en.RotateRight}]));const S=[n,...o];return new Yt["a"]({view:this.tool.view,renderObjects:x,autoScaleRenderObjects:!1,worldOriented:!0,radius:Ti,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:Object(d["e"])(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:S,direction:Object(f["h"])(0,0,1)}})}_createMaterial(e=1){const t=Object(we["d"])([...fi,e]);return new Ue["a"]({color:t,transparent:1!==e,cullFace:ie["b"].Back,renderOccluded:oe["c"].Transparent})}get test(){return{ringManipulator:this._ringManipulator,tooltip:this._tooltip}}}function nn(e,t){const i=Object(y["f"])(Ee["d"].get(),t.renderStart,e.origin),r=Object(y["f"])(Ee["d"].get(),t.renderEnd,e.origin),n=Object(y["p"])(i),a=Object(y["p"])(r);return 0===n?0:a/n}function an(e,t,i,r){const{renderStart:n,renderEnd:a}=e,s=sn(n,r,Ee["d"].get()),o=sn(a,r,Ee["d"].get());if(Object(y["h"])(s,o)<Di*Di)return null;const c=Object(y["f"])(Ee["d"].get(),n,i),l=Object(y["j"])(Ee["d"].get(),c,Object(Tr["q"])(t)),h=n,d=Object(y["e"])(Ee["d"].get(),h,l),u=sn(i,r,Ee["d"].get()),p=s,b=sn(d,r,Ee["d"].get()),f=Object(y["f"])(Ee["d"].get(),b,p),g=Object(y["f"])(Ee["d"].get(),s,u),O=Object(Q["g"])(p,f),m=Object(Q["g"])(u,g);return Object(Q["d"])(O,o)<Object(Q["d"])(m,o)?"rotate":"scale"}function sn(e,t,i){return t.projectToScreen(e,hn),Object(y["w"])(i,hn[0],hn[1],0)}function on(e,t){let i=null,r=1;const n=()=>r;return{start:()=>{r=e.getScale(),i=e.getScale,e.getScale=n,t()},update:e=>(r+=((r+1)/2-r)*Math.min(e*Gi,1),t(),Math.abs(r-1)<.01?tn.STOP:tn.CONTINUE),destroy:()=>{e.getScale=i,t()}}}function cn(e,t){let i=0,r=null;const n=()=>!1;return{start:()=>{r=e.getFocused,e.getFocused=n,i=0,t()},update:e=>(i+=e,!r()||i>Fi?tn.STOP:tn.CONTINUE),destroy:()=>{e.getFocused=r,t()}}}function ln(e){switch(e){case"integer":case"long":return 0;default:return null}}!function(e){e[e.CONTINUE=0]="CONTINUE",e[e.STOP=1]="STOP"}(tn||(tn={}));const hn=Object(p["f"])();var dn=i("33b0");function un(e){return Object(a["k"])(e.geometry)&&"mesh"===e.geometry.type?pn(e.geometry):bn(e)}function pn(e){return Object(a["k"])(e.transform)?fn(e,e.transform):gn(e)}function bn(e){let t=e.geometry,i=a["n"];return{undo(e){i=e.geometry,e.geometry=t},redo(e){t=e.geometry,e.geometry=i}}}function fn(e,t){let i=t.clone(),r=null;return{undo:t=>{r=Object(a["k"])(e.transform)?e.transform.clone():null,e.transform=i,t.notifyGeometryChanged()},redo:t=>{i=Object(a["k"])(e.transform)?e.transform.clone():null,e.transform=r,t.notifyGeometryChanged()}}}function gn(e){let t,i=e.vertexAttributes.clonePositional();return{undo:r=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i,r.notifyGeometryChanged()},redo:r=>{i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,r.notifyGeometryChanged()}}}let On=class extends Bt["a"]{constructor(e){super(e),this.interactionState=null}initialize(){this.own([Object(s["g"])(()=>Object(a["k"])(this.interactionState)&&this.interactionState.angle!==this.interactionState.previousAngle?{interactionState:this.interactionState,angle:this.interactionState.state.angle}:null,({interactionState:e})=>{this._updateMeshRotation(e)},s["d"]),Object(s["g"])(()=>Object(a["k"])(this.interactionState)&&this.interactionState.scale!==this.interactionState.previousScale?{interactionState:this.interactionState,scale:this.interactionState.state.scale}:null,({interactionState:e})=>{this._updateMeshSize(e)},s["d"])])}get angle(){const e=this.geometry.transform;if(Object(a["j"])(e))return 0;const t=Object(dn["c"])(e.rotation)[2];return Math.abs(t)>.999999?Object(Te["g"])(Object(dn["a"])(e.rotation))*Math.sign(t):0}get scale(){return Object(a["k"])(this.interactionState)?this.interactionState.scale:1}startInteraction(){const e=new mn({angle:this.angle});this.interactionState=e;const t=()=>this.interactionState=null;return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return un(this.graphic)}_updateMeshRotation(e){const t=this.geometry.anchor,i=this.viewingMode===Xr["a"].Global,{angle:r,previousAngle:n}=e;this.geometry.rotate(0,0,Object(Te["o"])(r-n),{origin:t,geographic:i}),e.previousAngle=r,Object(a["k"])(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}_updateMeshSize(e){const t=this.geometry.anchor,i=this.viewingMode===Xr["a"].Global,{scale:r,previousScale:n}=e;this.geometry.scale(r/n,{origin:t,geographic:i}),e.previousScale=r,Object(a["k"])(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}};Object(r["a"])([Object(o["b"])({constructOnly:!0})],On.prototype,"graphic",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0})],On.prototype,"geometry",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0})],On.prototype,"viewingMode",void 0),Object(r["a"])([Object(o["b"])()],On.prototype,"angle",null),Object(r["a"])([Object(o["b"])()],On.prototype,"scale",null),Object(r["a"])([Object(o["b"])()],On.prototype,"interactionState",void 0),On=Object(r["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],On);let mn=class extends g["a"]{constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}get state(){const{angle:e,scale:t}=this;return{angle:e,scale:t}}cancel(){this.angle=this.initialAngle,this.scale=1}};Object(r["a"])([Object(o["b"])()],mn.prototype,"angle",void 0),Object(r["a"])([Object(o["b"])()],mn.prototype,"initialAngle",void 0),Object(r["a"])([Object(o["b"])()],mn.prototype,"previousAngle",void 0),Object(r["a"])([Object(o["b"])()],mn.prototype,"previousScale",void 0),Object(r["a"])([Object(o["b"])()],mn.prototype,"scale",void 0),Object(r["a"])([Object(o["b"])()],mn.prototype,"state",null),mn=Object(r["a"])([Object(h["a"])("InteractionState")],mn);let vn=class extends Bt["a"]{constructor(e){super(e),this.sizeAxis=null,this.interactionState=null}initialize(){this.own(Object(s["g"])(()=>Object(a["k"])(this.interactionState)?this.interactionState.state:null,e=>{this._updateSymbol(e)},s["d"]))}get angle(){return Object(a["k"])(this.interactionState)?this.interactionState.angle:Object(a["k"])(this._orientationReferenceSymbolLayer)?_n(this._orientationReferenceSymbolLayer.heading):0}get scale(){return Object(a["k"])(this.interactionState)?this.interactionState.scale:1}get relativeAngle(){return this.angle-this.initialAngle}get initialAngle(){return Object(a["k"])(this.interactionState)?this.interactionState.initialAngle:0}get size(){const e=this._sizeReferenceSymbolLayer;if(Object(a["j"])(e))return null;const t=this.findLayerView(),i=this._graphicSymbol;if(Object(a["j"])(t)||Object(a["j"])(i)||"point-3d"!==i.type)return null;const r=t.getSymbolLayerSize(i,e);if("size"in r&&Object(a["k"])(r.size))return r.size;const n=this.sizeAxis;return"width"in r&&Object(a["k"])(r.width)&&(Object(a["j"])(n)||"width"===n||"all"===n||"width-and-depth"===n)?r.width:"depth"in r&&Object(a["k"])(e.depth)&&(Object(a["j"])(n)||"depth"===n||"all"===n||"width-and-depth"===n)?r.depth:"height"in r&&Object(a["k"])(e.height)&&(Object(a["j"])(n)||"height"===n||"all"===n)?r.height:null}get _sizeReferenceSymbolLayer(){const e=this._graphicSymbol;return Object(a["j"])(e)||0===e.symbolLayers.length?null:e.symbolLayers.find(e=>"object"===e.type)}get _orientationReferenceSymbolLayer(){const e=this._graphicSymbol;return Object(a["j"])(e)||0===e.symbolLayers.length?null:e.symbolLayers.find(e=>"object"===e.type&&Object(a["k"])(e.heading))}get _graphicSymbol(){return Object(a["k"])(this.graphic)&&Object(a["k"])(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(e){this.graphic.symbol=e}startInteraction(){const e=this._graphicSymbol,t=this.findLayerView();if(Object(a["k"])(this.interactionState)||Object(a["j"])(e)||Object(a["j"])(t))return jn;const i=e.symbolLayers.map(i=>"object"===i.type?t.getSymbolLayerSize(e,i):null).toArray(),r=e.clone(),n=this.angle,s=new yn({originalSymbol:r,angle:n,initialSizes:i});this.interactionState=s;const o=()=>this.interactionState=null;return{state:s,done:o,cancel:()=>{this._graphicSymbol=r,o()}}}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:i=>{t=i.symbol,i.symbol=e},redo:i=>{e=i.symbol,i.symbol=t}}}_updateSymbol({scale:e,angle:t,originalSymbol:i,initialSizes:r}){const n=this._graphicSymbol;if(Object(a["j"])(n)||"point-3d"!==n.type)return;const s=n.clone(),o=-Object(Te["o"])(t-this.initialAngle);let c=!1;this._forEachObjectSymbolLayerPair(i,s,(t,i,n)=>{const s=Object(a["s"])(t.heading,0)+o;i.heading!==s&&(i.heading=s,c=!0);const l=r[n];if(Object(a["k"])(l)&&"width"in l){l.width=this.sizeFilter(l.width),l.height=this.sizeFilter(l.height),l.depth=this.sizeFilter(l.depth);const t=l.width*e;i.width!==t&&(i.width=t,c=!0);const r=l.depth*e;i.depth!==r&&(i.depth=r,c=!0);const n=l.height*e;i.height!==n&&(i.height=n,c=!0)}}),c&&(this._graphicSymbol=s)}_forEachObjectSymbolLayerPair(e,t,i){e.symbolLayers.forEach((e,r)=>{const n=t.symbolLayers.getItemAt(r);"object"===e.type&&"object"===n.type&&i(e,n,r)})}};function _n(e){return-Object(Te["g"])(e)}Object(r["a"])([Object(o["b"])()],vn.prototype,"angle",null),Object(r["a"])([Object(o["b"])()],vn.prototype,"scale",null),Object(r["a"])([Object(o["b"])()],vn.prototype,"relativeAngle",null),Object(r["a"])([Object(o["b"])()],vn.prototype,"initialAngle",null),Object(r["a"])([Object(o["b"])()],vn.prototype,"size",null),Object(r["a"])([Object(o["b"])()],vn.prototype,"sizeAxis",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0})],vn.prototype,"graphic",void 0),Object(r["a"])([Object(o["b"])()],vn.prototype,"interactionState",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0})],vn.prototype,"findLayerView",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0})],vn.prototype,"sizeFilter",void 0),Object(r["a"])([Object(o["b"])()],vn.prototype,"_sizeReferenceSymbolLayer",null),Object(r["a"])([Object(o["b"])()],vn.prototype,"_orientationReferenceSymbolLayer",null),Object(r["a"])([Object(o["b"])()],vn.prototype,"_graphicSymbol",null),vn=Object(r["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],vn);const jn={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let yn=class extends g["a"]{constructor(e){super(e),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=e.angle}get state(){const{originalSymbol:e,angle:t,initialAngle:i,scale:r,initialSizes:n}=this;return{originalSymbol:e,angle:t,initialAngle:i,scale:r,initialSizes:n}}};Object(r["a"])([Object(o["b"])()],yn.prototype,"originalSymbol",void 0),Object(r["a"])([Object(o["b"])()],yn.prototype,"angle",void 0),Object(r["a"])([Object(o["b"])()],yn.prototype,"initialAngle",void 0),Object(r["a"])([Object(o["b"])()],yn.prototype,"initialSizes",void 0),Object(r["a"])([Object(o["b"])()],yn.prototype,"scale",void 0),Object(r["a"])([Object(o["b"])()],yn.prototype,"state",null),yn=Object(r["a"])([Object(h["a"])("InteractionState")],yn);let xn=class extends(Object(Bt["b"])(gt["a"].EventedMixin(or["a"]))){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Gt["a"],this.type="transform-3d",this._scaleRotate=null,this._snappingPipeline=new hr["a"],this._tooltip=null}initialize(){const{graphic:e,view:t}=this;this.graphicState=new Lt({graphic:e}),this.own(Object(s["f"])(()=>this.tooltipOptions.enabled,e=>{this._tooltip=e?new dr["a"]({view:t}):Object(a["d"])(this._tooltip)},s["e"])),this._moveManipulation=new tr({tool:this,view:t,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Zt(e),radius:tr.radiusForSymbol(e.symbol)}),this._moveManipulation.forEachManipulator((t,i)=>this.handles.add([t.events.on("immediate-click",t=>{this.emit("immediate-click",{...t,graphic:e}),t.stopPropagation()}),t.events.on("focus-changed",({action:e})=>{const{tooltipOptions:t,_tooltip:r}=this;if(!Object(a["j"])(r)&&(r.clear(),"focus"===e)){const e=i===Ut.TRANSLATE_Z?fr:br;r.info=new e({tooltipOptions:t})}})])),this._moveManipulation.elevationInfo=Object(d["e"])(e);const i=e.geometry;if(this._moveManipulation.createGraphicDragPipeline((r,n,s,o,c)=>(Object(a["k"])(i)&&r===rr.XY&&(s=s.next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new lr["a"]({elevationInfo:Object(d["e"])(e),pointer:c,editGeometryOperations:cr["a"].fromGeometry(new Zr["a"]({spatialReference:i.spatialReference}),t.state.viewingMode),visualizer:new Xe,excludeFeature:e}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,cancel:o}),this._snappingPipeline.next)),s.next(e=>{const{tooltipOptions:t,_tooltip:i}=this;if(Object(a["j"])(i))return e;const{mapStart:n,mapEnd:s}=e;i.clear();const o=r===rr.Z?fr:br;if("end"===e.action)i.info=new o({tooltipOptions:t});else{const e=r===rr.Z?Object(Or["i"])(n,s):Object(D["c"])(n,s,this.graphicState.isDraped?"on-the-ground":"absolute-height");Object(a["k"])(e)&&(i.info=new o({tooltipOptions:t,distance:e}))}return e})),this.graphicState,e=>{const{action:t,graphic:i,dxScreen:r,dyScreen:n}=e,a={graphic:i,dxScreen:r,dyScreen:n};switch(t){case"start":this.emit("graphic-translate-start",a),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",a);break;case"end":this.emit("graphic-translate-stop",a)}}),this._moveManipulation.angle=Object(a["k"])(this._scaleRotate)?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add(Object(s["f"])(()=>this._scaleRotateAdapter.angle,()=>this._updateMoveAngle())),this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new rn({tool:this,mode:e,adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",()=>this._onScaleChanged()))}this.handles.add([bi({view:this.view,graphic:this.graphic,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>Object(n["c"])()}),this.graphicState.on("changed",()=>this._onGeometryChanged()),this._hideManipulatorsForGraphicState(),Object(s["f"])(()=>t.scale,()=>this._updateMoveAngle())]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator(e=>{e instanceof Yt["a"]&&this.handles.add(e.events.on("grab-changed",()=>this._updateManipulatorsInteractive()))}),this.finishToolCreation()}destroy(){this._tooltip=Object(a["d"])(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=Object(a["d"])(this._scaleRotate),this._scaleRotateAdapter=Object(a["d"])(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){Object(a["j"])(this._scaleRotate)||(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return Object(a["k"])(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new On({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new vn({graphic:this.graphic,sizeFilter:e=>this._enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find(e=>e.layer===this.graphic.layer),sizeAxis:Object(a["k"])(this.tooltipOptions.visualVariables)&&Object(a["k"])(this.tooltipOptions.visualVariables.size)?this.tooltipOptions.visualVariables.size.axis:null})}_forEachManipulator(e){this._moveManipulation.forEachManipulator(e),Object(a["k"])(this._scaleRotate)&&this._scaleRotate.forEachManipulator(e)}_hideManipulatorsForGraphicState(){return Object(s["f"])(()=>this.graphicState.displaying,e=>{this._forEachManipulator(t=>t.available=e),this._moveManipulation.zManipulation.available=e&&this.enableZ&&Zt(this.graphic)})}_createGeometryUndoRecord(){return un(this.graphic)}set snapToScene(e){this._moveManipulation&&(this._moveManipulation.snapToScene=e),this._set("snapToScene",e)}get updating(){return this.updatingHandles.updating}set location(e){this._moveManipulation.location=e,Object(a["k"])(this._scaleRotate)&&(this._scaleRotate.location=e)}set elevationAlignedLocation(e){this._moveManipulation.elevationAlignedLocation=e,Object(a["k"])(this._scaleRotate)&&(this._scaleRotate.elevationAlignedLocation=e)}reset(){}onHide(){Object(a["k"])(this._scaleRotate)&&this._scaleRotate.cancelActiveAnimation()}_onScaleChanged(){if(Object(a["j"])(this._scaleRotate))return;const e=this._scaleRotate.getScale();this._moveManipulation.displayScale=e}_updateMoveAngle(){this.view.state.viewingMode===Xr["a"].Local||this.view.scale<ki?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}_onGeometryChanged(){Object(Wt["g"])(this.view,this,this.graphic)}_enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:Object(a["k"])(this._scaleRotate)?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};Object(r["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],xn.prototype,"view",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],xn.prototype,"graphic",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],xn.prototype,"enableZ",void 0),Object(r["a"])([Object(o["b"])()],xn.prototype,"enableRotation",void 0),Object(r["a"])([Object(o["b"])()],xn.prototype,"enableScaling",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,type:Gt["a"]})],xn.prototype,"tooltipOptions",void 0),Object(r["a"])([Object(o["b"])()],xn.prototype,"graphicState",void 0),Object(r["a"])([Object(o["b"])({value:!1})],xn.prototype,"snapToScene",null),Object(r["a"])([Object(o["b"])({constructOnly:!0})],xn.prototype,"snappingManager",void 0),Object(r["a"])([Object(o["b"])({readOnly:!0})],xn.prototype,"type",void 0),Object(r["a"])([Object(o["b"])({readOnly:!0})],xn.prototype,"updating",null),xn=Object(r["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],xn);var Sn=i("0d9f"),Tn=(i("e06a"),i("d3ac")),wn=i("6a0e"),Mn=i("1a3e"),An=i("c6f7");let En=class extends(Object(Tn["b"])(wn["a"])){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&Object(a["f"])(this.position,e.position)&&this.width===e.width&&this.height===e.height}};Object(r["a"])([Object(o["b"])({readOnly:!0,json:{read:!1,write:!0}})],En.prototype,"type",void 0),Object(r["a"])([Object(o["b"])({type:Zr["a"]}),Object(An["a"])()],En.prototype,"position",void 0),Object(r["a"])([Object(o["b"])({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(An["a"])(),Object(Mn["a"])(e=>Yr["a"].normalize(Object(l["i"])(e),0,!0))],En.prototype,"heading",void 0),Object(r["a"])([Object(o["b"])({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(An["a"])(),Object(Mn["a"])(e=>Yr["a"].normalize(Object(l["i"])(e),0,!0))],En.prototype,"tilt",void 0),Object(r["a"])([Object(o["b"])({type:Number,nonNullable:!0}),Object(An["a"])()],En.prototype,"width",void 0),Object(r["a"])([Object(o["b"])({type:Number,nonNullable:!0}),Object(An["a"])()],En.prototype,"height",void 0),En=Object(r["a"])([Object(h["a"])("esri.analysis.SlicePlane")],En);var Rn=i("04f0"),Pn=(i("3a35"),i("a1b1"));Object(c["a"])("mac");const Cn=2,Dn=1.15,In=1.15,Ln=1.1,Nn=(Math.cos(Object(Te["g"])(45)),Math.cos(Object(Te["g"])(5)),.7),zn=Object(f["h"])(1,.5,0),Vn=(Object(we["d"])([...zn,Nn]),Object(we["d"])([...zn,.5]),Object(we["d"])([...zn,1])),Fn=Object(we["g"])(1,1,1,1),Gn=Object(we["g"])(1,.8,.6,1),kn=Object(we["g"])(1,.93,.86,1),Un=Object(we["d"])([...zn,1]),Hn=Object(we["d"])([...zn,1]),Bn=3,Wn=11,qn=22.5,Zn=40,Xn=48,Yn=2.25,$n=Object(we["d"])([...zn,1]),Qn=4,Jn=1,Kn=.3,ea=6,ta=4,ia=12,ra=40,na=27;i("0cb9");Object(ee["d"])();var aa=i("a05b"),sa=i("da35"),oa=i("d7f7"),ca=i("badc"),la=i("8675"),ha=i("7c51"),da=i("3886"),ua=i("c3a4"),pa=i("ca98"),ba=i("fa1e"),fa=i("c829"),ga=i("b04d"),Oa=i("d17d"),ma=i("189c");da["a"];class va extends pa["a"]{initializeProgram(e){const t=va.shader.get().build(this.configuration);return new fa["a"](e.rctx,t,ba["a"])}initializePipeline(){return Object(ma["f"])({blending:Object(ma["g"])(Oa["b"].ONE,Oa["b"].ONE,Oa["b"].ONE_MINUS_SRC_ALPHA,Oa["b"].ONE_MINUS_SRC_ALPHA),depthTest:{func:Oa["h"].LESS},colorWrite:ma["c"]})}}va.shader=new ua["a"](ga["a"],()=>i.e("chunk-2d0a47c1").then(i.bind(null,"0748")));oe["a"];oa["a"];i("5996"),i("f694"),i("f895");Object(f["f"])();Object(f["f"])();i("84f4"),i("ce27");var _a=i("9990"),ja=i("b061"),ya=i("e93d"),xa=i("7438"),Sa=i("87b7"),Ta=i("6d35"),wa=i("f3d9");da["a"];class Ma extends pa["a"]{initializeProgram(e){const t=Ma.shader.get().build(this.configuration);return new fa["a"](e.rctx,t,ba["a"])}_setPipelineState(e,t){const i=this.configuration,r=e===ie["i"].NONE,n=e===ie["i"].FrontFace;return Object(ma["f"])({blending:i.output!==aa["a"].Color&&i.output!==aa["a"].Alpha||!i.transparent?null:r?Aa:Object(xa["f"])(e),culling:Object(ma["b"])(i.cullFace),depthTest:{func:Object(xa["g"])(e)},depthWrite:r?i.writeDepth&&ma["d"]:Object(xa["h"])(e),colorWrite:ma["c"],stencilWrite:i.hasOccludees?Sa["h"]:null,stencilTest:i.hasOccludees?t?Sa["d"]:Sa["c"]:null,polygonOffset:r||n?null:Object(xa["e"])(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}Ma.shader=new ua["a"](wa["a"],()=>i.e("chunk-2d215c84").then(i.bind(null,"c056")));const Aa=Object(ma["h"])(Oa["b"].ONE,Oa["b"].ONE_MINUS_SRC_ALPHA);class Ea extends Ta["a"]{constructor(){super(...arguments),this.output=aa["a"].Color,this.cullFace=ie["b"].None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=ie["i"].NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}Object(r["a"])([Object(sa["b"])({count:aa["a"].COUNT})],Ea.prototype,"output",void 0),Object(r["a"])([Object(sa["b"])({count:ie["b"].COUNT})],Ea.prototype,"cullFace",void 0),Object(r["a"])([Object(sa["b"])()],Ea.prototype,"hasSlicePlane",void 0),Object(r["a"])([Object(sa["b"])()],Ea.prototype,"transparent",void 0),Object(r["a"])([Object(sa["b"])()],Ea.prototype,"enableOffset",void 0),Object(r["a"])([Object(sa["b"])()],Ea.prototype,"writeDepth",void 0),Object(r["a"])([Object(sa["b"])()],Ea.prototype,"hasOccludees",void 0),Object(r["a"])([Object(sa["b"])({count:ie["i"].COUNT})],Ea.prototype,"transparencyPassType",void 0),Object(r["a"])([Object(sa["b"])()],Ea.prototype,"hasMultipassTerrain",void 0),Object(r["a"])([Object(sa["b"])()],Ea.prototype,"cullAboveGround",void 0);class Ra extends oe["a"]{constructor(e){super(e,new Ca),this.supportsEdges=!0,this.techniqueConfig=new Ea}getConfiguration(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<xa["b"],this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,n,a,s){Object(ha["e"])(e,t,r,n,a,void 0,s)}requiresSlot(e,t){return e===ca["a"].DRAPED_MATERIAL||(Object(ja["b"])(t)===aa["a"].Highlight?e===ca["a"].OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?ca["a"].TRANSPARENT_MATERIAL:ca["a"].TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:ca["a"].OPAQUE_MATERIAL))}createGLMaterial(e){return e.output===aa["a"].Color||e.output===aa["a"].Alpha||e.output===aa["a"].Highlight?new Pa(e):void 0}createBufferWriter(){return new la["a"](la["d"])}}class Pa extends ya["a"]{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(Ma,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}beginSlot(e){return this._output!==aa["a"].Color&&this._output!==aa["a"].Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}class Ca extends oe["b"]{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=ie["b"].None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0}}var Da=i("3748");i("3af1");b["a"].getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function Ia(e,t){return Object(Wt["b"])(e.basis1,e.basis2,e.origin,t)}function La(e,t,i,r){const n=t.worldUpAtPosition(e.origin,Ee["d"].get()),a=Ee["d"].get();switch(i){case Qa.HEADING:Object(y["g"])(a,n);break;case Qa.TILT:Object(y["g"])(a,e.basis1)}return Object(Tr["g"])(e.origin,a,r)}function Na(e,t,i,r){const n=Object(y["p"])(r.basis1),a=Object(y["p"])(r.basis2),s=Ga(r),o=ka(r),c=Object(y["w"])(Ee["d"].get(),0,0,0);Object(y["e"])(c,Object(y["k"])(Ee["d"].get(),r.basis1,t.direction[0]),Object(y["k"])(Ee["d"].get(),r.basis2,t.direction[1])),Object(y["e"])(c,r.origin,c);let l=0,h=1;if(Ua(t))1===t.direction[0]&&-1===t.direction[1]?l=es:1===t.direction[0]&&1===t.direction[1]?l=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(l=3*Math.PI/2),h=o;else{const e=0!==t.direction[0]?1:2;l=1===e?es:0,h=(1===e?a:n)-s}const d=Object(K["b"])(Ee["a"].get(),l);Object(K["h"])(d,d,Object(y["w"])(Ee["d"].get(),h,h,h)),Object(K["m"])(d,i,d),d[12]=0,d[13]=0,d[14]=0,e.modelTransform=d,e.renderLocation=c}function za(e,t,i,r){const n=r.worldUpAtPosition(i.origin,Ee["d"].get()),a=Fa(i,Va.POSITIVE_X),s=Object(K["b"])(Ee["a"].get(),a.edge*Math.PI/2);Object(K["r"])(s,s,-Ya(i,n)),Object(K["m"])(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=a.position}var Va;function Fa(e,t){switch(t){case Va.POSITIVE_X:return{basis:e.basis1,direction:1,position:Object(y["e"])(Ee["d"].get(),e.origin,e.basis1),edge:t};case Va.POSITIVE_Y:return{basis:e.basis2,direction:1,position:Object(y["e"])(Ee["d"].get(),e.origin,e.basis2),edge:t};case Va.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:Object(y["f"])(Ee["d"].get(),e.origin,e.basis1),edge:t};case Va.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:Object(y["f"])(Ee["d"].get(),e.origin,e.basis2),edge:t}}}function Ga(e){const t=Object(y["p"])(e.basis1),i=Object(y["p"])(e.basis2);return Kn*Math.min(t,i)}function ka(e){return Ga(e)}function Ua(e){return 0!==e.direction[0]&&0!==e.direction[1]}function Ha(e,t=rs.CENTER_ON_ARROW){const i=t===rs.CENTER_ON_CALLOUT?Zn:0,r=[Object(f["h"])(i,0,-Xn/2),Object(f["h"])(i,0,Xn/2)],n=Xa(r,!0),a=(e,t)=>qa(r,r,{tubeRadius:Bn,tipRadius:Wn,tipLength:qn,tubeFocusMultiplier:Dn,tipFocusMultiplier:In,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t}),s=a(0,!1),o=a(Yn,!0),c=new Ue["a"]({color:Fn,cullFace:ie["b"].Back,renderOccluded:oe["c"].Opaque}),l=new Ue["a"]({color:Gn,cullFace:ie["b"].Back,renderOccluded:oe["c"].Opaque}),h=new Ue["a"]({color:kn,cullFace:ie["b"].Back,renderOccluded:oe["c"].Opaque}),d=new Ue["a"]({color:Hn,transparent:!0,writeDepth:!1,cullFace:ie["b"].Front,renderOccluded:oe["c"].Transparent}),u=se["a"].createPolylineGeometry([[i,0,0],[i-Zn,0,0]]),p=se["a"].createPolylineGeometry([[i,0,0],[i-Zn,0,0]]),b=new Da["a"]({color:Un,renderOccluded:oe["c"].OccludeAndTransparent});return new Yt["a"]({view:e,renderObjects:[...s.normal.map(({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?c:"cap"===e?l:h,transform:i,stateMask:Zi["c"].Unfocused|$a})),...o.normal.map(({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:Zi["c"].Unfocused|$a})),{geometry:u,material:b,stateMask:Zi["c"].Unfocused|$a|Ka},...s.focused.map(({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?c:"cap"===e?l:h,transform:i,stateMask:Zi["c"].Focused|$a})),...o.focused.map(({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:Zi["c"].Focused|$a})),{geometry:p,material:b,stateMask:Zi["c"].Focused|$a|Ka}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:Wn,state:$a})}function Ba(e,t){const i=new Ra({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:oe["c"].Opaque}),r=ra,n=na,a=n*Ln,s=e=>{const t=new Uint32Array([0,1,2,2,3,0]);return new ke["a"]([[ce["a"].POSITION,{size:3,data:[r-e,-e,0,r+e,-e,0,r+e,e,0,r-e,e,0],exclusive:!0}],[ce["a"].UV0,{size:2,data:[0,0,1,0,1,1,0,1]}]],[[ce["a"].POSITION,t],[ce["a"].UV0,t]])},o=se["a"].createPolylineGeometry([[0,0,0],[r-n,0,0]]),c=se["a"].createPolylineGeometry([[0,0,0],[r-a,0,0]]),l=new Da["a"]({color:Vn,renderOccluded:oe["c"].OccludeAndTransparent}),h=[{geometry:s(n),material:i,stateMask:Zi["c"].Unfocused|$a},{geometry:o,material:l,stateMask:Zi["c"].Unfocused|$a},{geometry:s(a),material:i,stateMask:Zi["c"].Focused|$a},{geometry:c,material:l,stateMask:Zi["c"].Focused|$a}];return new Yt["a"]({view:e,renderObjects:h,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[r,0,0]},collisionPriority:1,radius:n/2,state:$a})}function Wa(e,t){const i=Ua(t),r=i?[Object(f["h"])(1,0,0),Object(f["h"])(0,0,0),Object(f["h"])(0,1,0)]:[Object(f["h"])(1,0,0),Object(f["h"])(-1,0,0)],n=se["a"].createPolylineGeometry(r),a=$n,s=e=>new le["a"]({color:a,width:e,renderOccluded:oe["c"].OccludeAndTransparent}),o=()=>new Da["a"]({color:a,renderOccluded:oe["c"].OccludeAndTransparent}),c=i?Qn:Jn,l=c*Cn,h=Jn,d=e=>e>1?s(e):o(),u=[{geometry:n,material:d(c),stateMask:Zi["c"].Unfocused|ts},{geometry:n,material:d(l),stateMask:Zi["c"].Focused|ts},{geometry:n,material:d(h),stateMask:is}],p=new Yt["a"]({view:e,renderObjects:u,collisionType:{type:"line",paths:[r]},autoScaleRenderObjects:!1,worldSized:!0,radius:i?ea:ta});return p.state=ts,p}function qa(e,t,i){const r=r=>{const n=(r?t:e).slice(0),s=Object(y["f"])(Ee["d"].get(),n[0],n[1]);Object(y["r"])(s,s);const o=Object(y["f"])(Ee["d"].get(),n[n.length-1],n[n.length-2]);if(Object(y["r"])(o,o),i.padding>0){const e=Object(y["k"])(Object(f["f"])(),o,-i.padding);if(n[n.length-1]=Object(y["e"])(e,e,n[n.length-1]),i.bothEnds){const e=Object(y["k"])(Object(f["f"])(),s,-i.padding);n[0]=Object(y["e"])(e,e,n[0])}}const c=r?i.tipFocusMultiplier:1,l=i.tipLength*(i.focusTipLength?c:1),h=i.tipRadius*c,d=Object(K["i"])(Ee["a"].get());if(i.padding>0){const e=l/4,t=Object(y["w"])(Ee["d"].get(),0,e,0),r=1+i.padding/e;Object(K["j"])(d,d,t),Object(K["h"])(d,d,Object(y["w"])(Ee["d"].get(),r,r,r)),Object(K["j"])(d,d,Object(y["k"])(t,t,-1/r))}const u=Object(K["i"])(Object(ee["d"])()),p=Object(f["h"])(0,1,0),b=Object(K["k"])(Object(ee["d"])(),Object(Rn["g"])(Ee["b"].get(),p,o));b[12]=n[n.length-1][0],b[13]=n[n.length-1][1],b[14]=n[n.length-1][2],Object(K["m"])(b,b,d);const g=[{part:"tube",geometry:Za(i.tubeRadius*(r?i.tubeFocusMultiplier:1)+i.padding,i.flat,n),transform:u}];let O,m;if(Object(a["k"])(i.flat)?O=se["a"].createExtrudedTriangle(l,h,h,i.flat.thickness):(O=se["a"].createConeGeometry(l,h,24,!1,!1,!0),m=se["a"].createConeGeometry(l,h,24,!1,!0,!1)),g.push({part:"tip",geometry:O,transform:b}),m&&g.push({part:"cap",geometry:m,transform:b}),i.bothEnds){const e=Object(K["k"])(Object(ee["d"])(),Object(Rn["g"])(Ee["b"].get(),p,s));e[12]=n[0][0],e[13]=n[0][1],e[14]=n[0][2],Object(K["m"])(e,e,d),g.push({part:"tip",geometry:O,transform:e}),m&&g.push({part:"cap",geometry:m,transform:e})}return g};return{normal:r(!1),focused:r(!0)}}function Za(e,t,i){const r=[];if(Object(a["k"])(t))r.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else{const t=12;for(let i=0;i<t;i++){const n=i/t*2*Math.PI;r.push([Math.cos(n)*e,Math.sin(n)*e])}}return se["a"].createPathExtrusionGeometry(r,i,[],[],!1)}function Xa(e,t){const i=Object(y["f"])(Object(f["f"])(),e[e.length-1],e[e.length-2]);if(Object(y["r"])(i,i),Object(y["k"])(i,i,ia),Object(y["e"])(i,i,e[e.length-1]),t){const t=Object(y["f"])(Object(f["f"])(),e[0],e[1]);return Object(y["r"])(t,t),Object(y["k"])(t,t,ia),Object(y["e"])(t,t,e[0]),[t,...e,i]}return[...e,i]}function Ya(e,t){return Object(Pn["b"])(t,e.basis2,e.basis1)+es}!function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"}(Va||(Va={}));const $a=Zi["b"].Custom1;var Qa,Ja;!function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"}(Qa||(Qa={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(Ja||(Ja={}));const Ka=Zi["b"].Custom2,es=(Object(Q["c"])(),Math.PI/2),ts=Zi["b"].Custom1,is=Zi["b"].Custom2;var rs;!function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(rs||(rs={}));const ns="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",as={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};function ss(e){return e.fromData(ns,()=>new Pe["a"](ns,as))}class os{constructor(){this.lastDragEvent=null,this.next=new Bi["a"],this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&Object(a["k"])(this.lastDragEvent)){const t={...this.lastDragEvent,action:"update"};e&&this._adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}createDragEventPipelineStep(){return this.lastDragEvent=null,e=>(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this._adjustScaleFactors(e),e)}_adjustScaleFactors(e){const t=Ua(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}get test(){return{_adjustScaleFactors:e=>this._adjustScaleFactors(e)}}}var cs=i("34f2"),ls=i("157c"),hs=i("e1e0"),ds=i("fbd0");function us(e,t){return bs(e,t,!1)}function ps(e,t){return bs(e,t,!0)}function bs(e,t,i){if(e instanceof cs["b"]){if(e.operation instanceof ls["a"])return fs(e.operation,t,i),!0;if(e.operation instanceof hs["a"])return gs(e.operation,t,i),!0;if(e.operation instanceof ds["a"])return Os(e.operation,t,i),!0}return!1}function fs(e,t,i=!1){const r=i?-1:1,n=Object(f["h"])(r*e.dx,r*e.dy,r*e.dz);Object(y["e"])(t.origin,t.origin,n)}function gs(e,t,i=!1){const r=i?-e.angle:e.angle;Object(y["d"])(t.basis1,t.basis1,f["c"],r),Object(y["d"])(t.basis2,t.basis2,f["c"],r)}function Os(e,t,i=!1){const r=i?1/e.factor1:e.factor1,n=i?1/e.factor2:e.factor2;Object(y["k"])(t.basis1,t.basis1,r),Object(y["k"])(t.basis2,t.basis2,n),Object(_["q"])(t.origin,t.origin,e.origin,e.axis1,r),Object(_["q"])(t.origin,t.origin,e.origin,e.axis2,n)}function ms(e,t,i,r){r||(r=Object(Sn["c"])());const n=Object(_["a"])(Ee["c"].get(),e[1],-e[0]),a=Object(_["a"])(Ee["c"].get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=Object(_["a"])(Ee["c"].get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),o=Ee["c"].get();t.components.forEach(t=>t.vertices.forEach(t=>{const i=t.pos;Object(_["a"])(o,Object(_["h"])(e,i),Object(_["h"])(n,i)),Object(_["w"])(a,a,o),Object(_["x"])(s,s,o)}));const c=1e-6,l=Object(_["a"])(Ee["c"].get(),s[0]-a[0]<c?i/2:0,s[1]-a[1]<c?i/2:0);return Object(_["g"])(a,a,l),Object(_["b"])(s,s,l),Object(_["f"])(r.basis1,e,(s[0]-a[0])/2),Object(_["f"])(r.basis2,n,(s[1]-a[1])/2),Object(_["a"])(r.origin,a[0]*e[0]+a[1]*n[0],a[0]*e[1]+a[1]*n[1]),Object(_["b"])(r.origin,r.origin,r.basis1),Object(_["b"])(r.origin,r.origin,r.basis2),r}function vs(e,t,i,r=0,n){n||(n=Object(Sn["c"])()),t.toRenderCoords(e.origin,i,n.origin);const a=Ee["d"].get();Object(y["e"])(a,e.origin,e.basis1),Object(y["e"])(a,a,e.basis2),t.toRenderCoords(a,i,a);const s=Ee["d"].get();Object(y["e"])(s,e.origin,e.basis1),Object(y["f"])(s,s,e.basis2),t.toRenderCoords(s,i,s);const o=Ee["d"].get();Object(y["f"])(o,e.origin,e.basis1),Object(y["f"])(o,o,e.basis2),t.toRenderCoords(o,i,o);const c=Ee["d"].get();Object(y["f"])(c,e.origin,e.basis1),Object(y["e"])(c,c,e.basis2),t.toRenderCoords(c,i,c);const l=Object(y["l"])(Ee["d"].get(),a,s,.5);Object(y["f"])(l,l,n.origin);const h=Object(y["l"])(Ee["d"].get(),o,c,.5);Object(y["f"])(h,n.origin,h),Object(y["l"])(n.basis1,l,h,.5);const d=Object(y["l"])(Ee["d"].get(),c,a,.5);Object(y["f"])(d,d,n.origin);const u=Object(y["l"])(Ee["d"].get(),s,o,.5);Object(y["f"])(u,n.origin,u),Object(y["l"])(n.basis2,d,u,.5);const p=Object(y["j"])(Ee["d"].get(),n.basis1,n.basis2),b=Object(y["j"])(p,p,n.basis1);return Object(y["r"])(b,b),Object(y["k"])(n.basis2,b,Object(y["i"])(n.basis2,b)),Object(y["k"])(n.basis1,n.basis1,1+r/Object(y["p"])(n.basis1)),Object(y["k"])(n.basis2,n.basis2,1+r/Object(y["p"])(n.basis2)),Object(Sn["k"])(n),n}function _s(e,t,i,r){const n=Ee["d"].get();Object(y["f"])(n,Object(y["f"])(n,e.origin,e.basis1),e.basis2);const s=Ee["d"].get();Object(y["a"])(s,n,e.basis1,2);const o=Ee["d"].get();Object(y["a"])(o,s,e.basis2,2);const c=Ee["d"].get();Object(y["a"])(c,n,e.basis2,2),n[2]=s[2]=o[2]=c[2]=t;const l=r?"on-the-ground":"absolute-height",h=Object(ur["d"])(Object(D["b"])(n,s,i,l),Object(D["b"])(c,o,i,l)),d=Object(ur["d"])(Object(D["b"])(s,o,i,l),Object(D["b"])(n,c,i,l));return Object(a["j"])(d)||Object(a["j"])(h)?null:[h,d]}let js=class extends pr["a"]{constructor(e){super(e),this.type="extent-rotate",this.angle=0}};Object(r["a"])([Object(o["b"])()],js.prototype,"type",void 0),Object(r["a"])([Object(o["b"])()],js.prototype,"angle",void 0),js=Object(r["a"])([Object(h["a"])("esri.views.interactive.tooltip.ExtentRotateTooltipInfo")],js);let ys=class extends pr["a"]{constructor(e){super(e),this.type="extent-scale",this.xScale=0,this.yScale=0,this.xSize=ur["f"],this.ySize=ur["f"]}};Object(r["a"])([Object(o["b"])()],ys.prototype,"type",void 0),Object(r["a"])([Object(o["b"])()],ys.prototype,"xScale",void 0),Object(r["a"])([Object(o["b"])()],ys.prototype,"yScale",void 0),Object(r["a"])([Object(o["b"])()],ys.prototype,"xSize",void 0),Object(r["a"])([Object(o["b"])()],ys.prototype,"ySize",void 0),ys=Object(r["a"])([Object(h["a"])("esri.views.interactive.tooltip.ExtentScaleTooltipInfo")],ys);let xs=class extends(gt["a"].EventedMixin(or["a"])){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Gt["a"],this._preserveAspectRatio=new os,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this.handles=new W["a"],this.moveZManipulator=null,this.resizeManipulators=null,this.rotateManipulator=null,this.attachmentOrigin=null,this.outlineVisualElement=null,this.mapBounds=Object(Sn["c"])(),this.mapBoundsStart=Object(Sn["c"])(),this.zmax=0,this.sizeStart=null,this.displayBounds=Object(Sn["c"])(),this.displayBoundsStart=Object(Sn["c"])(),this.displayBoundsMarginStart=0,this.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._rotateTooltipInfo=null,this._scaleTooltipInfo=null,this._startAngle=0,this._endAngle=0,this._startScale=Object(j["c"])(),this._endScale=Object(j["c"])()}initialize(){const{view:e,graphic:t,manipulators:i,handles:r}=this,o=this.graphicState=new Lt({graphic:t}),c=t.geometry;this.editGeometryOperations=cr["a"].fromGeometry(c,e.state.viewingMode),this.graphicMoveManipulation=new ar({tool:this,view:e,graphicState:o}),this.moveZManipulator=Ha(e,rs.CENTER_ON_CALLOUT),this.moveZManipulator.state|=Ka,r.add([this._createMoveXYGraphicDragPipeline(),Object(s["f"])(()=>this.enableZ,()=>this._updateManipulatorAvailability(this.moveZManipulator,Ut.TRANSLATE_Z)),this._createMoveZDragPipeline()]),i.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map(t=>{const i=Wa(e,t);return r.add([Object(s["f"])(()=>this.enableScaling,()=>this._updateManipulatorAvailability(i,Ut.SCALE)),i.events.on("grab-changed",e=>this._onResizeGrab(e)),this._createResizeDragPipeline(i,t)]),i}),i.addMany(this.resizeManipulators),this.rotateManipulatorTexture=ss(e.toolViewManager.textures),this.rotateManipulator=Ba(e,this.rotateManipulatorTexture.texture),r.add([Object(s["f"])(()=>this.enableRotation,()=>this._updateManipulatorAvailability(this.rotateManipulator,Ut.ROTATE)),this.rotateManipulator.events.on("grab-changed",e=>{this._onRotateGrab(e)}),this._createRotateDragPipeline(this.rotateManipulator)]),i.add(this.rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const l=bi({view:e,graphic:t,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>Object(n["c"])()});Object(a["k"])(l)&&(this.outlineVisualElement=l.visualElement instanceof wt?l.visualElement:null),Object(a["k"])(this.outlineVisualElement)&&r.add(this.outlineVisualElement.events.on("attachment-origin-changed",()=>this._updateDisplayBounds())),r.add(l),r.add([o.on("changed",()=>this._onGeometryChanged()),Object(s["f"])(()=>o.displaying,()=>this._updateAllManipulatorAvailability()),Object(s["f"])(()=>o.isDraped,()=>this._graphicDrapedChanged(),s["a"]),e.trackGraphicState(o)]);const h=e.pointsOfInterest;h&&r.add(Object(s["f"])(()=>h.centerOnSurfaceFrequent.location,()=>this._updateDisplayBounds()));const d=e=>{r.add(e.events.on("grab-changed",()=>{this.grabbing=e.grabbing,this._updateAllManipulatorAvailability()}))};this._forEachManipulator(d);const u=(e,i)=>{r.add(e.events.on("immediate-click",e=>{i===Ut.TRANSLATE_XY&&this.emit("immediate-click",{...e,graphic:t}),e.stopPropagation()}))};this._forEachManipulator(u),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}destroy(){this.mapBounds=null,this.displayBounds=null,this.rotateManipulatorTexture.release(),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{handles:e,view:t}=this,i=this._tooltip=new dr["a"]({view:t}),r=()=>{i.info=this._getUpdatedTooltipInfo()};e.add([this.on("graphic-translate-start",r),this.on("graphic-translate",r),this.on("graphic-translate-stop",()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._tooltip.clear()}),this.on("graphic-rotate-start",e=>{this._startAngle=e.angle,r()}),this.on("graphic-rotate",e=>{this._endAngle=e.angle,r()}),this.on("graphic-rotate-stop",()=>{this._startAngle=0,this._endAngle=0,r()}),this.on("graphic-scale-start",e=>{Object(_["a"])(this._startScale,e.xScale,e.yScale),Object(_["a"])(this._endScale,e.xScale,e.yScale),r()}),this.on("graphic-scale",e=>{Object(_["a"])(this._endScale,e.xScale,e.yScale),r()}),this.on("graphic-scale-stop",()=>{Object(_["a"])(this._startScale,0,0),Object(_["a"])(this._endScale,0,0),r()})]),this._forEachManipulator(t=>{e.add([t.events.on("focus-changed",r),t.events.on("grab-changed",r),t.events.on("drag",e=>{"cancel"===e.action?this._tooltip.clear():r()})])})}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this.graphicMoveManipulation.grabbing||this.graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():this.rotateManipulator.focused?this._computeRotateTooltipInfo():this.resizeManipulators.some(e=>e.focused)?this._computeScaleTooltipInfo():null:null}_computeMoveXYTooltipInfo(){return this._moveXYTooltipInfo=Object(a["s"])(this._moveXYTooltipInfo,()=>new br({tooltipOptions:this.tooltipOptions}))}_computeMoveZTooltipInfo(){const e=this._moveZTooltipInfo=Object(a["s"])(this._moveZTooltipInfo,()=>new fr({tooltipOptions:this.tooltipOptions})),t=this._moveUnit;if(this.moveZManipulator.dragging){const t=this.mapBoundsStart.origin,i=this.mapBounds.origin,r=Object(Or["h"])(t,i,this.view.spatialReference);if(Object(a["j"])(r))return null;e.distance=r}else e.distance=Object(ur["c"])(0,t);return e}_computeRotateTooltipInfo(){const e=this._rotateTooltipInfo=Object(a["s"])(this._rotateTooltipInfo,()=>new js({tooltipOptions:this.tooltipOptions}));return e.angle=this._startAngle-this._endAngle,e}_computeScaleTooltipInfo(){const e=this.graphic.geometry;if(Object(a["j"])(e))return null;const t=this._scaleTooltipInfo=Object(a["s"])(this._scaleTooltipInfo,()=>new ys({tooltipOptions:this.tooltipOptions})),i=_s(this.mapBounds,this.zmax,e.spatialReference,this.graphicState.isDraped);return Object(a["j"])(i)?null:(t.xSize=i[0],t.ySize=i[1],Object(a["k"])(this.sizeStart)&&this.resizeManipulators.some(e=>e.dragging)?(t.xScale=i[0].value/this.sizeStart[0].value,t.yScale=i[1].value/this.sizeStart[1].value):(t.xScale=1,t.yScale=1),t)}_graphicDrapedChanged(){this.handles.remove(Ss),this._updateDisplayBounds(),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",e=>{Object(a["k"])(this.attachmentOrigin)&&Object(ni["i"])(e.extent,this.attachmentOrigin.x,this.attachmentOrigin.y)&&this._updateDisplayBounds()}),Ss)}_updateAllManipulatorAvailability(){this._forEachManipulator((e,t)=>this._updateManipulatorAvailability(e,t))}_updateManipulatorAvailability(e,t){const i=this.grabbing&&!e.grabbing;if(e.interactive=!i,e instanceof Yt["a"]){const r=this.graphicState.displaying,n=this.enableZ&&Zt(this.graphic);switch(t){case Ut.ROTATE:e.available=r&&this.enableRotation;break;case Ut.SCALE:e.available=r&&(this.enableScaling||this.enableRotation||n),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?ts:is;break;case Ut.TRANSLATE_Z:e.available=r&&n;break;default:e.available=r}}}_forEachManipulator(e){this.graphicMoveManipulation.forEachManipulator(e),this.resizeManipulators.forEach(t=>e(t,Ut.SCALE)),e(this.rotateManipulator,Ut.ROTATE),e(this.moveZManipulator,Ut.TRANSLATE_Z)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}get _moveUnit(){return Object(a["s"])(Object(v["n"])(this.view.spatialReference),"meters")}reset(){}_onGeometryChanged(){this._updateDisplayBounds()}_calculateMapBounds(){const e=this.graphic.geometry,t=this.editGeometryOperations.data,i=t.components[0].edges[0],r=Object(_["g"])(Ee["c"].get(),i.leftVertex.pos,i.rightVertex.pos);Object(_["i"])(r,r);const n=Object(a["s"])(Object(Wt["f"])(this.view,this.graphic),()=>e.extent.center);let s=ws*this.view.pixelSizeAt(n);const o=this.view.spatialReference,c=e.spatialReference;o.equals(c)||(s*=Object(v["f"])(o)/Object(v["f"])(c)),ms(r,t,s,this.mapBounds),this._calculateZMax()}_calculateZMax(){const e=this.editGeometryOperations.data;if(!e.geometry.hasZ)return void(this.zmax=0);const t=e.coordinateHelper;let i=Number.NEGATIVE_INFINITY;for(const r of e.components)for(const e of r.vertices){const r=t.getZ(e.pos);i=Math.max(r,i)}this.zmax=i}_updateDisplayBounds(){const e=this.graphic.geometry;if(Object(a["j"])(e))return;const t=Object(a["k"])(this.outlineVisualElement)&&!this.graphicState.isDraped&&Object(a["k"])(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:Object(Wt["f"])(this.view,this.graphic);this.attachmentOrigin=Object(a["s"])(t,e.extent.center);const i=Object(a["k"])(t)?t.z:Object(De["f"])(this.mapBounds.origin,this.view.elevationProvider,Ie["a"].fromElevationInfo(Object(d["e"])(this.graphic)),this.view.renderCoordsHelper),r=Object(Sn["a"])(this.mapBounds);r.origin[2]=i,vs(r,this.view.renderCoordsHelper,e.spatialReference,this.displayBoundsMargin,this.displayBounds),this._updateManipulators()}get displayBoundsMargin(){const e=this.view.pointsOfInterest,t=e?e.centerOnSurfaceFrequent.location:this.editGeometryOperations.data.geometry.extent.center;return Ts*this.view.pixelSizeAt(t)}_createMoveXYGraphicDragPipeline(){return this.graphicMoveManipulation.createDragPipeline((e,t,i)=>this._applyGraphicMoveSteps(t,i,rr.XY))}_createMoveZDragPipeline(){const e=this.view,t=this.editGeometryOperations.data.spatialReference;return Object(Bi["e"])(this.moveZManipulator,(i,r,n)=>{const a=Object(f["d"])(i.renderLocation),s=r.next(Object(Hi["j"])(e,a,t)).next(Object(Bi["c"])());this._applyGraphicMoveSteps(s,n,rr.Z)})}_applyGraphicMoveSteps(e,t,i){const r=e.next(e=>("start"===e.action&&(this.inputState={type:"move"},Object(Sn["a"])(this.mapBounds,this.mapBoundsStart),this._calculateSizeStart(),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e)).next(Object(Bi["b"])()).next(this._moveDragUpdateGeometry()).next(e=>{const t={graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&this.emit("graphic-translate",t);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",t)}return e}).next(e=>this._updateMoveTooltip(e,i));return t.next(()=>{Object(a["k"])(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel()}),r}_calculateSizeStart(){Object(a["j"])(this.graphic.geometry)?this.sizeStart=null:this.sizeStart=_s(this.mapBoundsStart,this.zmax,this.graphic.geometry.spatialReference,this.graphicState.isDraped)}_moveDragUpdateGeometry(){return e=>{if(Object(a["j"])(this.inputState)||"move"!==this.inputState.type)return e;const t=[];for(const n of this.editGeometryOperations.data.components)t.push(...n.vertices);const i="start"===e.action?Ir["a"].NEW_STEP:Ir["a"].ACCUMULATE_STEPS,r=this.editGeometryOperations.moveVertices(t,e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,i);return us(r,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}_updateMoveTooltip(e,t){if(t===rr.XY||t===rr.XY_AXIS){const t=Object(D["c"])(e.mapStart,e.mapEnd,this.graphicState.isDraped?"on-the-ground":"absolute-height");Object(a["k"])(t)&&Object(a["k"])(this._moveXYTooltipInfo)&&(this._moveXYTooltipInfo.distance=t)}return e}_onResizeGrab(e){if("start"!==e.action)return;const t=this._calculatePickRay(e.screenPoint);Object(Tr["m"])(this.displayBounds.plane,t,Ee["d"].get())&&(Object(Sn["a"])(this.displayBounds,this.displayBoundsStart),Object(Sn["a"])(this.mapBounds,this.mapBoundsStart),this._calculateSizeStart(),this.displayBoundsMarginStart=this.displayBoundsMargin,this.inputState={type:"resize"})}_createResizeDragPipeline(e,t){return Object(Bi["e"])(e,(e,i,r)=>{Object(a["j"])(this.inputState)||(i.next(e=>("start"===e.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),e)).next(Object(Hi["h"])(this.view,this.displayBoundsStart.plane)).next(e=>({...e,handle:t})).next(this._resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this._resizeDragUpdateGeometry()).next(e=>{const t={graphic:this.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":this.emit("graphic-scale",t);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",t)}return e}),r.next(()=>{Object(a["k"])(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel()}))})}_resizeDragRenderPlaneToFactors(){return e=>{const t=this.displayBoundsStart,i=e.handle.direction,r=this.displayBoundsMargin,n=this.displayBoundsMarginStart,a=Object(y["g"])(Ee["d"].get(),t.origin);Object(y["a"])(a,a,t.basis1,-i[0]),Object(y["a"])(a,a,t.basis2,-i[1]);const s=Object(y["f"])(Ee["d"].get(),e.renderEnd,a),o=Object(y["f"])(Ee["d"].get(),e.renderStart,a),c=Ua(e.handle),l=ka(t),h=ka(this.displayBounds)/l,d=(e,t)=>{if(0===e)return 1;let i=Object(y["p"])(t),a=.5*e*Object(y["i"])(t,s)/i;const l=a<0?-1:1;c&&(a+=(i-.5*e*Object(y["i"])(t,o)/i)*l*h);const d=i<1.5*n?1:Ms;return i=Math.max(i-n,Ms),l>0&&(a-=r),l*Math.max(l*(a/i),d)};return{...e,factor1:d(i[0],t.basis1),factor2:d(i[1],t.basis2)}}}_resizeDragUpdateGeometry(){return e=>{const t=Object(y["g"])(Object(f["f"])(),this.mapBoundsStart.origin);Object(y["a"])(t,t,this.mapBoundsStart.basis1,-e.handle.direction[0]),Object(y["a"])(t,t,this.mapBoundsStart.basis2,-e.handle.direction[1]);const i=Object(_["a"])(Object(j["c"])(),this.mapBoundsStart.basis1[0],this.mapBoundsStart.basis1[1]);Object(_["i"])(i,i);const r=[];for(const s of this.editGeometryOperations.data.components)r.push(...s.vertices);const n="start"===e.action?Ir["a"].NEW_STEP:Ir["a"].ACCUMULATE_STEPS,a=this.editGeometryOperations.scaleVertices(r,t,i,e.factor1,e.factor2,n,cs["a"].REPLACE);return Object(Sn["a"])(this.mapBoundsStart,this.mapBounds),us(a,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}_onRotateGrab(e){if("start"!==e.action)return;const t=La(this.displayBounds,this.view.renderCoordsHelper,Qa.HEADING,Object(Tr["d"])()),i=this._calculatePickRay(e.screenPoint);Object(Tr["m"])(t,i,Ee["d"].get())&&(Object(Sn["a"])(this.displayBounds,this.displayBoundsStart),Object(Sn["a"])(this.mapBounds,this.mapBoundsStart),this._calculateSizeStart(),this.inputState={type:"rotate",rotatePlane:t})}_createRotateDragPipeline(e){return Object(Bi["e"])(e,(e,t,i)=>{const r=this.inputState;Object(a["j"])(r)||(t.next(e=>("start"===e.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),e)).next(Object(Hi["h"])(this.view,r.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(r)).next(this._rotateDragUpdateGeometry()).next(e=>{const t={graphic:this.graphic,angle:Object(Te["o"])(e.rotateAngle)};switch(e.action){case"start":case"update":this.emit("graphic-rotate",t);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",t)}return e}),i.next(()=>{Object(a["k"])(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel()}))})}_rotateDragRenderPlaneToRotate(e){return t=>{const i=Object(Tr["q"])(e.rotatePlane),r=Object(Wt["a"])(t.renderStart,t.renderEnd,this.displayBounds.origin,i);return{...t,rotateAxis:i,rotateAngle:r}}}_rotateDragUpdateGeometry(){return e=>{const t=Object(y["g"])(Object(f["f"])(),this.mapBoundsStart.origin),i=[];for(const a of this.editGeometryOperations.data.components)i.push(...a.vertices);const r="start"===e.action?Ir["a"].NEW_STEP:Ir["a"].ACCUMULATE_STEPS,n=this.editGeometryOperations.rotateVertices(i,t,e.rotateAngle,r,cs["a"].REPLACE);return Object(Sn["a"])(this.mapBoundsStart,this.mapBounds),us(n,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}_calculatePickRay(e){const t=Object(Q["c"])(),i=Object(p["i"])(e);return Object(_a["b"])(this.view.state.camera,i,t),Object(y["r"])(t.direction,t.direction),t}_updateManipulators(){if(!this.visible)return;const e=Ia(this.displayBounds,Ee["a"].get());za(this.rotateManipulator,e,this.displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this.moveZManipulator,e),this.resizeManipulators.forEach((t,i)=>{Na(t,this.resizeHandles[i],e,this.displayBounds)})}_updateZMoveHandle(e,t){const i=this.displayBounds,r={basis:i.basis1,direction:-1,position:Object(y["f"])(Ee["d"].get(),i.origin,i.basis1),edge:2},n=Ee["a"].get();Object(K["g"])(n,t,r.edge*Math.PI/2),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=r.position}_cancel(){const e=this.editGeometryOperations.lastOperation;Object(a["j"])(e)||(this.editGeometryOperations.undo(),this.graphic.geometry=this.editGeometryOperations.data.geometry,ps(e,this.mapBounds),this._updateDisplayBounds(),this.inputState=null)}get canUndo(){return this.editGeometryOperations.canUndo}undo(){if(Object(a["k"])(this.inputState))this.view.activeTool=null;else if(this.canUndo){const e=this.editGeometryOperations.undo();this.graphic.geometry=this.editGeometryOperations.data.geometry,ps(Object(a["r"])(e),this.mapBounds),this._updateDisplayBounds()}}get canRedo(){return this.editGeometryOperations.canRedo}redo(){if(this.canRedo){const e=this.editGeometryOperations.redo();this.graphic.geometry=this.editGeometryOperations.data.geometry,us(Object(a["r"])(e),this.mapBounds),this._updateDisplayBounds()}}get test(){return{resizeManipulators:this.resizeManipulators,rotateManipulator:this.rotateManipulator,moveZManipulator:this.moveZManipulator,tooltip:this._tooltip}}};Object(r["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],xs.prototype,"view",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],xs.prototype,"graphic",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,nonNullable:!0})],xs.prototype,"enableZ",void 0),Object(r["a"])([Object(o["b"])()],xs.prototype,"enableRotation",void 0),Object(r["a"])([Object(o["b"])()],xs.prototype,"enableScaling",void 0),Object(r["a"])([Object(o["b"])({constructOnly:!0,type:Gt["a"]})],xs.prototype,"tooltipOptions",void 0),Object(r["a"])([Object(o["b"])()],xs.prototype,"preserveAspectRatio",null),Object(r["a"])([Object(o["b"])()],xs.prototype,"grabbing",void 0),Object(r["a"])([Object(o["b"])()],xs.prototype,"inputState",void 0),Object(r["a"])([Object(o["b"])({readOnly:!0})],xs.prototype,"type",void 0),Object(r["a"])([Object(o["b"])()],xs.prototype,"_moveUnit",null),xs=Object(r["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],xs);const Ss="draped-elevation-changes",Ts=10,ws=80,Ms=1e-6},4492:function(e,t,i){"use strict";i.d(t,"a",(function(){return $}));var r=i("a4ee"),n=i("fc29"),a=i("b2b2"),s=i("477c"),o=i("59b2"),c=(i("b50f"),i("c120"),i("cea0"),i("d386"));const l="esri-tooltip",h=l+"-content";i("e92d"),i("2dd4"),i("1b8f");var d=i("7617"),u=i("8048"),p=i("121a"),b=i("702a"),f=i("755e"),g=i("21e2");let O=class extends p["a"]{constructor(){super(...arguments),this._messagesUnits=null,this._messagesTooltip=null}get _units(){const e=Object(u["e"])(this.tooltip.view);return{length:e,verticalLength:e,area:e}}_formatScale(e){return Object(g["b"])(e,{style:"percent",maximumFractionDigits:0})}_formatRelativeOrientation(e){return Object(g["b"])(e,{maximumFractionDigits:2,minimumFractionDigits:2,signDisplay:"exceptZero"})}_formatLength(e,t,i){return Object(d["c"])(this._messagesUnits,e,Object(a["s"])(t,this._units.length),i)}_formatRelativeLength(e){return Object(d["e"])(this._messagesUnits,e,this._units.length)}_formatVerticalLength(e){return Object(d["g"])(this._messagesUnits,e,this._units.verticalLength)}_formatRelativeVerticalLength(e){return Object(d["f"])(this._messagesUnits,e,this._units.verticalLength)}_formatTotalLength(e){return Object(d["c"])(this._messagesUnits,e,this._units.length)}_formatArea(e){return Object(d["b"])(this._messagesUnits,e,this._units.area)}_formatPercentage(e){return Object(g["b"])(e.value,{style:"percent"})}};Object(r["a"])([Object(o["b"])()],O.prototype,"info",void 0),Object(r["a"])([Object(o["b"])()],O.prototype,"tooltip",void 0),Object(r["a"])([Object(o["b"])()],O.prototype,"_units",null),Object(r["a"])([Object(f["a"])("esri/core/t9n/Units"),Object(o["b"])()],O.prototype,"_messagesUnits",void 0),Object(r["a"])([Object(f["a"])("esri/views/interactive/tooltip/t9n/Tooltip"),Object(o["b"])()],O.prototype,"_messagesTooltip",void 0),O=Object(r["a"])([Object(c["a"])("esri.views.interactive.tooltip.content.TooltipContent")],O);var m=i("d822");const v=l+"-field",_={base:v,title:v+"__title",value:v+"__value"};let j=class extends p["a"]{render(){return Object(m["a"])("div",{class:_.base},Object(m["a"])("div",{class:_.title},this.title),Object(m["a"])("div",{class:_.value},this.value))}};Object(r["a"])([Object(o["b"])()],j.prototype,"title",void 0),Object(r["a"])([Object(o["b"])()],j.prototype,"value",void 0),j=Object(r["a"])([Object(c["a"])("esri.views.interactive.tooltip.support.TooltipField")],j);const y={base:`${h} ${h+"--draw-point"}`};let x=class extends O{render(){var e;const{elevation:t}=this.info,i=null==(e=this._messagesTooltip)?void 0:e.sketch;return Object(m["a"])("div",{class:y.base},Object(m["a"])(j,{title:null==i?void 0:i.elevation,value:this._formatVerticalLength(t)}))}};x=Object(r["a"])([Object(c["a"])("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],x);const S={base:`${h} ${h+"--draw-polygon"}`};let T=class extends O{render(){var e;const{area:t,elevation:i}=this.info,r=null==(e=this._messagesTooltip)?void 0:e.sketch;return Object(m["a"])("div",{class:S.base},Object(m["a"])(j,{title:null==r?void 0:r.elevation,value:this._formatVerticalLength(i)}),Object(m["a"])(j,{title:null==r?void 0:r.area,value:this._formatArea(t)}))}};T=Object(r["a"])([Object(c["a"])("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],T);const w={base:`${h} ${h+"--draw-polyline"}`};let M=class extends O{render(){var e;const{elevation:t,totalLength:i}=this.info,r=null==(e=this._messagesTooltip)?void 0:e.sketch;return Object(m["a"])("div",{class:w.base},Object(m["a"])(j,{title:null==r?void 0:r.elevation,value:this._formatVerticalLength(t)}),Object(m["a"])(j,{title:null==r?void 0:r.totalLength,value:this._formatLength(i)}))}};M=Object(r["a"])([Object(c["a"])("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],M);const A={base:`${h} ${h+"--extent-rotate"}`};let E=class extends O{render(){var e;const{angle:t}=this.info,i=null==(e=this._messagesTooltip)?void 0:e.sketch;return Object(m["a"])("div",{class:A.base},Object(m["a"])(j,{title:null==i?void 0:i.rotation,value:this._formatRelativeOrientation(t)}))}};E=Object(r["a"])([Object(c["a"])("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],E);const R={base:l+"-value-by-value"};let P=class extends p["a"]{constructor(){super(...arguments),this.divider=""}render(){return Object(m["a"])("div",{class:R.base},Object(m["a"])("span",null,this.left),Object(m["a"])("span",null,this.divider),Object(m["a"])("span",null,this.right))}};Object(r["a"])([Object(o["b"])()],P.prototype,"left",void 0),Object(r["a"])([Object(o["b"])()],P.prototype,"divider",void 0),Object(r["a"])([Object(o["b"])()],P.prototype,"right",void 0),P=Object(r["a"])([Object(c["a"])("esri.views.interactive.tooltip.support.ValueByValue")],P);const C={base:`${h} ${h+"--extent-scale"}`};let D=class extends O{render(){var e;const{xScale:t,yScale:i,xSize:r,ySize:n}=this.info,a=null==(e=this._messagesTooltip)?void 0:e.sketch;return Object(m["a"])("div",{class:C.base},Object(m["a"])(j,{title:null==a?void 0:a.size,value:Object(m["a"])(P,{left:this._formatLength(r),right:this._formatLength(n)})}),Object(m["a"])(j,{title:null==a?void 0:a.scale,value:Object(m["a"])(P,{left:this._formatScale(t),right:this._formatScale(i)})}))}};D=Object(r["a"])([Object(c["a"])("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],D);const I={base:`${h} ${h+"--reshape-edge-offset"}`};let L=class extends O{render(){var e;const{distance:t}=this.info,i=null==(e=this._messagesTooltip)?void 0:e.sketch;return Object(m["a"])("div",{class:I.base},Object(m["a"])(j,{title:null==i?void 0:i.distance,value:this._formatRelativeLength(t)}))}};L=Object(r["a"])([Object(c["a"])("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],L);const N={base:`${h} ${h+"--reshape-move-graphic"}`};let z=class extends O{render(){var e;const{distance:t}=this.info,i=null==(e=this._messagesTooltip)?void 0:e.sketch;return Object(m["a"])("div",{class:N.base},Object(m["a"])(j,{title:null==i?void 0:i.distance,value:this._formatLength(t)}))}};z=Object(r["a"])([Object(c["a"])("esri.views.interactive.tooltip.content.TooltipContentReshapeMoveGraphic")],z);const V={base:`${h} ${h+"--transform-absolute"}`};let F=class extends O{render(){var e;const{orientation:t,orientationEnabled:i,orientationPrecision:r,rotationType:n,size:a,sizeEnabled:s,sizeUnit:o,sizePrecision:c}=this.info,l=null==(e=this._messagesTooltip)?void 0:e.sketch;return Object(m["a"])("div",{class:V.base},i&&Object(m["a"])(j,{title:null==l?void 0:l.orientation,value:Object(d["a"])(t,n,r)}),s&&Object(m["a"])(j,{title:null==l?void 0:l.size,value:this._formatLength(a,o,c)}))}};F=Object(r["a"])([Object(c["a"])("esri.views.interactive.tooltip.content.TooltipContentTransformAbsolute")],F);const G={base:`${h} ${h+"--transform-rotate"}`};let k=class extends O{render(){var e;const{rotation:t,rotationPrecision:i,orientation:r,orientationPrecision:n,rotationType:a}=this.info,s=null==(e=this._messagesTooltip)?void 0:e.sketch;return Object(m["a"])("div",{class:G.base},Object(m["a"])(j,{title:null==s?void 0:s.rotation,value:Object(d["d"])(t,a,i)}),Object(m["a"])(j,{title:null==s?void 0:s.orientation,value:Object(d["a"])(r,a,n)}))}};k=Object(r["a"])([Object(c["a"])("esri.views.interactive.tooltip.content.TooltipContentTransformRotate")],k);const U={base:`${h} ${h+"--transform-scale"}`};let H=class extends O{render(){var e;const{scale:t,size:i,sizePrecision:r,sizeUnit:n}=this.info,a=null==(e=this._messagesTooltip)?void 0:e.sketch;return Object(m["a"])("div",{class:U.base},Object(m["a"])(j,{title:null==a?void 0:a.scale,value:this._formatPercentage(t)}),Object(m["a"])(j,{title:null==a?void 0:a.size,value:this._formatLength(i,n,r)}))}};H=Object(r["a"])([Object(c["a"])("esri.views.interactive.tooltip.content.TooltipContentTransformScale")],H);const B={base:`${h} ${h+"--translate-vertex"}`};let W=class extends O{render(){var e;const{area:t,distance:i,elevation:r,totalLength:n}=this.info,s=null==(e=this._messagesTooltip)?void 0:e.sketch;return Object(m["a"])("div",{class:B.base},Object(m["a"])(j,{title:null==s?void 0:s.distance,value:this._formatLength(i)}),Object(a["k"])(r)&&Object(m["a"])(j,{title:null==s?void 0:s.elevation,value:this._formatVerticalLength(r)}),Object(a["k"])(t)&&Object(m["a"])(j,{title:null==s?void 0:s.area,value:this._formatArea(t)}),Object(a["k"])(n)&&Object(m["a"])(j,{title:null==s?void 0:s.totalLength,value:this._formatLength(n)}))}};W=Object(r["a"])([Object(c["a"])("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],W);const q={base:`${h} ${h+"--extent-move-z"}`};let Z=class extends O{render(){var e;const{distance:t}=this.info,i=null==(e=this._messagesTooltip)?void 0:e.sketch;return Object(m["a"])("div",{class:q.base},Object(m["a"])(j,{title:null==i?void 0:i.distance,value:this._formatRelativeVerticalLength(t)}))}};function X(e,t){if(Object(a["j"])(t))return null;const i=document.createElement("div");switch(t.type){case"draw-point":return new x({tooltip:e,info:t,container:i});case"draw-polygon":return new T({tooltip:e,info:t,container:i});case"draw-polyline":return new M({tooltip:e,info:t,container:i});case"extent-rotate":return new E({tooltip:e,info:t,container:i});case"extent-scale":return new D({tooltip:e,info:t,container:i});case"reshape-edge-offset":return new L({tooltip:e,info:t,container:i});case"transform-absolute":return new F({tooltip:e,info:t,container:i});case"transform-rotate":return new k({tooltip:e,info:t,container:i});case"transform-scale":return new H({tooltip:e,info:t,container:i});case"translate-graphic":return new z({tooltip:e,info:t,container:i});case"translate-vertex":return new W({tooltip:e,info:t,container:i});case"translate-z":return new Z({tooltip:e,info:t,container:i})}}Z=Object(r["a"])([Object(c["a"])("esri.views.interactive.tooltip.content.TooltipContentTranslateZ")],Z);const Y={base:""+l};let $=class extends n["a"]{constructor(e){super(e),this.info=null,this._contentContainer=(()=>{const e=document.createElement("div");return e.classList.add(Y.base),e})(),this._contentWidget=null}initialize(){const e=this._contentContainer;this.own([Object(s["f"])(()=>{var e;return null==(e=this.view.overlay)?void 0:e.surface},t=>{e.remove(),Object(a["b"])(t,t=>t.appendChild(e))},s["e"]),Object(s["f"])(()=>this.info,(t,i)=>{Object(a["k"])(this._contentWidget)&&Object(a["k"])(t)&&Object(a["k"])(i)&&t.type===i.type?this._contentWidget.info=t:(this._contentWidget=Object(a["d"])(this._contentWidget),Object(a["b"])(X(this,t),t=>{this._contentWidget=t,e.appendChild(t.container)}))},s["e"]),Object(s["f"])(()=>{var e;return{container:this._contentContainer,contentWidget:this._contentWidget,screenPoint:null==(e=this.view.inputManager)?void 0:e.latestPointerLocation}},Q,s["e"])])}destroy(){this._contentWidget=Object(a["d"])(this._contentWidget),this._contentContainer.remove()}clear(){this.info=null}get test(){return{contentContainer:this._contentContainer}}};function Q({container:e,contentWidget:t,screenPoint:i}){const{style:r}=e;if(Object(a["k"])(i)&&Object(a["k"])(t)){r.display="block";const t=Object(b["e"])(e),n=`translate(${Math.round(i.x)+J[0]*(t?-1:1)}px, ${Math.round(i.y)+J[1]}px)`;r.transform=t?"translate(-100%, 0) "+n:n}else r.display="none"}Object(r["a"])([Object(o["b"])({nonNullable:!0})],$.prototype,"view",void 0),Object(r["a"])([Object(o["b"])()],$.prototype,"info",void 0),Object(r["a"])([Object(o["b"])()],$.prototype,"_contentContainer",void 0),Object(r["a"])([Object(o["b"])()],$.prototype,"_contentWidget",void 0),$=Object(r["a"])([Object(c["a"])("esri.views.interactive.tooltip.Tooltip")],$);const J=[20,20]},4772:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var r=i("a4ee"),n=i("fc29"),a=i("e92d"),s=i("b2b2"),o=i("f4cc"),c=i("59b2"),l=(i("b50f"),i("c120"),i("cea0"),i("d386")),h=i("7aa6"),d=i("7298"),u=i("e047");const p=a["a"].getLogger("esri.views.interactive.InteractiveToolBase");let b=class extends n["a"]{constructor(e){super(e),this.manipulators=new u["a"],this.preferManipulatorCursor=!1,this.automaticManipulatorSelection=!0,this.hasFocusedManipulators=!1,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[d["a"].MANAGER,!0],[d["a"].USER,!0]]),this._creationFinishedResolver=Object(o["d"])()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(d["a"].USER)}set editable(e){this.setEditableFlag(d["a"].USER,e)}get updating(){return!1}get cursor(){return null}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){Object(s["j"])(this.view)?p.error("Can't activate tool if view is not defined."):(Object(h["b"])(this.view)&&this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===d["a"].USER&&this.notifyChange("editable"),this.onEditableChange()}getEditableFlag(e){return this._editableFlags.get(e)}whenCreated(){return this._creationFinishedResolver.promise}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(d["a"].USER)&&this.getEditableFlag(d["a"].MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.constructed)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};Object(r["a"])([Object(c["b"])({constructOnly:!0})],b.prototype,"view",void 0),Object(r["a"])([Object(c["b"])({readOnly:!0})],b.prototype,"active",null),Object(r["a"])([Object(c["b"])({value:!0})],b.prototype,"visible",null),Object(r["a"])([Object(c["b"])({value:!0})],b.prototype,"editable",null),Object(r["a"])([Object(c["b"])({readOnly:!0})],b.prototype,"manipulators",void 0),Object(r["a"])([Object(c["b"])({readOnly:!0})],b.prototype,"updating",null),Object(r["a"])([Object(c["b"])()],b.prototype,"cursor",null),Object(r["a"])([Object(c["b"])({readOnly:!0})],b.prototype,"preferManipulatorCursor",void 0),Object(r["a"])([Object(c["b"])({readOnly:!0})],b.prototype,"automaticManipulatorSelection",void 0),Object(r["a"])([Object(c["b"])()],b.prototype,"hasFocusedManipulators",void 0),Object(r["a"])([Object(c["b"])({readOnly:!0})],b.prototype,"created",void 0),Object(r["a"])([Object(c["b"])({readOnly:!0})],b.prototype,"removeIncompleteOnCancel",void 0),b=Object(r["a"])([Object(l["a"])("esri.views.interactive.InteractiveToolBase")],b)},"47f8":function(e,t,i){"use strict";function r(){return new Float32Array(3)}function n(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function a(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function s(e,t){return new Float32Array(e,t,3)}function o(){return r()}function c(){return a(1,1,1)}function l(){return a(1,0,0)}function h(){return a(0,1,0)}function d(){return a(0,0,1)}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return a}));const u=o(),p=c(),b=l(),f=h(),g=d();Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:n,fromValues:a,createView:s,zeros:o,ones:c,unitX:l,unitY:h,unitZ:d,ZEROS:u,ONES:p,UNIT_X:b,UNIT_Y:f,UNIT_Z:g},Symbol.toStringTag,{value:"Module"}))},"4aea":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));const r=["freehand","hybrid","click"],n="click"},"4d2d":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae");class n extends r["a"]{constructor(e){super(e,"vec2")}}},"4db9":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e,t={hasModelTransformation:!1,linearDepth:!1}){if(t.hasModelTransformation)return t.linearDepth?void e.vertex.code.add(r["b"]`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):void e.vertex.code.add(r["b"]`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.linearDepth?e.vertex.code.add(r["b"]`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(r["b"]`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},"4e73":function(e,t,i){"use strict";i.d(t,"a",(function(){return C}));i("e06a");var r=i("6c97"),n=i("ce6d"),a=i("38a4"),s=i("b2b2"),o=i("a915"),c=i("4c37"),l=i("1c92"),h=i("dae5"),d=i("d791"),u=i("afe1"),p=i("3349"),b=i("e431"),f=i("0b2d"),g=i("8188"),O=i("f694"),m=i("9180"),v=i("bd7e"),_=i("7289"),j=i("d18f"),y=i("7361"),x=i("d3cf"),S=i("0cb9"),T=i("9990"),w=i("b7c2"),M=i("171c"),A=i("5a22"),E=i("748f"),R=i("7298"),P=i("4ae5");class C{constructor(e){this.camera=new M["a"],this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=Object(u["d"])(),this._worldFrame=null,this._renderLocation=Object(f["f"])(),this._renderLocationDirty=!0,this._location=new P["a"]({x:0,y:0,z:0}),this._elevationAlignedLocation=new P["a"],this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=R["b"].None,this._focused=!1,this.events=new n["a"].EventEmitter,this._screenLocation={screenPointArray:Object(o["f"])(),renderScreenPointArray:Object(o["d"])(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=e.view.spatialReference;for(const t in e)this[t]=e[t];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:Object(c["d"])(()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()})}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){D(e)&&(this._screenLocationDirty=!0),Object(d["c"])(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=Object(u["d"])()),I(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){Object(x["a"])(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){Object(x["a"])(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;const e=Object(s["k"])(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;let e;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,D(this._modelTransform)){const t=this._calculateModelTransformOffset(Z);e=Object(b["e"])(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}intersectionDistance(e,t){if(!this.available)return null;const i=Object(o["i"])(e,L),n=this._getCollisionRadius(t),a=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(Object(p["s"])(this.screenLocation.screenPointArray,i)<n*n)return this.screenLocation.renderScreenPointArray[2]+a;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),r=this._calculateObjectTransform(t,G),c=n*this.screenLocation.pixelSize,l=Object(T["b"])(this.camera,i,z);if(Object(s["j"])(l))return null;for(const i of e){if(0===i.length)continue;const e=Object(b["q"])(U,i[0],r);for(let t=1;t<i.length;t++){const n=Object(b["q"])(H,i[t],r),s=Object(v["b"])(Object(v["f"])(e,n,N),l);if(null!=s&&s<c*c){const t=Object(b["e"])(y["d"].get(),e,n);Object(b["k"])(t,t,.5);const i=Object(o["a"])(y["d"].get());return this.camera.projectToRenderScreen(t,i),i[2]+a}Object(b["g"])(e,n)}}break}case"disc":{var c;const e=this.collisionType.direction,t=null!=(c=this.collisionType.offset)?c:f["c"],r=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(r,G),h=n*this.screenLocation.pixelSize,d=Object(T["b"])(this.camera,i,z);if(Object(s["j"])(d))return null;const u=Object(l["f"])(V,o),p=Object(b["x"])(W,e,u),g=Object(b["q"])(q,t,o);Object(_["g"])(g,p,k);const O=B;if(Object(_["m"])(k,d,O)&&Object(b["h"])(O,g)<h*h)return this.screenLocation.renderScreenPointArray[2]+a;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,r=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(r,G),h=n*this.camera.computeScreenPixelSizeAt(this.renderLocation),d=Object(T["b"])(this.camera,i,z);if(Object(s["j"])(d))return null;const u=Object(l["f"])(V,c),p=Object(b["x"])(W,t,u),f=this._calculateModelTransformPosition(q);Object(_["g"])(f,p,k);const g=B;if(!Object(_["m"])(k,d,g))break;for(const i of e){if(0===i.length)continue;const e=Object(b["q"])(U,i[0],c);for(let t=1;t<i.length;t++){const r=Object(b["q"])(H,i[t],c),n=Object(v["e"])(Object(v["f"])(e,r,N),g);if(null!=n&&n<h*h){const t=Object(b["e"])(y["d"].get(),e,r);Object(b["k"])(t,t,.5);const i=Object(o["a"])(y["d"].get());return this.camera.projectToRenderScreen(t,i),i[2]+a}Object(b["g"])(e,r)}}break}default:Object(r["a"])(this.collisionType)}return null}attach(e={manipulator3D:{}}){var t;if(!this.view._stage)return;const i=e.manipulator3D;if(Object(s["j"])(i.engineLayerId)){const e=new E["a"]({isPickable:!1,updatePolicy:w["j"].SYNC});this.view._stage.add(e),i.engineLayerId=e.id,this._engineLayer=e}else(null==(t=this.view._stage)?void 0:t.getObject)&&(this._engineLayer=this.view._stage.getObject(i.engineLayerId));i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,Object(s["j"])(this._materialIdReferences)&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),Object(g["b"])(this._location.spatialReference,this.view.spatialReference)||(this.location=new P["a"]({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const i=0===t.engineLayerReferences;i&&(t.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){Object(g["o"])(this.location,X,e.spatialReference),Object(m["g"])(e.extent,X)&&(this.location=this._location)}_evaluateElevationAlignment(e=this.location){if(Object(s["j"])(this.elevationInfo))return!1;let t=null,i=0;const r=Object(s["s"])(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=Object(s["s"])(Object(S["b"])(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":i=Object(s["s"])(Object(S["b"])(this.view.elevationProvider,e,"ground"),0)+r;break;case"relative-to-scene":i=Object(s["s"])(Object(S["b"])(this.view.elevationProvider,e,"scene"),0)+r;break;case"absolute-height":i=r}return(i!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=t,!0)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=G;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),r=(this.focused?R["c"].Focused:R["c"].Unfocused)|(this.selected?R["c"].Selected:R["c"].Unselected),n=this._noDisplayCount>0;for(const{stateMask:a,objects:s}of i){if(n){for(const e of s)e.setVisible(!1);continue}const e=(a&R["c"].All)!==R["c"].None,i=(a&R["b"].All)!==R["b"].None,o=!e||(r&a)==(a&R["c"].All),c=!i||(this.state&a)==(a&R["b"].All);if(o&&c)for(const r of s)r.setVisible(!0),r.transformation=t;else for(const t of s)t.setVisible(!1)}}_ensureEngineResources(){if(Object(s["j"])(this._engineResources)){const e=Object(s["r"])(this._engineLayer),t=[],i=new Set;this.renderObjects.forEach(({material:e})=>{i.has(e)||(t.push(e),i.add(e))});const r=(e,t)=>{const{geometry:i,material:r,transform:n}=t;Array.isArray(i)?i.forEach(t=>e.addGeometry(t,r,n)):e.addGeometry(i,r,n)},n=new Map;this._renderObjects.forEach(e=>{const t=new A["a"]({castShadow:!1});r(t,e);const i=e.stateMask||0,a=n.get(i)||[];a.push(t),n.set(i,a)});const a=[];n.forEach((e,t)=>a.push({stateMask:t,objects:e})),this._engineResources={objectsByState:a,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){if(this._engineResourcesAddedToStage||Object(s["j"])(this._engineResources))return;const{objectsByState:e,layer:t,materials:i}=this._engineResources;i.forEach(e=>{const t=Object(s["r"])(this._materialIdReferences),i=t.get(e.id)||0;0===i&&this.view._stage.add(e),t.set(e.id,i+1)}),e.forEach(({objects:e})=>{t.addMany(e),this.view._stage.addMany(e)}),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(e=!1){if(!this._engineResourcesAddedToStage||Object(s["j"])(this._engineResources)||!this.view._stage)return;const{objectsByState:t,layer:i,materials:r}=this._engineResources;t.forEach(({objects:e})=>{i.removeMany(e),this.view._stage.removeMany(e)}),r.forEach(e=>{const t=Object(s["r"])(this._materialIdReferences),i=t.get(e.id);1===i?(this.view._stage.remove(e),t.delete(e.id)):t.set(e.id,i-1)}),e&&this.view._stage.remove(i),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,F);return Object(b["w"])(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return Object(b["f"])(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return Object(d["s"])(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&Object(d["m"])(t,t,this._worldFrame),Object(d["m"])(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,Object(s["k"])(this._applyObjectTransform)&&this._applyObjectTransform(t),t}get test(){let e=!1;if(Object(s["k"])(this._engineResources))for(const t in this._engineResources.objectsByState){const i=this._engineResources.objectsByState[t];for(const t of i.objects)if(t.isVisible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function D(e){return 0!==e[12]||0!==e[13]||0!==e[14]}function I(e,t,i){switch(e.viewingMode){case"local":return Object(d["i"])(i),!0;case"global":{const r=Object(O["e"])(e.renderCoordsHelper.spatialReference);return Object(g["z"])(t,0,U,0,r.radius),Object(g["c"])(Object(a["g"])(U[0]),Object(a["g"])(U[1]),i),!0}}}const L=Object(o["f"])(),N=Object(v["d"])(),z=Object(j["c"])(),V=Object(h["b"])(),F=Object(u["d"])(),G=Object(u["d"])(),k=Object(_["d"])(),U=Object(f["f"])(),H=Object(f["f"])(),B=Object(f["f"])(),W=Object(f["f"])(),q=Object(f["f"])(),Z=Object(f["f"])(),X=new P["a"]({x:0,y:0,z:0,spatialReference:null})},"4f8b":function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return l}));var r=i("2119"),n=i("e431"),a=i("d18f");i("7361");function s(e){return e?{ray:Object(a["c"])(e.ray),c0:e.c0,c1:e.c1}:{ray:Object(a["c"])(),c0:0,c1:Number.MAX_VALUE}}function o(e,t=s()){return Object(a["b"])(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function c(e,t,i=s()){const r=Object(n["p"])(e.vector);return Object(a["f"])(e.origin,t,i.ray),i.c0=0,i.c1=r,i}function l(e,t){return d(e,e.c0,t)}function h(e,t){return d(e,e.c1,t)}function d(e,t,i){return Object(n["e"])(i,e.ray.origin,Object(n["k"])(i,e.ray.direction,t))}new r["a"](()=>({c0:0,c1:0,ray:null}))},"501b":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){e.code.add(r["b"]`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}},5241:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return f})),i.d(t,"c",(function(){return O})),i.d(t,"d",(function(){return g}));var r=i("b2b2"),n=i("afe1"),a=i("0b2d"),s=i("8188"),o=i("4261"),c=i("32ed"),l=i("1a54"),h=i("2e0f"),d=i("ba58"),u=i("5a22");const p=Object(a["f"])();function b(e,t,i,a,c,l,d,b){const f=i?i.length:0,g=e.clippingExtent;if(Object(s["p"])(t,p,e.elevationProvider.spatialReference),Object(r["k"])(g)&&!Object(o["e"])(g,p))return null;Object(s["p"])(t,p,e.renderCoordsHelper.spatialReference);const O=e.localOriginFactory.getOrigin(p),m=new u["a"]({castShadow:!1,metadata:{layerUid:l,graphicUid:d,usesVerticalDistanceToGround:!0}});for(let r=0;r<f;r++){const e=n["a"];m.addGeometry(i[r],a[r],e,O,b)}return{object:m,sampledElevation:Object(h["c"])(m,t,e.elevationProvider,e.renderCoordsHelper,c)}}function f(e,t,i){const r=e.elevationContext,n=i.spatialReference;Object(s["p"])(t,p,n),r.centerPointInElevationSR=Object(l["g"])(p[0],p[1],t.hasZ?p[2]:0,n)}function g(e){switch(e.type){case"point":return e;case"polygon":case"extent":return Object(d["a"])(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const i=Object(c["g"])(t,Object(c["f"])(t)/2);return Object(l["g"])(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.origin}return null}function O(e,t,i,r,n){const a=new Float64Array(3*e.length),s=new Float64Array(a.length);e.forEach((e,t)=>{a[3*t+0]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0});const o=Object(h["d"])(a,t,0,s,0,a,0,a.length/3,i,r,n),c=null!=o;return{numVertices:e.length,position:a,mapPosition:s,projectionSuccess:c,sampledElevation:o}}},"52b2":function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"}(r||(r={}))},"536f":function(e,t,i){"use strict";function r(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function n(e){let t=0,i=0;for(let r=0;r<e.length;r++){const n=e[r].size;"number"==typeof n&&(t+=n,i++)}return t/i}function a(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?n(e.stops):t}function s(e,t){if(!t)return e;const i=t.filter(e=>"size"===e.type).map(t=>{const{maxSize:i,minSize:r}=t;return(a(i,e)+a(r,e))/2});let r=0;const n=i.length;if(0===n)return e;for(let a=0;a<n;a++)r+=i[a];const s=Math.floor(r/n);return Math.max(s,e)}function o(e){const t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;const n="visualVariables"in t?s(i,t.visualVariables):i;if("simple"===t.type)return r(n,t.symbol);if("unique-value"===t.type){let e=n;return t.uniqueValueInfos.forEach(t=>{e=r(e,t.symbol)}),e}if("class-breaks"===t.type){let e=n;return t.classBreakInfos.forEach(t=>{e=r(e,t.symbol)}),e}return"dot-density"===t.type||t.type,n}i.d(t,"a",(function(){return o}))},5414:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return b}));var r=i("38a4"),n=i("b2b2"),a=i("3349"),s=i("02f1"),o=i("e431"),c=i("0b2d"),l=i("7289"),h=i("a1b1"),d=i("0f94");class u{constructor(e,t,i,r=0,n=f.IMMEDIATE){this.helper=e,this.planeType=t,this.edge=i,this.distance=r,this._plane=Object(l["d"])(),this._offsetPlane=Object(l["d"])(),this._minDistance=-1/0,this._maxDistance=1/0,n===f.IMMEDIATE&&this._initialize()}get plane(){return this._plane}get requiresSplitEdgeLeft(){return!this._left.isOriginalDirection}get requiresSplitEdgeRight(){return!this._right.isOriginalDirection}get edgeDirection(){return this._edgeDirection}_initialize(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}_initializeNeighbors(){var e,t,i,r;const n=this._toXYZ(this.edge.leftVertex.pos),a=this._toXYZ(null==(e=this.edge.leftVertex.leftEdge)||null==(t=e.leftVertex)?void 0:t.pos),s=this._toXYZ(this.edge.rightVertex.pos),l=this._toXYZ(null==(i=this.edge.rightVertex.rightEdge)||null==(r=i.rightVertex)?void 0:r.pos);this._edgeDirection=Object(o["v"])(Object(c["f"])(),n,s),this._left=this._computeNeighbor(n,a,this._edgeDirection),this._right=this._computeNeighbor(s,l,this._edgeDirection)}_toXYZ(e){return Object(n["k"])(e)?this.helper.toXYZ(e):null}_computeNeighbor(e,t,i){if(Object(n["j"])(t))return{start:e,end:t,direction:Object(c["h"])(-i[1],i[0],0),isOriginalDirection:!0};const r=Object(o["v"])(Object(c["f"])(),e,t),a=!this._passesBisectingAngleThreshold(r,i);return{start:e,end:t,direction:a?this._bisectVectorsPerpendicular(i,r):r,isOriginalDirection:!a}}_passesBisectingAngleThreshold(e,t){const i=Math.abs(Object(h["a"])(t,e));return i>=p&&i<=Math.PI-p}_bisectVectorsPerpendicular(e,t){const i=Object(o["i"])(e,t)<0?e:Object(o["s"])(Object(c["f"])(),e),r=Math.abs(Object(o["i"])(i,t));if(!(r<.001||r>.999))return this._bisectDirection(i,t);const n=Object(o["j"])(Object(c["f"])(),i,[0,0,1]);return Object(o["r"])(n,n)}_bisectDirection(e,t){const i=Object(o["e"])(Object(c["f"])(),e,t);return Object(o["r"])(i,i)}_initializePlane(){const e=this._computeNormalDirection(this._left),t=this._computeNormalDirection(this._right);Object(o["i"])(e,t)<0&&Object(o["s"])(t,t),Object(l["g"])(this._left.start,this._bisectDirection(e,t),this._plane)}_computeNormalDirection(e){const t=Object(o["j"])(Object(c["f"])(),e.direction,this._edgeDirection);Object(o["r"])(t,t);const i=Object(o["j"])(Object(c["f"])(),this._edgeDirection,t);return this.planeType===b.XY&&(i[2]=0),Object(o["r"])(i,i)}_initializeDistanceConstraints(){Object(n["k"])(this._left.end)&&!this.requiresSplitEdgeLeft&&this._updateDistanceConstraint(Object(l["u"])(this._plane,this._left.end)),Object(n["k"])(this._right.end)&&!this.requiresSplitEdgeRight&&this._updateDistanceConstraint(Object(l["u"])(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}_updateDistanceConstraint(e){e<=0&&(this._minDistance=Math.max(this._minDistance,e)),e>=0&&(this._maxDistance=Math.min(this._maxDistance,e))}_updateIntersectDistanceConstraint(e){const t=Object(l["q"])(e),i=this._edgeDirection,r=Object(o["e"])(Object(c["f"])(),this._left.start,this._left.direction),n=Object(o["e"])(Object(c["f"])(),this._right.start,this._right.direction),h=this._pointInBasis2D(Object(s["c"])(),t,i,this._left.start),u=this._pointInBasis2D(Object(s["c"])(),t,i,r),p=this._pointInBasis2D(Object(s["c"])(),t,i,this._right.start),b=this._pointInBasis2D(Object(s["c"])(),t,i,n),[f]=Object(d["d"])({start:u,end:h,type:d["a"].LINE},{start:b,end:p,type:d["a"].LINE});if(!f)return;const g=Object(a["g"])(Object(s["c"])(),h,u);Object(a["i"])(g,g);const O=Object(a["g"])(Object(s["c"])(),f,u),m=Object(a["h"])(g,O),v=Object(o["e"])(Object(c["f"])(),r,Object(o["k"])(Object(c["f"])(),this._left.direction,-m)),_=Object(l["u"])(e,v);this._updateDistanceConstraint(_)}_pointInBasis2D(e,t,i,r){return e[0]=Object(h["d"])(t,r),e[1]=Object(h["d"])(i,r),e}_offset(e,t){Number.isFinite(this._minDistance)&&(t=Math.max(this._minDistance,t)),Number.isFinite(this._maxDistance)&&(t=Math.min(this._maxDistance,t)),Object(l["c"])(this._offsetPlane,this._plane),this._offsetPlane[3]-=t;const i=(e,t,i)=>Object(n["k"])(t)&&Object(l["j"])(this._offsetPlane,e,Object(o["e"])(Object(c["f"])(),e,t),i),r=Object(c["f"])();(e===this.edge.leftVertex?i(this._left.start,this._left.direction,r):i(this._right.start,this._right.direction,r))&&this.helper.copy(this.helper.fromXYZ(r,void 0,this.helper.getM(e.pos)),e.pos)}signedDistanceToPoint(e){return Object(l["u"])(this.plane,this.helper.toXYZ(this.helper.pointToVector(e)))}apply(e){this._offset(e,this.distance)}undo(e){this._offset(e,0)}canAccumulate(e){return e instanceof u&&this.edge.leftVertex.index===e.edge.leftVertex.index&&this.edge.rightVertex.index===e.edge.rightVertex.index&&this.edge.component===e.edge.component&&this._maybeEqualsVec3(this._left.direction,e._left.direction)&&this._maybeEqualsVec3(this._right.direction,e._right.direction)&&Object(o["D"])(Object(l["q"])(this._plane),Object(l["q"])(e._plane))}accumulate(e,t){const i=this._plane[3]-t._plane[3]+t.distance;this._offset(e,i)}accumulateParams(e){const t=e.distance-e._plane[3];this.distance=t+this._plane[3]}clone(){const e=new u(this.helper,this.planeType,this.edge,this.distance,f.DEFERRED);return Object(l["c"])(e._plane,this._plane),Object(l["c"])(e._offsetPlane,this._offsetPlane),e._maxDistance=this._maxDistance,e._minDistance=this._minDistance,e._left=this._cloneNeighbor(this._left),e._right=this._cloneNeighbor(this._right),e._edgeDirection=Object(o["g"])(Object(c["f"])(),this._edgeDirection),e}_maybeEqualsVec3(e,t){return Object(n["j"])(e)&&Object(n["j"])(t)||Object(n["k"])(e)&&Object(n["k"])(t)&&Object(o["D"])(e,t)}_cloneNeighbor({start:e,end:t,direction:i,isOriginalDirection:r}){return{start:Object(o["g"])(Object(c["f"])(),e),end:Object(n["k"])(t)?Object(o["g"])(Object(c["f"])(),t):null,direction:Object(o["g"])(Object(c["f"])(),i),isOriginalDirection:r}}}const p=Object(r["g"])(15);var b,f;!function(e){e[e.XYZ=0]="XYZ",e[e.XY=1]="XY"}(b||(b={})),function(e){e[e.IMMEDIATE=0]="IMMEDIATE",e[e.DEFERRED=1]="DEFERRED"}(f||(f={}))},"56d6":function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return b}));var r=i("d791"),n=i("afe1"),a=i("3349"),s=i("02f1"),o=i("9e77"),c=i("d8a4"),l=i("1fe9"),h=i("3886"),d=i("85b3"),u=i("690a"),p=i("b7bd");function b(e){const t=new u["a"];t.include(o["a"],e);const{vertex:i,fragment:n}=t;return i.uniforms.add([new d["a"]("modelView",(e,t)=>Object(r["j"])(g,t.camera.viewMatrix,e.origin)),new d["a"]("proj",(e,t)=>t.camera.projectionMatrix),new l["a"]("glowWidth",(e,t)=>e.glowWidth*t.camera.pixelRatio),new c["a"]("pixelToNDC",(e,t)=>Object(a["a"])(f,2/t.camera.fullViewport[2],2/t.camera.fullViewport[3]))]),t.attributes.add(p["a"].START,"vec3"),t.attributes.add(p["a"].END,"vec3"),t.attributes.add(p["a"].UP,"vec3"),t.attributes.add(p["a"].EXTRUDE,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),i.code.add(h["b"]`void main() {
vec3 pos = mix(start, end, extrude.x);
vec4 viewPos = modelView * vec4(pos, 1);
vec4 projPos = proj * viewPos;
vec2 ndcPos = projPos.xy / projPos.w;
vec3 viewUp = (modelView * vec4(extrude.y * up, 0)).xyz;
vec4 projPosUp = proj * vec4(viewPos.xyz + viewUp, 1);
vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);
vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);
ndcPos += length(lxy) * projExtrudeDir;
vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));
vec3 viewPlaneNormal = (modelView * vec4(worldPlaneNormal, 0)).xyz;
vViewStart = (modelView * vec4(start, 1)).xyz;
vViewEnd = (modelView * vec4(end, 1)).xyz;
vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));
float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
ndcPos.x += xPaddingPixels * pixelToNDC.x;
uv = ndcPos * 0.5 + 0.5;
gl_Position = vec4(ndcPos, 0, 1);
}`),n.uniforms.add(new l["a"]("perScreenPixelRatio",(e,t)=>t.camera.perScreenPixelRatio)),n.code.add(h["b"]`float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {
vec3 origin = mix(start, end, 0.5);
vec3 basis = end - origin;
vec3 posAtOrigin = pos - origin;
float x = dot(normalize(basis), posAtOrigin);
float y = dot(plane.xyz, posAtOrigin);
float dx = max(abs(x) - length(basis), 0.0);
float dy = y;
float dist = length(vec2(dx, dy));
float width = fwidth(y);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}
void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);
vec4 color = laserlineProfile(distance);
float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));
gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);
}`),t}const f=Object(s["c"])(),g=Object(n["d"])(),O=Object.freeze(Object.defineProperty({__proto__:null,build:b},Symbol.toStringTag,{value:"Module"}))},"579f":function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c}));var r=i("2119"),n=i("e431"),a=i("0b2d"),s=i("bd7e");i("7361");function o(e,t,i){const r=t[0]-e[0],n=t[1]-e[1],a=i[0]-e[0],s=i[1]-e[1];return.5*Math.abs(r*s-n*a)}function c(e,t,i){return Object(n["f"])(l,t,e),Object(n["f"])(h,i,e),Object(n["p"])(Object(n["j"])(l,l,h))/2}new r["a"](s["d"]),new r["a"](()=>({p0:null,p1:null,p2:null}));const l=Object(a["f"])(),h=Object(a["f"])()},"58c2":function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return p}));var r=i("3349"),n=i("02f1"),a=i("7577"),s=i("0fc4"),o=i("d8a4"),c=i("fd48"),l=i("3886");function h(e){e.fragment.uniforms.add(new c["a"]("projInfo",(e,t)=>d(t))),e.fragment.uniforms.add(new o["a"]("zScale",(e,t)=>p(t))),e.fragment.code.add(l["b"]`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function d(e){const t=e.camera.projectionMatrix;return 0===t[11]?Object(a["l"])(u,2/(e.camera.fullWidth*t[0]),2/(e.camera.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):Object(a["l"])(u,-2/(e.camera.fullWidth*t[0]),-2/(e.camera.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}const u=Object(s["e"])();function p(e){return 0===e.camera.projectionMatrix[11]?Object(r["a"])(b,0,1):Object(r["a"])(b,1,0)}const b=Object(n["c"])()},5957:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return p})),i.d(t,"c",(function(){return b})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return h}));var r=i("d791"),n=i("8190"),a=i("1153"),s=i("b7bd");function o(e,t,i,r){const n=i.typedBuffer,a=i.typedBufferStride,s=e.length;r*=a;for(let o=0;o<s;++o){const i=2*e[o];n[r]=t[i],n[r+1]=t[i+1],r+=a}}function c(e,t,i,r,n){const a=i.typedBuffer,s=i.typedBufferStride,o=e.length;if(r*=s,null==n||1===n)for(let c=0;c<o;++c){const i=3*e[c];a[r]=t[i],a[r+1]=t[i+1],a[r+2]=t[i+2],r+=s}else for(let c=0;c<o;++c){const i=3*e[c];for(let e=0;e<n;++e)a[r]=t[i],a[r+1]=t[i+1],a[r+2]=t[i+2],r+=s}}function l(e,t,i,r,n=1){const a=i.typedBuffer,s=i.typedBufferStride,o=e.length;if(r*=s,1===n)for(let c=0;c<o;++c){const i=4*e[c];a[r]=t[i],a[r+1]=t[i+1],a[r+2]=t[i+2],a[r+3]=t[i+3],r+=s}else for(let c=0;c<o;++c){const i=4*e[c];for(let e=0;e<n;++e)a[r]=t[i],a[r+1]=t[i+1],a[r+2]=t[i+2],a[r+3]=t[i+3],r+=s}}function h(e,t,i,r,n,a=1){if(!i)return void c(e,t,r,n,a);const s=r.typedBuffer,o=r.typedBufferStride,l=e.length,h=i[0],d=i[1],u=i[2],p=i[4],b=i[5],f=i[6],g=i[8],O=i[9],m=i[10],v=i[12],_=i[13],j=i[14];if(n*=o,1===a)for(let c=0;c<l;++c){const i=3*e[c],r=t[i],a=t[i+1],l=t[i+2];s[n]=h*r+p*a+g*l+v,s[n+1]=d*r+b*a+O*l+_,s[n+2]=u*r+f*a+m*l+j,n+=o}else for(let c=0;c<l;++c){const i=3*e[c],r=t[i],l=t[i+1],y=t[i+2],x=h*r+p*l+g*y+v,S=d*r+b*l+O*y+_,T=u*r+f*l+m*y+j;for(let e=0;e<a;++e)s[n]=x,s[n+1]=S,s[n+2]=T,n+=o}}function d(e,t,i,n,a,s=1){if(!i)return void c(e,t,n,a,s);const o=i,l=n.typedBuffer,h=n.typedBufferStride,d=e.length,u=o[0],p=o[1],b=o[2],f=o[4],g=o[5],O=o[6],m=o[8],v=o[9],_=o[10],j=!Object(r["p"])(o),y=1e-6,x=1-y;if(a*=h,1===s)for(let r=0;r<d;++r){const i=3*e[r],n=t[i],s=t[i+1],o=t[i+2];let c=u*n+f*s+m*o,d=p*n+g*s+v*o,S=b*n+O*s+_*o;if(j){const e=c*c+d*d+S*S;if(e<x&&e>y){const t=1/Math.sqrt(e);c*=t,d*=t,S*=t}}l[a+0]=c,l[a+1]=d,l[a+2]=S,a+=h}else for(let r=0;r<d;++r){const i=3*e[r],n=t[i],o=t[i+1],c=t[i+2];let d=u*n+f*o+m*c,S=p*n+g*o+v*c,T=b*n+O*o+_*c;if(j){const e=d*d+S*S+T*T;if(e<x&&e>y){const t=1/Math.sqrt(e);d*=t,S*=t,T*=t}}for(let e=0;e<s;++e)l[a+0]=d,l[a+1]=S,l[a+2]=T,a+=h}}function u(e,t,i,n,a,s=1){if(!i)return void l(e,t,n,a,s);const o=i,c=n.typedBuffer,h=n.typedBufferStride,d=e.length,u=o[0],p=o[1],b=o[2],f=o[4],g=o[5],O=o[6],m=o[8],v=o[9],_=o[10],j=!Object(r["p"])(o),y=1e-6,x=1-y;if(a*=h,1===s)for(let r=0;r<d;++r){const i=4*e[r],n=t[i],s=t[i+1],o=t[i+2],l=t[i+3];let d=u*n+f*s+m*o,S=p*n+g*s+v*o,T=b*n+O*s+_*o;if(j){const e=d*d+S*S+T*T;if(e<x&&e>y){const t=1/Math.sqrt(e);d*=t,S*=t,T*=t}}c[a+0]=d,c[a+1]=S,c[a+2]=T,c[a+3]=l,a+=h}else for(let r=0;r<d;++r){const i=4*e[r],n=t[i],o=t[i+1],l=t[i+2],d=t[i+3];let S=u*n+f*o+m*l,T=p*n+g*o+v*l,w=b*n+O*o+_*l;if(j){const e=S*S+T*T+w*w;if(e<x&&e>y){const t=1/Math.sqrt(e);S*=t,T*=t,w*=t}}for(let e=0;e<s;++e)c[a+0]=S,c[a+1]=T,c[a+2]=w,c[a+3]=d,a+=h}}function p(e,t,i,r,n,a=1){const s=r.typedBuffer,o=r.typedBufferStride,c=e.length;if(n*=o,1===a){if(4===i)for(let l=0;l<c;++l){const i=4*e[l];s[n]=t[i],s[n+1]=t[i+1],s[n+2]=t[i+2],s[n+3]=t[i+3],n+=o}else if(3===i)for(let l=0;l<c;++l){const i=3*e[l];s[n]=t[i],s[n+1]=t[i+1],s[n+2]=t[i+2],s[n+3]=255,n+=o}}else if(4===i)for(let l=0;l<c;++l){const i=4*e[l];for(let e=0;e<a;++e)s[n]=t[i],s[n+1]=t[i+1],s[n+2]=t[i+2],s[n+3]=t[i+3],n+=o}else if(3===i)for(let l=0;l<c;++l){const i=3*e[l];for(let e=0;e<a;++e)s[n]=t[i],s[n+1]=t[i+1],s[n+2]=t[i+2],s[n+3]=255,n+=o}}function b(e,t,i,r,c,l){for(const b of t.fieldNames){const t=e.vertexAttributes.get(b),f=e.indices.get(b);if(t&&f)switch(b){case s["a"].POSITION:{Object(a["a"])(3===t.size);const e=c.getField(b,n["u"]);e&&h(f,t.data,i,e,l);break}case s["a"].NORMAL:{Object(a["a"])(3===t.size);const e=c.getField(b,n["u"]);e&&d(f,t.data,r,e,l);break}case s["a"].UV0:{Object(a["a"])(2===t.size);const e=c.getField(b,n["m"]);e&&o(f,t.data,e,l);break}case s["a"].COLOR:{Object(a["a"])(3===t.size||4===t.size);const e=c.getField(b,n["J"]);e&&p(f,t.data,t.size,e,l);break}case s["a"].SYMBOLCOLOR:{Object(a["a"])(3===t.size||4===t.size);const e=c.getField(b,n["J"]);e&&p(f,t.data,t.size,e,l);break}case s["a"].TANGENT:{Object(a["a"])(4===t.size);const e=c.getField(b,n["C"]);e&&u(f,t.data,r,e,l);break}}}}},"5a22":function(e,t,i){"use strict";i.d(t,"a",(function(){return v}));var r=i("b2b2"),n=i("d791"),a=i("afe1"),s=i("e431"),o=i("0b2d"),c=i("f895"),l=i("680b"),h=i("b7c2"),d=i("003f"),u=i("2765"),p=i("ecd7"),b=i("f2e0");class f{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(e,t,i,r,n,a){this.id=Object(b["a"])(),this.geometry=e,this.material=t,this.transformation=i,this.instanceParameters=r,this.origin=n,this._shaderTransformation=a,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return Object(r["k"])(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&(Object(s["q"])(e,e,this.getStaticTransformation()),!0)}}f.pool=new p["a"](f);var g=i("bea9"),O=i("1153"),m=i("b623");class v extends d["a"]{constructor(e={}){super(),this.type=u["a"].Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Object(a["d"])(),this._bvObjectSpace=new j,this._bvWorldSpace=new j,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==e.castShadow||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new _),this.transformation=Object(a["d"])();const{geometries:t,materials:i,transformations:r,origins:n}=e;if(Array.isArray(t)){Object(O["a"])(i.length===t.length,"Object3D: materials don't match geometries"),Object(O["a"])(r.length===t.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=t.length,this._geometries.length=t.length;for(let e=0;e<t.length;e++)this._geometries[e]=t[e],this._geometryRecords[e]=f.pool.acquire(t[e],i[e],Object(a["c"])(r[e]),{highlights:null,occludees:null,visible:this._visible},n&&n[e])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(e){Object(n["c"])(this._objectTransformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){Object(O["a"])(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e,t,i,n,s){i=i||a["a"],this._geometries.push(e);const o=f.pool.acquire(e,t,i,{highlights:null,occludees:null,visible:this._visible},n,s);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||Object(r["k"])(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}removeGeometry(e){const t=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=Object(r["k"])(t.shaderTransformation)?this._geometryRecords.some(e=>Object(r["k"])(e.shaderTransformation)):this._hasVolatileTransformation,t.dispose(),this._geometries.splice(e,1),this._emit("objectGeometryRemoved",{object:this,record:t}),this._invalidateBoundingVolume(),t}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("vertexAttrsUpdated",{object:this,record:e}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometryRecords)e.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new g["a"](h["d"].MaskOccludee);for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(m["a"])(t.instanceParameters.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(m["e"])(t.instanceParameters.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new g["a"](h["d"].Highlight);for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(m["a"])(t.instanceParameters.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(m["e"])(t.instanceParameters.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return Object(n["m"])(Object(r["s"])(t,Object(a["d"])()),this.transformation,e.getStaticTransformation())}_getCombinedShaderTransformation(e,t){return t=t||Object(a["d"])(),Object(n["m"])(t,this.transformation,e.getShaderTransformation()),t}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let n=0;n<this._geometryRecords.length;++n){const e=this._geometries[n],t=this._geometryRecords[n],i=e.boundingInfo;Object(r["k"])(i)&&(this._calculateTransformedBoundingVolume(i,this._bvObjectSpace,t.getShaderTransformation()),this._calculateTransformedBoundingVolume(i,this._bvWorldSpace,this._getCombinedShaderTransformation(t)))}Object(s["l"])(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),Object(s["l"])(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=Object(o["f"])(),t=Object(o["f"])(),i=Object(l["a"])(this.transformation);for(let n=0;n<this._geometryRecords.length;++n){const a=this._geometries[n].boundingInfo;if(Object(r["j"])(a))continue;const o=this._geometryRecords[n].getShaderTransformation(),c=Object(l["a"])(o);Object(s["q"])(e,a.getCenter(),o);const h=Object(s["m"])(e,this._bvObjectSpace.bounds),d=a.getBSRadius()*c;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],h+d),Object(s["q"])(t,e,this.transformation);const u=Object(s["m"])(t,this._bvWorldSpace.bounds),p=d*i;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],u+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(e,t,i){const r=e.getBBMin(),n=e.getBBMax(),a=Object(o["d"])(r),c=Object(o["d"])(n);Object(s["q"])(a,a,i),Object(s["q"])(c,c,i);for(let s=0;s<3;++s)t.min[s]=Math.min(t.min[s],a[s],c[s]),t.max[s]=Math.max(t.max[s],a[s],c[s]);for(let o=0;o<3;++o){Object(s["g"])(a,r),Object(s["g"])(c,n),a[o]=n[o],c[o]=r[o],Object(s["q"])(a,a,i),Object(s["q"])(c,c,i);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],a[e],c[e]),t.max[e]=Math.max(t.max[e],a[e],c[e])}}_invalidateBoundingVolume(){this._bvDirty=!0,Object(r["k"])(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,t){Object(r["k"])(this._parentLayer)&&this._parentLayer.events.emit(e,t)}get test(){const e=this;return{hasGeometry:t=>e._geometries.includes(t),getGeometryIndex:t=>e._geometries.indexOf(t)}}}class _{constructor(){this.min=Object(o["h"])(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Object(o["h"])(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class j extends _{constructor(){super(...arguments),this.bounds=Object(c["c"])()}init(){Object(s["w"])(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Object(s["w"])(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Object(c["a"])(this.bounds)}}},"5bab":function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c}));var r=i("b2b2"),n=i("a915"),a=i("1a54"),s=i("f408");class o{constructor(e,t,i,r=null){this.elevationInfo=e,this.defaultZ=t,this.view=i,this.excludeGraphics=r}screenToMap(e){if(Object(r["k"])(this.defaultZ))return this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(n["f"])(e.x,e.y),this.elevationInfo,this.defaultZ,this.excludeGraphics);const t=this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(n["f"])(e.x,e.y),this.elevationInfo,0,this.excludeGraphics);return Object(r["k"])(t)&&(t.z=void 0),t}mapToScreen(e){const t=Object(a["g"])(e.x,e.y,Object(s["a"])(this.view,e,this.elevationInfo),e.spatialReference);return this.view.toScreen(t)}}class c{constructor(e,t,i=[]){this.view=e,this.elevationInfo=t,this.exclude=i}screenToMap(e){const t=this.view.toMap(e,{exclude:this.exclude});return Object(r["k"])(t)&&(t.z=Object(s["g"])(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return Object(r["k"])(this.elevationInfo)&&(t=Object(a["g"])(e.x,e.y,Object(s["a"])(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}}class l{constructor(e){this.view=e,this.screenToMap=t=>e.toMap(t),this.mapToScreen=t=>e.toScreen(t)}}},"5d5f":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("3886");function n(e){const t=e.fragment.code;t.add(r["b"]`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(r["b"]`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(r["b"]`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var a=i("a7d7"),s=i("c51b");function o(e,t){const i=e.fragment.code;e.include(s["a"]),t.pbrMode===a["a"].Water||t.pbrMode===a["a"].WaterOnIntegratedMesh?(i.add(r["b"]`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),i.add(r["b"]`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(r["b"]`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(r["b"]`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(r["b"]`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):t.pbrMode!==a["a"].Normal&&t.pbrMode!==a["a"].Schematic||(e.include(n),i.add(r["b"]`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(r["b"]`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(r["b"]`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),i.add(r["b"]`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(r["b"]`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(r["b"]`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}},"5d7f":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae");class n extends r["a"]{constructor(e){super(e,"sampler2D")}}},"5dd2":function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return h}));var r=i("f315"),n=i("0b2d"),a=i("ea51"),s=i("8188"),o=i("40b6"),c=i("7f83"),l=i("41ef");function h(e){const{spatialReference:t}=e;return Object(l["a"])(t,g,O,m,e)}function d(e,t){if(!Object(c["d"])(e.spatialReference,t.spatialReference))return null;const{spatialReference:i}=e;return j[0]=e.x,j[1]=e.y,j[2]=e.hasZ?e.z:0,y[0]=t.x,y[1]=t.y,y[2]=t.hasZ?t.z:0,u(j,y,i)}function u(e,t,i){return Object(l["a"])(i,p,b,f,e,t,i)}function p(e,t,i){return Object(r["c"])(Object(o["e"])(_,e,t,i).distance,"meters")}function b(e,t,i){return Object(r["c"])(Object(a["geodesicLength"])(v(e,t,i),"meters"),"meters")}function f(e,t,i){return Object(s["x"])(e,i,x)&&Object(s["x"])(t,i,S)?Object(r["c"])(Object(o["e"])(_,x,S).distance,"meters"):null}function g(e){return Object(r["c"])(Object(o["d"])([e],"meters")[0],"meters")}function O(e){return Object(r["c"])(Object(a["geodesicLength"])(e,"meters"),"meters")}function m(e){const t=[];if(!Object(s["t"])(e,t))return null;let i=0;for(const r of t){let e=0;for(let t=1;t<r.length;++t)e+=Object(o["e"])(_,r[t-1],r[t]).distance;i+=e}return Object(r["c"])(i,"meters")}function v(e,t,i){return{type:"polyline",spatialReference:i,paths:[[[...e],[...t]]]}}const _={distance:null},j=Object(n["f"])(),y=Object(n["f"])(),x=Object(n["f"])(),S=Object(n["f"])()},"5ef2":function(e,t,i){"use strict";function r(){return new Float32Array(4)}function n(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function a(e,t,i,r){const n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function s(e,t){return new Float32Array(e,t,4)}function o(){return r()}function c(){return a(1,1,1,1)}function l(){return a(1,0,0,0)}function h(){return a(0,1,0,0)}function d(){return a(0,0,1,0)}function u(){return a(0,0,0,1)}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return a}));const p=o(),b=c(),f=l(),g=h(),O=d(),m=u();Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:n,fromValues:a,createView:s,zeros:o,ones:c,unitX:l,unitY:h,unitZ:d,unitW:u,ZEROS:p,ONES:b,UNIT_X:f,UNIT_Y:g,UNIT_Z:O,UNIT_W:m},Symbol.toStringTag,{value:"Module"}))},6061:function(e,t,i){"use strict";i.d(t,"a",(function(){return g}));var r=i("b2b2"),n=i("f2e0"),a=i("d791"),s=i("afe1"),o=i("e431"),c=i("0fc4"),l=i("680b"),h=i("b7c2"),d=i("1038");class u{constructor(){this.visible=!0}}var p=i("bea9"),b=i("b7bd"),f=i("b623");class g{constructor(e,t,i={}){this.data=e,this.material=t,this.boundingSphere=Object(c["e"])(),this.instanceParameters=new u,this._transformation=Object(s["d"])(),this._shaderTransformationDirty=!0,this.layerUid=Object(r["s"])(i.layerUid,null),this.graphicUid=Object(r["s"])(i.graphicUid,null),this.id=i.id?i.id:Object(n["a"])(),this.boundingInfo=Object(r["s"])(i.boundingInfo,null),this.calculateShaderTransformation=Object(r["s"])(i.calculateShaderTransformation,null),this.castShadow=!!i.castShadow&&i.castShadow}get transformation(){return this._transformation}updateTransformation(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(e,t,i=Object(l["a"])(e)){Object(r["j"])(this.boundingInfo)||(Object(o["q"])(t,this.boundingInfo.getCenter(),e),t[3]=this.boundingInfo.getBSRadius()*i)}get hasShaderTransformation(){return Object(r["k"])(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return Object(r["j"])(this.calculateShaderTransformation)?Object(r["s"])(this.transformation,s["a"]):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Object(s["d"])()),Object(a["c"])(this._shaderTransformation,this.calculateShaderTransformation(Object(r["s"])(this.transformation,s["a"]))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(Object(r["k"])(this._transformation)&&Object(o["q"])(e,e,this._transformation),!0);const t=this.indices.get(b["a"].POSITION),i=this.vertexAttributes.get(b["a"].POSITION);return!!Object(d["c"])(i,t,e)&&(Object(r["k"])(this._transformation)&&Object(o["q"])(e,e,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const e=new p["a"](h["d"].Highlight),t=this.instanceParameters;return t.highlights=Object(f["a"])(t.highlights,e),e}removeHighlight(e){const t=this.instanceParameters;t.highlights=Object(f["e"])(t.highlights,e)}}},"614d":function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_ALPHA=1]="MATERIAL_ALPHA",e[e.MATERIAL_DEPTH=2]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=3]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL",e[e.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT",e[e.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT",e[e.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT"}(r||(r={}))},"62ae":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("b2b2"),n=i("52b2");class a{constructor(e,t,i,a,s=null){this.name=e,this.type=t,this.arraySize=s,this.bind={[n["a"].Pass]:null,[n["a"].Draw]:null},Object(r["k"])(i)&&Object(r["k"])(a)&&(this.bind[i]=a)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}}},"647b":function(e,t,i){"use strict";i.d(t,"a",(function(){return Q}));var r=i("b2b2"),n=i("e431"),a=i("0b2d"),s=i("bd7e"),o=i("f53a"),c=i("38a4"),l=i("7577"),h=i("0fc4"),d=i("4f8b"),u=i("d359"),p=i("7289"),b=i("d18f"),f=i("f895"),g=i("2ebb"),O=i("fc00"),m=i("b7bd"),v=i("c3a4"),_=i("ca98"),j=i("c829"),y=i("56d6"),x=i("d17d"),S=i("189c");class T extends _["a"]{initializeProgram(e){const t=T.shader.get().build(this.configuration);return new j["a"](e.rctx,t,T.attributeLocations)}initializePipeline(){return Object(S["f"])({blending:Object(S["h"])(x["b"].ONE,x["b"].ONE_MINUS_SRC_ALPHA),colorWrite:S["c"]})}}T.shader=new v["a"](y["a"],()=>i.e("chunk-2d22cca6").then(i.bind(null,"f578"))),T.attributeLocations=new Map([[m["a"].START,0],[m["a"].END,1],[m["a"].UP,2],[m["a"].EXTRUDE,3]]);var w=i("7ce4"),M=i("0fa6");class A{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=Object(a["f"])(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=new Float64Array(3*e.length);let i=0;for(const r of e)t[i++]=r[0],t[i++]=r[1],t[i++]=r[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);Object(n["w"])(this._origin,e[t+0],e[t+1],e[t+2])}else Object(n["w"])(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this._ensureVAO(e);Object(r["k"])(t)&&(e.bindVAO(t),e.drawArrays(x["r"].TRIANGLES,0,this._count))}dispose(){Object(r["k"])(this._vao)&&this._vao.dispose()}_ensureVAO(e){return Object(r["j"])(this._buffers)?null:(Object(r["j"])(this._vao)&&(this._vao=this._createVAO(e,this._buffers)),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){const i=this._createDataBuffer(t);return this._dirty=!1,new M["a"](e,T.attributeLocations,{data:Object(g["a"])(P)},{data:w["a"].createVertex(e,x["D"].STATIC_DRAW,i)})}_ensureVertexData(e,t){if(!this._dirty)return;const i=this._createDataBuffer(t);e.vertexBuffers.data.setData(i),this._dirty=!1}_numberOfRenderVertices(e){return 2*(e.length/3-1)*3}_createDataBuffer(e){const t=e.reduce((e,t)=>e+this._numberOfRenderVertices(t),0);this._count=t;const i=P.createBuffer(t),r=this._origin;let a=0,s=0;for(const o of e){for(let e=0;e<o.length;e+=3){const t=Object(n["w"])(R,o[e+0],o[e+1],o[e+2]);0===e?s=this._renderCoordsHelper.getAltitude(t):this._renderCoordsHelper.setAltitude(t,s);const c=this._renderCoordsHelper.worldUpAtPosition(t,E),l=a+2*e,h=Object(n["f"])(R,t,r);if(e<o.length-3){i.up.setVec(l,c),i.up.setVec(l+3,c),i.up.setVec(l+5,c);for(let e=0;e<6;e++)i.start.setVec(l+e,h);i.extrude.setValues(l+0,0,-1),i.extrude.setValues(l+1,1,-1),i.extrude.setValues(l+2,1,1),i.extrude.setValues(l+3,0,-1),i.extrude.setValues(l+4,1,1),i.extrude.setValues(l+5,0,1)}if(e>0){i.up.setVec(l-2,c),i.up.setVec(l-4,c),i.up.setVec(l-5,c);for(let e=-6;e<0;e++)i.end.setVec(l+e,h)}}a+=this._numberOfRenderVertices(o)}return i.buffer}}const E=Object(a["f"])(),R=Object(a["f"])(),P=Object(O["a"])().vec3f(m["a"].START).vec3f(m["a"].END).vec3f(m["a"].UP).vec2f(m["a"].EXTRUDE);var C=i("d5f7"),D=i("badc"),I=i("7c51"),L=i("a4ee"),N=i("da35");class z extends N["a"]{constructor(){super(...arguments),this.contrastControlEnabled=!1}}Object(L["a"])([Object(N["b"])()],z.prototype,"contrastControlEnabled",void 0);var V=i("3886"),F=i("fa1e"),G=i("a997");V["a"];class k extends _["a"]{initializeProgram(e){const t=k.shader.get().build(this.configuration);return new j["a"](e.rctx,t,F["a"])}initializePipeline(){return Object(S["f"])({blending:Object(S["h"])(x["b"].ONE,x["b"].ONE_MINUS_SRC_ALPHA),colorWrite:S["c"]})}}k.shader=new v["a"](G["a"],()=>i.e("chunk-2d2248f1").then(i.bind(null,"e13b")));class U extends z{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1}}Object(L["a"])([Object(N["b"])()],U.prototype,"heightManifoldEnabled",void 0),Object(L["a"])([Object(N["b"])()],U.prototype,"pointDistanceEnabled",void 0),Object(L["a"])([Object(N["b"])()],U.prototype,"lineVerticalPlaneEnabled",void 0),Object(L["a"])([Object(N["b"])()],U.prototype,"intersectsLineEnabled",void 0);const H=Object(a["f"])(),B=Object(h["e"])(),W={glowColor:[1,.5,0],glowWidth:8,glowFalloff:8,innerColor:[1,1,1],innerWidth:1,globalAlpha:.75,angleCutoff:Object(c["g"])(6),globalAlphaContrastBoost:2,__tagStrict:"NoParameters"};function q(e,t,i,r){const a=H,s=B;Object(n["q"])(a,t,r),Object(n["g"])(s,i),s[3]=0,Object(l["m"])(s,s,r),Object(p["g"])(a,s,e)}class Z{constructor(e,t={},i={contrastControlEnabled:!1}){this._renderCoordsHelper=e,this._config=i,this._technique=null,this._heightManifoldEnabled=!1,this._heightManifoldTarget=Object(a["f"])(),this._pointDistanceEnabled=!1,this._pointDistanceOrigin=Object(a["f"])(),this._pointDistanceTarget=Object(a["f"])(),this._lineVerticalPlaneEnabled=!1,this._lineVerticalPlaneSegment=Object(s["d"])(),this._intersectsLineEnabled=!1,this._intersectsLineSegment=Object(s["d"])(),this._intersectsLineRadius=3,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._tempNormal=Object(a["f"])(),this._tempDir=Object(a["f"])(),this._tempUp=Object(a["f"])(),this._tempVec3A=Object(a["f"])(),this._tempVec3B=Object(a["f"])(),this._tempVec4=Object(h["e"])(),this._tempPlane=Object(p["d"])(),this._tempSphere=Object(f["c"])(),this._parameters=Object(I["b"])(t,W)}get renderSlots(){return[this._config.contrastControlEnabled?D["a"].LASERLINES_CONTRAST_CONTROL:D["a"].LASERLINES]}get needsLinearDepth(){return!0}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}get heightManifoldTarget(){return this._heightManifoldTarget}set heightManifoldTarget(e){Object(n["g"])(this._heightManifoldTarget,e),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}get pointDistanceTarget(){return this._pointDistanceTarget}set pointDistanceTarget(e){Object(n["g"])(this._pointDistanceTarget,e),this._requestRender()}get pointDistanceOrigin(){return this._pointDistanceOrigin}set pointDistanceOrigin(e){Object(n["g"])(this._pointDistanceOrigin,e),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){Object(s["c"])(e,this._lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}get intersectsLineSegment(){return this._intersectsLineSegment}set intersectsLineSegment(e){Object(s["c"])(e,this._intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._intersectsLineRadius}set intersectsLineRadius(e){e!==this._intersectsLineRadius&&(this._intersectsLineRadius=e,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,Object(r["k"])(this._pathVerticalPlaneData)&&this._requestRender())}set pathVerticalPlaneVertices(e){Object(r["j"])(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new A(this._renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(e){Object(r["j"])(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new A(this._renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameters(e){Object(I["g"])(this._parameters,e)&&this._requestRender()}initializeRenderContext(e){this._context=e;const t=e.renderContext.rctx;this._quadVAO=Object(C["b"])(t),this._techniqueRepository=e.shaderTechniqueRepository,this._techniqueConfig=new U;const i=new z;i.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(T,i)}uninitializeRenderContext(){this._quadVAO=Object(r["e"])(this._quadVAO),this._technique=Object(r["p"])(this._technique),this._pathVerticalPlaneData=Object(r["e"])(this._pathVerticalPlaneData),this._pathTechnique=Object(r["p"])(this._pathTechnique)}prepareTechnique(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._technique=this._techniqueRepository.releaseAndAcquire(k,this._techniqueConfig,this._technique),this._technique):this._pathTechnique}render(e,t){(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(e,t),this.pathVerticalPlaneEnabled&&this._renderPath(e)}_renderUnified(e,t){const i=e.rctx,r=i.bindTechnique(t,this._parameters,e.bindParameters);this._bindGlobalUniforms(e,r),this._bindHeightManifoldUniforms(e,r),this._bindPointDistanceUniforms(e,r),this._bindLineVerticalPlaneUniforms(e,r),this._bindIntersectsLineUniforms(e,r),i.bindVAO(this._quadVAO),i.drawArrays(x["r"].TRIANGLE_STRIP,0,4)}_renderPath(e){if(Object(r["j"])(this._pathVerticalPlaneData)||Object(r["j"])(this._pathTechnique))return;const t=e.rctx,i=this._pathTechnique,n=t.bindTechnique(i,{...this._parameters,origin:this._pathVerticalPlaneData.origin},e.bindParameters);this._bindGlobalUniforms(e,n),this._pathVerticalPlaneData.draw(e.rctx)}_bindHeightManifoldUniforms(e,t){if(!this.heightManifoldEnabled)return;const i=this._tempVec3A,r=this._tempPlane,n=e.bindParameters.camera;this._renderCoordsHelper.worldUpAtPosition(this._heightManifoldTarget,i),q(r,this._heightManifoldTarget,i,n.viewMatrix),t.setUniform4fv("heightPlane",r)}_bindPointDistanceUniforms(e,t){if(!this._pointDistanceEnabled)return;const i=e.bindParameters.camera,r=this._tempSphere;Object(n["g"])(r,this._pointDistanceOrigin),Object(n["q"])(r,r,i.viewMatrix),r[3]=Object(n["m"])(this._pointDistanceOrigin,this._pointDistanceTarget),t.setUniform4f("pointDistanceSphere",r[0],r[1],r[2],r[3])}_bindLineVerticalPlaneUniforms(e,t){if(!this._lineVerticalPlaneEnabled)return;const i=this._renderCoordsHelper,r=e.bindParameters.camera,a=this._tempPlane,o=this._tempVec3A,c=this._tempUp,l=this._tempDir,h=this._tempNormal;Object(s["h"])(this._lineVerticalPlaneSegment,.5,o),i.worldUpAtPosition(o,c),Object(n["r"])(l,this._lineVerticalPlaneSegment.vector),Object(n["j"])(h,c,l),Object(n["r"])(h,h),q(a,this._lineVerticalPlaneSegment.origin,h,r.viewMatrix),t.setUniform4fv("lineVerticalPlane",a);const d=this._tempVec3A;Object(n["g"])(d,this._lineVerticalPlaneSegment.origin),i.setAltitude(d,0),Object(n["q"])(d,d,r.viewMatrix),t.setUniform3fv("lineVerticalStart",d);const u=this._tempVec3B;Object(n["e"])(u,this._lineVerticalPlaneSegment.origin,this._lineVerticalPlaneSegment.vector),i.setAltitude(u,0),Object(n["q"])(u,u,r.viewMatrix),t.setUniform3fv("lineVerticalEnd",u)}_bindIntersectsLineUniforms(e,t){if(!this._intersectsLineEnabled)return;const i=Y,r=$,a=e.bindParameters.camera;if(this._intersectsLineInfinite){if(Object(d["c"])(Object(b["g"])(this._intersectsLineSegment.origin,this._intersectsLineSegment.vector),X),X.c0=-Number.MAX_VALUE,!Object(u["e"])(a.frustum,X))return;Object(d["e"])(X,i),Object(d["d"])(X,r)}else Object(n["g"])(i,this._intersectsLineSegment.origin),Object(n["e"])(r,this._intersectsLineSegment.origin,this._intersectsLineSegment.vector);const s=this._tempVec3A;Object(n["q"])(s,i,a.viewMatrix),t.setUniform3fv("intersectsLineStart",s);const o=this._tempVec4;Object(n["g"])(o,this._intersectsLineSegment.vector),this._tempVec4[3]=0,Object(l["m"])(this._tempVec4,this._tempVec4,a.viewMatrix),Object(n["q"])(r,r,a.viewMatrix),t.setUniform3fv("intersectsLineEnd",r),Object(n["r"])(o,o),t.setUniform3f("intersectsLineDirection",o[0],o[1],o[2]),t.setUniform1f("intersectsLineRadius",this._intersectsLineRadius)}_bindGlobalUniforms(e,t){const i=e.bindParameters.camera;this._heightManifoldEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._heightManifoldTarget)):this._pointDistanceEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._pointDistanceTarget)):this._lineVerticalPlaneEnabled&&t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._lineVerticalPlaneSegment.origin)),t.bindTexture("frameColor",e.offscreenRenderingHelper.mainColorTexture)}_requestRender(){this._context&&this._context.requestRender()}}const X=Object(d["a"])(),Y=Object(a["f"])(),$=Object(a["f"])();class Q extends o["a"]{constructor(e){super(e.view),this._angleCutoff=G["c"],this._style={},this._heightManifoldTarget=Object(a["f"])(),this._heightManifoldEnabled=!1,this._intersectsLine=Object(s["d"])(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProps(e)}get testData(){return this.renderer}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){Object(r["k"])(e)?(Object(n["g"])(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(Object(r["j"])(e))return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,J);this.intersectsLine=Object(s["g"])(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){Object(r["k"])(e)?(Object(s["c"])(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=Object(r["k"])(e)?Object(s["c"])(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=Object(r["k"])(e)?{origin:Object(a["d"])(e.origin),target:Object(a["d"])(e.target)}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||Object(r["k"])(this._pointDistanceLine)||Object(r["k"])(this._pathVerticalPlaneBuffers))?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){Object(r["k"])(this.renderer)||(this.renderer=new Z(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))}_syncStyle(){Object(r["j"])(this.renderer)||(this.renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))}_syncAngleCutoff(){Object(r["j"])(this.renderer)||this.renderer.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){Object(r["j"])(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){Object(r["j"])(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){Object(r["j"])(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){Object(r["j"])(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=Object(r["k"])(this._pathVerticalPlaneBuffers)&&this.visible,Object(r["k"])(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){Object(r["j"])(this.renderer)||(this.renderer.lineVerticalPlaneEnabled=Object(r["k"])(this._lineVerticalPlaneSegment)&&this.visible,Object(r["k"])(this._lineVerticalPlaneSegment)&&(this.renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){Object(r["j"])(this.renderer)||(this.renderer.pointDistanceEnabled=Object(r["k"])(this._pointDistanceLine)&&this.visible,Object(r["k"])(this._pointDistanceLine)&&(this.renderer.pointDistanceOrigin=this._pointDistanceLine.origin,this.renderer.pointDistanceTarget=this._pointDistanceLine.target))}_disposeRenderer(){Object(r["k"])(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)}}const J=Object(a["f"])()},"648c":function(e,t,i){"use strict";var r,n;i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n})),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(r||(r={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(n||(n={}))},"65a7":function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i("c649"),n=i("e753"),a=i("e6b5"),s=i("d232"),o=i("b63c"),c=i("5715");class l{draw(e,t){const i=this._getUniqueHints(e),l=[];for(const r of i)r instanceof n["a"]&&l.push(this.visualizeIntersectionPoint(r,t)),r instanceof a["a"]&&l.push(this.visualizeLine(r,t)),r instanceof s["a"]&&l.push(this.visualizeParallelSign(r,t)),r instanceof c["a"]&&l.push(this.visualizeRightAngleQuad(r,t)),r instanceof o["a"]&&l.push(this.visualizePoint(r,t));return Object(r["b"])(l)}_getUniqueHints(e){const t=[];for(const i of e){let e=!0;for(const r of t)if(i.equals(r)){e=!1;break}e&&t.push(i)}return t}}},6611:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("a4ee"),n=i("fc29"),a=i("59b2"),s=(i("b50f"),i("c120"),i("cea0"),i("d386"));let o=class extends n["a"]{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};Object(r["a"])([Object(a["b"])()],o.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"DECONFLICTOR_SHOW_GRID",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"LABELS_SHOW_BORDER",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"TEXT_SHOW_BASELINE",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"TEXT_SHOW_BORDER",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"OVERLAY_SHOW_CENTER",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"SHOW_POI",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"I3S_TREE_SHOW_TILES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"I3S_SHOW_MODIFICATIONS",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"LINE_WIREFRAMES",void 0),o=Object(r["a"])([Object(s["a"])("esri.views.3d.support.DebugFlags")],o);const c=new o},"661c":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a}));var r=i("38a4");function n(e,t,i=0){const n=Object(r["e"])(e,0,c);for(let r=0;r<4;r++)t[i+r]=Math.floor(256*l(n*s[r]))}function a(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*o[r];return i}const s=[1,256,65536,16777216],o=[1/256,1/65536,1/16777216,1/4294967296],c=a(new Uint8ClampedArray([255,255,255,255]));function l(e){return e-Math.floor(e)}},"666b":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae");class n extends r["a"]{constructor(e){super(e,"vec3")}}},6750:function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var r=i("501b"),n=i("8e97"),a=i("fd48"),s=i("1fe9"),o=i("8a80"),c=i("3886"),l=i("5d7f"),h=i("b2b2"),d=i("7577"),u=i("0fc4");function p(e){return Object(h["j"])(e)?u["b"]:4===e.length?e:Object(d["l"])(b,e[0],e[1],e[2],1)}const b=Object(u["e"])();function f(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?g(e,t):O(e)}function g(e,t){const i=!(t.draped&&t.stipplePreferContinuous),{vertex:h,fragment:d}=e;d.include(r["a"]),h.uniforms.add(new o["a"]("stipplePatternPixelSize")),t.draped||(Object(n["a"])(h,t),h.uniforms.add(new s["a"]("worldToScreenPerDistanceRatio",(e,t)=>1/t.camera.perScreenPixelRatio)),h.code.add(c["b"]`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),h.code.add(c["b"]`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${m};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),h.code.add(c["b"]`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),h.code.add(c["b"]`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),h.uniforms.add(new s["a"]("pixelRatio",(e,t)=>t.camera.pixelRatio)),h.code.add(c["b"]`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?c["b"]`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),d.uniforms.add(new l["a"]("stipplePatternTexture")),d.uniforms.add(new o["a"]("stipplePatternSDFNormalizer")),d.uniforms.add(new o["a"]("stipplePatternTextureSize")),d.uniforms.add(new o["a"]("stipplePatternPixelSizeInv")),d.code.add(c["b"]`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),d.code.add(c["b"]`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?c["b"]`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:c["b"]`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?c["b"]`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?c["b"]`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:c["b"]`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?c["b"]`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:c["b"]`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(d.uniforms.add(new a["a"]("stippleOffColor",e=>p(e.stippleOffColor))),d.code.add(c["b"]`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):d.code.add(c["b"]`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function O(e){e.fragment.code.add(c["b"]`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}const m=c["b"].float(.4)},"680b":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return o}));i("38a4");var r=i("e431"),n=i("0b2d");function a(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],r=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}function s(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),n=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),a=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return Object(r["w"])(e,i,n,a),e}function o(e,t,i){Math.abs(e[0])>Math.abs(e[1])?Object(r["w"])(t,0,1,0):Object(r["w"])(t,1,0,0),Object(r["j"])(i,e,t),Object(r["r"])(t,t),Object(r["j"])(t,i,e),Object(r["r"])(i,i)}function c(e,t,i,n){Object(r["f"])(l,t,e),Object(r["f"])(h,i,e),Object(r["j"])(n,l,h),Object(r["r"])(n,n),n[3]=-Object(r["i"])(e,n)}const l=Object(n["f"])(),h=Object(n["f"])();Object(n["f"])(),Object(n["f"])(),Object(n["f"])()},"690a":function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("ce50"),n=i("e92d"),a=i("b2b2");const s=n["a"].getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class o{constructor(){this.includedModules=new Map}include(e,t){if(this.includedModules.has(e)){const i=this.includedModules.get(e);if(i!==t){s.error("Trying to include shader module multiple times with different sets of options.");const t=new Set;for(const r of Object.keys(i))i[r]!==e[r]&&t.add(r);for(const r of Object.keys(e))i[r]!==e[r]&&t.add(r);t.forEach(t=>console.error(`  ${t}: current ${i[t]} new ${e[t]}`))}}else this.includedModules.set(e,t),e(this.builder,t)}}class c extends o{constructor(){super(...arguments),this.vertex=new d,this.fragment=new d,this.attributes=new u,this.varyings=new p,this.extensions=new b,this.constants=new f}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const t=this.extensions.generateSource(e),i=this.attributes.generateSource(e),r=this.varyings.generateSource(),n="vertex"===e?this.vertex:this.fragment,a=n.uniforms.generateSource(),s=n.code.generateSource(),o="vertex"===e?O:g,c=this.constants.generateSource().concat(n.constants.generateSource());return`\n${t.join("\n")}\n\n${o}\n\n${c.join("\n")}\n\n${a.join("\n")}\n\n${i.join("\n")}\n\n${r.join("\n")}\n\n${s.join("\n")}`}generateBind(e,t){const i=new Map;this.vertex.uniforms.entries.forEach(t=>{const r=t.bind[e];Object(a["k"])(r)&&i.set(t.name,r)}),this.fragment.uniforms.entries.forEach(t=>{const r=t.bind[e];Object(a["k"])(r)&&i.set(t.name,r)});const r=Array.from(i.values()),n=r.length;return(e,i)=>{for(let a=0;a<n;++a)r[a](t,e,i)}}}class l{constructor(){this._entries=new Map}add(e){if(!Array.isArray(e))return this._add(e);for(const t of e)this._add(t)}_add(e){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new r["a"](`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}generateSource(){return Array.from(this._entries.values()).map(e=>Object(a["k"])(e.arraySize)?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}}class h{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}}class d extends o{constructor(){super(...arguments),this.uniforms=new l,this.code=new h,this.constants=new f}get builder(){return this}}class u{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map(e=>`attribute ${e[1]} ${e[0]};`)}}class p{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(){return this._entries.map(e=>`varying ${e[1]} ${e[0]};`)}}class b{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?b.ALLOWLIST_VERTEX:b.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(e=>t.includes(e)).map(e=>`#extension ${e} : enable`)}}b.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],b.ALLOWLIST_VERTEX=[];class f{constructor(){this._entries=new Set}add(e,t,i){let r="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":r=f._numberToFloatStr(i);break;case"int":r=f._numberToIntStr(i);break;case"bool":r=i.toString();break;case"vec2":r=`vec2(${f._numberToFloatStr(i[0])},                            ${f._numberToFloatStr(i[1])})`;break;case"vec3":r=`vec3(${f._numberToFloatStr(i[0])},                            ${f._numberToFloatStr(i[1])},                            ${f._numberToFloatStr(i[2])})`;break;case"vec4":r=`vec4(${f._numberToFloatStr(i[0])},                            ${f._numberToFloatStr(i[1])},                            ${f._numberToFloatStr(i[2])},                            ${f._numberToFloatStr(i[3])})`;break;case"ivec2":r=`ivec2(${f._numberToIntStr(i[0])},                             ${f._numberToIntStr(i[1])})`;break;case"ivec3":r=`ivec3(${f._numberToIntStr(i[0])},                             ${f._numberToIntStr(i[1])},                             ${f._numberToIntStr(i[2])})`;break;case"ivec4":r=`ivec4(${f._numberToIntStr(i[0])},                             ${f._numberToIntStr(i[1])},                             ${f._numberToIntStr(i[2])},                             ${f._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":r=`${t}(${Array.prototype.map.call(i,e=>f._numberToFloatStr(e)).join(", ")})`}return this._entries.add(`const ${t} ${e} = ${r};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const g="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",O="precision highp float;\nprecision highp sampler2D;"},"692f":function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return v}));var r=i("0fc4"),n=i("2252"),a=i("a05b"),s=i("d272"),o=i("4db9"),c=i("c6d7"),l=i("3976"),h=i("4377"),d=i("8e97"),u=i("ea32"),p=i("fd48"),b=i("3886"),f=i("85b3"),g=i("690a"),O=i("b7c2"),m=i("b7bd");function v(e){const t=new g["a"],i=e.hasMultipassTerrain&&(e.output===a["a"].Color||e.output===a["a"].Alpha);t.include(o["a"]),t.include(n["a"],e),t.include(s["a"],e);const{vertex:r,fragment:v}=t;return v.include(h["a"]),Object(d["b"])(t,e),v.uniforms.add(new p["a"]("uColor",e=>e.color)),t.attributes.add(m["a"].POSITION,"vec3"),t.varyings.add("vWorldPosition","vec3"),i&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add(m["a"].OFFSET,"vec3"),e.shadingEnabled&&(r.uniforms.add(new f["a"]("viewNormal",(e,t)=>t.camera.viewInverseTransposeMatrix)),t.attributes.add(m["a"].NORMAL,"vec3"),t.varyings.add("vViewNormal","vec3")),r.code.add(b["b"]`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&r.code.add(b["b"]`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),r.code.add(b["b"]`
    ${i?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),i&&t.include(c["b"],e),v.code.add(b["b"]`
    void main() {
      discardBySlice(vWorldPosition);
      ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),e.shadingEnabled?(v.uniforms.add(new u["a"]("shadingDirection",e=>e.shadingDirection)),v.uniforms.add(new p["a"]("shadedColor",e=>_(e.shadingTint,e.color))),v.code.add(b["b"]`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`)):v.code.add(b["b"]`vec4 finalColor = uColor;`),v.code.add(b["b"]`
      if (finalColor.a < ${b["b"].float(l["b"])}) {
        discard;
      }
      ${e.output===a["a"].Alpha?b["b"]`gl_FragColor = vec4(finalColor.a);`:""}

      ${e.output===a["a"].Color?b["b"]`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${e.transparencyPassType===O["i"].Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),t}function _(e,t){const i=1-e[3],r=e[3]+t[3]*i;return 0===r?(j[3]=r,j):(j[0]=(e[0]*e[3]+t[0]*t[3]*i)/r,j[1]=(e[1]*e[3]+t[1]*t[3]*i)/r,j[2]=(e[2]*e[3]+t[2]*t[3]*i)/r,j[3]=t[3],j)}const j=Object(r["e"])(),y=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},"6a07":function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));i("02f1");var r=i("0fc4"),n=i("d8a4"),a=i("3886"),s=i("6a3c");const o=Object(r["g"])(1,1,0,1),c=Object(r["g"])(1,0,1,1);function l(e){e.fragment.uniforms.add(new s["a"]("depthTex",(e,t)=>t.highlightDepthTexture)),e.fragment.uniforms.add(new n["a"]("highlightViewportPixelSz",(e,t)=>t.inverseViewport)),e.fragment.constants.add("occludedHighlightFlag","vec4",o).add("unoccludedHighlightFlag","vec4",c),e.fragment.code.add(a["b"]`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, fragCoord.xy * highlightViewportPixelSz.xy).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}a["a"]},"6a21":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i("c120"),n=i("3886");function a({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(n["b"]`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(n["b"]`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function s(e){return!!Object(r["a"])("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}},"6a3c":function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return h}));var r=i("b2b2"),n=i("3349"),a=i("02f1"),s=i("d8a4"),o=i("62ae"),c=i("52b2");class l extends o["a"]{constructor(e,t){super(e,"sampler2D",c["a"].Pass,(i,r,n)=>i.bindTexture(e,t(r,n)))}}function h(e,t,i){const o=[new l(e,t)];if(i){const i=e+"Size";o.push(new s["a"](i,(e,i)=>{const s=t(e,i);return Object(r["k"])(s)?Object(n["a"])(d,s.descriptor.width,s.descriptor.height):a["b"]}))}return o}const d=Object(a["c"])()},"6ae9":function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return b})),i.d(t,"c",(function(){return g})),i.d(t,"d",(function(){return p}));var r=i("b50f"),n=i("ce6d"),a=i("b2b2"),s=i("1219"),o=i("521c"),c=i("8b1a"),l=i("7f83"),h=i("3c9c");function d(e,t){if(!t.supported)return;let i=1/0,r=-1/0;const n=t.upperBoundX-t.lowerBoundX;e.forEach(e=>{let a=e.pos[0];for(;a<t.lowerBoundX;)a+=n;for(;a>t.upperBoundX;)a-=n;i=Math.min(i,a),r=Math.max(r,a),e.pos[0]=a});const a=r-i;n-a<a&&e.forEach(e=>{e.pos[0]<0&&(e.pos[0]+=n)})}function u(e,t){const i=Object(l["e"])(e);return t===h["a"].Global&&i?{supported:!0,lowerBoundX:i.valid[0],upperBoundX:i.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}class p{constructor(e){this.component=e,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}get pos(){return this._pos}set pos(e){this._pos=e,this.component.unnormalizeVertexPositions()}}class b{constructor(e,t,i){this.component=e,this.leftVertex=t,this.rightVertex=i,this.type="edge",t.rightEdge=this,i.leftEdge=this}}class f{constructor(e,t){this.spatialReference=e,this.viewingMode=t,this.vertices=[],this.edges=[]}unnormalizeVertexPositions(){this.vertices.length<=1||d(this.vertices,u(this.spatialReference,this.viewingMode))}updateVertexIndex(e,t){if(0===this.vertices.length)return;const i=this.vertices[0];let r=null,n=e,a=t;do{r=n,r.index=a++,n=r.rightEdge?r.rightEdge.rightVertex:null}while(null!=n&&n!==i);r.leftEdge&&r!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(r),this.vertices.length-1)}getFirstVertex(){return 0===this.vertices.length?null:this.vertices[0]}getLastVertex(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]}isClosed(){return this.vertices.length>2&&null!==this.vertices[0].leftEdge}swapVertices(e,t){const i=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=i}iterateVertices(e){if(0===this.vertices.length)return;const t=this.vertices[0];let i=t;do{e(i,i.index),i=Object(a["k"])(i.rightEdge)?i.rightEdge.rightVertex:null}while(i!==t&&null!=i)}}class g extends n["a"]{constructor(e,t){super(),this.type=e,this.coordinateHelper=t,this._geometry=null,this.dirty=!0,this.components=[]}get geometry(){if(this.dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon()}this.dirty=!1}return this._geometry}get spatialReference(){return this.coordinateHelper.spatialReference}notifyChanges(e){this.dirty=!0,this.emit("change",e)}_toPoint(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}_toPolyline(){const e=[],t=this.coordinateHelper.vectorToArray;for(const i of this.components){if(i.vertices.length<1)continue;const r=[];let n=i.vertices.find(e=>null==e.leftEdge);const a=n;do{r.push(t(n.pos)),n=n.rightEdge?n.rightEdge.rightVertex:null}while(n&&n!==a);e.push(r)}return new o["a"]({paths:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}_toPolygon(){const e=[],t=this.coordinateHelper.vectorToArray;for(const i of this.components){if(i.vertices.length<1)continue;const r=[],n=i.vertices[0];let s=n;const o=s;do{r.push(t(s.pos)),s=Object(a["k"])(s.rightEdge)?s.rightEdge.rightVertex:null}while(s&&s!==o);i.isClosed()&&r.push(t(n.pos)),e.push(r)}return new s["a"]({rings:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(e,t){const i=e.spatialReference,n=Object(c["a"])(e.hasZ,e.hasM,i),a=new g(e.type,n);switch(e.type){case"polygon":{const s=e.rings;for(let e=0;e<s.length;++e){const o=s[e],c=new f(i,t),l=o.length>2&&Object(r["d"])(o[0],o[o.length-1]),h=l?o.length-1:o.length;for(let e=0;e<h;++e){const t=n.arrayToVector(o[e]),i=new p(c);c.vertices.push(i),i.pos=t,i.index=e}const d=c.vertices.length-1;for(let e=0;e<d;++e){const t=c.vertices[e],i=c.vertices[e+1],r=new b(c,t,i);c.edges.push(r)}if(l){const e=new b(c,c.vertices[c.vertices.length-1],c.vertices[0]);c.edges.push(e)}a.components.push(c)}break}case"polyline":for(const r of e.paths){const e=new f(i,t),s=r.length;for(let t=0;t<s;++t){const i=n.arrayToVector(r[t]),a=new p(e);e.vertices.push(a),a.pos=i,a.index=t}const o=e.vertices.length-1;for(let t=0;t<o;++t){const i=e.vertices[t],r=e.vertices[t+1],n=new b(e,i,r);e.edges.push(n)}a.components.push(e)}break;case"point":{const r=new f(i,t),s=new p(r);s.index=0,s.pos=n.pointToVector(e),r.vertices.push(s),a.components.push(r);break}}return a}}},"6d35":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("a4ee"),n=i("52b2"),a=i("da35");class s extends a["a"]{}Object(r["a"])([Object(a["b"])({constValue:!0})],s.prototype,"hasSliceHighlight",void 0),Object(r["a"])([Object(a["b"])({constValue:!1})],s.prototype,"hasSliceInVertexProgram",void 0),Object(r["a"])([Object(a["b"])({constValue:!1})],s.prototype,"instancedDoublePrecision",void 0),Object(r["a"])([Object(a["b"])({constValue:!1})],s.prototype,"isGround",void 0),Object(r["a"])([Object(a["b"])({constValue:n["a"].Pass})],s.prototype,"pbrTextureBindType",void 0)},"6d5b":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("3886"),n=i("b7bd");function a(e,t){t.hasVertexColors?(e.attributes.add(n["a"].COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(r["b"]`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(r["b"]`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(r["b"]`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},7079:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i("d047"),n=i("9617"),a=i("501b"),s=i("d8a4"),o=i("3886"),c=i("6a3c");function l(e,t){const{vertex:i,fragment:l}=e;t.hasMultipassGeometry&&i.include(n["b"]),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.code.add(o["b"]`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.hasMultipassGeometry?o["b"]`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.hasMultipassTerrain&&l.include(r["a"]),t.hasMultipassTerrain&&l.uniforms.add([new c["a"]("terrainDepthTexture",(e,t)=>t.multipassTerrain.linearDepthTexture),new s["a"]("nearFar",(e,t)=>t.camera.nearFar),new s["a"]("inverseViewport",(e,t)=>t.inverseViewport)]),l.include(a["a"]),l.code.add(o["b"]`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.hasMultipassTerrain?o["b"]`
          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}},"713b":function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return g}));var r=i("a05b"),n=i("d272"),a=i("4db9"),s=i("6d5b"),o=i("6a07"),c=i("6750"),l=i("3976"),h=i("8e97"),d=i("fd48"),u=i("1fe9"),p=i("3886"),b=i("690a"),f=i("b7bd");function g(e){const t=new b["a"];t.include(a["a"]),t.include(s["a"],e),t.include(c["a"],e),Object(h["b"])(t,e);const{vertex:i,fragment:g}=t;return e.stippleEnabled&&(t.attributes.add(f["a"].UV0,"vec2"),t.attributes.add(f["a"].AUXPOS1,"vec3"),i.uniforms.add(new d["a"]("viewport",(e,t)=>t.camera.fullViewport))),t.attributes.add(f["a"].POSITION,"vec3"),t.varyings.add("vpos","vec3"),i.code.add(p["b"]`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(i.code.add(p["b"]`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped?i.uniforms.add(new u["a"]("worldToScreenRatio",(e,t)=>1/t.screenToPCSRatio)):i.code.add(p["b"]`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(p["b"]`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?i.code.add(p["b"]`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):i.code.add(p["b"]`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.code.add(p["b"]`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),i.code.add(p["b"]`}`),e.output===r["a"].Highlight&&t.include(o["a"]),t.include(n["a"],e),g.uniforms.add(new u["a"]("alphaCoverage",(e,t)=>Math.min(1,e.width*t.camera.pixelRatio))),e.hasVertexColors||g.uniforms.add(new d["a"]("constantColor",e=>e.color)),g.code.add(p["b"]`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${p["b"].float(l["b"])}) {
      discard;
    }

    ${e.output===r["a"].Color?p["b"]`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===r["a"].Highlight?p["b"]`outputHighlight();`:""}
  }
  `),t}const O=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}))},7289:function(e,t,i){"use strict";i.d(t,"a",(function(){return C})),i.d(t,"b",(function(){return D})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return g})),i.d(t,"f",(function(){return f})),i.d(t,"g",(function(){return b})),i.d(t,"h",(function(){return p})),i.d(t,"i",(function(){return T})),i.d(t,"j",(function(){return w})),i.d(t,"k",(function(){return A})),i.d(t,"l",(function(){return E})),i.d(t,"m",(function(){return M})),i.d(t,"n",(function(){return P})),i.d(t,"o",(function(){return R})),i.d(t,"p",(function(){return S})),i.d(t,"q",(function(){return F})),i.d(t,"r",(function(){return I})),i.d(t,"s",(function(){return L})),i.d(t,"t",(function(){return x})),i.d(t,"u",(function(){return z})),i.d(t,"v",(function(){return d}));var r=i("38a4"),n=i("b2b2"),a=i("e431"),s=i("0b2d"),o=(i("f895"),i("a1b1")),c=i("7361"),l=i("680b");function h(e=G){return[e[0],e[1],e[2],e[3]]}function d(e=G[0],t=G[1],i=G[2],r=G[3]){return p(e,t,i,r,c["e"].get())}function u(e,t){return p(t[0],t[1],t[2],t[3],e)}function p(e,t,i,r,n=h()){return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function b(e,t,i){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function f(e,t,i,r=h()){const n=i[0]-t[0],a=i[1]-t[1],s=i[2]-t[2],o=e[0]-t[0],c=e[1]-t[1],l=e[2]-t[2],d=a*l-s*c,u=s*o-n*l,p=n*c-a*o,b=d*d+u*u+p*p,f=Math.abs(b-1)>1e-5&&b>1e-12?1/Math.sqrt(b):1;return r[0]=d*f,r[1]=u*f,r[2]=p*f,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function g(e,t,i,r,n){if(e.count<3)return!1;e.getVec(i,m);let s=r,o=!1;for(;s<e.count-1&&!o;)e.getVec(s,v),s++,o=!Object(a["o"])(m,v);if(!o)return!1;for(s=Math.max(s,n),o=!1;s<e.count&&!o;)e.getVec(s,_),s++,Object(a["f"])(j,m,v),Object(a["r"])(j,j),Object(a["f"])(y,v,_),Object(a["r"])(y,y),o=!Object(a["o"])(m,_)&&!Object(a["o"])(v,_)&&Math.abs(Object(a["i"])(j,y))<O;return o?(f(m,v,_,t),!0):(0!==i||1!==r||2!==n)&&g(e,t,0,1,2)}const O=.99619469809,m=Object(s["f"])(),v=Object(s["f"])(),_=Object(s["f"])(),j=Object(s["f"])(),y=Object(s["f"])();function x(e,t,i){return t!==e&&u(e,t),e[3]=-Object(a["i"])(F(e),i),e}function S(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function T(e,t,i,r){return Object(a["j"])(_,t,e),b(i,_,r)}function w(e,t,i,r){return V(e,t,Object(a["f"])(c["d"].get(),i,t),U,r)}function M(e,t,i){return!!Object(n["k"])(t)&&V(e,t.origin,t.direction,H,i)}function A(e,t,i){return V(e,t.origin,t.vector,k.NONE,i)}function E(e,t,i){return V(e,t.origin,t.vector,k.CLAMP,i)}function R(e,t){return z(e,t)>=0}function P(e,t){const i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5];return e[0]*(e[0]>0?i:a)+e[1]*(e[1]>0?r:s)+e[2]*(e[2]>0?n:o)+e[3]>=0}function C(e,t){const i=Object(a["i"])(F(e),t.ray.direction),r=-z(e,t.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const n=r/i;return i>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1}function D(e,t){const i=Object(a["i"])(F(e),t.ray.direction),r=-z(e,t.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const n=r/i;return i>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1}function I(e,t,i){const r=Object(a["k"])(c["d"].get(),F(e),-e[3]),n=N(e,Object(a["f"])(c["d"].get(),t,r),c["d"].get());return Object(a["e"])(i,n,r),i}function L(e,t,i,r){const n=F(e),s=c["d"].get(),h=c["d"].get();Object(l["d"])(n,s,h);const d=Object(a["f"])(c["d"].get(),i,t),u=Object(o["d"])(s,d),p=Object(o["d"])(h,d),b=Object(o["d"])(n,d);return Object(a["w"])(r,u,p,b)}function N(e,t,i){const r=Object(a["k"])(c["d"].get(),F(e),Object(a["i"])(F(e),t));return Object(a["f"])(i,t,r),i}function z(e,t){return Object(a["i"])(F(e),t)+e[3]}function V(e,t,i,n,s){const o=Object(a["i"])(F(e),i);if(0===o)return!1;let c=-(Object(a["i"])(F(e),t)+e[3])/o;return n&k.CLAMP&&(c=Object(r["e"])(c,0,1)),!(!(n&k.INFINITE_MIN)&&c<0||!(n&k.INFINITE_MAX)&&c>1)&&(Object(a["e"])(s,t,Object(a["k"])(s,i,c)),!0)}function F(e){return e}const G=[0,0,1,0];var k;!function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"}(k||(k={}));const U=k.INFINITE_MIN|k.INFINITE_MAX,H=k.INFINITE_MAX},7361:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return O})),i.d(t,"c",(function(){return p})),i.d(t,"d",(function(){return b})),i.d(t,"e",(function(){return f}));var r=i("f0b9"),n=i("2ab7"),a=i("dae5"),s=i("afe1"),o=i("b139"),c=i("02f1"),l=i("0b2d"),h=i("0fc4");class d{constructor(e,t,i){this.itemByteSize=e,this.itemCreate=t,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this.itemByteSize)}get(){0===this._itemsPtr&&Object(n["a"])(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const e=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let t=0;t<this._itemsPerBuffer;++t)this._items.push(this.itemCreate(e,t*this.itemByteSize));this._buffers.push(e)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=u){return new d(16,c["e"],e)}static createVec3f64(e=u){return new d(24,l["e"],e)}static createVec4f64(e=u){return new d(32,h["c"],e)}static createMat3f64(e=u){return new d(72,a["a"],e)}static createMat4f64(e=u){return new d(128,s["b"],e)}static createQuatf64(e=u){return new d(32,o["d"],e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}const u=4*r["a"].KILOBYTES,p=d.createVec2f64(),b=d.createVec3f64(),f=d.createVec4f64(),g=(d.createMat3f64(),d.createMat4f64()),O=d.createQuatf64()},7438:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return s})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return l})),i.d(t,"g",(function(){return b})),i.d(t,"h",(function(){return h}));var r=i("b7c2"),n=i("d17d"),a=i("189c");const s=Object(a["g"])(n["b"].SRC_ALPHA,n["b"].ONE,n["b"].ONE_MINUS_SRC_ALPHA,n["b"].ONE_MINUS_SRC_ALPHA),o=Object(a["h"])(n["b"].ONE,n["b"].ONE),c=Object(a["h"])(n["b"].ZERO,n["b"].ONE_MINUS_SRC_ALPHA);function l(e){return e===r["i"].FrontFace?null:e===r["i"].Alpha?c:o}function h(e){return e===r["i"].FrontFace?a["d"]:null}const d=5e5,u={factor:-1,units:-2};function p(e){return e?u:null}function b(e,t=n["h"].LESS){return e===r["i"].NONE||e===r["i"].FrontFace?t:n["h"].LEQUAL}},"748f":function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r=i("ce6d"),n=i("af40"),a=i("b2b2"),s=i("8a44"),o=i("b7c2"),c=i("003f"),l=i("2765");const h=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];var d=i("0bde");class u extends c["a"]{constructor(e,t=""){var i,a,c;super(),this.apiLayerUid=t,this.type=l["a"].Layer,this.events=new r["a"],this.isSliceable=!1,this._objects=new s["a"],this._stageHandles=new n["a"],this.apiLayerUid=t,this.isVisible=null==(i=null==e?void 0:e.isVisible)||i,this.isPickable=null==(a=null==e?void 0:e.isPickable)||a,this.updatePolicy=null!=(c=null==e?void 0:e.updatePolicy)?c:o["j"].ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const t of h)this._stageHandles.add(this.events.on(t,i=>e.handleEvent(t,i)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),Object(a["k"])(this._octree)&&this._octree.add([e])}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),Object(a["k"])(this._octree)&&this._octree.remove([e]))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),Object(a["k"])(this._octree)&&this._octree.add(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),Object(a["k"])(this._octree)&&this._octree.remove(t)}}sync(){Object(a["k"])(this._stage)&&this.updatePolicy!==o["j"].SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){Object(a["k"])(this._octree)&&this._octree.update(e,t)}getSpatialQueryAccelerator(){return Object(a["j"])(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Object(a["d"])(this._octree)}_createOctree(){this._octree=new d["a"](e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}},"74af":function(e,t,i){"use strict";i.d(t,"a",(function(){return v})),i.d(t,"b",(function(){return _})),i.d(t,"c",(function(){return g})),i.d(t,"d",(function(){return O})),i.d(t,"e",(function(){return m})),i.d(t,"f",(function(){return j})),i.d(t,"g",(function(){return y}));var r=i("b2b2"),n=i("d791"),a=i("e431"),s=i("0fc4"),o=i("7361"),c=i("d3cf"),l=i("4e73"),h=i("ba58"),d=i("b7c2"),u=i("caf7"),p=i("35b3"),b=i("d36e"),f=i("9360");function g(e,t=p["c"].OccludeAndTransparent,i=!0){const r=Object(s["g"])(e[0],e[1],e[2],e.length>3?e[3]:1),n=e[3]<1;return i?new f["a"]({color:r,transparent:n,writeDepth:!0,cullFace:d["b"].Back,renderOccluded:t}):new b["a"]({color:r,transparent:n,writeDepth:!0,cullFace:d["b"].Back,renderOccluded:t})}function O(e,t=p["c"].OccludeAndTransparent){const i=Object(s["g"])(e[0],e[1],e[2],4===e.length?e[3]:1);return new b["a"]({color:i,transparent:!0,writeDepth:!0,cullFace:d["b"].Front,renderOccluded:t})}function m(e,t,i){return new l["a"]({view:e,renderObjects:[{geometry:u["a"].createSphereGeometry(1,32,32),material:g(Object(s["g"])(t[0],t[1],t[2],null!=i?i:1))}]})}function v(e,t,i,r){const s=Object(a["f"])(o["d"].get(),e,i),c=_(s,Object(a["j"])(o["d"].get(),r,s),i,o["a"].get());Object(n["a"])(c,c);const l=Object(a["q"])(o["d"].get(),t,c);return Math.atan2(l[1],l[0])}function _(e,t,i,r){const n=Object(a["r"])(o["d"].get(),e),s=Object(a["r"])(o["d"].get(),t),c=Object(a["j"])(o["d"].get(),n,s);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=0,r[4]=s[0],r[5]=s[1],r[6]=s[2],r[7]=0,r[8]=c[0],r[9]=c[1],r[10]=c[2],r[11]=0,r[12]=i[0],r[13]=i[1],r[14]=i[2],r[15]=1,r}function j(e,t){const i=e.getViewForGraphic(t);return Object(r["k"])(i)&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(t,e.spatialReference):null}function y(e,t,i){const n=j(e,i);Object(r["k"])(n)?t.elevationAlignedLocation=n:x(t,i.geometry)}function x(e,t){if(Object(r["j"])(t))return;const i="mesh"===t.type?t.anchor:Object(h["a"])(t);Object(r["j"])(i)||(e.location=Object(c["b"])(i))}},7585:function(e,t,i){"use strict";i.d(t,"a",(function(){return yi}));var r,n=i("a4ee"),a=i("fc29"),s=i("ce6d"),o=i("af40"),c=i("28eb"),l=i("b2b2"),h=i("8a44"),d=i("477c"),u=i("c47a"),p=i("59b2"),b=(i("b50f"),i("c120"),i("cea0"),i("d386")),f=i("d791"),g=i("0b2d"),O=i("3c9c"),m=i("648c"),v=i("6611"),_=i("9b8b"),j=i("38a4"),y=i("9180"),x=i("b7c2"),S=i("f643");!function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded"}(r||(r={}));class T{constructor(e,t){this.index=e,this.renderTargets=t,this._extent=Object(y["k"])(),this.resolution=0,this.renderLocalOrigin=Object(S["a"])(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new w,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(t.renderTargets.length).fill(!1)}get extent(){return this._extent}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const t=e===r.ColorAndWater?this.renderTargets.getTarget(_["c"].Color):e===r.Highlight?this.renderTargets.getTarget(_["c"].Highlight):this.renderTargets.getTarget(_["c"].Occluded);return t?t.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(_["c"].ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(_["c"].Color):null}getNormalTexture(e){const t=e===r.ColorAndWater?this.renderTargets.getTarget(_["c"].Water):null;return t?t.getTexture():null}draw(e,t){const i=this.computeRenderTargetValidityBitfield();for(const r of this.renderTargets.renderTargets)r.type!==_["c"].ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[r.type]=e.drawTarget(this,r,t):this.validTargets[r.type]=!1;return i^this.computeRenderTargetValidityBitfield()?x["k"].CHANGED:x["k"].UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[_["c"].Color]|+e[_["c"].ColorNoRasterImage]<<1|+e[_["c"].Highlight]<<2|+e[_["c"].Water]<<3|+e[_["c"].Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(y["t"])(this._extent,e.range,0,t)}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(y["t"])(this._extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Object(y["j"])(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===_["b"].INNER?0:this.resolution,0,this.resolution,this.resolution)}}class w{constructor(){this.extents=[Object(y["k"])(),Object(y["k"])(),Object(y["k"])()],this.numViews=0}}var M=i("738e"),A=i("d17d"),E=i("d267");class R{constructor(e,t){this.size=Object(M["a"])(),this._fbo=null,this._fbo=new E["a"](e,{colorTarget:A["y"].TEXTURE,depthStencilTarget:A["m"].NONE},{target:A["A"].TEXTURE_2D,pixelFormat:A["p"].RGBA,dataType:A["q"].UNSIGNED_BYTE,wrapMode:A["B"].CLAMP_TO_EDGE,samplingMode:A["z"].LINEAR_MIPMAP_LINEAR,hasMipmap:t,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=Object(l["e"])(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return null!==this._fbo}resize(e,t){this.size[0]=e,this.size[1]=t,this._fbo.resize(this.size[0],this.size[1])}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var e;null==(e=this._fbo)||e.resize(0,0)}get gpuMemoryUsage(){var e,t;return null!=(e=null==(t=this._fbo)?void 0:t.gpuMemoryUsage)?e:0}}var P=i("614d");class C{constructor(e){const t=(t,i,r=!0)=>({type:i,fbo:new R(e,r),renderPass:t,valid:!1,lastUsed:1/0});this.renderTargets=[t(P["a"].MATERIAL,_["c"].Color),t(P["a"].MATERIAL,_["c"].ColorNoRasterImage),t(P["a"].MATERIAL_HIGHLIGHT,_["c"].Highlight,!1),t(P["a"].MATERIAL_NORMAL,_["c"].Water),t(P["a"].MATERIAL,_["c"].Occluded)]}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,t,i){if(e)t.lastUsed=i;else if(i-t.lastUsed>D)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((e,t)=>e+t.fbo.gpuMemoryUsage,0)}}const D=1e3;var I=i("f9d0");class L{constructor(e){this._context=e,this._perConstructorInstances=new I["a"],this._frameCounter=0,this._keepAliveFrameCount=z}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(e=>e.forEach(e=>e.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,t){const i=t.key;let r=this._perConstructorInstances.get(e,i);if(Object(l["j"])(r)){const n=new e(this._context,t,()=>this.release(n));r=new N(n),this._perConstructorInstances.set(e,i,r)}return++r.refCount,r.technique}releaseAndAcquire(e,t,i){if(Object(l["k"])(i)){if(t.key===i.key)return i;this.release(i)}return this.acquire(e,t)}release(e){if(Object(l["j"])(e)||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);Object(l["j"])(t)||(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==z&&this._perConstructorInstances.forEach((e,t)=>{e.forEach((e,i)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,i))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((t,i)=>{const r=async(e,t)=>{const i=t.shader;i&&(await i.reload(),e.forEach(e=>{e.technique.reload(this._context)}))};e.push(r(t,i))}),await Promise.all(e)}}class N{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}const z=-1,V=e=>{class t extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){for(const t of null!=(e=this._managedDisposables)?e:[]){var e;const i=this[t];this[t]=null,i&&"function"==typeof i.dispose&&i.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}}return t};V(class{});function F(){return(e,t)=>{var i,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=null!=(i=null==(r=e._managedDisposables)?void 0:r.slice())?i:[]),e._managedDisposables.unshift(t)}}var G=i("171c"),k=i("e92d"),U=i("1153");const H=k["a"].getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class B{constructor(e,t,i,r){this._textureRepository=e,this._techniqueRepository=t,this.materialChanged=i,this.requestRender=r,this._id2glMaterialRef=new I["a"]}dispose(){this._textureRepository.dispose()}acquire(e,t){this._ownMaterial(e);let i=this._id2glMaterialRef.get(t,e.id);if(Object(l["j"])(i)){const r=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:t});i=new W(r),this._id2glMaterialRef.set(t,e.id,i)}return i.ref(),i.glMaterial}release(e,t){const i=this._id2glMaterialRef.get(t,e.id);Object(l["k"])(i)&&(i.unref(),i.referenced||(Object(l["e"])(i.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){Object(l["k"])(e.repository)&&e.repository!==this&&H.error("Material is already owned by a different material repository"),e.repository=this}}class W{constructor(e){this.glMaterial=e,this.refCnt=0}ref(){++this.refCnt}unref(){--this.refCnt,Object(U["a"])(this.refCnt>=0)}get referenced(){return this.refCnt>0}}var q=i("d5f7"),Z=i("adf1"),X=i("35b3"),Y=i("02f1"),$=i("7bf3"),Q=i("9617"),J=i("c6d7"),K=i("df77"),ee=i("badc"),te=i("2245");class ie{constructor(e,t,i){this.shadowMap=e,this.ssaoHelper=t,this.slicePlane=i,this.slot=ee["a"].OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this._inverseViewport=Object(Y["c"])(),this.lighting=new te["a"],this.ssr=new K["a"],this.multipassTerrain=new J["a"],this.multipassGeometry=new Q["a"],this.clouds=new $["a"],this.overlays=[]}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}}class re{constructor(e,t,i,r=null){this.rctx=e,this.sliceHelper=r,this.lastFrameCamera=new G["a"],this.pass=P["a"].MATERIAL,this.renderOccludedMask=ne,this.bindParameters=new ie(t,i,Object(l["k"])(r)?r.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=ne}get isHighlightPass(){return this.pass===P["a"].MATERIAL_HIGHLIGHT}}const ne=X["c"].Occlude|X["c"].OccludeAndTransparent|X["c"].OccludeAndTransparentStencil;var ae,se=i("dae5"),oe=i("afe1"),ce=i("3349"),le=i("e431"),he=i("7577"),de=i("0fc4"),ue=i("a1ff"),pe=i("8539");!function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"}(ae||(ae={}));class be{constructor(){this.camera=new G["a"],this.lightMat=Object(oe["d"])()}}class fe{constructor(e,t,i=0){this.rctx=e,this.viewingMode=t,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Object(de["e"])(),this._cascades=[new be,new be,new be,new be],this.maxTextureSize=this.rctx.parameters.maxTextureSize,this.snapshotCount=i}get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get cascadeDistances(){return Object(he["l"])(this._usedCascadeDistances,this._cascadeDistances[0],this.numCascades>1?this._cascadeDistances[1]:1/0,this.numCascades>2?this._cascadeDistances[2]:1/0,this.numCascades>3?this._cascadeDistances[3]:1/0)}dispose(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(e){this.maxNumCascades=Object(j["e"])(Math.floor(e),1,4)}get maxCascades(){return this.maxNumCascades}set enabled(e){this._enabled=e,e||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&Object(l["k"])(this._depthTexture)}get snapshotCount(){return this._snapshots.length}set snapshotCount(e){const t=this._snapshots.length;if(e>t){const i=e-t;this._snapshots.length=e;for(let e=0;e<i;++e)this._snapshots[t+e]=null}else if(e<this.snapshotCount){const i=t-e;for(let t=0;t<i;++t)this._discardSnapshot(e+t);this._snapshots.length=e}}getSnapshot(e){return this.enabled?this._snapshots[e]:null}getCascades(){for(let e=0;e<this.numCascades;++e)Re[e]=this._cascades[e];return Re.length=this.numCascades,Re}start(e,t,i){Object(U["a"])(this.enabled),this._textureSize=this._computeTextureSize(e.fullWidth,e.fullHeight),this._ensureDepthTexture();const{near:r,far:n}=this._clampNearFar(i);this._computeCascadeDistances(n,r),this._setupMatrices(e,t);const a=e.viewMatrix,s=e.projectionMatrix;for(let o=0;o<this.numCascades;++o)this._constructCascade(o,s,a,t);this.lastOrigin=null,this.clear()}finish(e){Object(U["a"])(this.enabled),this.rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this.lastOrigin||!Object(le["o"])(e,this.lastOrigin)){this.lastOrigin=this.lastOrigin||Object(g["f"])(),Object(le["g"])(this.lastOrigin,e);for(let t=0;t<this.numCascades;++t){Object(f["j"])(Pe,this._cascades[t].lightMat,e);for(let e=0;e<16;++e)Ce[16*t+e]=Pe[e]}}return Ce}takeCascadeSnapshotTo(e,t){Object(U["a"])(this.enabled);const i=this._ensureSnapshot(t);this._bindFbo();const r=this.rctx,n=r.bindTexture(i,ue["a"].TEXTURE_UNIT_FOR_UPDATES);r.gl.copyTexSubImage2D(A["A"].TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),r.bindTexture(n,ue["a"].TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this.rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(A["e"].COLOR_BUFFER_BIT|A["e"].DEPTH_BUFFER_BIT)}_computeTextureSize(e,t){const i=.5*Math.log(e*e+t*t)*Math.LOG2E,r=.35,n=2**Math.round(i+r);return Math.min(this.maxTextureSize,2*n)}_ensureDepthTexture(){if(Object(l["k"])(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const e={target:A["A"].TEXTURE_2D,pixelFormat:A["p"].RGBA,dataType:A["q"].UNSIGNED_BYTE,wrapMode:A["B"].CLAMP_TO_EDGE,samplingMode:A["z"].NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new ue["a"](this.rctx,e),this._fbo=new E["a"](this.rctx,{colorTarget:A["y"].TEXTURE,depthStencilTarget:A["m"].DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(e){let t=this._snapshots[e];if(Object(l["k"])(t)&&t.descriptor.width===this._textureSize)return t;this._discardSnapshot(e);const i={target:A["A"].TEXTURE_2D,pixelFormat:A["p"].RGBA,dataType:A["q"].UNSIGNED_BYTE,wrapMode:A["B"].CLAMP_TO_EDGE,samplingMode:A["z"].NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return t=new ue["a"](this.rctx,i),this._snapshots[e]=t,t}_discardDepthTexture(){this._fbo=Object(l["e"])(this._fbo),this._depthTexture=Object(l["e"])(this._depthTexture)}_discardSnapshot(e){this._snapshots[e]=Object(l["e"])(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this.snapshotCount;++e)this._discardSnapshot(e)}_bindFbo(){const e=this.rctx;e.unbindTexture(this._depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,t,i,r){const n=this._cascades[e],a=-this._cascadeDistances[e],s=-this._cascadeDistances[e+1],o=(t[10]*a+t[14])/Math.abs(t[11]*a+t[15]),c=(t[10]*s+t[14])/Math.abs(t[11]*s+t[15]);Object(U["a"])(o<c);for(let h=0;h<8;++h){Object(he["l"])(ve,h%4==0||h%4==3?-1:1,h%4==0||h%4==1?-1:1,h<4?o:c,1),Object(he["m"])(_e[h],ve,me);for(let e=0;e<3;++e)_e[h][e]/=_e[h][3]}Object(le["s"])(Ee,_e[0]),Object(f["j"])(ge,Ae,Ee),n.camera.viewMatrix=ge;for(let h=0;h<8;++h)Object(le["q"])(_e[h],_e[h],n.camera.viewMatrix);Object(le["g"])(je,_e[0]),Object(le["g"])(ye,_e[0]);for(let h=1;h<8;++h)for(let e=0;e<3;++e)je[e]=Math.min(je[e],_e[h][e]),ye[e]=Math.max(ye[e],_e[h][e]);je[2]-=200,ye[2]+=200,n.camera.near=-ye[2],n.camera.far=-je[2],this.warp?this._constructTrapezoidalProjection(i,r,n):this._constructOrthogonalProjection(n),Object(f["m"])(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const l=this._textureSize/2;n.camera.viewport[0]=e%2==0?0:l,n.camera.viewport[1]=0===Math.floor(e/2)?0:l,n.camera.viewport[2]=l,n.camera.viewport[3]=l}_constructOrthogonalProjection(e){Object(f["q"])(e.camera.projectionMatrix,je[0],ye[0],je[1],ye[1],e.camera.near,e.camera.far)}_constructTrapezoidalProjection(e,t,i){const r=1/_e[0][3],n=1/_e[4][3];Object(U["a"])(r<n);let a=r+Math.sqrt(r*n);const s=Math.sin(Object(j["b"])(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));a/=s,He(_e,a,s,xe,Se,Te,we,Me),Ye(xe,Se,we,Me,i.camera.projectionMatrix),i.camera.projectionMatrix[10]=2/(je[2]-ye[2]),i.camera.projectionMatrix[14]=-(je[2]+ye[2])/(je[2]-ye[2])}_setupMatrices(e,t){Object(f["m"])(Oe,e.projectionMatrix,e.viewMatrix),Object(f["a"])(me,Oe);const i=this.viewingMode===O["a"].Global?e.eye:Object(le["w"])(Ee,0,0,1);Object(f["n"])(Ae,[0,0,0],[-t[0],-t[1],-t[2]],i)}_clampNearFar(e){let{near:t,far:i}=e;return t<2&&(t=2),i<2&&(i=2),t>=i&&(t=2,i=4),{near:t,far:i}}_computeCascadeDistances(e,t){this.numCascades=Math.min(1+Math.floor(Object(U["g"])(e/t,4)),this.maxNumCascades);const i=(e-t)/this.numCascades,r=(e/t)**(1/this.numCascades);let n=t,a=t;for(let s=0;s<this.numCascades+1;++s)this._cascadeDistances[s]=Object(j["l"])(n,a,this.splitSchemeLambda),n*=r,a+=i}get gpuMemoryUsage(){var e,t;return this._snapshots.reduce((e,t)=>e+Object(pe["d"])(t),null!=(e=null==(t=this._fbo)?void 0:t.gpuMemoryUsage)?e:0)}get test(){const e=this;return{maxNumCascades:this.maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(t){e.splitSchemeLambda=t},get splitSchemeLambda(){return e.splitSchemeLambda},set warp(t){e.warp=t},get warp(){return e.warp}}}}const ge=Object(oe["d"])(),Oe=Object(oe["d"])(),me=Object(oe["d"])(),ve=Object(de["e"])(),_e=[];for(let Si=0;Si<8;++Si)_e.push(Object(de["e"])());const je=Object(g["f"])(),ye=Object(g["f"])(),xe=Object(Y["c"])(),Se=Object(Y["c"])(),Te=Object(Y["c"])(),we=Object(Y["c"])(),Me=Object(Y["c"])(),Ae=Object(oe["d"])(),Ee=Object(g["f"])(),Re=[],Pe=Object(oe["d"])(),Ce=new Float32Array(64),De=Object(Y["c"])(),Ie=Object(Y["c"])(),Le=[Object(Y["c"])(),Object(Y["c"])(),Object(Y["c"])(),Object(Y["c"])()],Ne=Object(Y["c"])(),ze=Object(Y["c"])(),Ve=Object(Y["c"])(),Fe=Object(Y["c"])(),Ge=Object(Y["c"])(),ke=Object(Y["c"])(),Ue=Object(Y["c"])();function He(e,t,i,r,n,a,s,o){Object(ce["a"])(De,0,0);for(let j=0;j<4;++j)Object(ce["b"])(De,De,e[j]);Object(ce["f"])(De,De,.25),Object(ce["a"])(Ie,0,0);for(let j=4;j<8;++j)Object(ce["b"])(Ie,Ie,e[j]);Object(ce["f"])(Ie,Ie,.25),Object(ce["l"])(Le[0],e[4],e[5],.5),Object(ce["l"])(Le[1],e[5],e[6],.5),Object(ce["l"])(Le[2],e[6],e[7],.5),Object(ce["l"])(Le[3],e[7],e[4],.5);let c=0,l=Object(ce["s"])(Le[0],De);for(let j=1;j<4;++j){const e=Object(ce["s"])(Le[j],De);e<l&&(l=e,c=j)}Object(ce["g"])(Ne,Le[c],e[c+4]);const h=Ne[0];let d,u;Ne[0]=-Ne[1],Ne[1]=h,Object(ce["g"])(ze,Ie,De),Object(ce["h"])(ze,Ne)<0&&Object(ce["n"])(Ne,Ne),Object(ce["l"])(Ne,Ne,ze,i),Object(ce["i"])(Ne,Ne),d=u=Object(ce["h"])(Object(ce["g"])(Ve,e[0],De),Ne);for(let j=1;j<8;++j){const t=Object(ce["h"])(Object(ce["g"])(Ve,e[j],De),Ne);t<d?d=t:t>u&&(u=t)}Object(ce["c"])(r,De),Object(ce["f"])(Ve,Ne,d-t),Object(ce["b"])(r,r,Ve);let p=-1,b=1,f=0,g=0;for(let j=0;j<8;++j){Object(ce["g"])(Fe,e[j],r),Object(ce["i"])(Fe,Fe);const t=Ne[0]*Fe[1]-Ne[1]*Fe[0];t>0?t>p&&(p=t,f=j):t<b&&(b=t,g=j)}Object(U["k"])(p>0,"leftArea"),Object(U["k"])(b<0,"rightArea"),Object(ce["f"])(Ge,Ne,d),Object(ce["b"])(Ge,Ge,De),Object(ce["f"])(ke,Ne,u),Object(ce["b"])(ke,ke,De),Ue[0]=-Ne[1],Ue[1]=Ne[0];const O=Object(U["i"])(r,e[g],ke,Object(ce["b"])(Ve,ke,Ue),1,n),m=Object(U["i"])(r,e[f],ke,Ve,1,a),v=Object(U["i"])(r,e[f],Ge,Object(ce["b"])(Ve,Ge,Ue),1,s),_=Object(U["i"])(r,e[g],Ge,Ve,1,o);Object(U["k"])(O,"rayRay"),Object(U["k"])(m,"rayRay"),Object(U["k"])(v,"rayRay"),Object(U["k"])(_,"rayRay")}function Be(e,t){return 3*t+e}const We=Object(Y["c"])();function qe(e,t){return Object(ce["a"])(We,e[t],e[t+3]),We}const Ze=Object(Y["c"])(),Xe=Object(se["b"])();function Ye(e,t,i,r,n){Object(ce["g"])(Ze,i,r),Object(ce["f"])(Ze,Ze,.5),Xe[0]=Ze[0],Xe[1]=Ze[1],Xe[2]=0,Xe[3]=Ze[1],Xe[4]=-Ze[0],Xe[5]=0,Xe[6]=Ze[0]*Ze[0]+Ze[1]*Ze[1],Xe[7]=Ze[0]*Ze[1]-Ze[1]*Ze[0],Xe[8]=1,Xe[Be(0,2)]=-Object(ce["h"])(qe(Xe,0),e),Xe[Be(1,2)]=-Object(ce["h"])(qe(Xe,1),e);let a=Object(ce["h"])(qe(Xe,0),i)+Xe[Be(0,2)],s=Object(ce["h"])(qe(Xe,1),i)+Xe[Be(1,2)],o=Object(ce["h"])(qe(Xe,0),r)+Xe[Be(0,2)],c=Object(ce["h"])(qe(Xe,1),r)+Xe[Be(1,2)];a=-(a+o)/(s+c),Xe[Be(0,0)]+=Xe[Be(1,0)]*a,Xe[Be(0,1)]+=Xe[Be(1,1)]*a,Xe[Be(0,2)]+=Xe[Be(1,2)]*a,a=1/(Object(ce["h"])(qe(Xe,0),i)+Xe[Be(0,2)]),s=1/(Object(ce["h"])(qe(Xe,1),i)+Xe[Be(1,2)]),Xe[Be(0,0)]*=a,Xe[Be(0,1)]*=a,Xe[Be(0,2)]*=a,Xe[Be(1,0)]*=s,Xe[Be(1,1)]*=s,Xe[Be(1,2)]*=s,Xe[Be(2,0)]=Xe[Be(1,0)],Xe[Be(2,1)]=Xe[Be(1,1)],Xe[Be(2,2)]=Xe[Be(1,2)],Xe[Be(1,2)]+=1,a=Object(ce["h"])(qe(Xe,1),t)+Xe[Be(1,2)],s=Object(ce["h"])(qe(Xe,2),t)+Xe[Be(2,2)],o=Object(ce["h"])(qe(Xe,1),i)+Xe[Be(1,2)],c=Object(ce["h"])(qe(Xe,2),i)+Xe[Be(2,2)],a=-.5*(a/s+o/c),Xe[Be(1,0)]+=Xe[Be(2,0)]*a,Xe[Be(1,1)]+=Xe[Be(2,1)]*a,Xe[Be(1,2)]+=Xe[Be(2,2)]*a,a=Object(ce["h"])(qe(Xe,1),t)+Xe[Be(1,2)],s=Object(ce["h"])(qe(Xe,2),t)+Xe[Be(2,2)],o=-s/a,Xe[Be(1,0)]*=o,Xe[Be(1,1)]*=o,Xe[Be(1,2)]*=o,n[0]=Xe[0],n[1]=Xe[1],n[2]=0,n[3]=Xe[2],n[4]=Xe[3],n[5]=Xe[4],n[6]=0,n[7]=Xe[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=Xe[6],n[13]=Xe[7],n[14]=0,n[15]=Xe[8]}class $e{constructor(){this.adds=new h["a"],this.removes=new h["a"],this.updates=new h["a"]({allocator:e=>e||new Qe,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class Qe{}class Je{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var Ke=i("9250"),et=i("1942"),tt=i("3bd5");function it(e){const t=new Map,i=e=>{let i=t.get(e);return i||(i=new Je,t.set(e,i)),i};return e.removes.forAll(e=>{rt(e)&&i(e.material).removes.push(e)}),e.adds.forAll(e=>{rt(e)&&i(e.material).adds.push(e)}),e.updates.forAll(e=>{rt(e.renderGeometry)&&i(e.renderGeometry.material).updates.push(e)}),t}function rt(e){return e.data.indexCount>=1}var nt=i("2ebb"),at=i("b061"),st=i("7d11");class ot extends st["b"]{constructor(e=Object(g["f"])()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}}var ct=i("1f93");class lt{constructor(e){this.first=e.from,this.count=e.to-e.from}}class ht{constructor(e=0,t=0){this.from=e,this.to=t}}class dt extends ht{constructor(e,t,i,r,n,a){super(t,i),this.id=e,this.isVisible=r,this.hasHighlights=n,this.hasOccludees=a}}function ut(e){return Array.from(e.values()).sort(pt)}function pt(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function bt(e,t){if(0===e.length)return void e.push(new lt(t));const i=e[e.length-1];if(ft(i,t)){const e=t.from-i.first+t.to-t.from;i.count=e}else e.push(new lt(t))}function ft(e,t){return e.first+e.count>=t.from}class gt{constructor(e,t){this._pool=e,this._size=0,this._buffer=e.newBuffer(mt(t))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(e){this._resize(this._size+e,!0).dispose()}alloc(e){return this._resize(e,!1)}_resize(e,t){let i;const r=vt(this._buffer.length,this._size,e);if(this._buffer.length!==r){const e=this._pool.newBuffer(r);t&&(e.array.set(this._buffer.array.subarray(0,Math.min(this._size,r))),e.vao.vertexBuffers.geometry.setSubData(e.array,0,0,e.array.byteLength)),i=this._buffer,this._buffer=e}const n=this._size;return this._size=e,i?{dispose:()=>{i.array.fill(0,0,n),this._pool.deleteBuffer(i)},copy:(e,t,r)=>this._buffer.array.set(i.array.subarray(t,r),e),hasNewBuffer:!0}:{dispose:()=>{},copy:(e,t,i)=>{e!==t&&this._buffer.array.copyWithin(e,t,i)},hasNewBuffer:!1}}erase(e,t){this._buffer.array.fill(0,e,t)}}const Ot=65536;function mt(e){return Math.ceil(e/Ot)*Ot}function vt(e,t,i){return t<=i?e>=i?e:mt(Math.max(2*e,i)):e<=2*i?e:mt(i)}var _t=i("aefa"),jt=i("f2e0"),yt=i("7ce4"),xt=i("0fa6");class St{constructor(e,t,i,r){this.vao=new xt["a"](e,t,{geometry:i},{geometry:yt["a"].createVertex(e,A["D"].STATIC_DRAW)}),this.array=new Float32Array(r),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const Tt=_t["a"]+1;class wt{constructor(e,t,i){this._rctx=e,this._locations=t,this._layout=i,this._cache=e.newCache("MergedRenderer pool "+Object(jt["a"])(),Mt)}dispose(){this._cache.destroy()}newBuffer(e){const t=e.toString(),i=this._cache.pop(t);if(Object(l["k"])(i)){const e=i.pop();return i.length>0&&this._cache.put(t,i,e.array.byteLength*i.length,Tt),e}return new St(this._rctx,this._locations,this._layout,e)}deleteBuffer(e){const t=e.array.byteLength,i=e.array.length.toString(),r=this._cache.pop(i);return Object(l["k"])(r)?(r.push(e),this._cache.put(i,r,t*r.length,-1)):this._cache.put(i,[e],t,-1),null}}function Mt(e,t){if(t===_t["d"].ALL)return void e.forEach(e=>e.dispose());const i=e.pop(),r=e.length*i.array.byteLength;return i.dispose(),r}var At=i("b623");class Et{constructor(e,t,i){this._rctx=e,this._materialRepository=t,this._material=i,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new h["a"],this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new at["a"](this._material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._bufferPool=new wt(e,i.vertexAttributeLocations,Object(nt["a"])(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(e=>e.buffer.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof ct["a"]}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==X["c"].Occlude}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateRenderCommands()}_addAndRemoveGeometries(e,t){const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4,n=this._dataByOrigin,a=Pt(e,t);a.forEach((e,t)=>{a.delete(t);const s=e.toAdd.reduce((e,t)=>e+i.elementCount(t.data),0);let o=n.get(t);if(null==o)Object(U["a"])(0===e.toRemove.length),o=new Nt(e.origin,new gt(this._bufferPool,s*r)),n.set(t,o);else if(0===e.toAdd.length&&o.instances.size===e.toRemove.length)return o.buffer.dispose(),void n.delete(t);let c=0;o.instances.forEach(e=>c+=e.to-e.from);const l=e.toRemove.reduce((e,t)=>e+i.elementCount(t.data),0),h=o.buffer.size,d=(c+s-l)*r,u=Vt;if(d<h/2?this._removeAndRebuild(o,e.toRemove,r,d,u):e.toRemove.length>0&&this._remove(o,e.toRemove,r,u),e.toAdd.length>0){const t=Ft;Object(U["j"])(t,-e.origin[0],-e.origin[1],-e.origin[2]),this._add(o,e.toAdd,r,t,u)}const p=o.buffer.vao.vertexBuffers.geometry;Lt(u),u.forAll(({from:e,to:t})=>{if(e<t){const i=o.buffer.array,r=4,n=e*r,a=t*r;p.setSubData(i,n,n,a)}}),u.clear(),o.drawCommandsDirty=!0})}_updateGeometries(e){const t=this._bufferWriter,i=t.vertexBufferLayout.stride/4;for(const r of e){const e=r.renderGeometry,n=this._dataByOrigin.get(e.origin.id),a=n&&n.instances.get(e.id);if(!a)return;const s=r.updateType;if(s&tt["a"].State.VISIBILITIES&&(a.isVisible=e.instanceParameters.visible),s&(tt["a"].State.HIGHLIGHTS|tt["a"].State.VISIBILITIES)){const t=e.instanceParameters.visible;a.hasHighlights=!!e.instanceParameters.highlights&&t}if(s&tt["a"].State.OCCLUDEES&&(a.hasOccludees=!!e.instanceParameters.occludees),s&(tt["a"].State.VERTEXATTRS|tt["a"].State.TRANSFORMATION)){const{array:r,vao:s}=n.buffer;Object(At["b"])(e,Gt,kt),t.write({transformation:Gt,invTranspTransformation:kt},e.data,t.vertexBufferLayout.createView(r.buffer),a.from),Object(U["a"])(a.from+t.elementCount(e.data)===a.to,"material VBO layout has changed"),s.vertexBuffers.geometry.setSubData(r,a.from*i*4,a.from*i*4,a.to*i*4)}n.drawCommandsDirty=!0}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,Object(c["c"])(e.instances,t=>(t.isVisible?(t.hasHighlights&&(this._hasHighlights=!0,e.hasHighlights=!0),t.hasOccludees&&(this._hasOccludees=!0,e.hasOccludees=!0)):e.hasHiddenInstances=!0,e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees))});const e=e=>{if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.drawCommandsShadowHighlightRest=null,0===e.instances.size)return;if(!Dt(e)){const t=this._bufferWriter.vertexBufferLayout.stride,i=4*e.buffer.size/t;return void(e.drawCommandsDefault=[{first:0,count:i}])}const t=ut(e.instances);e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[],e.drawCommandsShadowHighlightRest=[];for(const i of t)i.isVisible&&(i.hasOccludees?bt(e.drawCommandsOccludees,i):bt(e.drawCommandsDefault,i),i.hasHighlights?bt(e.drawCommandsHighlight,i):bt(e.drawCommandsShadowHighlightRest,i))};this._dataByOrigin.forEach(t=>{t.drawCommandsDirty&&(e(t),t.drawCommandsDirty=!1)})}updateAnimation(e){return this._material.update(e)}requiresSlot(e,t){return null==e||this._material.requiresSlot(e,t)}render(e,t){if(!this.requiresSlot(t.slot,e))return!1;const i=e===P["a"].MATERIAL_HIGHLIGHT||e===P["a"].MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(i&&!this._hasHighlights)return!1;const r=e===P["a"].MATERIAL_DEPTH_SHADOWMAP_DEFAULT,n=!(i||r);if(this._dataByOrigin.forEach(e=>{if(i&&!e.hasHighlights)return;const t=(i?e.drawCommandsHighlight:r&&Dt(e)?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,a=n&&e.drawCommandsOccludees||null;(Object(l["k"])(t)||Object(l["k"])(a))&&this._renderCommandData.push(new zt(e.origin,e.buffer,t,a))}),0===this._renderCommandData.length)return!1;const a=this._rctx,s=this._glMaterials.load(a,e);if(Object(l["j"])(s))return this._renderCommandData.clear(),!1;const o=s.beginSlot(t);return a.bindTechnique(o,this._material.parameters,t,!1),this._renderCommandData.forAll(e=>{o.bindDraw(e,t);const{buffer:i,renderCommands:r,occludeeCommands:n}=e;o.ensureAttributeLocations(i.vao),a.bindVAO(i.vao);const s=o.primitiveType;Object(l["k"])(r)&&this._renderCommands(a,s,r),Object(l["k"])(n)&&(o.bindPipelineState(a,t.slot,!0),this._renderCommands(a,s,n),o.bindPipelineState(a,t.slot,!1))}),this._renderCommandData.clear(),!0}_renderCommands(e,t,i){for(let r=0;r<i.length;r++)e.drawArrays(t,i[r].first,i[r].count)}_removeAndRebuild(e,t,i,r,n){for(const l of t)e.instances.delete(l.id);const a=ut(e.instances);e.instances.clear();const s=e.buffer.size,o=e.buffer.alloc(r);let c=0;for(const l of a){const t=l.from*i,r=l.to*i;o.copy(c,t,r),l.from=c/i,c+=r-t,l.to=c/i,e.instances.set(l.id,l)}n.push(new ht(0,o.hasNewBuffer?e.buffer.array.length:s)),o.dispose(),e.buffer.erase(c,n.back().to),e.holes.clear()}_remove(e,t,i,r){for(const n of t){const t=n.id,a=e.instances.get(t),s=a.from*i,o=a.to*i;e.buffer.erase(s,o),e.holes.push(new ht(a.from,a.to)),e.instances.delete(t),r.push(new ht(s,o))}Lt(e.holes)}_add(e,t,i,r,n){if(0===t.length)return;const a=this._bufferWriter;let s=a.vertexBufferLayout.createView(e.buffer.array.buffer);const o=e.holes.length>0;let c=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;for(const d of t){const t=Object(l["k"])(d.transformation)?Object(f["m"])(Gt,r,d.transformation):r;Object(f["a"])(kt,t);const u=Object(f["t"])(kt,kt),p=a.elementCount(d.data),b=p*i;let g=It(e.holes,p);Object(l["j"])(g)&&(g=e.buffer.size/i,e.buffer.grow(b),s=a.vertexBufferLayout.createView(e.buffer.array.buffer)),a.write({transformation:t,invTranspTransformation:u},d.data,s,g);const O=d.instanceParameters.visible,m=!!d.instanceParameters.highlights&&O,v=!!d.instanceParameters.occludees,_=new dt(d.id,g,g+p,O,m,v);Object(U["a"])(null==e.instances.get(d.id)),e.instances.set(d.id,_),o?n.push(new ht(_.from*i,_.to*i)):(c=Math.min(_.from,c),h=Math.max(_.to,h))}o||n.push(new ht(c*i,h*i))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class Rt{constructor(e){this.origin=e,this.toAdd=new Array,this.toRemove=new Array}}function Pt(e,t){const i=new Map;for(const r of e)Ct(i,r,!0);for(const r of t)Ct(i,r,!1);return i}function Ct(e,t,i){const r=t.origin;if(Object(l["j"])(r))return;let n=e.get(r.id);null==n&&(n=new Rt(r.vec3),e.set(r.id,n)),i?n.toAdd.push(t):n.toRemove.push(t)}function Dt(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function It(e,t){let i;if(!e.some(e=>!(e.to-e.from<t)&&(i=e,!0)))return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}function Lt(e){const t=new Map;e.forAll(e=>t.set(e.from,e));let i=!0;for(;i;)i=!1,e.forEach(r=>{const n=t.get(r.to);n&&(r.to=n.to,t.delete(n.from),e.removeUnordered(n),i=!0)})}class Nt{constructor(e,t){this.origin=e,this.buffer=t,this.instances=new Map,this.holes=new h["a"]({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class zt extends ot{constructor(e,t,i,r){super(e),this.buffer=t,this.renderCommands=i,this.occludeeCommands=r}}const Vt=new h["a"]({deallocator:null}),Ft=Object(oe["d"])(),Gt=Object(oe["d"])(),kt=Object(oe["d"])();let Ut=class extends a["a"]{constructor(e){super(e),this._pending=new Ht,this._changes=new $e,this._materialRenderers=new Map,this._sortedMaterialRenderers=new h["a"],this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Object(c["c"])(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=it(this._changes);let t=!1,i=!1,r=!1;return e.forEach((e,n)=>{let a=this._materialRenderers.get(n);if(!a&&e.adds.length>0&&(a=new Et(this.rctx,this._materialRepository,n),this._materialRenderers.set(n,a),t=!0,i=!0,r=!0),!a)return;const s=i||a.hasHighlights,o=r||a.hasWater;a.modify(e),i=i||s!==a.hasHighlights,r=r||o!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(n),a.dispose(),t=!0)}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=Object(c["c"])(this._materialRenderers,e=>e.hasHighlights)),r&&(this._hasWater=Object(c["c"])(this._materialRenderers,e=>e.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,t){if(0===e.length)return;const i=this._validateRenderGeometries(e);for(const n of i)this._geometries.set(n.id,n);const r=this._pending.empty;for(const n of i)this._pending.adds.add(n);r&&this.notifyChange("updating"),t===tt["a"].Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const i=this._pending.empty,r=this._pending.adds;for(const n of e)r.has(n)?(this._pending.removed.add(n),r.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(Object(l["r"])(n.id));i&&!this._pending.empty&&this.notifyChange("updating"),t===tt["a"].Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const i=0===this._changes.updates.length;for(const r of e){const e=this._changes.updates.pushNew();e.renderGeometry=this._validateRenderGeometry(r),e.updateType=t}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case tt["a"].State.TRANSFORMATION:case tt["a"].State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e);case tt["a"].State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:i})=>t=i.updateAnimation(e)||t),t}render(e,t){for(let i=0;i<this._sortedMaterialRenderers.length;i++){const r=this._sortedMaterialRenderers.data[i];r.material.shouldRender(e)&&r.materialRenderer.render(e.pass,t)}}intersect(e,t,i,r,n){return this._geometries.forEach(a=>{if(r&&!r(a))return;this._intersectRenderGeometry(a,i,t,0,e,n);const s=this.rendererContext.longitudeCyclical;s&&(a.boundingSphere[0]-a.boundingSphere[3]<s.min&&this._intersectRenderGeometry(a,i,t,s.range,e,n),a.boundingSphere[0]+a.boundingSphere[3]>s.max&&this._intersectRenderGeometry(a,i,t,-s.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push({material:i,materialRenderer:t})}),this._sortedMaterialRenderers.sort((e,t)=>{const i=t.material.renderPriority-e.material.renderPriority;return 0!==i?i:e.material.insertOrder-t.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,i,r,n,a){if(!e.instanceParameters.visible)return;let s=0;Object(l["k"])(e.transformation)&&(r+=e.transformation[12],s=e.transformation[13]),Wt[0]=i[0]-r,Wt[1]=i[1]-s,Wt[2]=1,qt[0]=i[0]-r,qt[1]=i[1]-s,qt[2]=0,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),n,Wt,qt,(i,r,s)=>{Bt(t,s,e.material.renderPriority,a,n,e.layerUid,e.graphicUid)},e.calculateShaderTransformation,t)}_notifyGraphicGeometryChanged(e){if(Object(l["j"])(this.drapeSource.notifyGraphicGeometryChanged))return;let t;for(const i of e){const e=i.graphicUid;Object(l["k"])(e)&&e!==t&&(this.drapeSource.notifyGraphicGeometryChanged(e),t=e)}}_notifyGraphicVisibilityChanged(e){if(Object(l["j"])(this.drapeSource.notifyGraphicVisibilityChanged))return;let t;for(const i of e){const e=i.graphicUid;Object(l["k"])(e)&&e!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(e),t=e)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return Object(l["j"])(e.origin)&&(e.origin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};Object(n["a"])([Object(p["b"])()],Ut.prototype,"drapeSource",void 0),Object(n["a"])([Object(p["b"])()],Ut.prototype,"updating",null),Object(n["a"])([Object(p["b"])()],Ut.prototype,"rctx",null),Object(n["a"])([Object(p["b"])()],Ut.prototype,"rendererContext",void 0),Object(n["a"])([Object(p["b"])()],Ut.prototype,"_materialRepository",null),Object(n["a"])([Object(p["b"])()],Ut.prototype,"_localOriginFactory",null),Ut=Object(n["a"])([Object(b["a"])("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Ut);class Ht{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}function Bt(e,t,i,r,n,a,s){const o={layerUid:a,graphicUid:s,triangleNr:t},c=t=>{t.set(et["b"].OVERLAY,o,e.dist,e.normal,e.transformation,i,r)};if((null==n.results.min.drapedLayerOrder||i>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||n.results.ground.dist<=n.results.min.dist)&&c(n.results.min),n.options.store!==et["c"].MIN&&(null==n.results.max.drapedLayerOrder||i<n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||n.results.ground.dist>n.results.max.dist)&&c(n.results.max),n.options.store===et["c"].ALL){const e=Object(Ke["b"])(n.ray);c(e),n.results.all.push(e)}}const Wt=Object(g["f"])(),qt=Object(g["f"])();var Zt=i("2db0"),Xt=i("3886"),Yt=i("c3a4"),$t=i("ca98"),Qt=i("fa1e"),Jt=i("c829"),Kt=i("36df"),ei=i("189c");class ti extends $t["a"]{initializeProgram(e){const t=ti.shader.get().build(this.configuration);return new Jt["a"](e.rctx,t,Qt["a"])}initializePipeline(){return Object(ei["f"])({colorWrite:ei["c"]})}}ti.shader=new Yt["a"](Kt["a"],()=>i.e("chunk-2d0ab6a6").then(i.bind(null,"14d1")));var ii=i("3205");class ri{constructor(e,t,i){this._techniqueRep=e,this._rctx=t,this._requestRender=i,this._enabled=!1,this._ssaoTechniqueConfig=new ii["b"],this.quadVAO=null,this._blurSizePx=2,this._attenuation=.5}dispose(){this.quadVAO=Object(l["e"])(this.quadVAO)}disposeOffscreenBuffers(){Object(l["b"])(this._ssaoFBO,e=>e.resize(0,0)),Object(l["b"])(this._blur0FBO,e=>e.resize(0,0)),Object(l["b"])(this._blur1FBO,e=>e.resize(0,0))}set enabled(e){e?this._enable():this._disable()}get enabled(){return this._enabled}get ready(){return this.enabled&&Object(l["k"])(this._noiseTexture)&&Object(l["k"])(this._ssaoFBO)&&Object(l["k"])(this._blur0FBO)&&Object(l["k"])(this._blur1FBO)}get colorTexture(){return Object(l["k"])(this._blur1FBO)?this._blur1FBO.colorTexture:null}get width(){return Object(l["k"])(this._ssaoFBO)?this._ssaoFBO.width:-1}get height(){return Object(l["k"])(this._ssaoFBO)?this._ssaoFBO.height:-1}computeSSAO(e,t,i){if(!this.enabled||Object(l["j"])(t)||Object(l["j"])(i)||Object(l["j"])(this._noiseTexture)||Object(l["j"])(this._ssaoFBO)||Object(l["j"])(this._blur0FBO)||Object(l["j"])(this._blur1FBO))return;const r=this._rctx,n=e.camera,a=n.fullViewport,s=a[2],o=a[3],c=s/this._blurSizePx,h=o/this._blurSizePx;this._ssaoFBO.resize(s,o),this._blur0FBO.resize(c,h),this._blur1FBO.resize(c,h);const d=1,u=1,p=s*d,b=o*u;r.bindFramebuffer(this._ssaoFBO),r.setViewport(0,0,s,o);const f=r.bindTechnique(this._ssaoTechnique,ni,e);f.setUniform2f("rnmScale",s/this._noiseTexture.descriptor.width,o/this._noiseTexture.descriptor.height);let g=1/n.computeRenderPixelSizeAtDist(1);f.setUniform1f("projScale",g*d),f.setUniform2f("screenSize",p,b);const O=Object(le["m"])(n.eye,n.center);let m=20*n.computeRenderPixelSizeAtDist(O);m=Math.max(.1,m),f.setUniform1f("radius",m),f.setUniform1f("intensity",4*this._attenuation/m**6),f.bindTexture("rnm",this._noiseTexture),f.bindTexture("normalMap",i),f.bindTexture("depthMap",t),Object(l["j"])(this.quadVAO)&&(this.quadVAO=Object(q["b"])(this._rctx)),r.bindVAO(this.quadVAO),r.drawArrays(A["r"].TRIANGLE_STRIP,0,Object(pe["f"])(this.quadVAO,"geometry"));const v=r.bindTechnique(this._blurTechnique,ni,e);v.bindTexture("tex",this._ssaoFBO.colorTexture),v.bindTexture("normalMap",i),v.bindTexture("depthMap",t),r.setViewport(0,0,p/this._blurSizePx,b/this._blurSizePx),r.bindFramebuffer(this._blur0FBO),v.setUniform2f("screenSize",p,b),v.setUniform2f("blurSize",0,this._blurSizePx*d/b),O>5e4&&(g=Math.max(0,g-(O-5e4))),v.setUniform1f("projScale",g),r.drawArrays(A["r"].TRIANGLE_STRIP,0,Object(pe["f"])(this.quadVAO,"geometry")),v.setUniform2f("blurSize",this._blurSizePx*u/p,0),r.bindFramebuffer(this._blur1FBO),v.bindTexture("tex",this._blur0FBO.colorTexture),r.drawArrays(A["r"].TRIANGLE_STRIP,0,Object(pe["f"])(this.quadVAO,"geometry")),r.setViewport(a[0],a[1],a[2],a[3])}_selectPrograms(){this._ssaoTechniqueConfig.output=ii["a"].SSAO,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(ti,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=ii["a"].Blur,this._blurTechnique=this._techniqueRep.releaseAndAcquire(ti,this._ssaoTechniqueConfig,this._blurTechnique)}_enable(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))}_loadResources(e){this._data?e():i.e("chunk-2d0be660").then(i.bind(null,"2fa7")).then(t=>{this._data=t,e()})}_initialize(){const e={target:A["A"].TEXTURE_2D,pixelFormat:A["p"].RGBA,dataType:A["q"].UNSIGNED_BYTE,samplingMode:A["z"].LINEAR,wrapMode:A["B"].CLAMP_TO_EDGE,width:0,height:0},t={colorTarget:A["y"].TEXTURE,depthStencilTarget:A["m"].NONE};Object(Zt["a"])(this._data.noiseTexture).then(i=>{this._enabled&&(this._ssaoFBO=new E["a"](this._rctx,t,e),this._blur0FBO=new E["a"](this._rctx,t,e),this._blur1FBO=new E["a"](this._rctx,t,e),this._noiseTexture=new ue["a"](this._rctx,{target:A["A"].TEXTURE_2D,pixelFormat:A["p"].RGBA,dataType:A["q"].UNSIGNED_BYTE,hasMipmap:!0,width:i.width,height:i.height},i),this._requestRender())}),this._selectPrograms()}_disable(){this._enabled=!1,this._noiseTexture=Object(l["e"])(this._noiseTexture),this._blur1FBO=Object(l["e"])(this._blur1FBO),this._blur0FBO=Object(l["e"])(this._blur0FBO),this._ssaoFBO=Object(l["e"])(this._ssaoFBO)}get gpuMemoryUsage(){return(Object(l["k"])(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(Object(l["k"])(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(Object(l["k"])(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}const ni=new Xt["a"];var ai=i("3e44");class si extends $t["a"]{initializeProgram(e){const t=si.shader.get().build();return new Jt["a"](e.rctx,t,Qt["a"])}initializePipeline(){return this.configuration.hasAlpha?Object(ei["f"])({blending:Object(ei["g"])(A["b"].SRC_ALPHA,A["b"].ONE,A["b"].ONE_MINUS_SRC_ALPHA,A["b"].ONE_MINUS_SRC_ALPHA),colorWrite:ei["c"]}):Object(ei["f"])({colorWrite:ei["c"]})}}si.shader=new Yt["a"](ai["a"],()=>i.e("chunk-2d0b3143").then(i.bind(null,"279a")));var oi=i("da35");class ci extends oi["a"]{constructor(){super(...arguments),this.hasAlpha=!1}}Object(n["a"])([Object(oi["b"])()],ci.prototype,"hasAlpha",void 0);var li,hi,di=i("2bc9"),ui=i("661c");class pi{constructor(e){this._rctx=e,this.cache=new Map}dispose(){this.cache.forEach(e=>e.texture=Object(l["e"])(e.texture)),this.cache.clear()}_acquire(e){if(Object(l["j"])(e))return null;const t=this._patternId(e),i=this.cache.get(t);if(i)return i.refCount++,i.bind;const r=e.pixelRatio,{encodedData:n,sdfNormalizer:a,pixels:s,paddedPixels:o}=bi(e.pattern,r),c=s/r,h={refCount:1,texture:null,bind:e=>(Object(l["j"])(h.texture)&&(h.texture=new ue["a"](this._rctx,{width:o,height:1,internalFormat:A["p"].RGBA,pixelFormat:A["p"].RGBA,dataType:A["q"].UNSIGNED_BYTE,wrapMode:A["B"].CLAMP_TO_EDGE},n)),e.bindTexture("stipplePatternTexture",h.texture),{pixelSize:c,sdfNormalizer:a,pixels:s})};return this.cache.set(t,h),h.bind}release(e){if(Object(l["j"])(e))return;const t=this._patternId(e),i=this.cache.get(t);i&&(i.refCount--,0===i.refCount&&(Object(l["k"])(i.texture)&&i.texture.dispose(),this.cache.delete(t)))}swap(e,t){const i=this._acquire(t);return this.release(e),i}_patternId(e){return`${e.pattern.join(",")}-r${e.pixelRatio}`}}function bi(e,t){const i=e.map(e=>Math.round(e*t)),r=1/t,n=Math.floor(i.reduce((e,t)=>e+t)),a=i.reduce((e,t)=>Math.max(e,t)),s=(Math.floor(.5*(a-1))+.5)*r,o=[];let c=1;for(const b of i){for(let e=0;e<b;e++){const t=c*(Math.min(e,b-1-e)+.5)*r/s*.5+.5;o.push(t)}c=-c}const l=Math.round(i[0]/2),h=[...o.slice(l),...o.slice(0,l)],d=n+2,u=new Uint8Array(4*d);let p=4;for(const b of h)Object(ui["a"])(b,u,p),p+=4;return u.copyWithin(0,p-4,p),u.copyWithin(p,4,8),{encodedData:u,sdfNormalizer:s,paddedPixels:d,pixels:n}}!function(e){e[e.Standard=0]="Standard",e[e.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",e[e.Transparency=2]="Transparency",e[e.OverlayWithTransparency=3]="OverlayWithTransparency",e[e.COUNT=4]="COUNT"}(li||(li={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"}(hi||(hi={}));class fi extends oi["a"]{constructor(){super(...arguments),this.function=li.Standard,this.alphaMode=hi.None,this.hasOpacityFactor=!1}}Object(n["a"])([Object(oi["b"])({count:li.COUNT})],fi.prototype,"function",void 0),Object(n["a"])([Object(oi["b"])({count:hi.COUNT})],fi.prototype,"alphaMode",void 0),Object(n["a"])([Object(oi["b"])()],fi.prototype,"hasOpacityFactor",void 0);var gi=i("9305");let Oi=class extends(V(a["a"])){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new o["a"],this._frameTask=gi["a"],this._drapeSourceRenderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers=new h["a"],this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.worldToPCSRatio=1,this.events=new s["a"],this.longitudeCyclical=null}get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const t=e.waterTextureRepository;this._stippleTextureRepository=new pi(e.renderingContext),this._shaderTechniqueRepository=new L({rctx:this._rctx,viewingMode:O["a"].Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._renderContext=new re(this._rctx,new fe(this._rctx,this.view.state.viewingMode),new ri(this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([Object(d["f"])(()=>t.updating,()=>this.events.emit("content-changed"),d["e"]),Object(d["f"])(()=>this.spatialReference,e=>this._localOriginFactory=new Z["a"](e),d["e"]),Object(d["b"])(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new B(e.textureRepository,this._shaderTechniqueRepository,e=>{(e.renderOccluded&xi)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._bindParameters.slot=ee["a"].DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=Object(q["a"])(this._rctx),this._bindParameters.camera=ji,this._bindParameters.transparencyPassType=x["i"].NONE,this._bindParameters.lighting.groundLightingFactor=1,this._bindParameters.lighting.globalFactor=0,this._bindParameters.lighting.set([new di["a"](Object(g["h"])(1,1,1))]),this._frameTask=this.view.resourceController.scheduler.registerTask(gi["b"].STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._drapeSourceRenderers.forEach(e=>e.destroy()),this._drapeSourceRenderers.clear(),this._debugTextureTechnique=Object(l["p"])(this._debugTextureTechnique),this._debugPatternTexture=Object(l["e"])(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Object(l["e"])(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Object(l["e"])(this._shaderTechniqueRepository),this._temporaryFBO=Object(l["e"])(this._temporaryFBO),this._quadVAO=Object(l["e"])(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||this._frameTask.updating||Object(c["c"])(this._drapeSourceRenderers,e=>e.updating)}get hasOverlays(){return Object(l["k"])(this._overlays)&&Object(l["k"])(this._overlayRenderTarget)}get gpuMemoryUsage(){return Object(l["k"])(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Ut)}createDrapeSourceRenderer(e,t,i){const r=this._drapeSourceRenderers.get(e);Object(l["k"])(r)&&r.destroy();const n=new t({...i,rendererContext:this,drapeSource:e});return this._drapeSourceRenderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(Object(d["f"])(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(Object(l["j"])(e))return;const t=this._drapeSourceRenderers.get(e);Object(l["j"])(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._drapeSourceRenderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(e){let t=!1;if(Object(l["k"])(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const r=this.overlays[0].validTargets[i.type]||!this.overlays[1].validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(r,i,e)||t}return t}get overlays(){return Object(l["s"])(this._overlays,[])}ensureDrapeTargets(e){Object(l["k"])(this._overlays)&&this._overlays.forEach(t=>{t.hasTargetWithoutRasterImage=Object(u["a"])(e,e=>e.drapeTargetType===m["b"].WithoutRasterImage)})}ensureDrapeSources(e){Object(l["k"])(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=Object(u["a"])(e,e=>e.drapeSourceType===m["a"].Features),t.hasDrapedRasterSource=Object(u["a"])(e,e=>e.drapeSourceType===m["a"].RasterImage)})}ensureOverlays(e,t){Object(l["j"])(this._overlays)&&(this._overlayRenderTarget=new C(this._rctx),this._overlays=[new T(_["b"].INNER,this._overlayRenderTarget),new T(_["b"].OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Object(l["e"])(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=(()=>!0)){this._frameTask.processQueue(e),e.done||this._processDrapeSources(e,t)}_processDrapeSources(e,t){let i=!1;for(const[r,n]of this._drapeSourceRenderers){if(e.done)break;(r.destroyed||t(r))&&n.commitChanges()&&(i=!0,e.madeProgress())}this._updateSortedDrapeSourceRenderers(),i&&(Object(l["k"])(this._overlays)&&0===this._drapeSourceRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(gi["c"],e=>e.updatePolicy===x["j"].SYNC)}isEmpty(){if(v["a"].OVERLAY_DRAW_DEBUG_TEXTURE)return!1;for(const e of this._drapeSourceRenderers.values())if(!e.isEmpty)return!1;return!0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._drapeSourceRenderers.forEach(i=>t=i.updateAnimation(e)||t),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,i){const r=e.canvasGeometries;if(0===r.numViews)return!1;this._screenToWorldRatio=i*e.mapUnitsPerPixel;const n=t.renderPass;if(this.isEmpty()||n===P["a"].MATERIAL_HIGHLIGHT&&!this.hasHighlights||n===P["a"].MATERIAL_NORMAL&&!this.hasWater||!e.hasSomeSizedView())return!1;const a=t.fbo;if(!a.isValid())return!1;const s=2*e.resolution,o=e.resolution;a.resize(s,o);const c=this._rctx;ji.pixelRatio=e.pixelRatio*i,this._renderContext.pass=n,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=n===P["a"].MATERIAL_NORMAL?ee["a"].DRAPED_WATER:ee["a"].DRAPED_MATERIAL,e.applyViewport(this._rctx),a.bind(c),e.index===_["b"].INNER&&(c.setClearColor(0,0,0,0),c.clearSafe(A["e"].COLOR_BUFFER_BIT));const h=t.type===_["c"].ColorNoRasterImage?mi.ExcludeRasterImage:t.type===_["c"].Occluded?mi.OccludedOnly:mi.Normal;if(h===mi.OccludedOnly&&(this._renderContext.renderOccludedMask=xi),v["a"].OVERLAY_DRAW_DEBUG_TEXTURE&&h!==mi.OccludedOnly)for(let l=0;l<r.numViews;l++)this._setViewParameters(r.extents[l],e,ji),this._drawDebugTexture(e.resolution,_i[e.index]);return this._drapeSourceRenderers.size>0&&this._sortedDrapeSourceRenderers.forAll(({drapeSource:t,renderer:i})=>{if(h===mi.ExcludeRasterImage&&t.drapeSourceType===m["a"].RasterImage)return;const{fullOpacity:d}=t,u=Object(l["k"])(d)&&d<1&&n===P["a"].MATERIAL;u&&(this.bindTemporaryFramebuffer(this._rctx,s,o),c.clearSafe(A["e"].COLOR_BUFFER_BIT));for(let n=0;n<r.numViews;n++)this._setViewParameters(r.extents[n],e,ji),i.render(this._renderContext,this._bindParameters);u&&Object(l["k"])(this._temporaryFBO)&&(a.bind(c),this.view._stage.renderView.compositingHelper.composite(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),hi.PremultipliedAlpha,d,li.OverlayWithTransparency,e.index))}),c.bindFramebuffer(null),a.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,i){Object(l["j"])(this._temporaryFBO)&&(this._temporaryFBO=new R(e,!1)),this._temporaryFBO.resize(t,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,i,r){let n=0;for(const s of this._drapeSourceRenderers.values()){var a;n=null!=(a=null==s.intersect?void 0:s.intersect(e,t,i,r,n))?a:n}}_updateSortedDrapeSourceRenderers(){if(!this._sortedDrapeSourceRenderersDirty)return;if(this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers.clear(),0===this._drapeSourceRenderers.size)return;const e=this.view.map.allLayers;this._drapeSourceRenderers.forEach((t,i)=>{const r=e.indexOf(i.layer);this._sortedDrapeSourceRenderers.push(new vi(i,t,r<0?1/0:r))}),this._sortedDrapeSourceRenderers.sort((e,t)=>e.index-t.index)}_setViewParameters(e,t,i){i.viewport[0]=i.viewport[1]=0,i.viewport[2]=i.viewport[3]=t.resolution,Object(f["q"])(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),Object(f["f"])(i.viewMatrix,[-e[0],-e[1],0]),this._bindParameters.camera=i}_updateHasWater(){const e=Object(c["c"])(this._drapeSourceRenderers,e=>e.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=Object(c["c"])(this._drapeSourceRenderers,e=>e.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=Object(c["c"])(this._drapeSourceRenderers,e=>e.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e);const i=this._rctx,r=i.bindTechnique(this._debugTextureTechnique);r.setUniform4f("uColor",t[0],t[1],t[2],1),r.bindTexture("tex",this._debugPatternTexture),i.bindVAO(this._quadVAO),i.drawArrays(A["r"].TRIANGLE_STRIP,0,Object(pe["f"])(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const i=new Uint8Array(e*t*4);let r=0;for(let a=0;a<t;a++)for(let n=0;n<e;n++){const s=Math.floor(n/10),o=Math.floor(a/10);s<2||o<2||10*s>e-20||10*o>t-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&s&&1&o?1&n^1&a?0:255:1&s^1&o?0:128)}this._debugPatternTexture=new ue["a"](this._rctx,{target:A["A"].TEXTURE_2D,pixelFormat:A["p"].RGBA,dataType:A["q"].UNSIGNED_BYTE,samplingMode:A["z"].NEAREST,width:e,height:t},i);const n=new ci;n.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(si,n),this._quadVAO=Object(q["b"])(this._rctx)}get test(){return{drapeSourceRenderers:this._drapeSourceRenderers,getDrapeSourceRenderer:e=>this._drapeSourceRenderers.get(e)}}};var mi;Object(n["a"])([Object(p["b"])()],Oi.prototype,"_frameTask",void 0),Object(n["a"])([Object(p["b"])()],Oi.prototype,"_sortedDrapeSourceRenderersDirty",void 0),Object(n["a"])([F()],Oi.prototype,"_shaderTechniqueRepository",void 0),Object(n["a"])([F()],Oi.prototype,"_stippleTextureRepository",void 0),Object(n["a"])([Object(p["b"])({constructOnly:!0})],Oi.prototype,"view",void 0),Object(n["a"])([Object(p["b"])()],Oi.prototype,"worldToPCSRatio",void 0),Object(n["a"])([Object(p["b"])()],Oi.prototype,"spatialReference",void 0),Object(n["a"])([Object(p["b"])({type:Boolean,readOnly:!0})],Oi.prototype,"updating",null),Oi=Object(n["a"])([Object(b["a"])("esri.views.3d.terrain.OverlayRenderer")],Oi),function(e){e[e.Normal=0]="Normal",e[e.OccludedOnly=1]="OccludedOnly",e[e.ExcludeRasterImage=2]="ExcludeRasterImage"}(mi||(mi={}));class vi{constructor(e,t,i){this.drapeSource=e,this.renderer=t,this.index=i}}const _i=[[1,.5,.5],[.5,.5,1]],ji=new G["a"];ji.near=1,ji.far=1e4,ji.relativeElevation=null;const yi=-2,xi=X["c"].OccludeAndTransparent},7590:function(e,t,i){"use strict";i.r(t),i.d(t,"hydratedAdapter",(function(){return c}));var r=i("3af1"),n=i("57dc"),a=i("4ae5"),s=i("1219"),o=i("521c");const c={convertToGEGeometry:l,exportPoint:h,exportPolygon:d,exportPolyline:u,exportMultipoint:p,exportExtent:b};function l(e,t){if(null==t)return null;let i="cache"in t?t.cache._geVersion:void 0;return null==i&&(i=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=i)),i}function h(e,t,i){const r=e.hasZ(t),n=e.hasM(t),s=new a["a"]({x:e.getPointX(t),y:e.getPointY(t),spatialReference:i});return r&&(s.z=e.getPointZ(t)),n&&(s.m=e.getPointM(t)),s.cache._geVersion=t,s}function d(e,t,i){const r=new s["a"]({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return r.cache._geVersion=t,r}function u(e,t,i){const r=new o["a"]({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return r.cache._geVersion=t,r}function p(e,t,i){const r=new n["a"]({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:i});return r.cache._geVersion=t,r}function b(e,t,i){const n=e.hasZ(t),a=e.hasM(t),s=new r["a"]({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:i});if(n){const i=e.getZExtent(t);s.zmin=i.vmin,s.zmax=i.vmax}if(a){const i=e.getMExtent(t);s.mmin=i.vmin,s.mmax=i.vmax}return s.cache._geVersion=t,s}},7617:function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return S})),i.d(t,"c",(function(){return _})),i.d(t,"d",(function(){return v})),i.d(t,"e",(function(){return j})),i.d(t,"f",(function(){return x})),i.d(t,"g",(function(){return y}));var r=i("b2b2"),n=i("f315"),a=i("6aa9");function s(e,t,i,r=2,s="abbr"){return Object(a["c"])(e,Object(n["e"])(t,i).value,i,r,s)}function o(e,t,i,r=2,s="abbr"){return Object(a["p"])(e,Object(n["e"])(t,i).value,i,r,s)}function c(e,t,i=2,r="abbr"){return Object(a["k"])(e,t.value,t.unit,i,r)}function l(e,t,i=2,r="abbr"){return Object(a["l"])(e,t.value,t.unit,i,r)}function h(e,t,i=2,r="abbr"){return Object(a["n"])(e,t.value,t.unit,i,r)}function d(e,t,i=2,r="abbr"){return Object(a["m"])(e,t.value,t.unit,i,r)}function u(e,t,i=2,r="abbr"){return Object(a["j"])(e,t.value,t.unit,i,r)}function p(e,t,i=2,r="abbr"){return Object(a["f"])(e,t.value,t.unit,i,r)}function b(e,t,i=2,r="abbr"){return Object(a["g"])(e,t.value,t.unit,i,r)}function f(e,t,i=2,r="abbr"){return Object(a["i"])(e,t.value,t.unit,i,r)}function g(e,t,i=2,r="abbr"){return Object(a["h"])(e,t.value,t.unit,i,r)}function O(e,t,i=2,r="abbr"){return Object(a["e"])(e,t.value,t.unit,i,r)}function m(e,t,i){return Object(a["a"])(e.value,e.unit,e.rotationType,t,i)}function v(e,t,i){return Object(a["o"])(e.value,e.unit,e.rotationType,t,i)}function _(e,t,i,n,a="abbr"){switch(n=Object(r["s"])(n,2),i){case"imperial":return p(e,t,n,a);case"metric":return c(e,t,n,a);default:return s(e,t,i,n,a)}}function j(e,t,i,r=2,n="abbr"){switch(i){case"imperial":return b(e,t,r,n);case"metric":return l(e,t,r,n);default:return o(e,t,i,r,n)}}function y(e,t,i,r=2,n="abbr"){switch(i){case"imperial":return f(e,t,r,n);case"metric":return h(e,t,r,n);default:return s(e,t,i,r,n)}}function x(e,t,i,r=2,n="abbr"){switch(i){case"imperial":return g(e,t,r,n);case"metric":return d(e,t,r,n);default:return o(e,t,i,r,n)}}function S(e,t,i,r=2,n="abbr"){switch(i){case"imperial":return O(e,t,r,n);case"metric":return u(e,t,r,n);default:return s(e,t,i,r,n)}}},"76a8":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("62ae"),n=i("52b2");class a extends r["a"]{constructor(e,t,i){super(e,"vec4",n["a"].Pass,(i,r,n)=>i.setUniform4fv(e,t(r,n)),i)}}},"79a1":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("62ae"),n=i("52b2");class a extends r["a"]{constructor(e,t){super(e,"int",n["a"].Pass,(i,r,n)=>i.setUniform1i(e,t(r,n)))}}},"7bf3":function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return n}));var r,n,a,s=i("afe1"),o=i("0b2d");class c{constructor(){this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=Object(o["f"])(),this.parallax={anchorPointClouds:Object(o["f"])(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Object(s["d"])()},this.parallaxNew={anchorPointClouds:Object(o["f"])(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Object(s["d"])()},this.crossFade={enabled:!1,factor:0,distanceThresholdFactor:.3},this.fadeInOut={stage:n.FINISHED,factor:0,distanceThresholdFactor:.6},this.fadeIn={stage:r.FINISHED,factor:0,distanceThresholdFactor:2},this.fadeInOutHeight={stage:a.FINISHED,factor:-1}}}!function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"}(r||(r={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}(n||(n={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(a||(a={}))},"7c1d":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){const t=r["b"]`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=r["b"]`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}},"7c51":function(e,t,i){"use strict";i.d(t,"a",(function(){return C})),i.d(t,"b",(function(){return A})),i.d(t,"c",(function(){return T})),i.d(t,"d",(function(){return R})),i.d(t,"e",(function(){return f})),i.d(t,"f",(function(){return v})),i.d(t,"g",(function(){return E})),i.d(t,"h",(function(){return M}));var r=i("b50f"),n=i("38a4"),a=i("b2b2"),s=i("e431"),o=i("0b2d"),c=i("4261"),l=i("b7c2"),h=i("da1c"),d=i("1153"),u=i("b7bd"),p=i("b623");const b=Object(c["f"])();function f(e,t,i,r,n,a,s){if(!Object(p["d"])(t))if(e.boundingInfo){Object(d["a"])(e.primitiveType===l["f"].Triangle);const t=i.tolerance;O(e.boundingInfo,r,n,t,a,s)}else{const t=e.indices.get(u["a"].POSITION),i=e.vertexAttributes.get(u["a"].POSITION);v(r,n,0,t.length/3,t,i,void 0,a,s)}}const g=Object(o["f"])();function O(e,t,i,r,n,s){if(Object(a["j"])(e))return;const o=S(t,i,g);if(Object(c["y"])(b,e.getBBMin()),Object(c["x"])(b,e.getBBMax()),Object(a["k"])(n)&&n.applyToAabb(b),T(b,t,o,r)){const{primitiveIndices:a,indices:o,position:c}=e,l=a?a.length:o.length/3;if(l>D){const a=e.getChildren();if(void 0!==a){for(let e=0;e<8;++e)void 0!==a[e]&&O(a[e],t,i,r,n,s);return}}v(t,i,0,l,o,c,a,n,s)}}const m=Object(o["f"])();function v(e,t,i,r,n,s,o,c,l){if(o)return _(e,t,i,r,n,s,o,c,l);const h=s.data,d=s.stride||s.size,u=e[0],p=e[1],b=e[2],f=t[0]-u,g=t[1]-p,O=t[2]-b;for(let v=i,_=3*i;v<r;++v){let e=d*n[_++],t=h[e++],i=h[e++],r=h[e];e=d*n[_++];let s=h[e++],o=h[e++],j=h[e];e=d*n[_++];let y=h[e++],S=h[e++],T=h[e];Object(a["k"])(c)&&([t,i,r]=c.applyToVertex(t,i,r,v),[s,o,j]=c.applyToVertex(s,o,j,v),[y,S,T]=c.applyToVertex(y,S,T,v));const w=s-t,M=o-i,A=j-r,E=y-t,R=S-i,P=T-r,C=g*P-R*O,D=O*E-P*f,I=f*R-E*g,L=w*C+M*D+A*I;if(Math.abs(L)<=Number.EPSILON)continue;const N=u-t,z=p-i,V=b-r,F=N*C+z*D+V*I;if(L>0){if(F<0||F>L)continue}else if(F>0||F<L)continue;const G=z*A-M*V,k=V*w-A*N,U=N*M-w*z,H=f*G+g*k+O*U;if(L>0){if(H<0||F+H>L)continue}else if(H>0||F+H<L)continue;const B=(E*G+R*k+P*U)/L;B>=0&&l(B,x(w,M,A,E,R,P,m),v,!1)}}function _(e,t,i,r,n,s,o,c,l){const h=s.data,d=s.stride||s.size,u=e[0],p=e[1],b=e[2],f=t[0]-u,g=t[1]-p,O=t[2]-b;for(let v=i;v<r;++v){const e=o[v];let t=3*e,i=d*n[t++],r=h[i++],s=h[i++],_=h[i];i=d*n[t++];let j=h[i++],y=h[i++],S=h[i];i=d*n[t];let T=h[i++],w=h[i++],M=h[i];Object(a["k"])(c)&&([r,s,_]=c.applyToVertex(r,s,_,v),[j,y,S]=c.applyToVertex(j,y,S,v),[T,w,M]=c.applyToVertex(T,w,M,v));const A=j-r,E=y-s,R=S-_,P=T-r,C=w-s,D=M-_,I=g*D-C*O,L=O*P-D*f,N=f*C-P*g,z=A*I+E*L+R*N;if(Math.abs(z)<=Number.EPSILON)continue;const V=u-r,F=p-s,G=b-_,k=V*I+F*L+G*N;if(z>0){if(k<0||k>z)continue}else if(k>0||k<z)continue;const U=F*R-E*G,H=G*A-R*V,B=V*E-A*F,W=f*U+g*H+O*B;if(z>0){if(W<0||k+W>z)continue}else if(W>0||k+W<z)continue;const q=(P*U+C*H+D*B)/z;q>=0&&l(q,x(A,E,R,P,C,D,m),e,!1)}}const j=Object(o["f"])(),y=Object(o["f"])();function x(e,t,i,r,n,a,o){return Object(s["w"])(j,e,t,i),Object(s["w"])(y,r,n,a),Object(s["j"])(o,j,y),Object(s["r"])(o,o),o}function S(e,t,i){return Object(s["w"])(i,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function T(e,t,i,r){return w(e,t,i,r,1/0)}function w(e,t,i,r,n){const a=(e[0]-r-t[0])*i[0],s=(e[3]+r-t[0])*i[0];let o=Math.min(a,s),c=Math.max(a,s);const l=(e[1]-r-t[1])*i[1],h=(e[4]+r-t[1])*i[1];if(c=Math.min(c,Math.max(l,h)),c<0)return!1;if(o=Math.max(o,Math.min(l,h)),o>c)return!1;const d=(e[2]-r-t[2])*i[2],u=(e[5]+r-t[2])*i[2];return c=Math.min(c,Math.max(d,u)),!(c<0)&&(o=Math.max(o,Math.min(d,u)),!(o>c)&&o<n)}function M(e,t,i,r,s){let o=(i.screenLength||0)*e.pixelRatio;Object(a["k"])(s)&&(o=Object(h["d"])(o,r,t,s));const c=o*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return Object(n["e"])(c*t,i.minWorldLength||0,null!=i.maxWorldLength?i.maxWorldLength:1/0)}function A(e,t){const i=t?A(t):{};for(const r in e){let t=e[r];t&&t.forEach&&(t=P(t)),null==t&&r in i||(i[r]=t)}return i}function E(e,t){let i=!1;for(const n in t){const a=t[n];void 0!==a&&(Array.isArray(a)?null===e[n]?(e[n]=a.slice(),i=!0):Object(r["l"])(e[n],a)&&(i=!0):e[n]!==a&&(i=!0,e[n]=a))}return i}function R(e,t,i,r,a,s){if(!t.options.selectionMode)return;const o=e.vertexAttributes.get(u["a"].POSITION).data,c=e.vertexAttributes.get(u["a"].SIZE),l=c&&c.data[0],h=r[0],d=r[1],p=((l+a)/2+4)*e.screenToWorldRatio;let b=Number.MAX_VALUE,f=0;for(let u=0;u<o.length-5;u+=3){const e=o[u],t=o[u+1],i=h-e,r=d-t,a=o[u+3]-e,s=o[u+4]-t,c=Object(n["e"])((a*i+s*r)/(a*a+s*s),0,1),l=a*c-i,p=s*c-r,g=l*l+p*p;g<b&&(b=g,f=u/3)}b<p*p&&s(i.dist,i.normal,f,!1)}function P(e){const t=[];return e.forEach(e=>t.push(e)),t}const C={multiply:1,ignore:2,replace:3,tint:4},D=1e3},"7cb4":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("6c97"),n=i("dfaf"),a=i("3886");function s(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(a["b"]`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function o(e,t){switch(e.include(n["a"],t),e.fragment.code.add(a["b"]`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),t.textureCoordinateType){case n["b"].Default:return void e.fragment.code.add(a["b"]`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case n["b"].Atlas:return e.include(s),void e.fragment.code.add(a["b"]`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:Object(r["a"])(t.textureCoordinateType);case n["b"].None:case n["b"].COUNT:return}}},"7d11":function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return d}));var r=i("dae5"),n=i("0fc4"),a=i("c332"),s=i("bc40"),o=i("3886"),c=i("037a"),l=i("aa1e");function h(e,t){t.normalType===a["b"].Attribute||t.normalType===a["b"].CompressedAttribute?(e.include(a["a"],t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add([new c["a"]("transformNormalGlobalFromModel",e=>e.transformNormalGlobalFromModel),new l["a"]("transformNormalViewFromGlobal",e=>e.transformNormalViewFromGlobal)]),e.vertex.code.add(o["b"]`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):t.normalType===a["b"].Ground?(e.include(s["a"],t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(o["b"]`
    void forwardNormal() {
      vNormalWorld = ${t.spherical?o["b"]`normalize(vPositionWorldCameraRelative);`:o["b"]`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(o["b"]`void forwardNormal() {}`)}class d extends s["c"]{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Object(r["b"])()}}class u extends s["b"]{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Object(r["b"])(),this.toMapSpace=Object(n["e"])()}}},"84f4":function(e,t,i){"use strict";function r(e){return"point"===e.type}i.d(t,"a",(function(){return r}))},"85b3":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("62ae"),n=i("52b2");class a extends r["a"]{constructor(e,t){super(e,"mat4",n["a"].Pass,(i,r,n)=>i.setUniformMatrix4fv(e,t(r,n)))}}},8675:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return o}));var r=i("fc00"),n=i("b7bd"),a=i("5957");const s=Object(r["a"])().vec3f(n["a"].POSITION),o=Object(r["a"])().vec3f(n["a"].POSITION).vec2f(n["a"].UV0),c=Object(r["a"])().vec3f(n["a"].POSITION).vec4u8(n["a"].COLOR);class l{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(n["a"].POSITION).length}write(e,t,i,r){Object(a["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r)}}},"86ba":function(e,t,i){"use strict";i.d(t,"a",(function(){return G}));var r=i("e92d"),n=i("38a4"),a=i("b2b2"),s=i("a915"),o=i("3349"),c=i("e431"),l=i("0b2d"),h=i("0fc4"),d=i("d359"),u=i("bd7e"),p=i("7289"),b=i("fc00"),f=i("a05b"),g=i("1038"),O=i("d7f7"),m=i("b061"),v=i("35b3"),_=i("badc"),j=i("1153"),y=i("b7bd"),x=i("02a0"),S=i("b623"),T=i("9a68"),w=i("c3a4"),M=i("ca98"),A=i("b7c2"),E=i("7438"),R=i("c829"),P=i("87b7"),C=i("d17d"),D=i("189c");const I=new Map([[y["a"].POSITION,0],[y["a"].SUBDIVISIONFACTOR,1],[y["a"].UV0,2],[y["a"].AUXPOS1,3],[y["a"].AUXPOS2,4],[y["a"].COLOR,5],[y["a"].COLORFEATUREATTRIBUTE,5],[y["a"].SIZE,6],[y["a"].SIZEFEATUREATTRIBUTE,6],[y["a"].OPACITYFEATUREATTRIBUTE,7]]);class L extends M["a"]{constructor(e,t,i){super(e,t,i),this.stippleTextureRepository=e.stippleTextureRepository}initializeProgram(e){const t=L.shader.get().build(this.configuration);return new R["a"](e.rctx,t,I)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(this.program.bindPass(e,t),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.configuration.stippleEnabled){const{pixelSize:e,sdfNormalizer:t,pixels:i}=Object(a["k"])(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",t),this.program.setUniform1f("stipplePatternTextureSize",i),this.program.setUniform1f("stipplePatternPixelSize",e),this.program.setUniform1f("stipplePatternPixelSizeInv",1/e)}}_makePipelineState(e,t){const i=this.configuration,r=e===A["i"].NONE,n=e===A["i"].FrontFace;return Object(D["f"])({blending:i.output===f["a"].Color||i.output===f["a"].Alpha?r?E["d"]:Object(E["f"])(e):null,depthTest:{func:Object(E["g"])(e)},depthWrite:r?i.writeDepth&&D["d"]:Object(E["h"])(e),colorWrite:D["c"],stencilWrite:i.hasOccludees?P["h"]:null,stencilTest:i.hasOccludees?t?P["d"]:P["c"]:null,polygonOffset:r||n?i.hasPolygonOffset&&N:E["a"]})}initializePipeline(){const e=this.configuration;if(e.occluder){const t=e.hasPolygonOffset&&N;this._occluderPipelineTransparent=Object(D["f"])({blending:E["d"],polygonOffset:t,depthTest:P["a"],depthWrite:null,colorWrite:D["c"],stencilWrite:null,stencilTest:P["f"]}),this._occluderPipelineOpaque=Object(D["f"])({blending:E["d"],polygonOffset:t,depthTest:P["a"],depthWrite:null,colorWrite:D["c"],stencilWrite:P["g"],stencilTest:P["e"]}),this._occluderPipelineMaskWrite=Object(D["f"])({blending:null,polygonOffset:t,depthTest:P["b"],depthWrite:null,colorWrite:null,stencilWrite:P["h"],stencilTest:P["d"]})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?C["r"].LINES:C["r"].TRIANGLE_STRIP}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?e===_["a"].TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===_["a"].OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,t)}}L.shader=new w["a"](T["b"],()=>i.e("chunk-2d213386").then(i.bind(null,"ac6d")));const N={factor:0,units:-4};var z=i("a6b6");const V=r["a"].getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var F;!function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"}(F||(F={}));class G extends v["a"]{constructor(e){super(e,new U),this._vertexAttributeLocations=I,this.techniqueConfig=new z["b"],this.layout=this.createLayout()}isClosed(e,t){return q(this.parameters,e,t)}getConfiguration(e,t){this.techniqueConfig.output=e,this.techniqueConfig.draped=t.slot===_["a"].DRAPED_MATERIAL;const i=Object(a["k"])(this.parameters.stipplePattern)&&e!==f["a"].Highlight;return this.techniqueConfig.stippleEnabled=i,this.techniqueConfig.stippleOffColorEnabled=i&&Object(a["k"])(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.roundJoins="round"===this.parameters.join,this.techniqueConfig.capType=this.parameters.cap,this.techniqueConfig.hasPolygonOffset=this.parameters.hasPolygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&Object(a["k"])(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=this.parameters.renderOccluded===v["c"].OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig.wireframe=this.parameters.wireframe,this.techniqueConfig}intersect(e,t,i,r,n,s,o,c,l){Object(a["k"])(l)?this._intersectDrapedLineGeometry(e,r,l,s,o):this._intersectLineGeometry(e,t,i,r,o)}_intersectDrapedLineGeometry(e,t,i,r,a){if(!t.options.selectionMode)return;const s=e.vertexAttributes.get(y["a"].POSITION).data,o=e.vertexAttributes.get(y["a"].SIZE);let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const t=e.vertexAttributes.get(y["a"].SIZEFEATUREATTRIBUTE).data[0];c*=Object(n["e"])(this.parameters.vvSizeOffset[0]+t*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o&&(c*=o.data[0]);const l=r[0],h=r[1],d=(c/2+4)*e.screenToWorldRatio;let u=Number.MAX_VALUE,p=0;for(let b=0;b<s.length-5;b+=3){const e=s[b],t=s[b+1],i=l-e,r=h-t,a=s[b+3]-e,o=s[b+4]-t,c=Object(n["e"])((a*i+o*r)/(a*a+o*o),0,1),d=a*c-i,f=o*c-r,g=d*d+f*f;g<u&&(u=g,p=b/3)}u<d*d&&a(i.dist,i.normal,p,!1)}_intersectLineGeometry(e,t,i,r,a){if(!r.options.selectionMode||Object(S["d"])(t))return;if(!Object(j["f"])(i))return void V.error("intersection assumes a translation-only matrix");const s=e.vertexAttributes,l=s.get(y["a"].POSITION).data;let h=this.parameters.width;if(this.parameters.vvSizeEnabled){const e=s.get(y["a"].SIZEFEATUREATTRIBUTE).data[0];h*=Object(n["e"])(this.parameters.vvSizeOffset[0]+e*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else s.has(y["a"].SIZE)&&(h*=s.get(y["a"].SIZE).data[0]);const b=r.camera,f=Q;Object(o["c"])(f,r.point);const g=h*b.pixelRatio/2+4*b.pixelRatio;Object(c["w"])(oe[0],f[0]-g,f[1]+g,0),Object(c["w"])(oe[1],f[0]+g,f[1]+g,0),Object(c["w"])(oe[2],f[0]+g,f[1]-g,0),Object(c["w"])(oe[3],f[0]-g,f[1]-g,0);for(let n=0;n<4;n++)if(!b.unprojectFromRenderScreen(oe[n],ce[n]))return;Object(p["f"])(b.eye,ce[0],ce[1],le),Object(p["f"])(b.eye,ce[1],ce[2],he),Object(p["f"])(b.eye,ce[2],ce[3],de),Object(p["f"])(b.eye,ce[3],ce[0],ue);let O=Number.MAX_VALUE,m=0;const v=W(this.parameters,s,e.indices)?l.length-2:l.length-5;for(let n=0;n<v;n+=3){Z[0]=l[n]+i[12],Z[1]=l[n+1]+i[13],Z[2]=l[n+2]+i[14];const e=(n+3)%l.length;if(X[0]=l[e]+i[12],X[1]=l[e+1]+i[13],X[2]=l[e+2]+i[14],Object(p["u"])(le,Z)<0&&Object(p["u"])(le,X)<0||Object(p["u"])(he,Z)<0&&Object(p["u"])(he,X)<0||Object(p["u"])(de,Z)<0&&Object(p["u"])(de,X)<0||Object(p["u"])(ue,Z)<0&&Object(p["u"])(ue,X)<0)continue;if(b.projectToRenderScreen(Z,J),b.projectToRenderScreen(X,K),J[2]<0&&K[2]>0){Object(c["f"])(Y,Z,X);const e=b.frustum,t=-Object(p["u"])(e[d["a"].NEAR],Z)/Object(c["i"])(Y,Object(p["q"])(e[d["a"].NEAR]));Object(c["k"])(Y,Y,t),Object(c["e"])(Z,Z,Y),b.projectToRenderScreen(Z,J)}else if(J[2]>0&&K[2]<0){Object(c["f"])(Y,X,Z);const e=b.frustum,t=-Object(p["u"])(e[d["a"].NEAR],X)/Object(c["i"])(Y,Object(p["q"])(e[d["a"].NEAR]));Object(c["k"])(Y,Y,t),Object(c["e"])(X,X,Y),b.projectToRenderScreen(X,K)}else if(J[2]<0&&K[2]<0)continue;J[2]=0,K[2]=0;const t=Object(u["e"])(Object(u["f"])(J,K,ie),f);t<O&&(O=t,Object(c["g"])(ee,Z),Object(c["g"])(te,X),m=n/3)}const _=r.rayBegin,x=r.rayEnd;if(O<g*g){let e=Number.MAX_VALUE;if(Object(u["a"])(Object(u["f"])(ee,te,ie),Object(u["f"])(_,x,re),$)){Object(c["f"])($,$,_);const t=Object(c["p"])($);Object(c["k"])($,$,1/t),e=t/Object(c["m"])(_,x)}a(e,$,m,!1)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return null;const r=e.indices,n=i.get(y["a"].POSITION);return Object(g["a"])(n,r?r.get(y["a"].POSITION):null,r&&W(this.parameters,i,r),t)}createLayout(){const e=Object(b["a"])().vec3f(y["a"].POSITION).f32(y["a"].SUBDIVISIONFACTOR).vec2f(y["a"].UV0).vec3f(y["a"].AUXPOS1).vec3f(y["a"].AUXPOS2);return this.parameters.vvSizeEnabled?e.f32(y["a"].SIZEFEATUREATTRIBUTE):e.f32(y["a"].SIZE),this.parameters.vvColorEnabled?e.f32(y["a"].COLORFEATUREATTRIBUTE):e.vec4f(y["a"].COLOR),this.parameters.vvOpacityEnabled&&e.f32(y["a"].OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new H(this.layout,this.parameters)}requiresSlot(e,t){if(e===_["a"].DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===v["c"].OccludeAndTransparentStencil)return e===_["a"].OPAQUE_MATERIAL||e===_["a"].OCCLUDER_MATERIAL||e===_["a"].TRANSPARENT_OCCLUDER_MATERIAL;const i=Object(m["b"])(t);return i===f["a"].Color||i===f["a"].Alpha?e===(this.parameters.writeDepth?_["a"].TRANSPARENT_MATERIAL:_["a"].TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===_["a"].OPAQUE_MATERIAL}createGLMaterial(e){return e.output===f["a"].Color||e.output===f["a"].Alpha||e.output===f["a"].Highlight||e.output===f["a"].Depth?new k(e):null}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0)}}class k extends O["a"]{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==f["a"].Color&&this._output!==f["a"].Alpha||this._updateOccludeeState(e),this.ensureTechnique(L,e)}}class U extends x["a"]{constructor(){super(...arguments),this.width=0,this.color=h["a"],this.join="miter",this.cap=z["a"].BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class H{constructor(e,t){this.parameters=t,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const i=t.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=T["a"]+i}}_isClosed(e){return W(this.parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=2,i=e.indices.get(y["a"].POSITION).length/2+1,r=this._isClosed(e);let n=r?2:2*t;return n+=((r?i:i-1)-(r?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this.parameters.wireframe&&(n=2+4*(n-2)),n}write(e,t,i,r){var n;const a=ne,s=ae,o=se,l=t.vertexAttributes.get(y["a"].POSITION).data,h=t.indices&&t.indices.get(y["a"].POSITION),d=null==(n=t.vertexAttributes.get(y["a"].DISTANCETOSTART))?void 0:n.data;h&&h.length!==2*(l.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let u=1,p=0;this.parameters.vvSizeEnabled?p=t.vertexAttributes.get(y["a"].SIZEFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(y["a"].SIZE)&&(u=t.vertexAttributes.get(y["a"].SIZE).data[0]);let b=[1,1,1,1],f=0;this.parameters.vvColorEnabled?f=t.vertexAttributes.get(y["a"].COLORFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(y["a"].COLOR)&&(b=t.vertexAttributes.get(y["a"].COLOR).data);let g=0;this.parameters.vvOpacityEnabled&&(g=t.vertexAttributes.get(y["a"].OPACITYFEATUREATTRIBUTE).data[0]);const O=l.length/3,m=e.transformation,v=new Float32Array(i.buffer),_=this.vertexBufferLayout.stride/4;let j=r*_;const x=j;let S=0;const T=d?(e,t,i)=>S=d[i]:(e,t,i)=>S+=Object(c["m"])(e,t),w=(e,t,i,r,n,a,s)=>{if(v[j++]=t[0],v[j++]=t[1],v[j++]=t[2],v[j++]=r,v[j++]=s,v[j++]=n,v[j++]=e[0],v[j++]=e[1],v[j++]=e[2],v[j++]=i[0],v[j++]=i[1],v[j++]=i[2],this.parameters.vvSizeEnabled?v[j++]=p:v[j++]=u,this.parameters.vvColorEnabled)v[j++]=f;else{const e=Math.min(4*a,b.length-4);v[j++]=b[e+0],v[j++]=b[e+1],v[j++]=b[e+2],v[j++]=b[e+3]}this.parameters.vvOpacityEnabled&&(v[j++]=g)};j+=_,Object(c["w"])(s,l[0],l[1],l[2]),m&&Object(c["q"])(s,s,m);const M=this._isClosed(t);if(M){const e=l.length-3;Object(c["w"])(a,l[e],l[e+1],l[e+2]),m&&Object(c["q"])(a,a,m)}else Object(c["w"])(o,l[3],l[4],l[5]),m&&Object(c["q"])(o,o,m),w(s,s,o,1,F.LEFT_CAP_START,0,0),w(s,s,o,1,F.RIGHT_CAP_START,0,0),Object(c["g"])(a,s),Object(c["g"])(s,o);const A=M?0:1,E=M?O:O-1;for(let y=A;y<E;y++){const e=(y+1)%O*3;Object(c["w"])(o,l[e+0],l[e+1],l[e+2]),m&&Object(c["q"])(o,o,m),T(a,s,y),w(a,s,o,0,F.LEFT_JOIN_END,y,S),w(a,s,o,0,F.RIGHT_JOIN_END,y,S);const t=this.numJoinSubdivisions;for(let i=0;i<t;++i){const e=(i+1)/(t+1);w(a,s,o,e,F.LEFT_JOIN_END,y,S),w(a,s,o,e,F.RIGHT_JOIN_END,y,S)}w(a,s,o,1,F.LEFT_JOIN_START,y,S),w(a,s,o,1,F.RIGHT_JOIN_START,y,S),Object(c["g"])(a,s),Object(c["g"])(s,o)}M?(Object(c["w"])(o,l[3],l[4],l[5]),m&&Object(c["q"])(o,o,m),S=T(a,s,E),w(a,s,o,0,F.LEFT_JOIN_END,A,S),w(a,s,o,0,F.RIGHT_JOIN_END,A,S)):(S=T(a,s,E),w(a,s,s,0,F.LEFT_CAP_END,E,S),w(a,s,s,0,F.RIGHT_CAP_END,E,S)),B(v,x+_,v,x,_),j=B(v,j-_,v,j,_),this.parameters.wireframe&&this._addWireframeVertices(i,x,j,_)}_addWireframeVertices(e,t,i,r){const n=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),a=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,i-t);let s=0;const o=e=>s=B(a,e,n,s,r);for(let c=0;c<a.length-1;c+=2*r)o(c),o(c+2*r),o(c+1*r),o(c+2*r),o(c+1*r),o(c+3*r)}}function B(e,t,i,r,n){for(let a=0;a<n;a++)i[r++]=e[t++];return r}function W(e,t,i){return q(e,t.get(y["a"].POSITION).data,i?i.get(y["a"].POSITION):null)}function q(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}const Z=Object(l["f"])(),X=Object(l["f"])(),Y=Object(l["f"])(),$=Object(l["f"])(),Q=Object(l["f"])(),J=Object(s["d"])(),K=Object(s["d"])(),ee=Object(l["f"])(),te=Object(l["f"])(),ie=Object(u["d"])(),re=Object(u["d"])(),ne=Object(l["f"])(),ae=Object(l["f"])(),se=Object(l["f"])(),oe=[Object(s["d"])(),Object(s["d"])(),Object(s["d"])(),Object(s["d"])()],ce=[Object(l["f"])(),Object(l["f"])(),Object(l["f"])(),Object(l["f"])()],le=Object(p["d"])(),he=Object(p["d"])(),de=Object(p["d"])(),ue=Object(p["d"])()},"87b7":function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return d})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return c})),i.d(t,"h",(function(){return o}));var r=i("b7c2"),n=i("d17d");const a={func:n["h"].LESS},s={func:n["h"].ALWAYS},o={mask:255},c={mask:0},l={function:{func:n["h"].ALWAYS,ref:r["h"].OutlineVisualElementMask,mask:r["h"].OutlineVisualElementMask},operation:{fail:n["w"].KEEP,zFail:n["w"].KEEP,zPass:n["w"].ZERO}},h={function:{func:n["h"].ALWAYS,ref:r["h"].OutlineVisualElementMask,mask:r["h"].OutlineVisualElementMask},operation:{fail:n["w"].KEEP,zFail:n["w"].KEEP,zPass:n["w"].REPLACE}},d={function:{func:n["h"].EQUAL,ref:r["h"].OutlineVisualElementMask,mask:r["h"].OutlineVisualElementMask},operation:{fail:n["w"].KEEP,zFail:n["w"].KEEP,zPass:n["w"].KEEP}},u={function:{func:n["h"].NOTEQUAL,ref:r["h"].OutlineVisualElementMask,mask:r["h"].OutlineVisualElementMask},operation:{fail:n["w"].KEEP,zFail:n["w"].KEEP,zPass:n["w"].KEEP}}},"89bf":function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return S})),i.d(t,"c",(function(){return x}));var r=i("b2b2"),n=i("1c92"),a=i("dae5"),s=i("d791"),o=i("afe1"),c=i("04f0"),l=i("b139"),h=i("e431"),d=i("47f8"),u=i("0b2d"),p=i("f895");class b{constructor(){this._transform=Object(o["d"])(),this._transformInverse=new f({value:this._transform},s["a"],o["d"]),this._transformInverseTranspose=new f(this._transformInverse,s["t"],o["d"]),this._transformTranspose=new f({value:this._transform},s["t"],o["d"]),this._transformInverseRotation=new f({value:this._transform},n["k"],a["b"])}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Object(s["c"])(this._transform,e)}multiplyTransform(e){Object(s["m"])(this._transform,this._transform,e)}set(e){Object(s["c"])(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this._invalidateLazyTransforms()}}class f{constructor(e,t,i){this.original=e,this.update=t,this.dirty=!0,this.transform=i()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class g{constructor(e=0){this.offset=e,this.tmpVertex=Object(u["f"])()}applyToVertex(e,t,i){const r=e+this.localOrigin[0],n=t+this.localOrigin[1],a=i+this.localOrigin[2],s=this.offset/Math.sqrt(r*r+n*n+a*a);return this.tmpVertex[0]=e+r*s,this.tmpVertex[1]=t+n*s,this.tmpVertex[2]=i+a*s,this.tmpVertex}applyToAabb(e){for(let n=0;n<3;++n)O[n]=e[0+n]+this.localOrigin[n],m[n]=e[3+n]+this.localOrigin[n],v[n]=O[n];const t=this.applyToVertex(O[0],O[1],O[2]);for(let n=0;n<3;++n)e[n]=t[n],e[n+3]=t[n];const i=t=>{const i=this.applyToVertex(t[0],t[1],t[2]);for(let r=0;r<3;++r)e[r+0]=Math.min(e[r+0],i[r]),e[r+3]=Math.max(e[r+3],i[r])};for(let n=1;n<8;++n){for(let e=0;e<3;++e)v[e]=0==(n&1<<e)?O[e]:m[e];i(v)}let r=0;for(let n=0;n<3;++n)O[n]*m[n]<0&&(r|=1<<n);if(0!==r&&7!==r)for(let n=0;n<8;++n)if(0==(r&n)){for(let e=0;e<3;++e)r[e]?v[e]=0:v[e]=0!=(n&1<<e)?O[e]:m[e];i(v)}for(let n=0;n<3;++n)e[n+0]-=this.localOrigin[n],e[n+3]-=this.localOrigin[n];return e}}const O=Object(u["f"])(),m=Object(u["f"])(),v=Object(u["f"])();class _{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=Object(u["f"])(),this._mbs=Object(p["c"])(),this._obb={center:Object(u["f"])(),halfSize:Object(d["b"])(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,t,i){const r=e,n=t,a=i+this.componentLocalOriginLength,s=this._totalOffset/Math.sqrt(r*r+n*n+a*a);return this._tmpVertex[0]=e+r*s,this._tmpVertex[1]=t+n*s,this._tmpVertex[2]=i+a*s,this._tmpVertex}applyToAabb(e){const t=e[0],i=e[1],r=e[2]+this.componentLocalOriginLength,n=e[3],a=e[4],s=e[5]+this.componentLocalOriginLength,o=t*n<0?0:Math.min(Math.abs(t),Math.abs(n)),c=i*a<0?0:Math.min(Math.abs(i),Math.abs(a)),l=r*s<0?0:Math.min(Math.abs(r),Math.abs(s)),h=Math.sqrt(o*o+c*c+l*l);if(h<this._totalOffset)return e[0]-=t<0?this._totalOffset:0,e[1]-=i<0?this._totalOffset:0,e[2]-=r<0?this._totalOffset:0,e[3]+=n>0?this._totalOffset:0,e[4]+=a>0?this._totalOffset:0,e[5]+=s>0?this._totalOffset:0,e;const d=Math.max(Math.abs(t),Math.abs(n)),u=Math.max(Math.abs(i),Math.abs(a)),p=Math.max(Math.abs(r),Math.abs(s)),b=Math.sqrt(d*d+u*u+p*p),f=this._totalOffset/b,g=this._totalOffset/h;return e[0]+=t*(t>0?f:g),e[1]+=i*(i>0?f:g),e[2]+=r*(r>0?f:g),e[3]+=n*(n<0?f:g),e[4]+=a*(a<0?f:g),e[5]+=s*(s<0?f:g),e}applyToMbs(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this._totalOffset/t;return this._mbs[0]=e[0]+e[0]*i,this._mbs[1]=e[1]+e[1]*i,this._mbs[2]=e[2]+e[2]*i,this._mbs[3]=e[3]+e[3]*this._totalOffset/t,this._mbs}applyToObb(e){const t=e.center,i=this._totalOffset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this._obb.center[0]=t[0]+t[0]*i,this._obb.center[1]=t[1]+t[1]*i,this._obb.center[2]=t[2]+t[2]*i,Object(h["u"])(this._obb.halfSize,e.halfSize,e.quaternion),Object(h["e"])(this._obb.halfSize,this._obb.halfSize,e.center);const r=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*r,this._obb.halfSize[1]+=this._obb.halfSize[1]*r,this._obb.halfSize[2]+=this._obb.halfSize[2]*r,Object(h["f"])(this._obb.halfSize,this._obb.halfSize,e.center),Object(c["a"])(T,e.quaternion),Object(h["u"])(this._obb.halfSize,this._obb.halfSize,T),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}}class j{constructor(e=0){this.offset=e,this.sphere=Object(p["c"])(),this.tmpVertex=Object(u["f"])()}applyToVertex(e,t,i){const r=this.objectTransform.transform;let n=r[0]*e+r[4]*t+r[8]*i+r[12],a=r[1]*e+r[5]*t+r[9]*i+r[13],s=r[2]*e+r[6]*t+r[10]*i+r[14];const o=this.offset/Math.sqrt(n*n+a*a+s*s);n+=n*o,a+=a*o,s+=s*o;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*a+c[8]*s+c[12],this.tmpVertex[1]=c[1]*n+c[5]*a+c[9]*s+c[13],this.tmpVertex[2]=c[2]*n+c[6]*a+c[10]*s+c[14],this.tmpVertex}applyToMinMax(e,t){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/t;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}}const y=new j;function x(e){return Object(r["k"])(e)?(y.offset=e,y):null}new _;new g;const S="terrain",T=Object(l["b"])()},"8a19":function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i("b2b2"),n=i("f4cc"),a=i("3563"),s=i("c20d"),o=i("1f1c"),c=i("9305");class l{constructor(){this.next=new s["a"]}createSnapDragEventPipelineStep({predicate:e=(()=>!0),cancel:t,snappingManager:i,snappingContext:l,updatingHandles:h}){if(Object(r["j"])(i))return e=>e;let d=null,u=null;const p=()=>{d=Object(r["a"])(d),i.doneSnapping(),Object(r["k"])(u)&&u.frameTask.remove(),u=null};t.next(e=>(p(),e)),this.next=new s["a"];const b=Object(n["f"])(async({frameTask:e,point:t,context:r,event:n,dx:s,dy:o},c)=>{const l=await e.schedule(()=>i.snap(t,r,c),c);if(l.valid){let h=await e.schedule(()=>l.apply(),c);t!==f&&(h=i.update(f,r)),Object(a["a"])(h,g)||(n.mapEnd.x=h.x+s,n.mapEnd.y=h.y+o,this.next.execute(n))}});let f,g;return t=>{if(!e(t))return t;if("start"===t.action){const e="3d"===i.view.type?i.view.resourceController.scheduler.registerTask(c["b"].SNAPPING):c["a"];u={context:new o["a"]({editGeometryOperations:l.editGeometryOperations,elevationInfo:l.elevationInfo,pointer:l.pointer,vertexHandle:Object(r["k"])(t.info)?t.info.handle:null,excludeFeature:l.excludeFeature,visualizer:l.visualizer}),originalPos:Object(r["k"])(t.snapOrigin)?l.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,frameTask:e}}if(Object(r["k"])(u)){const e=u.context.coordinateHelper.vectorToDehydratedPoint(u.context.coordinateHelper.arrayToVector([u.originalPos.x,u.originalPos.y,u.originalPos.z]));e.x+=t.mapEnd.x-t.mapStart.x,e.y+=t.mapEnd.y-t.mapStart.y;const a=t.mapStart.x-u.originalPos.x,s=t.mapStart.y-u.originalPos.y,o={...t,action:"update"},c=u.context,l=i.update(e,u.context);if(g=l,t.mapEnd.x=l.x+a,t.mapEnd.y=l.y+s,f=e,"end"!==t.action){const t=u.frameTask;Object(r["k"])(d)||(d=new AbortController),h.addPromise(Object(n["i"])(b({frameTask:t,event:o,context:c,point:e,dx:a,dy:s},d.signal)))}}return"end"===t.action&&p(),t}}}},"8a80":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae");class n extends r["a"]{constructor(e){super(e,"float")}}},"8b1a":function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var r,n=i("3349"),a=i("02f1"),s=i("e431"),o=i("0b2d"),c=i("7577"),l=i("0fc4"),h=i("4ae5");!function(e){e[e.Z=0]="Z",e[e.M=1]="M"}(r||(r={}));class d{constructor(e){this.spatialReference=e}createVector(){return this._tag(Object(a["c"])())}pointToVector(e){return this._tag(Object(a["g"])(e.x,e.y))}arrayToVector(e){return this._tag(Object(a["g"])(e[0],e[1]))}vectorToArray(e){return[e[0],e[1]]}pointToArray(e){return[e.x,e.y]}vectorToPoint(e,t=new h["a"]){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new h["a"]){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"}){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.hasZ=!1,t.hasM=!1,t.spatialReference=this.spatialReference,t}lerp(e,t,i,r){return Object(n["l"])(r,e,t,i)}addDelta(e,t,i){e[0]+=t,e[1]+=i}distance(e,t){return Object(n["j"])(e,t)}getZ(e,t){return t}hasZ(){return!1}getM(e,t){return t}hasM(){return!1}clone(e){return this._tag(Object(a["d"])(e))}copy(e,t){return Object(n["c"])(t,e)}fromXYZ(e){return this._tag(Object(a["g"])(e[0],e[1]))}toXYZ(e,t=0){return Object(o["h"])(e[0],e[1],t)}_tag(e){return e}}class u{constructor(e,t){this.valueType=e,this.spatialReference=t}createVector(){return this._tag(Object(o["f"])())}pointToVector(e){return this._tag(Object(o["h"])(e.x,e.y,this.valueType===r.Z?e.z:e.m))}arrayToVector(e){return this._tag(Object(o["h"])(e[0],e[1],e[2]||0))}vectorToArray(e){return[e[0],e[1],e[2]]}pointToArray(e){return this.valueType===r.Z?[e.x,e.y,e.z]:[e.x,e.y,e.m]}vectorToPoint(e,t=new h["a"]){return t.x=e[0],t.y=e[1],t.z=this.valueType===r.Z?e[2]:void 0,t.m=this.valueType===r.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new h["a"]){return t.x=e[0],t.y=e[1],t.z=this.valueType===r.Z?e[2]:void 0,t.m=this.valueType===r.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"}){const i=this.valueType===r.Z,n=this.valueType===r.M;return t.x=e[0],t.y=e[1],t.z=i?e[2]:void 0,t.m=n?e[2]:void 0,t.hasZ=i,t.hasM=n,t.spatialReference=this.spatialReference,t}lerp(e,t,i,r){return Object(s["l"])(r,e,t,i)}addDelta(e,t,i,n){e[0]+=t,e[1]+=i,this.valueType===r.Z&&(e[2]+=n)}distance(e,t){return this.valueType===r.Z?Object(s["m"])(e,t):Object(n["j"])(e,t)}getZ(e,t){return this.valueType===r.Z?e[2]:t}hasZ(){return this.valueType===r.Z}getM(e,t){return this.valueType===r.M?e[2]:t}hasM(){return this.valueType===r.M}clone(e){return this._tag(Object(o["g"])(e))}copy(e,t){return Object(s["g"])(t,e)}fromXYZ(e,t=0,i=0){return this._tag(Object(o["h"])(e[0],e[1],this.valueType===r.Z?e.length>2?e[2]:t:i))}toXYZ(e,t=0){return this._tag(Object(o["h"])(e[0],e[1],this.valueType===r.Z?e[2]:t))}_tag(e){return e}}class p{constructor(e){this.spatialReference=e}createVector(){return this._tag(Object(l["e"])())}pointToVector(e){return this._tag(Object(l["g"])(e.x,e.y,e.z,e.m))}arrayToVector(e){return this._tag(Object(l["g"])(e[0],e[1],e[2]||0,e[3]||0))}vectorToArray(e){return[e[0],e[1],e[2],e[3]]}pointToArray(e){return[e.x,e.y,e.z,e.m]}vectorToPoint(e,t=new h["a"]){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new h["a"]){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"}){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t.spatialReference=this.spatialReference,t}lerp(e,t,i,r){return Object(c["j"])(r,e,t,i)}addDelta(e,t,i,r){e[0]+=t,e[1]+=i,e[2]+=r}distance(e,t){return Object(s["m"])(e,t)}getZ(e){return e[2]}hasZ(){return!0}getM(e){return e[3]}hasM(){return!0}clone(e){return this._tag(Object(l["d"])(e))}copy(e,t){return Object(c["c"])(t,e)}fromXYZ(e,t=0,i=0){return this._tag(Object(l["g"])(e[0],e[1],e.length>2?e[2]:t,i))}toXYZ(e){return Object(o["h"])(e[0],e[1],e[2])}_tag(e){return e}}function b(e,t,i){return e&&t?new p(i):t?new u(r.M,i):e?new u(r.Z,i):new d(i)}},"8bbe":function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.NEW_STEP=0]="NEW_STEP",e[e.ACCUMULATE_STEPS=1]="ACCUMULATE_STEPS"}(r||(r={}))},"8c4b":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("38a4");function n(e,t,i){var n;const l=e.byteLength/(4*t),h=new Uint32Array(e,0,l*t);let d=new Uint32Array(l);const u=null!=(n=null==i?void 0:i.minReduction)?n:0,p=(null==i?void 0:i.originalIndices)||null,b=p?p.length:0,f=(null==i?void 0:i.componentOffsets)||null;let g=0;if(f)for(let r=0;r<f.length-1;r++){const e=f[r+1]-f[r];e>g&&(g=e)}else g=l;const O=Math.floor(1.1*g)+1;(null==c||c.length<2*O)&&(c=new Uint32Array(Object(r["m"])(2*O)));for(let r=0;r<2*O;r++)c[r]=0;let m=0;const v=!!f&&!!p,_=v?b:l,j=v?new Uint32Array(b):null,y=1.96;let x=0!==u?Math.ceil(4*y*y/(u*u)*u*(1-u)):_,S=1,T=f?f[1]:_;for(let r=0;r<_;r++){if(r===x){const e=1-m/r;if(e+y*Math.sqrt(e*(1-e)/r)<u)return null;x*=2}if(r===T){for(let e=0;e<2*O;e++)c[e]=0;if(p)for(let e=f[S-1];e<f[S];e++)j[e]=d[p[e]];T=f[++S]}const e=v?p[r]:r,i=e*t,n=o(h,i,t);let s=n%O,l=m;for(;0!==c[2*s+1];){if(c[2*s]===n){const e=c[2*s+1]-1;if(a(h,i,e*t,t)){l=d[e];break}}s++,s>=O&&(s-=O)}l===m&&(c[2*s]=n,c[2*s+1]=e+1,m++),d[e]=l}if(0!==u&&1-m/l<u)return null;if(v){for(let e=f[S-1];e<j.length;e++)j[e]=d[p[e]];d=j}const w=new Uint32Array(t*m);m=0;for(let r=0;r<_;r++)d[r]===m&&(s(h,(v?p[r]:r)*t,w,m*t,t),m++);if(p&&!v){const e=new Uint32Array(b);for(let t=0;t<e.length;t++)e[t]=d[p[t]];d=e}return{buffer:w.buffer,indices:d,uniqueCount:m}}function a(e,t,i,r){for(let n=0;n<r;n++)if(e[t+n]!==e[i+n])return!1;return!0}function s(e,t,i,r,n){for(let a=0;a<n;a++)i[r+a]=e[t+a]}function o(e,t,i){let r=0;for(let n=0;n<i;n++)r=e[t+n]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let c=null},"8e97":function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return b}));var r=i("d791"),n=i("970c"),a=i("e431"),s=i("0b2d"),o=i("35f0"),c=i("ea32"),l=i("62ae"),h=i("52b2");class d extends l["a"]{constructor(e,t){super(e,"mat4",h["a"].Draw,(i,r,n)=>i.setUniformMatrix4fv(e,t(r,n)))}}var u=i("85b3");function p(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",s["c"]):e.uniforms.add(new o["a"]("cameraPosition",(e,t)=>Object(a["w"])(g,t.camera.viewInverseTransposeMatrix[3]-e.origin[0],t.camera.viewInverseTransposeMatrix[7]-e.origin[1],t.camera.viewInverseTransposeMatrix[11]-e.origin[2])))}function b(e,t){if(e.vertex.uniforms.add(new u["a"]("proj",(e,t)=>t.camera.projectionMatrix)),t.instancedDoublePrecision){const t=(e,t)=>Object(a["w"])(g,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]);e.vertex.uniforms.add(new u["a"]("view",(e,i)=>Object(r["j"])(f,i.camera.viewMatrix,t(e,i))));const i=new c["a"]("localOrigin",t);return e.vertex.uniforms.add(i),i}e.vertex.uniforms.add(new d("view",(e,t)=>Object(r["j"])(f,t.camera.viewMatrix,e.origin)));const i=new o["a"]("localOrigin",e=>e.origin);return e.vertex.uniforms.add(i),i}const f=Object(n["a"])(),g=Object(s["f"])()},9250:function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return y}));var r=i("b2b2"),n=i("d791"),a=i("afe1"),s=i("e431"),o=i("0b2d"),c=i("7577"),l=i("0fc4"),h=i("d18f"),d=i("3c9c"),u=i("1942");i("0d9f");function p(e){return Object(r["k"])(e)&&Object(r["k"])(e.dist)}Object(o["f"])();var b=i("89bf"),f=i("b623");const g=1e-5;class O{constructor(e){this.options=new u["a"],this._results=new v,this.transform=new b["a"],this.tolerance=g,this.verticalOffset=null,this._ray=Object(h["c"])(),this._rayEnd=Object(o["f"])(),this._rayBeginTransformed=Object(o["f"])(),this._rayEndTransformed=Object(o["f"])(),this.viewingMode=null==e?d["a"].Global:e}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,i){this.resetWithRay(Object(h["e"])(e,t,this._ray),i)}resetWithRay(e,t){this.camera=t,e!==this._ray&&Object(h["b"])(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===d["a"].Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Object(s["e"])(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,t,i,n,a){this.point=t,this.filterPredicate=n,this.tolerance=null==i?g:i;const s=Object(b["c"])(this.verticalOffset);if(Object(r["k"])(e)&&e.length>0){const t=a?e=>{a(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const i of e){const e=i.getSpatialQueryAccelerator&&i.getSpatialQueryAccelerator();Object(r["k"])(e)?(Object(r["k"])(s)?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,s):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):i.objects.forAll(e=>t(e))}}this.sortResults()}intersectObject(e){const t=e.geometryRecords;if(!t)return;const i=e.transformation,n=Object(b["c"])(this.verticalOffset);for(const o of t){const{geometry:t,material:c,instanceParameters:l}=o;if(Object(f["d"])(l))continue;const h=t.id;this.transform.setAndInvalidateLazyTransforms(i,o.getShaderTransformation()),Object(s["q"])(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Object(s["q"])(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const d=this.transform.transform;Object(r["k"])(n)&&(n.objectTransform=this.transform),c.intersect(t,l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(t,i,n,s,o,c)=>{if(t>=0){if(Object(r["k"])(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;const l=s?this._results.hud:this._results,p=s?s=>{const l={object:e,geometryId:h,triangleNr:n,center:Object(r["k"])(c)?[c[0],c[1],c[2]]:null};s.set(u["b"].HUD,l,t,i,a["a"],o)}:r=>r.set(u["b"].OBJECT,{object:e,geometryId:h,triangleNr:n},t,i,d,o);if((null==l.min.drapedLayerOrder||o>=l.min.drapedLayerOrder)&&(null==l.min.dist||t<l.min.dist)&&p(l.min),this.options.store!==u["c"].MIN&&(null==l.max.drapedLayerOrder||o<l.max.drapedLayerOrder)&&(null==l.max.dist||t>l.max.dist)&&p(l.max),this.options.store===u["c"].ALL)if(s){const e=new j(this._ray);p(e),this._results.hud.all.push(e)}else{const e=new _(this._ray);p(e),this._results.all.push(e)}}},o.shaderTransformation)}}sortResults(e=this._results.all){e.sort((e,t)=>e.dist!==t.dist?Object(r["s"])(e.dist,0)-Object(r["s"])(t.dist,0):e.drapedLayerOrder!==t.drapedLayerOrder?Object(r["s"])(e.drapedLayerOrder,Number.MAX_VALUE)-Object(r["s"])(t.drapedLayerOrder,Number.MAX_VALUE):Object(r["s"])(t.drapedLayerGraphicOrder,Number.MIN_VALUE)-Object(r["s"])(e.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function m(e){return new O(e)}class v{constructor(){this.min=new _(Object(h["c"])()),this.max=new _(Object(h["c"])()),this.hud={min:new j(Object(h["c"])()),max:new j(Object(h["c"])()),all:new Array},this.ground=new _(Object(h["c"])()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}class _{constructor(e){this.intersector=u["b"].OBJECT,this.normal=Object(o["f"])(),this.transformation=Object(a["d"])(),this._ray=Object(h["c"])(),this.init(e)}get ray(){return this._ray}get distanceInRenderSpace(){return Object(r["k"])(this.dist)?(Object(s["k"])(x,this.ray.direction,this.dist),Object(s["p"])(x)):null}getIntersectionPoint(e){return!!p(this)&&(Object(s["k"])(x,this.ray.direction,this.dist),Object(s["e"])(e,this.ray.origin,x),!0)}getTransformedNormal(e){return Object(s["g"])(S,this.normal),S[3]=0,Object(c["m"])(S,S,this.transformation),Object(s["g"])(e,S),Object(s["r"])(e,e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=u["b"].OBJECT,Object(h["b"])(e,this._ray)}set(e,t,i,c,l,h,d){this.intersector=e,this.dist=i,Object(s["g"])(this.normal,Object(r["s"])(c,o["b"])),Object(n["c"])(this.transformation,Object(r["s"])(l,a["a"])),this.target=t,this.drapedLayerOrder=h,this.drapedLayerGraphicOrder=d}copy(e){Object(h["b"])(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Object(s["g"])(this.normal,e.normal),Object(n["c"])(this.transformation,e.transformation)}}class j extends _{constructor(){super(...arguments),this.intersector=u["b"].HUD}}function y(e){return new _(e)}const x=Object(o["f"])(),S=Object(l["e"])()},9360:function(e,t,i){"use strict";i.d(t,"a",(function(){return C}));var r=i("e431"),n=i("0b2d"),a=i("0fc4"),s=i("4261"),o=i("8190"),c=i("fc00"),l=i("a05b"),h=i("b7c2"),d=i("d7f7"),u=i("b061"),p=i("35b3"),b=i("badc"),f=i("1153"),g=i("b7bd"),O=i("5957"),m=i("7c51"),v=i("a4ee"),_=i("c3a4"),j=i("ca98"),y=i("da35"),x=i("7438"),S=i("c829"),T=i("6d35"),w=i("692f"),M=i("d17d"),A=i("189c");class E extends j["a"]{initializeProgram(e){const t=E.shader.get().build(this.configuration);return new S["a"](e.rctx,t,P)}_setPipelineState(e){const t=this.configuration,i=e===h["i"].NONE,r=e===h["i"].FrontFace;return Object(A["f"])({blending:t.output!==l["a"].Color&&t.output!==l["a"].Alpha||!t.transparent?null:i?x["d"]:Object(x["f"])(e),culling:Object(A["b"])(t.cullFace),depthTest:{func:r?M["h"].LESS:t.shadingEnabled?M["h"].LEQUAL:M["h"].LESS},depthWrite:i?t.writeDepth&&A["d"]:Object(x["h"])(e),colorWrite:A["c"],polygonOffset:i||r?null:x["a"]})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}E.shader=new _["a"](w["a"],()=>i.e("chunk-2d2219c9").then(i.bind(null,"caa6")));class R extends T["a"]{constructor(){super(...arguments),this.output=l["a"].Color,this.cullFace=h["b"].None,this.transparencyPassType=h["i"].NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}Object(v["a"])([Object(y["b"])({count:l["a"].COUNT})],R.prototype,"output",void 0),Object(v["a"])([Object(y["b"])({count:h["b"].COUNT})],R.prototype,"cullFace",void 0),Object(v["a"])([Object(y["b"])({count:h["i"].COUNT})],R.prototype,"transparencyPassType",void 0),Object(v["a"])([Object(y["b"])()],R.prototype,"hasSlicePlane",void 0),Object(v["a"])([Object(y["b"])()],R.prototype,"transparent",void 0),Object(v["a"])([Object(y["b"])()],R.prototype,"writeDepth",void 0),Object(v["a"])([Object(y["b"])()],R.prototype,"screenSizeEnabled",void 0),Object(v["a"])([Object(y["b"])()],R.prototype,"shadingEnabled",void 0),Object(v["a"])([Object(y["b"])()],R.prototype,"hasMultipassTerrain",void 0),Object(v["a"])([Object(y["b"])()],R.prototype,"cullAboveGround",void 0);const P=new Map([[g["a"].POSITION,0],[g["a"].NORMAL,1],[g["a"].OFFSET,2]]);class C extends p["a"]{constructor(e){super(e,new I),this.supportsEdges=!0,this.techniqueConfig=new R,this._vertexAttributeLocations=P}getConfiguration(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.screenSizeEnabled=this.parameters.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.parameters.shadingEnabled,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(e,t,i,n,a,o,c){if(this.parameters.screenSizeEnabled){const i=e.vertexAttributes.get(g["a"].OFFSET),l={applyToVertex:(e,t,a,s)=>{const o=Object(r["w"])(N,i.data[3*s+0],i.data[3*s+1],i.data[3*s+2]),c=Object(r["w"])(z,e,t,a);return Object(r["k"])(o,o,this.parameters.screenSizeScale*n.camera.computeRenderPixelSizeAt(o)),Object(r["e"])(c,c,o),[c[0],c[1],c[2]]},applyToAabb:e=>{const t=Object(s["d"])(e,N);return Object(s["v"])(e,this.parameters.screenSizeScale*n.camera.computeRenderPixelSizeAt(t))}};Object(m["e"])(e,t,n,a,o,l,c)}else Object(m["e"])(e,t,n,a,o,void 0,c)}requiresSlot(e,t){if(Object(u["b"])(t)===l["a"].Highlight)return e===b["a"].OPAQUE_MATERIAL;let i=b["a"].OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?b["a"].TRANSPARENT_MATERIAL:b["a"].TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i||e===b["a"].DRAPED_MATERIAL}createGLMaterial(e){return e.output===l["a"].Color||e.output===l["a"].Alpha||e.output===l["a"].Highlight?new D(e):null}createBufferWriter(){return new L(this.parameters.screenSizeEnabled)}}class D extends d["a"]{beginSlot(e){return this.ensureTechnique(E,e)}}class I extends p["b"]{constructor(){super(...arguments),this.color=Object(a["g"])(1,1,1,1),this.shadingTint=Object(a["g"])(0,0,0,.25),this.shadingDirection=Object(r["r"])(Object(n["f"])(),[.5,-.5,-.5]),this.screenSizeScale=14,this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=h["b"].None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}}class L{constructor(e){this.screenSizeEnabled=e;const t=Object(c["a"])().vec3f(g["a"].POSITION).vec3f(g["a"].NORMAL);this.screenSizeEnabled&&t.vec3f(g["a"].OFFSET),this.vertexBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(g["a"].POSITION).length}write(e,t,i,r){if(Object(O["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r),this.screenSizeEnabled){if(!t.vertexAttributes.has(g["a"].OFFSET))throw new Error(g["a"].OFFSET+" vertex attribute required for screenSizeEnabled ShadedColorMaterial");{const n=t.vertexAttributes.get(g["a"].OFFSET),a=t.indices.get(g["a"].OFFSET);Object(f["a"])(3===n.size);const s=i.getField(g["a"].OFFSET,o["u"]);if(!s)throw new Error("unable to acquire view for "+g["a"].OFFSET);Object(O["e"])(a,n.data,e.invTranspTransformation,s,r)}}}}const N=Object(n["f"])(),z=Object(n["f"])()},"94a9":function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var r=i("a4ee"),n=i("fc29"),a=i("b2b2"),s=i("f4cc"),o=i("59b2"),c=(i("b50f"),i("c120"),i("cea0"),i("d386")),l=i("9305");let h=class extends n["a"]{constructor(e){super(e),this.stagedPoint=null,this._abortController=null,this._snap=Object(s["f"])(async(e,t,i,r)=>{const n=await this._frameTask.schedule(()=>t.snap(e,i,r),r);n.valid&&await this._frameTask.schedule(()=>{this.stagedPoint=n.apply(),e!==this._snapMapPoint&&(this.stagedPoint=t.update(this._snapMapPoint,i))},r)})}initialize(){var e,t;const i="3d"===this.view.type?null==(e=this.view)||null==(t=e.resourceController)?void 0:t.scheduler:null;this._frameTask=Object(a["k"])(i)?i.registerTask(l["b"].SNAPPING):l["a"]}destroy(){this._abortController=Object(a["a"])(this._abortController),this._frameTask=Object(a["q"])(this._frameTask)}async snap(e,t,i){return this.stagedPoint=t.update(e,i),this._snapMapPoint=e,Object(a["j"])(this._abortController)&&(this._abortController=new AbortController),this._snap(e,t,i,this._abortController.signal)}abort(){this._abortController=Object(a["a"])(this._abortController)}};Object(r["a"])([Object(o["b"])({constructOnly:!0})],h.prototype,"view",void 0),Object(r["a"])([Object(o["b"])()],h.prototype,"stagedPoint",void 0),h=Object(r["a"])([Object(c["a"])("esri.views.interactive.snapping.SnappingOperation")],h)},"955a":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("62ae"),n=i("52b2");class a extends r["a"]{constructor(e,t,i){super(e,"float",n["a"].Pass,(i,r,n)=>i.setUniform1fv(e,t(r,n)),i)}}},9617:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return o}));var r=i("d047"),n=i("d8a4"),a=i("3886"),s=i("6a3c");function o(e){e.include(r["a"]),e.uniforms.add([new s["a"]("geometryDepthTexture",(e,t)=>t.multipassGeometry.linearDepthTexture),new n["a"]("nearFar",(e,t)=>t.camera.nearFar)]),e.code.add(a["b"]`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class c{constructor(){this.enabled=!1}}},9812:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r,n,a,s={exports:{}};r=s,n=function(){function e(e,i,n){n=n||2;var a,s,o,l,h,d,u,p=i&&i.length,b=p?i[0]*n:e.length,f=t(e,0,b,n,!0),g=[];if(!f||f.next===f.prev)return g;if(p&&(f=c(e,i,f,n)),e.length>80*n){a=o=e[0],s=l=e[1];for(var O=n;O<b;O+=n)(h=e[O])<a&&(a=h),(d=e[O+1])<s&&(s=d),h>o&&(o=h),d>l&&(l=d);u=0!==(u=Math.max(o-a,l-s))?1/u:0}return r(f,g,n,a,s,u),g}function t(e,t,i,r,n){var a,s;if(n===C(e,t,i,r)>0)for(a=t;a<i;a+=r)s=E(a,e[a],e[a+1],s);else for(a=i-r;a>=t;a-=r)s=E(a,e[a],e[a+1],s);if(s&&j(s,s.next)){var o=s.next;R(s),s=o}return s}function i(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!j(r,r.next)&&0!==_(r.prev,r,r.next))r=r.next;else{var n=r.prev;if(R(r),(r=t=n)===r.next)break;i=!0}}while(i||r!==t);return t}function r(e,t,c,l,h,d,u){if(e){!u&&d&&b(e,l,h,d);for(var p,f,g=e;e.prev!==e.next;)if(p=e.prev,f=e.next,d?a(e,l,h,d):n(e))t.push(p.i/c),t.push(e.i/c),t.push(f.i/c),R(e),e=f.next,g=f.next;else if((e=f)===g){u?1===u?r(e=s(i(e),t,c),t,c,l,h,d,2):2===u&&o(e,t,c,l,h,d):r(i(e),t,c,l,h,d,1);break}}}function n(e){var t=e.prev,i=e,r=e.next;if(_(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(m(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&_(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function a(e,t,i,r){var n=e.prev,a=e,s=e.next;if(_(n,a,s)>=0)return!1;for(var o=n.x<a.x?n.x<s.x?n.x:s.x:a.x<s.x?a.x:s.x,c=n.y<a.y?n.y<s.y?n.y:s.y:a.y<s.y?a.y:s.y,l=n.x>a.x?n.x>s.x?n.x:s.x:a.x>s.x?a.x:s.x,h=n.y>a.y?n.y>s.y?n.y:s.y:a.y>s.y?a.y:s.y,d=g(o,c,t,i,r),u=g(l,h,t,i,r),p=e.prevZ,b=e.nextZ;p&&p.z>=d&&b&&b.z<=u;){if(p!==e.prev&&p!==e.next&&m(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,b!==e.prev&&b!==e.next&&m(n.x,n.y,a.x,a.y,s.x,s.y,b.x,b.y)&&_(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&m(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;b&&b.z<=u;){if(b!==e.prev&&b!==e.next&&m(n.x,n.y,a.x,a.y,s.x,s.y,b.x,b.y)&&_(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function s(e,t,r){var n=e;do{var a=n.prev,s=n.next.next;!j(a,s)&&y(a,n,n.next,s)&&w(a,s)&&w(s,a)&&(t.push(a.i/r),t.push(n.i/r),t.push(s.i/r),R(n),R(n.next),n=e=s),n=n.next}while(n!==e);return i(n)}function o(e,t,n,a,s,o){var c=e;do{for(var l=c.next.next;l!==c.prev;){if(c.i!==l.i&&v(c,l)){var h=A(c,l);return c=i(c,c.next),h=i(h,h.next),r(c,t,n,a,s,o),void r(h,t,n,a,s,o)}l=l.next}c=c.next}while(c!==e)}function c(e,r,n,a){var s,o,c,h=[];for(s=0,o=r.length;s<o;s++)(c=t(e,r[s]*a,s<o-1?r[s+1]*a:e.length,a,!1))===c.next&&(c.steiner=!0),h.push(O(c));for(h.sort(l),s=0;s<h.length;s++)n=i(n=d(h[s],n),n.next);return n}function l(e,t){return e.x-t.x}function h(e){if(e.next.prev===e)return e;let t=e;for(;;){const i=t.next;if(i.prev===t||i===t||i===e)break;t=i}return t}function d(e,t){var r=u(e,t);if(!r)return t;var n=A(r,e),a=i(r,r.next);let s=h(n);return i(s,s.next),a=h(a),h(t===r?a:t)}function u(e,t){var i,r=t,n=e.x,a=e.y,s=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var o=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=n&&o>s){if(s=o,o===n){if(a===r.y)return r;if(a===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===s)return i;var c,l=i,h=i.x,d=i.y,u=1/0;r=i;do{n>=r.x&&r.x>=h&&n!==r.x&&m(a<d?n:s,a,h,d,a<d?s:n,a,r.x,r.y)&&(c=Math.abs(a-r.y)/(n-r.x),w(r,e)&&(c<u||c===u&&(r.x>i.x||r.x===i.x&&p(i,r)))&&(i=r,u=c)),r=r.next}while(r!==l);return i}function p(e,t){return _(e.prev,e,t.prev)<0&&_(t.next,e,e.next)<0}function b(e,t,i,r){var n=e;do{null===n.z&&(n.z=g(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,f(n)}function f(e){var t,i,r,n,a,s,o,c,l=1;do{for(i=e,e=null,a=null,s=0;i;){for(s++,r=i,o=0,t=0;t<l&&(o++,r=r.nextZ);t++);for(c=l;o>0||c>0&&r;)0!==o&&(0===c||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,c--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;i=r}a.nextZ=null,l*=2}while(s>1);return e}function g(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function O(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function m(e,t,i,r,n,a,s,o){return(n-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(r-o)-(i-s)*(t-o)>=0&&(i-s)*(a-o)-(n-s)*(r-o)>=0}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!T(e,t)&&(w(e,t)&&w(t,e)&&M(e,t)&&(_(e.prev,e,t.prev)||_(e,t.prev,t))||j(e,t)&&_(e.prev,e,e.next)>0&&_(t.prev,t,t.next)>0)}function _(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function j(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,i,r){var n=S(_(e,t,i)),a=S(_(e,t,r)),s=S(_(i,r,e)),o=S(_(i,r,t));return n!==a&&s!==o||!(0!==n||!x(e,i,t))||!(0!==a||!x(e,r,t))||!(0!==s||!x(i,e,r))||!(0!==o||!x(i,t,r))}function x(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function S(e){return e>0?1:e<0?-1:0}function T(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&y(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function w(e,t){return _(e.prev,e,e.next)<0?_(e,t,e.next)>=0&&_(e,e.prev,t)>=0:_(e,t,e.prev)<0||_(e,e.next,t)<0}function M(e,t){var i=e,r=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&n<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}function A(e,t){var i=new P(e.i,e.x,e.y),r=new P(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}function E(e,t,i,r){var n=new P(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function R(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function P(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(e,t,i,r){for(var n=0,a=t,s=i-r;a<i;a+=r)n+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return n}return e.deviation=function(e,t,i,r){var n=t&&t.length,a=n?t[0]*i:e.length,s=Math.abs(C(e,0,a,i));if(n)for(var o=0,c=t.length;o<c;o++){var l=t[o]*i,h=o<c-1?t[o+1]*i:e.length;s-=Math.abs(C(e,l,h,i))}var d=0;for(o=0;o<r.length;o+=3){var u=r[o]*i,p=r[o+1]*i,b=r[o+2]*i;d+=Math.abs((e[u]-e[b])*(e[p+1]-e[u+1])-(e[u]-e[p])*(e[b+1]-e[u+1]))}return 0===s&&0===d?0:Math.abs((d-s)/s)},e.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var a=0;a<e[n].length;a++)for(var s=0;s<t;s++)i.vertices.push(e[n][a][s]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i},e},void 0!==(a=n())&&(r.exports=a);const o=s.exports},9990:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c}));var r=i("b2b2"),n=i("a915"),a=i("3349"),s=i("e431"),o=i("7361");function c(e,t,i){return l(e,e.screenToRender(t,Object(n["b"])(o["d"].get())),i)}function l(e,t,i){const c=Object(n["b"])(Object(a["c"])(o["d"].get(),t));if(c[2]=0,!e.unprojectFromRenderScreen(c,i.origin))return null;const l=Object(n["b"])(Object(a["c"])(o["d"].get(),t));l[2]=1;const h=e.unprojectFromRenderScreen(l,o["d"].get());return Object(r["j"])(h)?null:(Object(s["f"])(i.direction,h,i.origin),i)}},"9a68":function(e,t,i){"use strict";i.d(t,"a",(function(){return x})),i.d(t,"b",(function(){return T})),i.d(t,"c",(function(){return S}));var r=i("b2b2"),n=i("a05b"),a=i("d272"),s=i("e6aa"),o=i("c2d1"),c=i("6750"),l=i("c6d7"),h=i("c51b"),d=i("3976"),u=i("4377"),p=i("8e97"),b=i("d8a4"),f=i("fd48"),g=i("1fe9"),O=i("3886"),m=i("85b3"),v=i("690a"),_=i("b7c2"),j=i("b7bd"),y=i("a6b6");const x=1;function S(e){const t=new v["a"],i=e.hasMultipassTerrain&&(e.output===n["a"].Color||e.output===n["a"].Alpha);t.include(h["a"]),t.include(s["a"],e),t.include(c["a"],e),e.output===n["a"].Depth&&t.include(o["a"],e),Object(p["b"])(t,e);const{vertex:S,fragment:T}=t;S.uniforms.add([new m["a"]("inverseProjectionMatrix",(e,t)=>t.camera.inverseProjectionMatrix),new b["a"]("nearFar",(e,t)=>t.camera.nearFar),new g["a"]("miterLimit",e=>"miter"!==e.join?0:e.miterLimit),new f["a"]("viewport",(e,t)=>t.camera.fullViewport)]),S.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(j["a"].POSITION,"vec3"),t.attributes.add(j["a"].SUBDIVISIONFACTOR,"float"),t.attributes.add(j["a"].UV0,"vec2"),t.attributes.add(j["a"].AUXPOS1,"vec3"),t.attributes.add(j["a"].AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),i&&t.varyings.add("depth","float");const w=e.capType===y["a"].ROUND,M=e.stippleEnabled&&e.stippleScaleWithLineWidth||w;M&&t.varyings.add("vLineWidth","float");const A=e.stippleEnabled&&e.stippleScaleWithLineWidth;A&&t.varyings.add("vLineSizeInv","float");const E=e.innerColorEnabled||w;E&&t.varyings.add("vLineDistance","float");const R=e.stippleEnabled&&w,P=e.falloffEnabled||R;P&&t.varyings.add("vLineDistanceNorm","float"),w&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),S.code.add(O["b"]`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),S.code.add(O["b"]`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),S.code.add(O["b"]`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${i?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),S.uniforms.add(new g["a"]("pixelRatio",(e,t)=>t.camera.pixelRatio)),S.code.add(O["b"]`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${M?O["b"]`vLineWidth = lineWidth;`:""}
      ${A?O["b"]`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),(e.stippleEnabled||w)&&S.code.add(O["b"]`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${w?O["b"]`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),S.code.add(O["b"]`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?S.code.add(O["b"]`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?O["b"]`min(1.0, subdivisionFactor * ${O["b"].float((x+2)/(x+1))})`:O["b"]`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):S.code.add(O["b"]`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const C=e.capType!==y["a"].BUTT;return S.code.add(O["b"]`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${C?O["b"]`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),S.code.add(O["b"]`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${P||E?O["b"]`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${E?O["b"]`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${P?O["b"]`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),w&&S.code.add(O["b"]`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?S.uniforms.add(new g["a"]("worldToScreenRatio",(e,t)=>1/t.screenToPCSRatio)):S.code.add(O["b"]`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),S.code.add(O["b"]`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?S.code.add(O["b"]`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):S.code.add(O["b"]`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),S.code.add(O["b"]`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),S.code.add(O["b"]`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `),i&&t.include(l["b"],e),t.include(a["a"],e),T.include(u["a"]),T.code.add(O["b"]`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?T.code.add(O["b"]`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(w&&T.code.add(O["b"]`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${O["b"].float(d["b"])}) {
        discard;
      }
    `),R?T.code.add(O["b"]`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${O["b"].float(d["b"])}, stippleCoverage);
      `):T.code.add(O["b"]`float stippleAlpha = getStippleAlpha();`),T.uniforms.add(new f["a"]("intrinsicColor",e=>e.color)),T.code.add(O["b"]`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(T.uniforms.add(new f["a"]("innerColor",e=>Object(r["s"])(e.innerColor,e.color))),T.uniforms.add(new g["a"]("innerWidth",(e,t)=>e.innerWidth*t.camera.pixelRatio)),T.code.add(O["b"]`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),T.code.add(O["b"]`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(T.uniforms.add(new g["a"]("falloff",e=>e.falloff)),T.code.add(O["b"]`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),T.code.add(O["b"]`
    if (finalColor.a < ${O["b"].float(d["b"])}) {
      discard;
    }

    ${e.output===n["a"].Alpha?O["b"]`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===n["a"].Color?O["b"]`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===n["a"].Color&&e.transparencyPassType===_["i"].Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===n["a"].Highlight?O["b"]`gl_FragColor = vec4(1.0);`:""}
    ${e.output===n["a"].Depth?O["b"]`outputDepth(linearDepth);`:""}
  }
  `),t}const T=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:x,build:S},Symbol.toStringTag,{value:"Module"}))},"9cc4":function(e,t,i){"use strict";function r(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function n(e,t){const i=e.length;for(let r=0;r<i;++r)s[0]=e[r],t[r]=s[0];return t}function a(e,t){const i=e.length;for(let r=0;r<i;++r)s[0]=e[r],s[1]=e[r]-s[0],t[r]=s[1];return t}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a}));const s=new Float32Array(2)},"9e77":function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r=i("b2b2"),n=i("d047"),a=i("58c2"),s=i("d8a4"),o=i("ea32"),c=i("1fe9"),l=i("3886"),h=i("6a3c"),d=i("5d7f");function u(e,t){e.extensions.add("GL_OES_standard_derivatives");const i=e.fragment;i.include(n["a"]),e.include(a["a"]),i.uniforms.add([new c["a"]("globalAlpha",e=>e.globalAlpha),new o["a"]("glowColor",e=>e.glowColor),new c["a"]("glowWidth",(e,t)=>e.glowWidth*t.camera.pixelRatio),new c["a"]("glowFalloff",e=>e.glowFalloff),new o["a"]("innerColor",e=>e.innerColor),new c["a"]("innerWidth",(e,t)=>e.innerWidth*t.camera.pixelRatio),new h["a"]("depthMap",(e,t)=>t.linearDepthTexture),new s["a"]("nearFar",(e,t)=>t.camera.nearFar),new d["a"]("frameColor")]),i.code.add(l["b"]`vec4 blendPremultiplied(vec4 source, vec4 dest) {
float oneMinusSourceAlpha = 1.0 - source.a;
return vec4(
source.rgb + dest.rgb * oneMinusSourceAlpha,
source.a + dest.a * oneMinusSourceAlpha
);
}`),i.code.add(l["b"]`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),i.code.add(l["b"]`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),i.code.add(l["b"]`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {
float depth = linearDepthFromTexture(depthMap, uv, nearFar);
if (-depth == nearFar[0]) {
return false;
}
pos = reconstructPosition(gl_FragCoord.xy, depth);
normal = normalize(cross(dFdx(pos), dFdy(pos)));
float ddepth = fwidth(depth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);
return true;
}`),t.contrastControlEnabled?(i.uniforms.add(new c["a"]("globalAlphaContrastBoost",e=>Object(r["k"])(e.globalAlphaContrastBoost)?e.globalAlphaContrastBoost:1)),i.code.add(l["b"]`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`)):i.code.add(l["b"]`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`)}},a05b:function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.Highlight=4]="Highlight",e[e.Draped=5]="Draped",e[e.Occlusion=6]="Occlusion",e[e.Alpha=7]="Alpha",e[e.COUNT=8]="COUNT"}(r||(r={}))},a1b1:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return o}));var r=i("38a4"),n=i("e431"),a=i("0b2d");function s(e,t,i){const r=Object(n["i"])(e,t)/Object(n["i"])(e,e);return Object(n["k"])(i,e,r)}function o(e,t){return Object(n["i"])(e,t)/Object(n["p"])(e)}function c(e,t){const i=Object(n["i"])(e,t)/(Object(n["p"])(e)*Object(n["p"])(t));return-Object(r["b"])(i)}function l(e,t,i){Object(n["r"])(h,e),Object(n["r"])(d,t);const a=Object(n["i"])(h,d),s=Object(r["b"])(a),o=Object(n["j"])(h,h,d);return Object(n["i"])(o,i)<0?2*Math.PI-s:s}const h=Object(a["f"])(),d=Object(a["f"])()},a222:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var r=i("b2b2"),n=i("3349"),a=i("02f1"),s=i("62ae"),o=i("52b2");class c extends s["a"]{constructor(e,t){super(e,"vec2",o["a"].Draw,(i,r,n)=>i.setUniform2fv(e,t(r,n)))}}class l extends s["a"]{constructor(e,t){super(e,"sampler2D",o["a"].Draw,(i,r,n)=>i.bindTexture(e,t(r,n)))}}function h(e,t,i){const s=[new l(e,t)];if(i){const i=e+"Size";s.push(new c(i,(e,i)=>{const s=t(e,i);return Object(r["k"])(s)?Object(n["a"])(d,s.descriptor.width,s.descriptor.height):a["b"]}))}return s}const d=Object(a["c"])()},a545:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return p}));i("e06a");var r=i("b2b2"),n=i("a29a"),a=i("f7eb"),s=i("04f0"),o=i("b139"),c=i("e431"),l=i("0b2d"),h=i("3a35"),d=i("4ae5");function u(e,t,i=null){return Object(r["k"])(i)?[e,t,i]:[e,t]}function p(e,t,i=null){return Object(r["k"])(i)?{x:e,y:t,z:i}:{x:e,y:t}}class b{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return Object(r["g"])(e.map(e=>this.mapToLocal(e)))}get doUnnormalization(){return!1}}class f extends b{constructor(e,t,i=null){super(t),this.defaultZ=i,this.transform=Object(a["b"])(),this.transformInv=Object(a["b"])(),this.transform=Object(a["a"])(e),Object(n["b"])(this.transformInv,this.transform)}makeMapPoint(e,t){return u(e,t,this.defaultZ)}mapToLocal(e){return p(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return u(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this.defaultZ)}}class g extends b{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=Object(l["f"])(),this.tangentFrameUpWS=Object(l["f"])(),this.tangentFrameRightWS=Object(l["f"])(),this.tangentFrameForwardWS=Object(l["f"])(),this.localFrameRightWS=Object(l["f"])(),this.localFrameUpWS=Object(l["f"])(),this.worldToLocalTransform=Object(o["b"])(),this.localToWorldTransform=Object(o["b"])(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,h["a"].X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,h["a"].Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,h["a"].Z,this.tangentFrameForwardWS);const r=Object(l["f"])();Object(c["k"])(r,this.tangentFrameForwardWS,Object(c["i"])(i,this.tangentFrameForwardWS)),Object(c["f"])(this.localFrameRightWS,i,r),Object(c["r"])(this.localFrameRightWS,this.localFrameRightWS),Object(c["j"])(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),Object(s["g"])(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),Object(s["c"])(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(e,t){return u(e,t,this.defaultZ)}mapToLocal(e){const t=Object(l["f"])();this.view.renderCoordsHelper.toRenderCoords(new d["a"]({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),Object(c["u"])(t,t,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return Object(r["k"])(i)?p(i.x/this.scale,i.y/this.scale):null}localToMap(e){const t=Object(l["f"])();this.view.renderCoordsHelper.toRenderCoords(new d["a"]({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),Object(c["u"])(t,t,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return Object(r["k"])(i)?u(i.x,i.y,this.defaultZ):null}}function O(e,t){if("2d"===e.type)return new f(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){const i=t.length>2?new d["a"]({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new d["a"]({x:t[0],y:t[1],spatialReference:e.spatialReference});return new g(e,i)}return null}},a6b6:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return l}));var r,n=i("a4ee"),a=i("a05b"),s=i("da35"),o=i("b7c2"),c=i("6d35");!function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"}(r||(r={}));class l extends c["a"]{constructor(){super(...arguments),this.output=a["a"].Color,this.capType=r.BUTT,this.transparencyPassType=o["i"].NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1}}Object(n["a"])([Object(s["b"])({count:a["a"].COUNT})],l.prototype,"output",void 0),Object(n["a"])([Object(s["b"])({count:r.COUNT})],l.prototype,"capType",void 0),Object(n["a"])([Object(s["b"])({count:o["i"].COUNT})],l.prototype,"transparencyPassType",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"occluder",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"hasSlicePlane",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"hasPolygonOffset",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"writeDepth",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"draped",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"stippleEnabled",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"stippleOffColorEnabled",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"stippleScaleWithLineWidth",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"stipplePreferContinuous",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"roundJoins",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"vvSize",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"vvColor",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"vvOpacity",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"falloffEnabled",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"innerColorEnabled",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"hasOccludees",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"hasMultipassTerrain",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"cullAboveGround",void 0),Object(n["a"])([Object(s["b"])()],l.prototype,"wireframe",void 0),Object(n["a"])([Object(s["b"])({constValue:!0})],l.prototype,"stippleRequiresClamp",void 0),Object(n["a"])([Object(s["b"])({constValue:!0})],l.prototype,"stippleRequiresStretchMeasure",void 0),Object(n["a"])([Object(s["b"])({constValue:!0})],l.prototype,"hasVvInstancing",void 0),Object(n["a"])([Object(s["b"])({constValue:!0})],l.prototype,"hasSliceTranslatedView",void 0)},a6c9:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return c}));i("c120");var r=i("661c"),n=i("1e2c"),a=i("d17d");const s=128,o=.5;function c(e,t=s,i=t*o,r=0){const c=l(e,t,i,r);return new n["a"](c,{mipmap:!1,wrap:{s:a["B"].CLAMP_TO_EDGE,t:a["B"].CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function l(e,t=s,i=t*o,r=0){switch(e){case"circle":default:return h(t,i);case"square":return d(t,i);case"cross":return p(t,i,r);case"x":return b(t,i,r);case"kite":return u(t,i);case"triangle":return f(t,i);case"arrow":return g(t,i)}}function h(e,t){const i=e/2-.5;return j(e,v(i,i,t/2))}function d(e,t){return O(e,t,!1)}function u(e,t){return O(e,t,!0)}function p(e,t,i=0){return m(e,t,!1,i)}function b(e,t,i=0){return m(e,t,!0,i)}function f(e,t){return j(e,_(e/2,t,t/2))}function g(e,t){const i=t,r=t/2,n=e/2,a=.8*i,s=v(n,(e-t)/2-a,Math.sqrt(a*a+r*r)),o=_(n,i,r);return j(e,(e,t)=>Math.max(o(e,t),-s(e,t)))}function O(e,t,i){return i&&(t/=Math.SQRT2),j(e,(r,n)=>{let a=r-.5*e+.25,s=.5*e-n-.75;if(i){const e=(a+s)/Math.SQRT2;s=(s-a)/Math.SQRT2,a=e}return Math.max(Math.abs(a),Math.abs(s))-.5*t})}function m(e,t,i,r=0){t-=r,i&&(t*=Math.SQRT2);const n=.5*t;return j(e,(t,a)=>{let s,o=t-.5*e,c=.5*e-a-1;if(i){const e=(o+c)/Math.SQRT2;c=(c-o)/Math.SQRT2,o=e}return o=Math.abs(o),c=Math.abs(c),s=o>c?o>n?Math.sqrt((o-n)*(o-n)+c*c):c:c>n?Math.sqrt(o*o+(c-n)*(c-n)):o,s-=r/2,s})}function v(e,t,i){return(r,n)=>{const a=r-e,s=n-t;return Math.sqrt(a*a+s*s)-i}}function _(e,t,i){const r=Math.sqrt(t*t+i*i);return(n,a)=>{const s=Math.abs(n-e)-i,o=a-e+t/2+.75,c=(t*s+i*o)/r,l=-o;return Math.max(c,l)}}function j(e,t){const i=new Uint8Array(4*e*e);for(let n=0;n<e;n++)for(let a=0;a<e;a++){const s=a+e*n;let o=t(a,n);o=o/e+.5,Object(r["a"])(o,i,4*s)}return i}},a7d7:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return p}));var r=i("47f8"),n=i("7cb4"),a=i("35f0"),s=i("ea32"),o=i("3886"),c=i("a222"),l=i("6a3c"),h=i("52b2"),d=i("e93d");Object(r["c"])(0,.6,.2);var u;!function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.COUNT=5]="COUNT"}(u||(u={}));d["b"];function p(e,t){const i=e.fragment,r=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===u.Normal&&r&&e.include(n["a"],t),t.pbrMode!==u.Schematic)if(t.pbrMode!==u.Disabled){if(t.pbrMode===u.Normal){i.code.add(o["b"]`vec3 mrr;
vec3 emission;
float occlusion;`);const e=t.supportsTextureAtlas,n=t.pbrTextureBindType;t.hasMetalnessAndRoughnessTexture&&(i.uniforms.add(n===h["a"].Pass?Object(l["b"])("texMetallicRoughness",e=>e.textureMetallicRoughness,e):Object(c["a"])("texMetallicRoughness",e=>e.textureMetallicRoughness,e)),i.code.add(o["b"]`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(i.uniforms.add(n===h["a"].Pass?Object(l["b"])("texEmission",e=>e.textureEmissive,e):Object(c["a"])("texEmission",e=>e.textureEmissive,e)),i.code.add(o["b"]`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(i.uniforms.add(n===h["a"].Pass?Object(l["b"])("texOcclusion",e=>e.textureOcclusion,e):Object(c["a"])("texOcclusion",e=>e.textureOcclusion,e)),i.code.add(o["b"]`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(o["b"]`float getBakedOcclusion() { return 1.0; }`),i.uniforms.add(n===h["a"].Pass?[new s["a"]("emissionFactor",e=>e.emissiveFactor),new s["a"]("mrrFactors",e=>e.mrrFactors)]:[new a["a"]("emissionFactor",e=>e.emissiveFactor),new a["a"]("mrrFactors",e=>e.mrrFactors)]),i.code.add(o["b"]`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${r?"vtc.uv = vuv0;":""}
      ${t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)}}else i.code.add(o["b"]`float getBakedOcclusion() { return 1.0; }`);else i.code.add(o["b"]`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}},a997:function(e,t,i){"use strict";i.d(t,"a",(function(){return _})),i.d(t,"b",(function(){return O})),i.d(t,"c",(function(){return g}));var r=i("38a4"),n=i("b2b2"),a=i("3349"),s=i("02f1"),o=i("9e77"),c=i("2aad"),l=i("d8a4"),h=i("666b"),d=i("db7b"),u=i("1fe9"),p=i("8a80"),b=i("3886"),f=i("690a");const g=Object(r["g"])(6);function O(e){const t=new f["a"];t.extensions.add("GL_OES_standard_derivatives"),t.include(c["a"]),t.include(o["a"],e);const i=t.fragment;return e.heightManifoldEnabled&&i.uniforms.add(new d["a"]("heightPlane")),e.pointDistanceEnabled&&i.uniforms.add(new d["a"]("pointDistanceSphere")),e.lineVerticalPlaneEnabled&&(i.uniforms.add(new d["a"]("lineVerticalPlane")),i.uniforms.add(new h["a"]("lineVerticalStart")),i.uniforms.add(new h["a"]("lineVerticalEnd"))),(e.heightManifoldEnabled||e.pointDistanceEnabled||e.lineVerticalPlaneEnabled)&&i.uniforms.add(new p["a"]("maxPixelDistance")),(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)&&i.code.add(b["b"]`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.pointDistanceEnabled&&i.code.add(b["b"]`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.intersectsLineEnabled&&(i.uniforms.add(new h["a"]("intersectsLineStart")),i.uniforms.add(new h["a"]("intersectsLineEnd")),i.uniforms.add(new h["a"]("intersectsLineDirection")),i.uniforms.add(new p["a"]("intersectsLineRadius")),i.uniforms.add(new u["a"]("perScreenPixelRatio",(e,t)=>t.camera.perScreenPixelRatio)),i.code.add(b["b"]`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`)),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&i.code.add(b["b"]`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),i.code.add(b["b"]`void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
vec4 color = vec4(0, 0, 0, 0);`),e.heightManifoldEnabled&&(i.uniforms.add(new l["a"]("angleCutoff",e=>m(e))),i.code.add(b["b"]`{
float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));
vec4 heightManifoldColor = laserlineProfile(planeDistancePixels(heightPlane, pos));
color = max(color, heightManifoldColor * heightManifoldAlpha);
}`)),e.pointDistanceEnabled&&(i.uniforms.add(new l["a"]("angleCutoff",e=>m(e))),i.code.add(b["b"]`{
float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);
}`)),e.lineVerticalPlaneEnabled&&(i.uniforms.add(new l["a"]("angleCutoff",e=>m(e))),i.code.add(b["b"]`{
if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}
}`)),e.intersectsLineEnabled&&(i.uniforms.add(new l["a"]("angleCutoff",e=>m(e))),i.code.add(b["b"]`{
if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}
}`)),i.code.add(b["b"]`gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);
}`),t}function m(e){const t=Object(n["k"])(e.angleCutoff)?e.angleCutoff:g;return Object(a["a"])(v,Math.cos(t),Math.cos(Math.max(0,t-Object(r["g"])(2))))}const v=Object(s["c"])(),_=Object.freeze(Object.defineProperty({__proto__:null,defaultAngleCutoff:g,build:O},Symbol.toStringTag,{value:"Module"}))},aa1e:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("62ae"),n=i("52b2");class a extends r["a"]{constructor(e,t){super(e,"mat3",n["a"].Pass,(i,r,n)=>i.setUniformMatrix3fv(e,t(r,n)))}}},adf1:function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var r=i("b2b2"),n=i("f2e0"),a=i("afe1"),s=i("e431"),o=i("0b2d"),c=i("0fc4"),l=i("8188"),h=i("b7c2"),d=i("0278"),u=i("f643"),p=i("5a22");const b={rootOrigin:null};var f=i("b7bd"),g=i("748f"),O=i("86ba");class m{constructor(e,t=125e4){this._originSR=e,this._gridSize=t,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+Object(n["a"])()}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){const t=b.rootOrigin;if(Object(r["k"])(t))return this._origins.set(this._rootOriginId,Object(u["a"])(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(e);const i=Object(u["a"])(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,i),i}const i=this._gridSize,n=Math.round(e[0]/i),a=Math.round(e[1]/i),o=Math.round(e[2]/i),c=`${n}/${a}/${o}`;let l=this._origins.get(c);const h=.5*i;if(Object(s["f"])(v,e,t.vec3),v[0]=Math.abs(v[0]),v[1]=Math.abs(v[1]),v[2]=Math.abs(v[2]),v[0]<h&&v[1]<h&&v[2]<h){if(l){const t=Math.max(...v);if(Object(s["f"])(v,e,l.vec3),v[0]=Math.abs(v[0]),v[1]=Math.abs(v[1]),v[2]=Math.abs(v[2]),Math.max(...v)<t)return l}return t}return l||(l=Object(u["a"])(n*i,a*i,o*i,c),this._origins.set(c,l)),l}_drawOriginBox(e,t=Object(c["g"])(1,1,0,1)){const i=window.view,r=i._stage,n=t.toString();if(!this._objects.has(n)){this._material=new O["a"]({width:2,color:t}),r.add(this._material);const e=new g["a"]({isPickable:!1}),i=new p["a"]({castShadow:!1});r.add(i),e.add(i),r.add(e),this._objects.set(n,i)}const s=this._objects.get(n),o=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],u=o.length,b=new Array(3*u),m=new Uint16Array(2*(u-1)),v=.5*this._gridSize;for(let a=0;a<u;a++)b[3*a+0]=e[0]+(1&o[a]?v:-v),b[3*a+1]=e[1]+(2&o[a]?v:-v),b[3*a+2]=e[2]+(4&o[a]?v:-v),a>0&&(m[2*a+0]=a-1,m[2*a+1]=a);Object(l["l"])(b,this._originSR,0,b,i.renderSpatialReference,0,u);const _=new d["a"]([[f["a"].POSITION,{size:3,data:b,exclusive:!0}]],[[f["a"].POSITION,m]],h["f"].Line);r.add(_),s.addGeometry(_,this._material,a["a"])}}const v=Object(o["f"])()},ae3c:function(e,t,i){"use strict";i.d(t,"a",(function(){return D})),i.d(t,"b",(function(){return N}));var r=i("a4ee"),n=i("8d60"),a=(i("c120"),i("ce6d")),s=i("9096"),o=i("c649"),c=i("b2b2"),l=i("59b2"),h=i("b50f"),d=(i("cea0"),i("d386")),u=i("ce0b"),p=(i("e06a"),i("7ffa")),b=i("8048"),f=i("b48e"),g=i("ea51"),O=i("32ed"),m=i("7f83"),v=i("a545"),_=i("57dc"),j=i("4ae5"),y=i("521c"),x=i("1219");function S(e,t){const i=new j["a"]({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function T(e,t){return new _["a"]({points:e,spatialReference:t})}function w(e,t,i){const r=new y["a"]({paths:e,spatialReference:t});return i&&Object(O["j"])(r),r}function M(e,t,i,r=!0){const n=Object(p["a"])(e);n.forEach(e=>{const t=e[0],i=e[e.length-1];Object(h["d"])(t,i)&&1!==e.length||e.push(e[0])});let a=new x["a"]({rings:n,spatialReference:t});return a.rings.forEach(e=>{Object(O["h"])(e,!1,!1)||e.reverse()}),i&&Object(O["j"])(a),r&&a.isSelfIntersecting&&Object(m["l"])(t)&&(a=Object(g["simplify"])(a)),a}function A(e,t,i){const r=t.mapToLocalMultiple(e),n=[],a={x:r[0].x,y:r[0].y},s={x:r[1].x,y:r[1].y},o=Math.round(s.x-a.x),l=Math.round(s.y-a.y),h=Math.max(Math.abs(o),Math.abs(l));if(i){const e={x:a.x+h,y:a.y+h},t={x:a.x-h,y:a.y-h};n.push(Object(v["b"])(e.x,t.y),Object(v["b"])(t.x,t.y),Object(v["b"])(t.x,e.y),Object(v["b"])(e.x,e.y))}else{const e={x:o>0?a.x+h:a.x-h,y:l>0?a.y+h:a.y-h};n.push(Object(v["b"])(a.x,a.y),Object(v["b"])(e.x,a.y),Object(v["b"])(e.x,e.y),Object(v["b"])(a.x,e.y))}return M([Object(c["g"])(n.map(e=>t.localToMap(e)))],t.spatialReference,t.doUnnormalization,!0)}function E(e,t,i){let r=t.mapToLocalMultiple(e);if(1===r.length){const e=48,t=r[0];r=[Object(v["b"])(t.x-e,t.y+e),Object(v["b"])(t.x+e,t.y-e),Object(v["b"])(t.x+e,t.y-e),Object(v["b"])(t.x-e,t.y+e)]}const n=[],a={x:r[0].x,y:r[0].y},s={x:r[1].x,y:r[1].y};if(i){const e=Math.round(s.x-a.x),t=Math.round(s.y-a.y);n.push(Object(v["b"])(a.x-e,a.y-t),Object(v["b"])(s.x,a.y-t),Object(v["b"])(s.x,s.y),Object(v["b"])(a.x-e,s.y))}else n.push(Object(v["b"])(a.x,a.y),Object(v["b"])(s.x,a.y),Object(v["b"])(s.x,s.y),Object(v["b"])(a.x,s.y));return M([Object(c["g"])(n.map(e=>t.localToMap(e)))],t.spatialReference,t.doUnnormalization,!0)}function R(e,t,i,r){const n=t.mapToLocalMultiple(e);let a=null,s=null;if(i)a=n[0],s=n[1];else{const e=n[0],t=n[1],i=Math.round(t.x-e.x),r=Math.round(t.y-e.y),o=Math.max(Math.abs(i),Math.abs(r));a=Object(v["b"])(i>0?e.x+o/2:e.x-o/2,r>0?e.y+o/2:e.y-o/2),s=Object(v["b"])(Math.abs(i)>Math.abs(r)?a.x-o/2:a.x,Math.abs(i)>Math.abs(r)?a.y:a.y-o/2)}const o=t.localToMap(a),l=t.localToMap(s);if(Object(c["j"])(o)||Object(c["j"])(l))return null;t.doUnnormalization&&Object(O["k"])([[o,l]],t.spatialReference);const h=S(o,t.spatialReference),d=S(l,t.spatialReference),u=Object(b["f"])(t.spatialReference);let p=0;if(Object(m["l"])(t.spatialReference))p=u*Object(g["distance"])(h,d,null);else{const e=a.x-s.x,t=a.y-s.y;p=u*Math.sqrt(e*e+t*t)*(r||1)}const _=new f["a"]({center:h,radius:p,radiusUnit:"meters",spatialReference:t.spatialReference});return M(_.rings,_.spatialReference,!1)}function P(e,t,i){const r=t.mapToLocalMultiple(e),n=r[0],a=r[1],s=Math.round(a.x-n.x),o=Math.round(a.y-n.y),l=Object(v["b"])(i?n.x:n.x+s/2,i?n.y:n.y+o/2),h=i?s:s/2,d=i?o:o/2,u=60,p=[],b=2*Math.PI/u;for(let c=0;c<u;c++){const e=Math.cos(c*b),t=Math.sin(c*b),i=Object(v["b"])(h*e+l.x,d*t+l.y);p.push(i)}return p.push(p[0]),M([Object(c["g"])(p.map(e=>t.localToMap(e)))],t.spatialReference,t.doUnnormalization,!1)}var C=i("4772");let D=class extends(Object(s["b"])(a["a"].EventedMixin(C["a"]))){constructor(e){super(e),this._graphic=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.mode=null,this.snappingManager=null,this.snapToScene=!1}initialize(){this.internalGraphicsLayer=new u["a"]({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation(),this.handles.add([this.drawOperation.on("vertex-add",e=>this.onVertexAdd(e)),this.drawOperation.on("vertex-remove",e=>this.onVertexRemove(e)),this.drawOperation.on("vertex-update",e=>this.onVertexUpdate(e)),this.drawOperation.on("cursor-update",e=>this.onCursorUpdate(e)),this.drawOperation.on("complete",e=>this.onComplete(e))]),this.finishToolCreation()}destroy(){this.drawOperation=Object(c["d"])(this.drawOperation),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=Object(c["d"])(this.internalGraphicsLayer),this._set("view",null)}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),Object(c["k"])(this._graphic)&&(this._graphic.symbol=e)}get updating(){var e,t;return null!=(e=null==(t=this.drawOperation)?void 0:t.updating)&&e}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_createGraphic(e){this._graphic=new n["a"]({...this.graphicProperties,geometry:e,symbol:this.graphicSymbol}),this.internalGraphicsLayer.add(this._graphic),this.handles.add(this.initializeGraphic(this._graphic)),this.notifyChange("graphic"),this.handles.add(Object(o["c"])(()=>{Object(c["k"])(this._graphic)&&(this.internalGraphicsLayer.remove(this._graphic),this._graphic=Object(c["d"])(this._graphic))}),I)}_destroyAllVisualisations(){this.handles.remove(L.outline),this.handles.remove(L.regularVertices),this.handles.remove(L.activeVertex),this.handles.remove(I)}_getCreateOperationGeometry(e={operationComplete:!1}){if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;const t=this.drawOperation.stagedVertex,i=this.drawOperation.committedVertices,r=i.slice();Object(c["k"])(t)&&r.push(this.drawOperation.coordinateHelper.pointToArray(t));const n=Object(c["k"])(t)?this.drawOperation.coordinateHelper.pointToArray(t):i.splice(-1)[0],a={regularVertices:null,activeVertex:null,full:null,outline:null},s=r.length,o=this.view.spatialReference,l="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":a.regularVertices=i,a.activeVertex=n,a.full=this.drawOperation.coordinateHelper.arrayToPoint(r[0]);break;case"multipoint":a.regularVertices=i,a.activeVertex=n,s>0&&(a.full=T(r,o));break;case"polyline":a.regularVertices=i,a.activeVertex=n,s>0&&(a.full=w([r],o,l));break;case"polygon":a.regularVertices=i,a.activeVertex=n,s>0&&(a.full=M([r],o,l,!0));break;case"circle":if(s>0){const t=Object(v["a"])(this.view,r[0]);if(1===s&&e.operationComplete){const e=r[0],i=t.makeMapPoint(e[0]+z*this.view.resolution,e[1]);a.full=R([e,i],t,!0)}else 2===s&&(a.full=this.forceUniformSize?R(r,t,this.centered):P(r,t,this.centered))}break;case"rectangle":if(s>0){const t=Object(v["a"])(this.view,r[0]);if(1===s&&e.operationComplete){const e=r[0],i=t.makeMapPoint(e[0]+z*this.view.resolution,e[1]);a.full=A([e,i],t,!0)}else 2===s&&(a.full=this.forceUniformSize?A(r,t,this.centered):E(r,t,this.centered))}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":case"polygon":s>1&&(a.outline=w([r],o,l));break;case"circle":case"rectangle":Object(c["k"])(a.full)&&"polygon"===a.full.type&&(a.outline=M(a.full.rings,o,l))}return a}initializeGraphic(e){return null}onComplete(e){this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateOperationGeometry({operationComplete:!0});Object(c["k"])(e)&&(Object(c["j"])(this._graphic)?this._createGraphic(e.full):this._graphic.geometry=e.full,t=Object(c["r"])(this._graphic).clone())}this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(e){this._updateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();Object(c["j"])(e)?this._destroyAllVisualisations():(Object(c["k"])(e.outline)?this.handles.add(this.onOutlineChanged(e.outline),L.outline):this.handles.remove(L.outline),Object(c["k"])(e.regularVertices)?this.handles.add(this.onRegularVerticesChanged(e.regularVertices),L.regularVertices):this.handles.remove(L.regularVertices),Object(c["k"])(e.activeVertex)?this.handles.add(this.onActiveVertexChanged(e.activeVertex),L.activeVertex):this.handles.remove(L.activeVertex),Object(c["k"])(e.full)?Object(c["j"])(this._graphic)?this._createGraphic(e.full):this._graphic.geometry=e.full:this.handles.remove(I))}};Object(r["a"])([Object(l["b"])({value:!0})],D.prototype,"centered",null),Object(r["a"])([Object(l["b"])({nonNullable:!0})],D.prototype,"defaultZ",void 0),Object(r["a"])([Object(l["b"])()],D.prototype,"drawOperation",void 0),Object(r["a"])([Object(l["b"])({value:!0})],D.prototype,"enabled",null),Object(r["a"])([Object(l["b"])({value:!0})],D.prototype,"forceUniformSize",null),Object(r["a"])([Object(l["b"])({constructOnly:!0})],D.prototype,"geometryType",void 0),Object(r["a"])([Object(l["b"])()],D.prototype,"graphic",null),Object(r["a"])([Object(l["b"])({constructOnly:!0})],D.prototype,"graphicProperties",void 0),Object(r["a"])([Object(l["b"])()],D.prototype,"graphicSymbol",null),Object(r["a"])([Object(l["b"])({constructOnly:!0})],D.prototype,"hasZ",void 0),Object(r["a"])([Object(l["b"])({constructOnly:!0})],D.prototype,"mode",void 0),Object(r["a"])([Object(l["b"])()],D.prototype,"snappingManager",void 0),Object(r["a"])([Object(l["b"])()],D.prototype,"snapToScene",void 0),Object(r["a"])([Object(l["b"])({readOnly:!0})],D.prototype,"type",void 0),Object(r["a"])([Object(l["b"])({readOnly:!0})],D.prototype,"updating",null),Object(r["a"])([Object(l["b"])({constructOnly:!0,nonNullable:!0})],D.prototype,"view",void 0),D=Object(r["a"])([Object(d["a"])("esri.views.draw.DrawGraphicTool")],D);const I="create-operation-graphic",L={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function N(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";default:return null}}const z=48},afe1:function(e,t,i){"use strict";function r(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function a(e,t,i,r,n,a,s,o,c,l,h,d,u,p,b,f){return[e,t,i,r,n,a,s,o,c,l,h,d,u,p,b,f]}function s(e,t){return new Float64Array(e,t,16)}i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return r})),i.d(t,"e",(function(){return a}));const o=r();Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:n,fromValues:a,createView:s,IDENTITY:o},Symbol.toStringTag,{value:"Module"}))},b04d:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return l}));var r=i("8e97"),n=i("fd48"),a=i("1fe9"),s=i("3886"),o=i("690a"),c=i("b7bd");function l(e){const t=new o["a"];return t.extensions.add("GL_OES_standard_derivatives"),Object(r["b"])(t,e),t.attributes.add(c["a"].POSITION,"vec3"),t.attributes.add(c["a"].UV0,"vec2"),t.varyings.add("vUV","vec2"),t.vertex.code.add(s["b"]`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),t.fragment.uniforms.add([new n["a"]("backgroundColor",e=>e.backgroundColor),new n["a"]("gridColor",e=>e.gridColor),new a["a"]("gridWidth",e=>e.gridWidth)]),t.fragment.code.add(s["b"]`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),t}const h=Object.freeze(Object.defineProperty({__proto__:null,build:l},Symbol.toStringTag,{value:"Module"}))},b061:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c}));var r=i("b2b2"),n=i("a05b"),a=i("b7c2"),s=i("614d");class o{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}destroy(){this._map.forEach((e,t)=>{Object(r["k"])(e)&&this._repository.release(this._material,c(t))})}load(e,t){this._map.has(t)||this._map.set(t,this._repository.acquire(this._material,c(t)));const i=this._map.get(t);if(Object(r["k"])(i)){if(i.ensureResources(e)===a["g"].LOADED)return i;this._repository.requestRender()}return null}}function c(e){switch(e){case s["a"].MATERIAL:return n["a"].Color;case s["a"].MATERIAL_ALPHA:return n["a"].Alpha;case s["a"].MATERIAL_DEPTH:return n["a"].Depth;case s["a"].MATERIAL_NORMAL:return n["a"].Normal;case s["a"].MATERIAL_DEPTH_SHADOWMAP_ALL:return n["a"].Shadow;case s["a"].MATERIAL_HIGHLIGHT:return n["a"].Highlight;case s["a"].MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case s["a"].MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return n["a"].Shadow}}},b09a:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("3886"),n=i("b7bd");function a(e){e.attributes.add(n["a"].POSITION,"vec3"),e.vertex.code.add(r["b"]`vec3 positionModel() { return position; }`)}},b139:function(e,t,i){"use strict";function r(){return[0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3]]}function a(e,t,i,r){return[e,t,i,r]}function s(e,t){return new Float64Array(e,t,4)}i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return s}));const o=r();Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:n,fromValues:a,createView:s,IDENTITY:o},Symbol.toStringTag,{value:"Module"}))},b4a5:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return E})),i.d(t,"c",(function(){return R})),i.d(t,"d",(function(){return P})),i.d(t,"e",(function(){return x})),i.d(t,"f",(function(){return T})),i.d(t,"g",(function(){return S})),i.d(t,"h",(function(){return v})),i.d(t,"i",(function(){return _})),i.d(t,"j",(function(){return M}));var r,n=i("b2b2"),a=i("a915"),s=i("e431"),o=i("0b2d"),c=i("8188"),l=i("7289"),h=i("d18f"),d=i("a1b1"),u=i("7361"),p=i("f408"),b=i("9990"),f=i("9250"),g=i("1942"),O=i("89bf"),m=i("c20d");function v(e,t){return j(e,()=>t)}function _(e){return j(e,e=>e.plane)}function j(e,t){const i=Object(o["f"])(),r=Object(o["f"])();let s=!1;return o=>{const c=t(o);if("start"===o.action){const t=Object(a["i"])(o.screenStart,Object(a["c"])(u["c"].get())),r=Object(b["b"])(e.state.camera,t,I);Object(n["k"])(r)&&(s=Object(l["m"])(c,r,i))}if(!s)return null;const h=Object(a["i"])(o.screenEnd,Object(a["c"])(u["c"].get())),d=Object(b["b"])(e.state.camera,h,I);return Object(n["j"])(d)?null:Object(l["m"])(c,d,r)?{...o,renderStart:i,renderEnd:r,plane:c,ray:d}:null}}function y(e,t,i,r=null,s=null){let o=null;return l=>{if("start"===l.action&&(o=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(a["f"])(l.screenStart.x,l.screenStart.y),t,i,s),Object(n["k"])(o)&&Object(n["k"])(r)&&!Object(c["o"])(o,o,r)))return null;if(Object(n["j"])(o))return null;const h=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(a["f"])(l.screenEnd.x,l.screenEnd.y),t,i,s);return Object(n["k"])(h)?Object(n["k"])(r)&&!Object(c["o"])(h,h,r)?null:{...l,mapStart:o,mapEnd:h}:null}}function x(e,t,i,r=null,n=null){return y(e,i,Object(p["g"])(t,e,i),r,n)}function S(e,t,i,r=null,n=null){return x(e,i,Object(p["e"])(t),r,n)}function T(e,t,i,r){const a=t.toMap(e.screenStart,{include:[i]});return Object(n["k"])(a)?S(t,i,a,r):null}function w(e,t){const i=C,r=D,n=Object(l["d"])();e.renderCoordsHelper.worldUpAtPosition(t,i);const a=Object(s["j"])(n,i,Object(s["f"])(r,t,e.state.camera.eye));return Object(s["j"])(a,a,i),Object(l["g"])(t,a,n)}function M(e,t,i){let r=null;const n=new m["a"];return n.next(v(e,w(e,t))).next(A(e,t)).next(E(e,i)).next(e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,r=e}),e=>(r=null,n.execute(e),r)}function A(e,t){const i=Object(o["f"])(),r=Object(s["p"])(t);e.renderCoordsHelper.worldUpAtPosition(t,i);const n=Object(o["f"])(),a=Object(o["f"])(),c=n=>(Object(s["f"])(n,n,t),Object(d["c"])(i,n,n),"global"===e.viewingMode&&Object(s["p"])(n)*Math.sign(Object(s["i"])(i,n))<.001-r&&Object(s["f"])(n,Object(s["k"])(n,i,.001),t),Object(s["e"])(n,n,t),n);return e=>(e.renderStart=c(Object(s["g"])(n,e.renderStart)),e.renderEnd=c(Object(s["g"])(a,e.renderEnd)),e)}function E(e,t){const i=e.renderCoordsHelper;return e=>{const r=i.fromRenderCoords(e.renderStart,t),a=i.fromRenderCoords(e.renderEnd,t);return Object(n["k"])(r)&&Object(n["k"])(a)?{...e,mapStart:r,mapEnd:a}:null}}function R(e){let t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":Object(n["k"])(t)&&(t.remove(),t=null)}return i}}function P(e,t=null){const i=Object(f["a"])(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=g["c"].MIN,i.options.hud=!1;const s=Object(a["f"])(),c={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},l=Object(o["f"])(),h=Object(n["s"])(t,e.spatialReference),d=t=>{e.map.ground&&e.map.ground.opacity<1?c.exclude.add(O["b"]):c.exclude.delete(O["b"]),e.sceneIntersectionHelper.intersectIntersectorScreen(Object(a["i"])(t,s),i,c);const n=i.results.min;let o;if(n.getIntersectionPoint(l))o=n.intersector===g["b"].TERRAIN?r.GROUND:r.OTHER;else{if(!i.results.ground.getIntersectionPoint(l))return null;o=r.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(l,h),surfaceType:o}};let u;return e=>{if("start"===e.action){const t=d(e.screenStart);u=Object(n["k"])(t)?t.location:null}if(Object(n["j"])(u))return null;const t=d(e.screenEnd);return Object(n["k"])(t)&&Object(n["k"])(t.location)?{...e,mapStart:u,mapEnd:t.location,surfaceType:t.surfaceType}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(r||(r={}));const C=Object(o["f"])(),D=Object(o["f"])(),I=Object(h["c"])()},b623:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return l}));var r=i("b2b2"),n=i("d791"),a=i("afe1"),s=i("1153"),o=i("9cc4");function c(e,t){return Object(r["j"])(e)&&(e=[]),e.push(t),e}function l(e,t){if(Object(r["j"])(e))return null;const i=e.filter(e=>e!==t);return 0===i.length?null:i}function h(e){return!!Object(r["k"])(e)&&!e.visible}function d(e,t,i){const a=e.origin.vec3;Object(s["j"])(f,-a[0],-a[1],-a[2]),Object(r["k"])(e.transformation)?Object(n["m"])(t,f,e.transformation):Object(n["c"])(t,f),i&&(Object(n["a"])(i,t),Object(n["t"])(i,i))}function u(e,t,i,r,n){p[0]=e.get(t,0),p[1]=e.get(t,1),p[2]=e.get(t,2),Object(o["a"])(p,b,3),i.set(n,0,b[0]),r.set(n,0,b[1]),i.set(n,1,b[2]),r.set(n,1,b[3]),i.set(n,2,b[4]),r.set(n,2,b[5])}const p=new Float64Array(3),b=new Float32Array(6),f=Object(a["d"])()},b63c:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("6706"),n=i("7dcb");class a extends n["a"]{constructor(e,t){super(t),this.point=e}equals(e){return e instanceof a&&Object(r["b"])(this.point,e.point)}}},b66e:function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return f})),i.d(t,"c",(function(){return b}));var r=i("b2b2"),n=i("f315"),a=i("8048"),s=i("9812"),o=i("e431"),c=i("0b2d"),l=i("8188"),h=i("7289"),d=i("579f"),u=i("7361"),p=i("d245");function b(e,t=m()){return g(e,t)}function f(e,t=m()){return g(e,t,!1)}function g(e,t,i=e.hasZ){const s=Object(p["a"])(e.spatialReference),b=Object(a["a"])(s);if(Object(r["j"])(b))return null;const f=(e,t)=>!(t.length<2)&&(Object(o["w"])(e,t[0],t[1],i&&t[2]||0),!0);let g=0;for(const r of e.rings){if(r.length<3)continue;const{positionsWorldCoords:i}=t;for(;i.length<r.length;)i.push(Object(c["f"])());const n=O;for(let t=0;t<3;t++){if(!f(n,r[t]))return null;if(!Object(l["w"])(n,e.spatialReference,i[t],s))return null}if(Object(o["o"])(i[0],i[1])||Object(o["o"])(i[0],i[2])||Object(o["o"])(i[1],i[2]))continue;const a=Object(h["f"])(i[0],i[1],i[2],Object(h["v"])()),p=Object(o["g"])(u["d"].get(),i[0]);for(let e=0;e<3;e++)Object(h["s"])(a,p,i[e],i[e]);for(let t=3;t<r.length;t++){if(!f(n,r[t]))return null;Object(l["w"])(n,e.spatialReference,i[t],s),Object(h["s"])(a,p,i[t],i[t])}const b=v(i);for(let e=0;e<b.length;e+=3)g+=Object(d["a"])(i[b[e]],i[b[e+1]],i[b[e+2]])}return Object(n["b"])(g,b)}const O=Object(c["f"])();function m(){return{positionsWorldCoords:[]}}function v(e){return Object(s["a"])(_(e),[],2)}function _(e){const t=new Float64Array(2*e.length);for(let i=0;i<e.length;++i){const r=e[i],n=2*i;t[n+0]=r[0],t[n+1]=r[1]}return t}},b7c2:function(e,t,i){"use strict";var r,n,a,s,o,c,l,h,d,u,p,b,f,g;i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return c})),i.d(t,"h",(function(){return l})),i.d(t,"i",(function(){return s})),i.d(t,"j",(function(){return h})),i.d(t,"k",(function(){return b})),function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"}(r||(r={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(n||(n={})),function(e){e[e.NONE=0]="NONE",e[e.SMAA=1]="SMAA"}(a||(a={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"}(s||(s={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(o||(o={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(c||(c={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(l||(l={})),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(h||(h={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(d||(d={})),function(e){e[e.Triangle=0]="Triangle",e[e.Point=1]="Point",e[e.Line=2]="Line"}(u||(u={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(p||(p={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(b||(b={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(f||(f={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(g||(g={}))},ba58:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return E})),i.d(t,"c",(function(){return T})),i.d(t,"d",(function(){return R})),i.d(t,"e",(function(){return y})),i.d(t,"f",(function(){return A})),i.d(t,"g",(function(){return S})),i.d(t,"h",(function(){return x})),i.d(t,"i",(function(){return M}));var r=i("b2b2"),n=i("d791"),a=i("afe1"),s=i("0b2d"),o=i("7577"),c=i("0fc4"),l=i("8188"),h=i("4261"),d=i("9180"),u=i("57e5"),p=i("32ed"),b=i("1a54"),f=i("d3cf"),g=i("b7bd");function O(e,t){if("point"===e.type)return j(e,t,!1);if(Object(f["d"])(e))switch(e.type){case"extent":return j(e.center,t,!1);case"polygon":return j(e.centroid,t,!1);case"polyline":return j(m(e),t,!0);case"mesh":return j(e.origin,t,!1)}else switch(e.type){case"extent":return j(v(e),t,!0);case"polygon":return j(_(e),t,!0);case"polyline":return j(m(e),t,!0)}}function m(e){const t=e.paths[0];if(!t||0===t.length)return null;const i=Object(p["g"])(t,Object(p["f"])(t)/2);return Object(b["g"])(i[0],i[1],i[2],e.spatialReference)}function v(e){const t=isFinite(e.zmin);return Object(b["g"])(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function _(e){const t=e.rings[0];if(!t||0===t.length)return null;const i=Object(u["c"])(e.rings,e.hasZ);return Object(b["g"])(i[0],i[1],i[2],e.spatialReference)}function j(e,t,i){const r=i?e:Object(f["a"])(e);return t&&e?Object(l["o"])(e,r,t)?r:null:r}function y(e,t,i,r=0){if(e){t||(t=Object(d["k"])());const n=e;let a=.5*n.width*(i-1),s=.5*n.height*(i-1);return n.width<1e-7*n.height?a+=s/20:n.height<1e-7*n.width&&(s+=a/20),Object(o["l"])(t,n.xmin-a-r,n.ymin-s-r,n.xmax+a+r,n.ymax+s+r),t}return null}function x(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute(g["a"].AUXPOS1);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[i]))}}function S(e,t){const i=Object(c["f"])(c["a"]);return Object(r["k"])(e)&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),Object(r["k"])(t)?i[3]=t:Object(r["k"])(e)&&e.length>3&&(i[3]=e[3]),i}function T(e=s["a"],t,i,n=1){const a=new Array(3);if(Object(r["j"])(t)||Object(r["j"])(i))a[0]=1,a[1]=1,a[2]=1;else{let r,n=0;for(let s=2;s>=0;s--){const o=e[s];let c;const l=null!=o,h=0===s&&!r&&!l,d=i[s];"symbol-value"===o||h?c=0!==d?t[s]/d:1:l&&"proportional"!==o&&isFinite(o)&&(c=0!==d?o/d:1),null!=c&&(a[s]=c,r=c,n=Math.max(n,Math.abs(c)))}for(let e=2;e>=0;e--)null==a[e]?a[e]=r:0===a[e]&&(a[e]=.001*n)}for(let r=2;r>=0;r--)a[r]/=n;return Object(s["g"])(a)}function w(e){return null!=e.isPrimitive}function M(e){return w(e)&&(e=[e.width,e.depth,e.height]),A(e)?null:"Symbol sizes may not be negative values"}function A(e){if(Array.isArray(e)){for(const t of e)if(!A(t))return!1;return!0}return null==e||e>=0}function E(e,t,i,r=Object(a["d"])()){const s=e||0,o=t||0,c=i||0;return 0!==s&&Object(n["g"])(r,r,-s/180*Math.PI),0!==o&&Object(n["r"])(r,r,o/180*Math.PI),0!==c&&Object(n["o"])(r,r,c/180*Math.PI),r}function R(e,t){return null!=t.minDemResolution?t.minDemResolution:Object(h["s"])(e)?t.minDemResolutionForPoints:.01*Object(h["t"])(e)}},badc:function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=12]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=14]="HUD_MATERIAL",e[e.LABEL_MATERIAL=15]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",e[e.DRAPED_WATER=19]="DRAPED_WATER",e[e.VOXEL=20]="VOXEL",e[e.MAX_SLOTS=21]="MAX_SLOTS"}(r||(r={}))},bc40:function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return O})),i.d(t,"c",(function(){return g}));var r=i("dae5"),n=i("afe1"),a=i("47f8"),s=i("0b2d"),o=i("b09a"),c=i("6a21"),l=i("35f0"),h=i("ea32"),d=i("3886"),u=i("037a"),p=i("aa1e"),b=i("85b3");function f(e,t){e.include(o["a"]);const i=e.vertex;i.include(c["a"],t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),i.uniforms.add([new h["a"]("transformWorldFromViewTH",e=>e.transformWorldFromViewTH),new h["a"]("transformWorldFromViewTL",e=>e.transformWorldFromViewTL),new p["a"]("transformViewFromCameraRelativeRS",e=>e.transformViewFromCameraRelativeRS),new b["a"]("transformProjFromView",e=>e.transformProjFromView),new u["a"]("transformWorldFromModelRS",e=>e.transformWorldFromModelRS),new l["a"]("transformWorldFromModelTH",e=>e.transformWorldFromModelTH),new l["a"]("transformWorldFromModelTL",e=>e.transformWorldFromModelTL)]),i.code.add(d["b"]`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(d["b"]`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?d["b"]`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:d["b"]`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new h["a"]("transformWorldFromViewTL",e=>e.transformWorldFromViewTL)),i.code.add(d["b"]`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(d["b"]`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class g extends d["a"]{constructor(){super(...arguments),this.transformWorldFromViewTH=Object(s["f"])(),this.transformWorldFromViewTL=Object(s["f"])(),this.transformViewFromCameraRelativeRS=Object(r["b"])(),this.transformProjFromView=Object(n["d"])()}}class O extends d["a"]{constructor(){super(...arguments),this.transformWorldFromModelRS=Object(r["b"])(),this.transformWorldFromModelTH=Object(a["b"])(),this.transformWorldFromModelTL=Object(a["b"])()}}},bd75:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("a05b"),n=i("bc40"),a=i("d8a4"),s=i("3886");function o(e,t){t.output===r["a"].Color&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(s["b"]`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):t.output===r["a"].Depth||t.output===r["a"].Shadow?(e.include(n["a"],t),e.varyings.add("linearDepth","float"),e.vertex.uniforms.add(new a["a"]("nearFar",(e,t)=>t.camera.nearFar)),e.vertex.code.add(s["b"]`void forwardLinearDepth() {
linearDepth = (-vPosition_view.z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):e.vertex.code.add(s["b"]`void forwardLinearDepth() {}`)}},bd7e:function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return O})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return d})),i.d(t,"h",(function(){return f})),i.d(t,"i",(function(){return b})),i.d(t,"j",(function(){return g}));var r=i("38a4"),n=i("2119"),a=i("e431"),s=i("0b2d"),o=i("7361");function c(e){return e?{origin:Object(s["d"])(e.origin),vector:Object(s["d"])(e.vector)}:{origin:Object(s["f"])(),vector:Object(s["f"])()}}function l(e,t){const i=j.get();return i.origin=e,i.vector=t,i}function h(e,t=c()){return d(e.origin,e.vector,t)}function d(e,t,i=c()){return Object(a["g"])(i.origin,e),Object(a["g"])(i.vector,t),i}function u(e,t,i=c()){return Object(a["g"])(i.origin,e),Object(a["f"])(i.vector,t,e),i}function p(e,t){const i=Object(a["f"])(o["d"].get(),t,e.origin),n=Object(a["i"])(e.vector,i),s=Object(a["i"])(e.vector,e.vector),c=Object(r["e"])(n/s,0,1),l=Object(a["f"])(o["d"].get(),Object(a["k"])(o["d"].get(),e.vector,c),i);return Object(a["i"])(l,l)}function b(e,t,i){return g(e,t,0,1,i)}function f(e,t,i){return Object(a["e"])(i,e.origin,Object(a["k"])(i,e.vector,t))}function g(e,t,i,n,s){const{vector:c,origin:l}=e,h=Object(a["f"])(o["d"].get(),t,l),d=Object(a["i"])(c,h)/Object(a["t"])(c);return Object(a["k"])(s,c,Object(r["e"])(d,i,n)),Object(a["e"])(s,s,e.origin)}function O(e,t){if(v(e,l(t.origin,t.direction),!1,_)){const{tA:t,pB:i,distance2:r}=_;if(t>=0&&t<=1)return r;if(t<0)return Object(a["h"])(e.origin,i);if(t>1)return Object(a["h"])(Object(a["e"])(o["d"].get(),e.origin,e.vector),i)}return null}function m(e,t,i){return!!v(e,t,!0,_)&&(Object(a["g"])(i,_.pA),!0)}function v(e,t,i,n){const s=1e-6,c=e.origin,l=Object(a["e"])(o["d"].get(),c,e.vector),h=t.origin,d=Object(a["e"])(o["d"].get(),h,t.vector),u=o["d"].get(),p=o["d"].get();if(u[0]=c[0]-h[0],u[1]=c[1]-h[1],u[2]=c[2]-h[2],p[0]=d[0]-h[0],p[1]=d[1]-h[1],p[2]=d[2]-h[2],Math.abs(p[0])<s&&Math.abs(p[1])<s&&Math.abs(p[2])<s)return!1;const b=o["d"].get();if(b[0]=l[0]-c[0],b[1]=l[1]-c[1],b[2]=l[2]-c[2],Math.abs(b[0])<s&&Math.abs(b[1])<s&&Math.abs(b[2])<s)return!1;const f=u[0]*p[0]+u[1]*p[1]+u[2]*p[2],g=p[0]*b[0]+p[1]*b[1]+p[2]*b[2],O=u[0]*b[0]+u[1]*b[1]+u[2]*b[2],m=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],v=(b[0]*b[0]+b[1]*b[1]+b[2]*b[2])*m-g*g;if(Math.abs(v)<s)return!1;let _=(f*g-O*m)/v,j=(f+g*_)/m;i&&(_=Object(r["e"])(_,0,1),j=Object(r["e"])(j,0,1));const y=o["d"].get(),x=o["d"].get();return y[0]=c[0]+_*b[0],y[1]=c[1]+_*b[1],y[2]=c[2]+_*b[2],x[0]=h[0]+j*p[0],x[1]=h[1]+j*p[1],x[2]=h[2]+j*p[2],n.tA=_,n.tB=j,n.pA=y,n.pB=x,n.distance2=Object(a["h"])(y,x),!0}const _={tA:0,tB:0,pA:Object(s["f"])(),pB:Object(s["f"])(),distance2:0},j=new n["a"](()=>({origin:null,vector:null}))},be24:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var r=i("ea32"),n=i("76a8"),a=i("955a"),s=i("3886"),o=i("aa1e"),c=i("b7bd"),l=i("02a0");function h(e,t){t.hasVvInstancing&&(t.vvSize||t.vvColor)&&e.attributes.add(c["a"].INSTANCEFEATUREATTRIBUTE,"vec4");const i=e.vertex;t.vvSize?(i.uniforms.add(new r["a"]("vvSizeMinSize",e=>e.vvSizeMinSize)),i.uniforms.add(new r["a"]("vvSizeMaxSize",e=>e.vvSizeMaxSize)),i.uniforms.add(new r["a"]("vvSizeOffset",e=>e.vvSizeOffset)),i.uniforms.add(new r["a"]("vvSizeFactor",e=>e.vvSizeFactor)),i.uniforms.add(new o["a"]("vvSymbolRotationMatrix",e=>e.vvSymbolRotationMatrix)),i.uniforms.add(new r["a"]("vvSymbolAnchor",e=>e.vvSymbolAnchor)),i.code.add(s["b"]`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(s["b"]`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?s["b"]`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(s["b"]`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(i.constants.add("vvColorNumber","int",l["b"]),t.hasVvInstancing&&i.uniforms.add([new a["a"]("vvColorValues",e=>e.vvColorValues,l["b"]),new n["a"]("vvColorColors",e=>e.vvColorColors,l["b"])]),i.code.add(s["b"]`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.hasVvInstancing?s["b"]`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):i.code.add(s["b"]`vec4 vvColor() { return vec4(1.0); }`)}},be4a:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return s}));var r=i("b2b2"),n=i("3170"),a=i("5dd2");function s(e,t){return h(n["g"],a["c"],n["f"],t,e)}function o(e,t,i,r){return h(n["b"],a["a"],n["d"],r,e,t,i)}function c(e,t,i){return h(n["e"],a["b"],n["e"],i,e,t)}function l(e,t,i,r){return h(n["d"],a["a"],n["d"],r,e,t,i)}function h(e,t,i,n,...a){if("on-the-ground"===n){const e=t.apply(void 0,a);return Object(r["k"])(e)?e:i.apply(void 0,a)}return e.apply(void 0,a)}},bea9:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("f2e0");class n{constructor(e){this.channel=e,this.id=Object(r["a"])()}}},c20d:function(e,t,i){"use strict";i.d(t,"a",(function(){return E})),i.d(t,"b",(function(){return w})),i.d(t,"c",(function(){return M})),i.d(t,"d",(function(){return b})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return A})),i.d(t,"g",(function(){return f})),i.d(t,"h",(function(){return j})),i.d(t,"i",(function(){return x})),i.d(t,"j",(function(){return T})),i.d(t,"k",(function(){return y})),i.d(t,"l",(function(){return _}));i("e06a"),i("c649");var r=i("7ffa"),n=i("38a4"),a=i("b2b2"),s=i("a915"),o=i("0b2d"),c=i("8188"),l=i("3c9c"),h=i("cdc1"),d=i("4ae5");function u(e,t){let i=null,r=null;return n=>{if("cancel"===n.action)return void(Object(a["k"])(r)&&(r.execute({action:"cancel"}),i=null,r=null));const s={action:n.action,screenStart:n.start,screenEnd:n.screenPoint};"start"===n.action&&Object(a["j"])(i)&&(i=new E,r=new E,t(e,i,r,n.pointerType,s)),Object(a["k"])(i)&&i.execute(s),"end"===n.action&&Object(a["k"])(i)&&(i=null,r=null)}}function p(e,t){return e.events.on("drag",u(e,t))}function b(e,t){const i=[e.x,e.y,e.z],r=t,n=[Math.cos(r),Math.sin(r)],a=Math.sqrt(n[0]*n[0]+n[1]*n[1]);if(0===a)return null;n[0]/=a,n[1]/=a;const s=e=>{const t=(e.x-i[0])*n[0]+(e.y-i[1])*n[1];e.x=i[0]+t*n[0],e.y=i[1]+t*n[1]};return e=>(s(e.mapStart),s(e.mapEnd),e)}function f(e,t){let i=null;return r=>{if("start"===r.action&&(i=O(e,r.mapStart.spatialReference,t)),Object(a["j"])(i))return null;const n=r.mapEnd.x-r.mapStart.x,s=r.mapEnd.y-r.mapStart.y,o=r.mapEnd.z-r.mapStart.z;return i.move(n,s,o),{...r,translationX:n,translationY:s,translationZ:o}}}function g(e,t){return Object(a["j"])(e)?null:e.spatialReference.equals(t)?e.clone():Object(c["j"])(e,t)}function O(e,t,i){const r=e.geometry;if(Object(a["j"])(r))return null;if("mesh"===r.type)return m(e,r,t,i);const n=g(r,t),s=r.spatialReference;return Object(a["j"])(n)?null:{move:(t,i,r)=>{const a=Object(h["d"])(n.clone(),t,i,r);a.spatialReference.equals(s)?e.geometry=a:e.geometry=Object(c["j"])(a,s)}}}function m(e,t,i,r){if(Object(a["k"])(t.transform))return v(e,t,t.transform,i);if(!t.spatialReference.equals(i))return null;let n=0,s=0,o=0;return{move:(i,a,c)=>{const h=i-n,u=a-s,p=c-o;if(h||u||p){const b=new d["a"](t.origin.x+h,t.origin.y+u,t.origin.z+p,t.origin.spatialReference);t.centerAt(b,{geographic:r===l["a"].Global}),e.notifyGeometryChanged(),n=i,s=a,o=c}}}}function v(e,t,i,r){const n=g(i.getOriginPoint(t.spatialReference),r),s=t.spatialReference;return Object(a["j"])(n)?null:{move:(t,r,l)=>{const d=Object(h["d"])(n.clone(),t,r,l);if(d.spatialReference.equals(s))i.origin=Object(o["h"])(d.x,d.y,d.z);else{const e=Object(c["j"])(d,s);Object(a["k"])(e)&&(i.origin=Object(o["h"])(e.x,e.y,e.z))}e.notifyMeshTransformChanged(),e.notifyGeometryChanged()}}}function _(e,t=null,i){let r=null;const n=Object(a["k"])(t)&&!e.spatialReference.equals(t)?e=>Object(a["k"])(e)?Object(c["j"])(e,t):e:e=>e,s={exclude:[],...i};return t=>{if("start"===t.action&&(r=n(e.toMap(t.screenStart,s))),Object(a["j"])(r))return null;const i=n(e.toMap(t.screenEnd,s));return Object(a["k"])(i)?{...t,mapStart:r,mapEnd:i}:null}}function j(e,t){const i=e.map(e=>Object(a["r"])(f(e,t))).filter(e=>Object(a["k"])(e));return e=>{const t=e.mapEnd.x-e.mapStart.x,r=e.mapEnd.y-e.mapStart.y,n=e.mapEnd.z-e.mapStart.z;return i.forEach(t=>t(e)),{...e,translationX:t,translationY:r,translationZ:n}}}function y(e,t){const i=new Map;for(const n of t)i.set(n,Object(r["a"])(e[n]));return t=>(i.forEach((t,i)=>{e[i]=t}),t)}function x(e){return Object(a["k"])(e.geometry)&&"mesh"===e.geometry.type?S(e,e.geometry):y(e,["geometry"])}function S(e,t){const i=Object(a["k"])(t.transform)?t.transform.clone():null,r=t.vertexAttributes.clonePositional();return n=>(t.transform=i,t.vertexAttributes=r,e.notifyGeometryChanged(),n)}function T(e){const t=e.map(e=>Object(a["r"])(x(e))).filter(e=>Object(a["k"])(e));return e=>(t.forEach(t=>t(e)),e)}function w(){let e=0,t=0,i=0;return r=>{"start"===r.action&&(e=r.mapStart.x,t=r.mapStart.y,i=r.mapStart.z);const n=r.mapEnd.x-e,a=r.mapEnd.y-t,s=r.mapEnd.z-i;return e=r.mapEnd.x,t=r.mapEnd.y,i=r.mapEnd.z,{...r,mapDeltaX:n,mapDeltaY:a,mapDeltaZ:s,mapDeltaSpatialReference:r.mapStart.spatialReference}}}function M(){let e=0,t=0;return i=>{"start"===i.action&&(e=i.screenStart.x,t=i.screenStart.y);const r=i.screenEnd.x-e,n=i.screenEnd.y-t;return e=i.screenEnd.x,t=i.screenEnd.y,{...i,screenDeltaX:r,screenDeltaY:n}}}function A(e,t){let i=null,r=0,a=0;return o=>{if("start"===o.action&&(i=e.toScreen(t),i.x<0||i.x>e.width||i.y<0||i.y>e.height?i=null:(r=o.screenStart.x-i.x,a=o.screenStart.y-i.y)),null==i)return null;const c=Object(n["e"])(o.screenEnd.x-r,0,e.width),l=Object(n["e"])(o.screenEnd.y-a,0,e.height),h=Object(s["e"])(c,l);return o.screenStart=i,o.screenEnd=h,o}}class E{constructor(){this.execute=()=>{}}next(e,t=new E){return Object(a["k"])(e)&&(this.execute=i=>{const r=e(i);Object(a["k"])(r)&&t.execute(r)}),t}}},c2d1:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("a05b"),n=i("501b"),a=i("3886");function s(e,t){e.fragment.include(n["a"]),t.output===r["a"].Shadow?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(a["b"]`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):t.output===r["a"].Depth&&e.fragment.code.add(a["b"]`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}},c332:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return a}));var r=i("3886");function n(e){const t=r["b"]`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.fragment.code.add(t),e.vertex.code.add(t)}var a,s=i("b7bd");function o(e,t){t.normalType===a.Attribute&&(e.attributes.add(s["a"].NORMAL,"vec3"),e.vertex.code.add(r["b"]`vec3 normalModel() {
return normal;
}`)),t.normalType===a.CompressedAttribute&&(e.include(n),e.attributes.add(s["a"].NORMALCOMPRESSED,"vec2"),e.vertex.code.add(r["b"]`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),t.normalType===a.ScreenDerivative&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(r["b"]`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}!function(e){e[e.Attribute=0]="Attribute",e[e.CompressedAttribute=1]="CompressedAttribute",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"}(a||(a={}))},c3a4:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(e,t){this._module=e,this._loadModule=t}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}},c51b:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){e.vertex.code.add(r["b"]`const float PI = 3.141592653589793;`),e.fragment.code.add(r["b"]`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}},c6d7:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return o}));var r=i("d047"),n=i("d8a4"),a=i("3886"),s=i("6a3c");function o(e,t){t.hasMultipassTerrain&&(e.fragment.include(r["a"]),e.fragment.uniforms.add(new s["a"]("terrainDepthTexture",(e,t)=>t.multipassTerrain.linearDepthTexture)),e.fragment.uniforms.add(new n["a"]("nearFar",(e,t)=>t.camera.nearFar)),e.fragment.uniforms.add(new n["a"]("inverseViewport",(e,t)=>t.inverseViewport)),e.fragment.code.add(a["b"]`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class c{constructor(){this.enabled=!1,this.cullAboveGround=!1}}},c6f7:function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var r=i("b2b2"),n=i("2698"),a=i("e041"),s=i("8eed"),o=i("7af8"),c=i("92ef"),l=i("59b2");function h(e){return p[d(e)]||f}function d(e){return e instanceof Blob?e.type:u(e.url)}function u(e){const t=Object(a["p"])(e);return g[t]||b}const p={},b="text/plain",f=p[b],g={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const E in g)p[g[E]]=E;var O=i("fcf2");function m(e){const t=Object(r["k"])(e)&&e.origins?e.origins:[void 0];return(i,r)=>{const n=v(e,i,r);for(const e of t){const t=Object(l["c"])(i,e,r);for(const e in n)t[e]=n[e]}}}function v(e,t,i){if(Object(r["k"])(e)&&"resource"===e.type)return _(e,t,i);switch(Object(r["k"])(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=O["e"];return{read:e,write:t}}}}function _(e,t,i){const s=Object(o["b"])(t,i);return{type:String,read:(e,t,i)=>{const r=Object(O["f"])(e,t,i);return s.type===String?r:"function"==typeof s.type?new s.type({url:r}):void 0},write:{writer(t,o,l,h){if(!h||!h.resources)return"string"==typeof t?void(o[l]=Object(O["g"])(t,h)):void(o[l]=t.write({},h));const d=M(t),u=d?Object(O["g"])(d,{...h,verifyItemRelativeUrls:h&&h.verifyItemRelativeUrls?{writtenUrls:h.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},O["a"].NO):null,p=s.type!==String&&(!Object(n["a"])(this)||h&&h.origin&&this.originIdOf(i)>Object(c["e"])(h.origin));h&&h.portalItem&&Object(r["k"])(u)&&!Object(a["u"])(u)?p?y(this,i,t,u,o,l,h,e):x(u,o,l,h):h&&h.portalItem&&(Object(r["j"])(u)||Object(r["k"])(Object(O["d"])(u))||Object(a["v"])(u)||p)?j(this,i,t,u,o,l,h,e):o[l]=u}}}}function j(e,t,i,n,o,c,l,d){const u=Object(s["a"])(),p=T(i,n,l),b=Object(a["B"])(Object(r["i"])(d,"prefix"),u),f=`${b}.${h(p)}`,g=l.portalItem.resourceFromPath(f);Object(a["v"])(n)&&l.resources.pendingOperations.push(w(n).then(e=>{g.path=`${b}.${h(e)}`,o[c]=g.itemRelativeUrl}).catch(()=>{})),S(e,t,g,p,l.resources.toAdd),o[c]=g.itemRelativeUrl}function y(e,t,i,r,n,s,o,c){const l=o.portalItem.resourceFromPath(r),d=T(i,r,o);h(d)===Object(a["p"])(l.path)?(S(e,t,l,d,o.resources.toUpdate),n[s]=r):j(e,t,i,r,n,s,o,c)}function x(e,t,i,r){r.resources.toKeep.push({resource:r.portalItem.resourceFromPath(e)}),t[i]=e}function S(e,t,i,r,n){n.push({resource:i,content:r,finish:i=>{A(e,t,i)}})}function T(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}async function w(e){const t=(await Promise.resolve().then(i.bind(null,"2eab"))).default,{data:r}=await t(e,{responseType:"blob"});return r}function M(e){return Object(r["j"])(e)?null:"string"==typeof e?e:e.url}function A(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}},c76b:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("ea32"),n=i("1fe9"),a=i("3886");function s(e,t){const i=e.fragment;t.isGround?i.uniforms.add(new n["a"]("lightingFixedFactor",(e,t)=>(1-t.lighting.groundLightingFactor)*(1-t.lighting.globalFactor))):i.constants.add("lightingFixedFactor","float",0),i.uniforms.add([new r["a"]("lightingMainDirection",(e,t)=>t.lighting.lightingMainDirection),new r["a"]("lightingMainIntensity",(e,t)=>t.lighting.mainLight.intensity)]),i.code.add(a["b"]`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}},c829:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("b2b2"),n=i("8a44"),a=i("52b2"),s=i("1956");class o{constructor(e,t,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new n["a"]({deallocator:null}),this._glProgram=e.programCache.acquire(t.generate("vertex"),t.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=t.generateBind(a["a"].Pass,this),this.bindDraw=t.generateBind(a["a"].Draw,this),this._fragmentUniforms=Object(s["b"])()?t.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(e,t){this._glProgram.setUniform1i(e,t?1:0)}setUniform1i(e,t){this._glProgram.setUniform1i(e,t)}setUniform1f(e,t){this._glProgram.setUniform1f(e,t)}setUniform2f(e,t,i){this._glProgram.setUniform2f(e,t,i)}setUniform2fv(e,t){this._glProgram.setUniform2fv(e,t)}setUniform3f(e,t,i,r){this._glProgram.setUniform3f(e,t,i,r)}setUniform3fv(e,t){this._glProgram.setUniform3fv(e,t)}setUniform4f(e,t,i,r,n){this._glProgram.setUniform4f(e,t,i,r,n)}setUniform4fv(e,t){this._glProgram.setUniform4fv(e,t)}setUniformMatrix3fv(e,t){this._glProgram.setUniformMatrix3fv(e,t)}setUniformMatrix4fv(e,t){this._glProgram.setUniformMatrix4fv(e,t)}setUniform1fv(e,t){this._glProgram.setUniform1fv(e,t)}setUniform1iv(e,t){this._glProgram.setUniform1iv(e,t)}setUniform2iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform3iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform4iv(e,t){this._glProgram.setUniform4iv(e,t)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,t){if(Object(r["j"])(t)||null==t.glName){const t=this._textures.get(e);return t&&(this._context.bindTexture(null,t.unit),this._freeTextureUnit(t),this._textures.delete(e)),null}let i=this._textures.get(e);return null==i?(i=this._allocTextureUnit(t),this._textures.set(e,i)):i.texture=t,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(t,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)}),Object(r["k"])(this._fragmentUniforms)&&this._fragmentUniforms.forEach(e=>{"sampler2D"!==e.type&&"samplerCube"!==e.type||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}}},ca98:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("b2b2"),n=i("d17d");class a{constructor(e,t,i){this.release=i,t&&(this.initializeConfiguration(e,t),this._configuration=t.snapshot()),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=Object(r["e"])(this._program),this._pipeline=this._configuration=null}reload(e){Object(r["e"])(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.isCompiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPass(e,t){this.program.bindPass(e,t)}bindDraw(e,t){this.program.bindDraw(e,t),this.program.rebindTextures()}bindPipelineState(e,t=null,i){e.setPipelineState(this.getPipelineState(t,i))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return n["r"].TRIANGLES}getPipelineState(e,t){return this._pipeline}initializeConfiguration(e,t){}}},caf7:function(e,t,i){"use strict";i.d(t,"a",(function(){return j}));var r,n=i("e431"),a=i("47f8"),s=i("0b2d"),o=i("7289"),c=i("d18f"),l=i("b7c2");!function(e){function t(e,t){const i=e[t],r=e[t+1],n=e[t+2];return Math.sqrt(i*i+r*r+n*n)}function i(e,t){const i=e[t],r=e[t+1],n=e[t+2],a=1/Math.sqrt(i*i+r*r+n*n);e[t]*=a,e[t+1]*=a,e[t+2]*=a}function r(e,t,i){e[t]*=i,e[t+1]*=i,e[t+2]*=i}function n(e,t,i,r,n,a=t){(n=n||e)[a]=e[t]+i[r],n[a+1]=e[t+1]+i[r+1],n[a+2]=e[t+2]+i[r+2]}function a(e,t,i,r,n,a=t){(n=n||e)[a]=e[t]-i[r],n[a+1]=e[t+1]-i[r+1],n[a+2]=e[t+2]-i[r+2]}e.length=t,e.normalize=i,e.scale=r,e.add=n,e.subtract=a}(r||(r={}));var h=i("0278"),d=i("1038"),u=i("1153"),p=i("b7bd");const b=r;var f,g,O,m;!function(e){const t=.5,i=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],n=[0,0,1,0,1,1,0,1],a=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),s=new Uint16Array(36);for(let l=0;l<6;l++)for(let e=0;e<6;e++)s[6*l+e]=l;const o=new Uint16Array(36);for(let l=0;l<6;l++)o[6*l+0]=0,o[6*l+1]=1,o[6*l+2]=2,o[6*l+3]=2,o[6*l+4]=3,o[6*l+5]=0;function c(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(24);for(let r=0;r<8;r++)t[3*r]=i[r][0]*e[0],t[3*r+1]=i[r][1]*e[1],t[3*r+2]=i[r][2]*e[2];return new h["a"]([[p["a"].POSITION,{size:3,data:t,exclusive:!0}],[p["a"].NORMAL,{size:3,data:r}],[p["a"].UV0,{size:2,data:n}]],[[p["a"].POSITION,a],[p["a"].NORMAL,s],[p["a"].UV0,o]])}e.createGeometry=c}(f||(f={})),function(e){const t=.5,i=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],n=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),a=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function s(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(18);for(let r=0;r<6;r++)t[3*r]=i[r][0]*e[0],t[3*r+1]=i[r][1]*e[1],t[3*r+2]=i[r][2]*e[2];return new h["a"]([[p["a"].POSITION,{size:3,data:t,exclusive:!0}],[p["a"].NORMAL,{size:3,data:r}]],[[p["a"].POSITION,n],[p["a"].NORMAL,a]])}e.createGeometry=s}(g||(g={})),function(e){const t=.5,i=0,r=Object(a["c"])(-t,i,-t),s=Object(a["c"])(t,i,-t),o=Object(a["c"])(0,i,t),c=Object(a["c"])(0,i+t,0),l=Object(a["b"])(),d=Object(a["b"])(),u=Object(a["b"])(),b=Object(a["b"])(),f=Object(a["b"])();Object(n["f"])(l,r,c),Object(n["f"])(d,r,s),Object(n["j"])(u,l,d),Object(n["r"])(u,u),Object(n["f"])(l,s,c),Object(n["f"])(d,s,o),Object(n["j"])(b,l,d),Object(n["r"])(b,b),Object(n["f"])(l,o,c),Object(n["f"])(d,o,r),Object(n["j"])(f,l,d),Object(n["r"])(f,f);const g=[r,s,o,c],O=[0,-1,0,u[0],u[1],u[2],b[0],b[1],b[2],f[0],f[1],f[2]],m=[0,1,2,3,1,0,3,2,1,3,0,2],v=[0,0,0,1,1,1,2,2,2,3,3,3];function _(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(12);for(let i=0;i<4;i++)t[3*i]=g[i][0]*e[0],t[3*i+1]=g[i][1]*e[1],t[3*i+2]=g[i][2]*e[2];return new h["a"]([[p["a"].POSITION,{size:3,data:t,exclusive:!0}],[p["a"].NORMAL,{size:3,data:O}]],[[p["a"].POSITION,new Uint16Array(m)],[p["a"].NORMAL,new Uint16Array(v)]])}e.createGeometry=_}(O||(O={})),function(e){function t(e,t,i,r={uv:!0}){const n=-Math.PI,a=2*Math.PI,s=-Math.PI/2,o=Math.PI,c=Math.max(3,Math.floor(t)),l=Math.max(2,Math.floor(i)),d=(c+1)*(l+1),u=new Float32Array(3*d),b=new Float32Array(3*d),f=new Float32Array(2*d),g=[];let O=0;for(let h=0;h<=l;h++){const t=[],i=h/l,r=s+i*o,d=Math.cos(r);for(let s=0;s<=c;s++){const o=s/c,l=n+o*a,h=Math.cos(l)*d,p=Math.sin(r),g=-Math.sin(l)*d;u[3*O]=h*e,u[3*O+1]=p*e,u[3*O+2]=g*e,b[3*O]=h,b[3*O+1]=p,b[3*O+2]=g,f[2*O]=o,f[2*O+1]=i,t.push(O),++O}g.push(t)}const m=new Uint32Array(2*c*(l-1)*3);O=0;for(let h=0;h<l;h++)for(let e=0;e<c;e++){const t=g[h][e],i=g[h][e+1],r=g[h+1][e+1],n=g[h+1][e];0===h?(m[O++]=t,m[O++]=r,m[O++]=n):h===l-1?(m[O++]=t,m[O++]=i,m[O++]=r):(m[O++]=t,m[O++]=i,m[O++]=r,m[O++]=r,m[O++]=n,m[O++]=t)}const v=[[p["a"].POSITION,m],[p["a"].NORMAL,m]],_=[[p["a"].POSITION,{size:3,data:u,exclusive:!0}],[p["a"].NORMAL,{size:3,data:b,exclusive:!0}]];return r.uv&&(_.push([p["a"].UV0,{size:2,data:f,exclusive:!0}]),v.push([p["a"].UV0,m])),r.offset&&(v[0][0]=p["a"].OFFSET,_[0][0]=p["a"].OFFSET,v.push([p["a"].POSITION,new Uint32Array(m.length)]),_.push([p["a"].POSITION,{size:3,data:Float64Array.from(r.offset),exclusive:!0}])),new h["a"](_,v)}function i(e,t,i){const r=e;let n,a;if(i)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],a=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const e=r*(1+Math.sqrt(5))/2;n=[-r,e,0,r,e,0,-r,-e,0,r,-e,0,0,-r,e,0,r,e,0,-r,-e,0,r,-e,e,0,-r,e,0,r,-e,0,-r,-e,0,r],a=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let h=0;h<n.length;h+=3)b.scale(n,h,e/b.length(n,h));let s={};function o(t,i){t>i&&([t,i]=[i,t]);const r=t.toString()+"."+i.toString();if(s[r])return s[r];let a=n.length;return n.length+=3,b.add(n,3*t,n,3*i,n,a),b.scale(n,a,e/b.length(n,a)),a/=3,s[r]=a,a}for(let h=0;h<t;h++){const e=a.length,t=new Uint32Array(4*e);for(let i=0;i<e;i+=3){const e=a[i],r=a[i+1],n=a[i+2],s=o(e,r),c=o(r,n),l=o(n,e),h=4*i;t[h]=e,t[h+1]=s,t[h+2]=l,t[h+3]=r,t[h+4]=c,t[h+5]=s,t[h+6]=n,t[h+7]=l,t[h+8]=c,t[h+9]=s,t[h+10]=c,t[h+11]=l}a=t,s={}}const c=new Float32Array(n);for(let h=0;h<c.length;h+=3)b.normalize(c,h);const l=[[p["a"].POSITION,a],[p["a"].NORMAL,a]],d=[[p["a"].POSITION,{size:3,data:new Float32Array(n),exclusive:!0}],[p["a"].NORMAL,{size:3,data:c,exclusive:!0}]];return new h["a"](d,l)}function r(e,t,i,r,n,a,s){const o=t?[t[0],t[1],t[2]]:[0,0,0],c=e?[e[0],e[1],e[2]]:[0,0,1];a=a||[0,0];const d=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],u=null!=r&&2===r.length?r:[1,1],b=[[p["a"].POSITION,{size:3,data:o,exclusive:!0}],[p["a"].NORMAL,{size:3,data:c,exclusive:!0}],[p["a"].UV0,{size:a.length,data:a}],[p["a"].COLOR,{size:4,data:d,exclusive:!0}],[p["a"].SIZE,{size:2,data:u}]];if(null!=n){const e=new Float32Array([n[0],n[1],n[2],n[3]]);b.push([p["a"].AUXPOS1,{size:4,data:e}])}if(null!=s){const e=new Float32Array([s[0],s[1],s[2],s[3]]);b.push([p["a"].AUXPOS2,{size:4,data:e}])}return new h["a"](b,null,l["f"].Point)}function m(e,t,i,r,n,a,s,o){if(null!=e){const{data:t}=o.getMutableAttribute(p["a"].NORMAL);t[0]=e[0],t[1]=e[1],t[2]=e[2]}if(null!=t){const{data:e}=o.getMutableAttribute(p["a"].POSITION);e[0]=t[0],e[1]=t[1],e[2]=t[2]}if(null!=i){const{data:e}=o.getMutableAttribute(p["a"].COLOR);e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3]}if(null!=r){const{data:e}=o.getMutableAttribute(p["a"].SIZE);e[0]=r[0],e[1]=r[1]}if(null!=n){const{data:e}=o.getMutableAttribute(p["a"].AUXPOS1);e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3]}if(null!=a){const{data:e}=o.getMutableAttribute(p["a"].UV0);e[0]=a[0],e[1]=a[1]}if(null!=s){const{data:e}=o.getMutableAttribute(p["a"].AUXPOS2);e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3]}}function j(e,t){const i=new Float32Array(3*e.length),r=new Float32Array(t?3*e.length:3),n=new Uint32Array(e.length),a=new Uint32Array(e.length);for(let l=0;l<e.length;l++)i[3*l]=e[l][0],i[3*l+1]=e[l][1],i[3*l+2]=e[l][2],t&&(r[3*l]=t[l][0],r[3*l+1]=t[l][1],r[3*l+2]=t[l][2]),n[l]=l,a[l]=0;t||(r[0]=0,r[1]=1,r[2]=0);const s=[0,0],o=[[p["a"].POSITION,n],[p["a"].NORMAL,t?n:a],[p["a"].UV0,a]],c=[[p["a"].POSITION,{size:3,data:i,exclusive:!0}],[p["a"].NORMAL,{size:3,data:r,exclusive:!0}],[p["a"].UV0,{size:2,data:s,exclusive:!0}]];return new h["a"](c,o,l["f"].Point)}function y(){const e=[0,0,0,0,0,100,100,0,0],t=new Uint16Array([0,1,2]),i=[0,1,0],r=new Uint16Array([0,0,0]),n=[0,0],a=new Uint16Array([0,0,0]),s=[[p["a"].POSITION,t],[p["a"].NORMAL,r],[p["a"].UV0,a]],o=[[p["a"].POSITION,{size:3,data:e,exclusive:!0}],[p["a"].NORMAL,{size:3,data:i,exclusive:!0}],[p["a"].UV0,{size:2,data:n,exclusive:!0}]];return new h["a"](o,s)}e.createBoxGeometry=f.createGeometry,e.createDiamondGeometry=g.createGeometry,e.createTetrahedronGeometry=O.createGeometry,e.createSphereGeometry=t,e.createPolySphereGeometry=i,e.createPointGeometry=r,e.updatePointGeometry=m,e.createPointArrayGeometry=j,e.createTriangleGeometry=y;const x=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function S(e=x){const t=new Array(12);for(let l=0;l<4;l++)for(let i=0;i<3;i++)t[3*l+i]=e[l][i];const i=new Uint32Array([0,1,2,2,3,0]),r=[0,0,1],n=new Uint32Array([0,0,0,0,0,0]),a=[0,0,1,0,1,1,0,1],s=[255,255,255,255],o=[[p["a"].POSITION,i],[p["a"].NORMAL,n],[p["a"].UV0,i],[p["a"].COLOR,n]],c=[[p["a"].POSITION,{size:3,data:t,exclusive:!0}],[p["a"].NORMAL,{size:3,data:r,exclusive:!0}],[p["a"].UV0,{size:2,data:a,exclusive:!0}],[p["a"].COLOR,{size:4,data:s,exclusive:!0}]];return new h["a"](c,o)}function T(e,t,i,r,n=!0,s=!0){let o=0;const c=t,l=e;let d=Object(a["c"])(0,o,0),u=Object(a["c"])(0,o+l,0),b=Object(a["c"])(0,-1,0),f=Object(a["c"])(0,1,0);r&&(o=l,u=Object(a["c"])(0,0,0),d=Object(a["c"])(0,o,0),b=Object(a["c"])(0,1,0),f=Object(a["c"])(0,-1,0));const g=[u,d],O=[b,f],m=i+2,v=Math.sqrt(l*l+c*c);if(r)for(let h=i-1;h>=0;h--){const e=h*(2*Math.PI/i),t=Object(a["c"])(Math.cos(e)*c,o,Math.sin(e)*c);g.push(t);const r=Object(a["c"])(l*Math.cos(e)/v,-c/v,l*Math.sin(e)/v);O.push(r)}else for(let h=0;h<i;h++){const e=h*(2*Math.PI/i),t=Object(a["c"])(Math.cos(e)*c,o,Math.sin(e)*c);g.push(t);const r=Object(a["c"])(l*Math.cos(e)/v,c/v,l*Math.sin(e)/v);O.push(r)}const _=new Uint32Array(2*(i+2)*3),j=new Uint32Array(2*(i+2)*3);let y=0,x=0;if(n){for(let e=3;e<g.length;e++)_[y++]=1,_[y++]=e-1,_[y++]=e,j[x++]=0,j[x++]=0,j[x++]=0;_[y++]=g.length-1,_[y++]=2,_[y++]=1,j[x++]=0,j[x++]=0,j[x++]=0}if(s){for(let e=3;e<g.length;e++)_[y++]=e,_[y++]=e-1,_[y++]=0,j[x++]=e,j[x++]=e-1,j[x++]=1;_[y++]=0,_[y++]=2,_[y++]=g.length-1,j[x++]=1,j[x++]=2,j[x++]=O.length-1}const S=new Float32Array(3*m);for(let a=0;a<m;a++)S[3*a]=g[a][0],S[3*a+1]=g[a][1],S[3*a+2]=g[a][2];const T=new Float32Array(3*m);for(let a=0;a<m;a++)T[3*a]=O[a][0],T[3*a+1]=O[a][1],T[3*a+2]=O[a][2];const w=[[p["a"].POSITION,_],[p["a"].NORMAL,j]],M=[[p["a"].POSITION,{size:3,data:S,exclusive:!0}],[p["a"].NORMAL,{size:3,data:T,exclusive:!0}]];return new h["a"](M,w)}function w(e,t,i,r,s,o){const c=r?Object(a["a"])(r):Object(a["c"])(1,0,0),l=s?Object(a["a"])(s):Object(a["c"])(0,0,0);o=null==o||o;const d=Object(a["b"])();Object(n["r"])(d,c);const u=Object(a["b"])();Object(n["k"])(u,d,Math.abs(e));const b=Object(a["b"])();Object(n["k"])(b,u,-.5),Object(n["e"])(b,b,l);const f=Object(a["c"])(0,1,0);Math.abs(1-Object(n["i"])(d,f))<.2&&Object(n["w"])(f,0,0,1);const g=Object(a["b"])();Object(n["j"])(g,d,f),Object(n["r"])(g,g),Object(n["j"])(f,g,d);const O=2*i+(o?2:0),m=i+(o?2:0),v=new Float32Array(3*O),_=new Float32Array(3*m),j=new Float32Array(2*O),y=new Uint32Array(3*i*(o?4:2)),x=new Uint32Array(3*i*(o?4:2));o&&(v[3*(O-2)+0]=b[0],v[3*(O-2)+1]=b[1],v[3*(O-2)+2]=b[2],j[2*(O-2)]=0,j[2*(O-2)+1]=0,v[3*(O-1)+0]=v[3*(O-2)+0]+u[0],v[3*(O-1)+1]=v[3*(O-2)+1]+u[1],v[3*(O-1)+2]=v[3*(O-2)+2]+u[2],j[2*(O-1)]=1,j[2*(O-1)+1]=1,_[3*(m-2)+0]=-d[0],_[3*(m-2)+1]=-d[1],_[3*(m-2)+2]=-d[2],_[3*(m-1)+0]=d[0],_[3*(m-1)+1]=d[1],_[3*(m-1)+2]=d[2]);const S=(e,t,i)=>{y[e]=t,x[e]=i};let T=0;const w=Object(a["b"])(),M=Object(a["b"])();for(let a=0;a<i;a++){const e=a*(2*Math.PI/i);Object(n["k"])(w,f,Math.sin(e)),Object(n["k"])(M,g,Math.cos(e)),Object(n["e"])(w,w,M),_[3*a+0]=w[0],_[3*a+1]=w[1],_[3*a+2]=w[2],Object(n["k"])(w,w,t),Object(n["e"])(w,w,b),v[3*a+0]=w[0],v[3*a+1]=w[1],v[3*a+2]=w[2],j[2*a+0]=a/i,j[2*a+1]=0,v[3*(a+i)+0]=v[3*a+0]+u[0],v[3*(a+i)+1]=v[3*a+1]+u[1],v[3*(a+i)+2]=v[3*a+2]+u[2],j[2*(a+i)+0]=a/i,j[2*a+1]=1;const r=(a+1)%i;S(T++,a,a),S(T++,a+i,a),S(T++,r,r),S(T++,r,r),S(T++,a+i,a),S(T++,r+i,r)}if(o){for(let e=0;e<i;e++){const t=(e+1)%i;S(T++,O-2,m-2),S(T++,e,m-2),S(T++,t,m-2)}for(let e=0;e<i;e++){const t=(e+1)%i;S(T++,e+i,m-1),S(T++,O-1,m-1),S(T++,t+i,m-1)}}const A=[[p["a"].POSITION,y],[p["a"].NORMAL,x],[p["a"].UV0,y]],E=[[p["a"].POSITION,{size:3,data:v,exclusive:!0}],[p["a"].NORMAL,{size:3,data:_,exclusive:!0}],[p["a"].UV0,{size:2,data:j,exclusive:!0}]];return new h["a"](E,A)}function M(t,i,r,n,a){r=r||10,n=null==n||n,Object(u["a"])(t.length>1);const s=[[0,0,0]],o=[],c=[];for(let e=0;e<r;e++){o.push([0,-e-1,-(e+1)%r-1]);const t=e/r*2*Math.PI;c.push([Math.cos(t)*i,Math.sin(t)*i])}return e.createPathExtrusionGeometry(c,t,s,o,n,a)}function A(e,t,i,r,l,d=Object(a["c"])(0,0,0)){const u=e.length,b=new Float32Array(t.length*u*3+(6*i.length||0)),f=new Float32Array(t.length*u*3+(i?6:0)),g=(t.length-1)*u*6+3*r.length*2,O=new Uint32Array(g),m=new Uint32Array(g);let _=0,j=0,y=0,x=0;const S=Object(a["b"])(),T=Object(a["b"])(),w=Object(a["b"])(),M=Object(a["b"])(),A=Object(a["b"])(),E=Object(a["b"])(),R=Object(a["b"])(),P=Object(s["f"])(),C=Object(a["b"])(),D=Object(a["b"])(),L=Object(a["b"])(),N=Object(a["b"])(),z=Object(a["b"])(),V=Object(o["d"])();Object(n["w"])(C,0,1,0),Object(n["f"])(T,t[1],t[0]),Object(n["r"])(T,T),l?(Object(n["e"])(P,t[0],d),Object(n["r"])(w,P)):Object(n["w"])(w,0,0,1),I(T,w,C,C,A,w,v),Object(n["g"])(M,w),Object(n["g"])(N,A);for(let a=0;a<i.length;a++)Object(n["k"])(E,A,i[a][0]),Object(n["k"])(P,w,i[a][2]),Object(n["e"])(E,E,P),Object(n["e"])(E,E,t[0]),b[_++]=E[0],b[_++]=E[1],b[_++]=E[2];f[j++]=-T[0],f[j++]=-T[1],f[j++]=-T[2];for(let n=0;n<r.length;n++)O[y++]=r[n][0]>0?r[n][0]:-r[n][0]-1+i.length,O[y++]=r[n][1]>0?r[n][1]:-r[n][1]-1+i.length,O[y++]=r[n][2]>0?r[n][2]:-r[n][2]-1+i.length,m[x++]=0,m[x++]=0,m[x++]=0;let F=i.length;const G=i.length-1;for(let a=0;a<t.length;a++){let i=!1;a>0&&(Object(n["g"])(S,T),a<t.length-1?(Object(n["f"])(T,t[a+1],t[a]),Object(n["r"])(T,T)):i=!0,Object(n["e"])(D,S,T),Object(n["r"])(D,D),Object(n["e"])(L,t[a-1],M),Object(o["g"])(t[a],D,V),Object(o["m"])(V,Object(c["g"])(L,S),P)?(Object(n["f"])(P,P,t[a]),Object(n["r"])(w,P),Object(n["j"])(A,D,w),Object(n["r"])(A,A)):I(D,M,N,C,A,w,v),Object(n["g"])(M,w),Object(n["g"])(N,A)),l&&(Object(n["e"])(P,t[a],d),Object(n["r"])(z,P));for(let r=0;r<u;r++)if(Object(n["k"])(E,A,e[r][0]),Object(n["k"])(P,w,e[r][1]),Object(n["e"])(E,E,P),Object(n["r"])(R,E),f[j++]=R[0],f[j++]=R[1],f[j++]=R[2],Object(n["e"])(E,E,t[a]),b[_++]=E[0],b[_++]=E[1],b[_++]=E[2],!i){const e=(r+1)%u;O[y++]=F+r,O[y++]=F+u+r,O[y++]=F+e,O[y++]=F+e,O[y++]=F+u+r,O[y++]=F+u+e;for(let t=0;t<6;t++)m[x++]=O[y-6+t]-G}F+=u}const k=t[t.length-1];for(let a=0;a<i.length;a++)Object(n["k"])(E,A,i[a][0]),Object(n["k"])(P,w,i[a][1]),Object(n["e"])(E,E,P),Object(n["e"])(E,E,k),b[_++]=E[0],b[_++]=E[1],b[_++]=E[2];const U=j/3;f[j++]=T[0],f[j++]=T[1],f[j++]=T[2];const H=F-u;for(let n=0;n<r.length;n++)O[y++]=r[n][0]>=0?F+r[n][0]:-r[n][0]-1+H,O[y++]=r[n][2]>=0?F+r[n][2]:-r[n][2]-1+H,O[y++]=r[n][1]>=0?F+r[n][1]:-r[n][1]-1+H,m[x++]=U,m[x++]=U,m[x++]=U;const B=[[p["a"].POSITION,O],[p["a"].NORMAL,m]],W=[[p["a"].POSITION,{size:3,data:b,exclusive:!0}],[p["a"].NORMAL,{size:3,data:f,exclusive:!0}]];return new h["a"](W,B)}function E(e,t,i){Object(u["a"])(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Object(u["a"])(3===e[0].length,"createPolylineGeometry(): malformed vertex"),Object(u["a"])(null==t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),Object(u["a"])(null==t||3===t[0].length,"createPolylineGeometry(): malformed normal");const r=new Float64Array(3*e.length),n=new Uint32Array(2*(e.length-1));let a=0,s=0;for(let l=0;l<e.length;l++){for(let t=0;t<3;t++)r[a++]=e[l][t];l>0&&(n[s++]=l-1,n[s++]=l)}const o=[],c=[];if(o.push([p["a"].POSITION,n]),c.push([p["a"].POSITION,{size:3,data:r,exclusive:!0}]),t){const i=new Float32Array(3*t.length);let r=0;for(let n=0;n<e.length;n++)for(let e=0;e<3;e++)i[r++]=t[n][e];o.push([p["a"].NORMAL,n]),c.push([p["a"].NORMAL,{size:3,data:i,exclusive:!0}])}return i&&(c.push([p["a"].COLOR,{size:4,data:i}]),o.push([p["a"].COLOR,Object(d["d"])(i.length/4)])),new h["a"](c,o,l["f"].Line)}function R(e,t,i,r,n=0){const a=new Array(18),s=[[-t,n,r/2],[i,n,r/2],[0,e+n,r/2],[-t,n,-r/2],[i,n,-r/2],[0,e+n,-r/2]],o=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let c=0;c<6;c++)a[3*c]=s[c][0],a[3*c+1]=s[c][1],a[3*c+2]=s[c][2];return new h["a"]([[p["a"].POSITION,{size:3,data:a,exclusive:!0}]],[[p["a"].POSITION,o]])}function P(e,t){const i=e.getMutableAttribute(p["a"].POSITION).data;for(let r=0;r<i.length;r+=3){const e=i[r],a=i[r+1],s=i[r+2];Object(n["w"])(_,e,a,s),Object(n["q"])(_,_,t),i[r]=_[0],i[r+1]=_[1],i[r+2]=_[2]}}function C(e,t=e){const i=e.vertexAttributes,r=i.get(p["a"].POSITION).data,n=i.get(p["a"].NORMAL).data;if(n){const e=t.getMutableAttribute(p["a"].NORMAL).data;for(let t=0;t<n.length;t+=3){const i=n[t+1];e[t+1]=-n[t+2],e[t+2]=i}}if(r){const e=t.getMutableAttribute(p["a"].POSITION).data;for(let t=0;t<r.length;t+=3){const i=r[t+1];e[t+1]=-r[t+2],e[t+2]=i}}return t}function D(e,t,i,r,a){return!(Math.abs(Object(n["i"])(t,e))>a)&&(Object(n["j"])(i,e,t),Object(n["r"])(i,i),Object(n["j"])(r,i,e),Object(n["r"])(r,r),!0)}function I(e,t,i,r,n,a,s){return D(e,t,n,a,s)||D(e,i,n,a,s)||D(e,r,n,a,s)}e.createSquareGeometry=S,e.createConeGeometry=T,e.createCylinderGeometry=w,e.createTubeGeometry=M,e.createPathExtrusionGeometry=A,e.createPolylineGeometry=E,e.createExtrudedTriangle=R,e.transformInPlace=P,e.cgToGIS=C,e.makeOrthoBasisDirUp=D,e.makeOrthoBasisDirUpFallback=I}(m||(m={}));const v=.99619469809,_=Object(a["b"])(),j=m},cdc1:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return o})),i.d(t,"e",(function(){return l}));var r=i("38a4"),n=i("9180"),a=i("28b1"),s=i("32ed");function o(e,t,i,r){if(null==r||e.hasZ||(r=void 0),"point"===e.type)return e.x+=t,e.y+=i,e.hasZ&&null!=r&&(e.z+=r),e;if("multipoint"===e.type){const n=e.points;for(let e=0;e<n.length;e++)n[e]=u(n[e],t,i,r);return e}if("extent"===e.type)return e.xmin+=t,e.xmax+=t,e.ymin+=i,e.ymax+=i,null!=r&&(e.zmin+=r,e.zmax+=r),e;const n=Object(s["c"])(e),a="polyline"===e.type?e.paths:e.rings;for(let s=0;s<n.length;s++){const e=n[s];for(let n=0;n<e.length;n++)e[n]=u(e[n],t,i,r)}return"paths"in e?e.paths=a:e.rings=a,e}function c(e,t,i,r,n){const a=e.clone(),c=r.resolution;if("point"===a.type){if(n)o(a,t*c,-i*c);else{const e=r.state.transform,n=r.state.inverseTransform,s=e[0]*a.x+e[2]*a.y+e[4],o=e[1]*a.x+e[3]*a.y+e[5];a.x=n[0]*(s+t)+n[2]*(o+i)+n[4],a.y=n[1]*(s+t)+n[3]*(o+i)+n[5]}return a}if("multipoint"===a.type){if(n)o(a,t*c,-i*c);else{const e=a.points,n=r.state.transform,s=r.state.inverseTransform;for(let r=0;r<e.length;r++){const a=e[r],o=n[0]*a[0]+n[2]*a[1]+n[4],c=n[1]*a[0]+n[3]*a[1]+n[5],l=s[0]*(o+t)+s[2]*(c+i)+s[4],h=s[1]*(o+t)+s[3]*(c+i)+s[5];e[r]=p(a,l,h,void 0)}}return a}if("extent"===a.type){if(n)o(a,t*c,-i*c);else{const e=r.state.transform,n=r.state.inverseTransform,s=e[0]*a.xmin+e[2]*a.ymin+e[4],o=e[1]*a.xmin+e[3]*a.ymin+e[5],c=e[0]*a.xmax+e[2]*a.ymax+e[4],l=e[1]*a.xmax+e[3]*a.ymax+e[5];a.xmin=n[0]*(s+t)+n[2]*(o+i)+n[4],a.ymin=n[1]*(s+t)+n[3]*(o+i)+n[5],a.xmax=n[0]*(c+t)+n[2]*(l+i)+n[4],a.ymax=n[1]*(c+t)+n[3]*(l+i)+n[5]}return a}if(n)o(a,t*c,-i*c);else{const e=Object(s["c"])(a),n="polyline"===a.type?a.paths:a.rings,o=r.state.transform,c=r.state.inverseTransform;for(let r=0;r<e.length;r++){const n=e[r];for(let e=0;e<n.length;e++){const r=n[e],a=o[0]*r[0]+o[2]*r[1]+o[4],s=o[1]*r[0]+o[3]*r[1]+o[5],l=c[0]*(a+t)+c[2]*(s+i)+c[4],h=c[1]*(a+t)+c[3]*(s+i)+c[5];n[e]=p(r,l,h,void 0)}}"paths"in a?a.paths=n:a.rings=n}return a}function l(e,t,i,r){if("point"===e.type){const{x:n,y:a}=e,s=r?r[0]:n,o=r?r[1]:a,c=e.clone(),l=(n-s)*t+s,h=(a-o)*i+o;return c.x=l,c.y=h,c}if("multipoint"===e.type){const o=Object(s["c"])(e),c=Object(n["k"])(),[l,h,d,u]=Object(a["d"])(c,[o]),b=r?r[0]:(l+d)/2,f=r?r[1]:(u+h)/2,g=e.clone(),O=g.points;for(let e=0;e<O.length;e++){const r=O[e],[n,a]=r,s=(n-b)*t+b,o=(a-f)*i+f;O[e]=p(r,s,o,void 0)}return g}if("extent"===e.type){const{xmin:n,xmax:a,ymin:s,ymax:o}=e,c=r?r[0]:(n+a)/2,l=r?r[1]:(o+s)/2,h=e.clone();if(h.xmin=(n-c)*t+c,h.ymax=(o-l)*i+l,h.xmax=(a-c)*t+c,h.ymin=(s-l)*i+l,h.xmin>h.xmax){const e=h.xmin,t=h.xmax;h.xmin=t,h.xmax=e}if(h.ymin>h.ymax){const e=h.ymin,t=h.ymax;h.ymin=t,h.ymax=e}return h}const o=Object(s["c"])(e),c=Object(n["k"])(),[l,h,d,u]=Object(a["d"])(c,o),b=r?r[0]:(l+d)/2,f=r?r[1]:(u+h)/2,g=e.clone(),O="polyline"===g.type?g.paths:g.rings;for(let n=0;n<o.length;n++){const e=o[n];for(let r=0;r<e.length;r++){const a=e[r],[s,o]=a,c=(s-b)*t+b,l=(o-f)*i+f;O[n][r]=p(a,c,l,void 0)}}return"paths"in g?g.paths=O:g.rings=O,g}function h(e,t,i,r,n,a){const s=Math.sqrt((i-e)*(i-e)+(r-t)*(r-t));return Math.sqrt((n-e)*(n-e)+(a-t)*(a-t))/s}function d(e,t,i){const n=Math.atan2(t.y-i.y,t.x-i.x)-Math.atan2(e.y-i.y,e.x-i.x),a=Math.atan2(Math.sin(n),Math.cos(n));return Object(r["o"])(a)}function u(e,t,i,r){return p(e,e[0]+t,e[1]+i,null!=e[2]&&null!=r?e[2]+r:void 0)}function p(e,t,i,r){const n=[t,i];return e.length>2&&n.push(null!=r?r:e[2]),e.length>3&&n.push(e[3]),n}},cfb5:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("a4ee"),n=i("fc29"),a=i("59b2"),s=(i("b50f"),i("c120"),i("cea0"),i("d386"));let o=class extends n["a"]{constructor(e){super(e)}};Object(r["a"])([Object(a["b"])()],o.prototype,"tooltipOptions",void 0),o=Object(r["a"])([Object(s["a"])("esri.views.interactive.tooltip.SketchTooltipInfo")],o)},d017:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return u}));i("0b2d");var r=i("501b"),n=i("fd48"),a=i("1fe9"),s=i("79a1"),o=i("3886"),c=i("62ae"),l=i("52b2");class h extends c["a"]{constructor(e,t,i,r){switch(t){case l["a"].Pass:return void super(e,"mat4",t,(t,r,n)=>t.setUniformMatrix4fv(e,i(r,n)),r);case l["a"].Draw:return void super(e,"mat4",t,(t,r,n)=>t.setUniformMatrix4fv(e,i(r,n)),r)}}}var d=i("6a3c");o["a"];function u(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new h("shadowMapMatrix",l["a"].Pass,(e,t)=>t.shadowMap.getShadowMapMatrices(e.origin),4)),b(e))}function p(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new h("shadowMapMatrix",l["a"].Draw,(e,t)=>t.shadowMap.getShadowMapMatrices(e.origin),4)),b(e))}function b(e){const t=e.fragment;t.include(r["a"]),t.uniforms.add([new d["a"]("shadowMapTex",(e,t)=>t.shadowMap.depthTexture),new s["a"]("numCascades",(e,t)=>t.shadowMap.numCascades),new n["a"]("cascadeDistances",(e,t)=>t.shadowMap.cascadeDistances),new a["a"]("depthHalfPixelSz",(e,t)=>.5/t.shadowMap.textureSize)]),t.code.add(o["b"]`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)}},d047:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("501b"),n=i("3886");function a(e){e.include(r["a"]),e.code.add(n["b"]`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}},d0cb:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return a}));var r,n=i("17b0");!function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(r||(r={}));var a,s=i("2f98"),o=i("8e97"),c=i("fd48"),l=i("1fe9"),h=i("3886"),d=i("85b3"),u=i("6a3c"),p=i("b7bd");function b(e,t){e.include(s["a"]),e.attributes.add(p["a"].POSITION,"vec3"),e.attributes.add(p["a"].NORMAL,"vec3"),e.attributes.add(p["a"].AUXPOS1,"vec4");const i=e.vertex;Object(o["b"])(e,t),Object(o["a"])(i,t),i.uniforms.add([new c["a"]("viewport",(e,t)=>t.camera.fullViewport),new l["a"]("polygonOffset",e=>e.shaderPolygonOffset),new l["a"]("cameraGroundRelative",(e,t)=>t.camera.aboveGround?1:-1),new l["a"]("renderTransparentlyOccludedHUD",(e,t)=>t.renderTransparentlyOccludedHUD===r.Occluded?1:t.renderTransparentlyOccludedHUD===r.NotOccluded?0:.75),new u["a"]("hudVisibilityTexture",(e,t)=>t.hudVisibilityTexture)]),t.hasVerticalOffset&&Object(n["b"])(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(h["b"]`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(h["b"]`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped&&!t.hasVerticalOffset||i.uniforms.add(new d["a"]("viewNormal",(e,t)=>t.camera.viewInverseTransposeMatrix)),t.isDraped||(i.uniforms.add(new l["a"]("perDistancePixelRatio",(e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2))),i.code.add(h["b"]`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),t.screenCenterOffsetUnitsEnabled===a.Screen&&i.uniforms.add(new l["a"]("pixelRatio",(e,t)=>t.camera.pixelRatio)),t.hasScreenSizePerspective&&Object(s["c"])(i),i.code.add(h["b"]`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===a.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?h["b"]`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==a.Screen?h["b"]`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===a.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===a.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.code.add(h["b"]`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}!function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"}(a||(a={}))},d18f:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return h})),i.d(t,"f",(function(){return d})),i.d(t,"g",(function(){return c}));i("b50f");var r=i("2119"),n=i("e431"),a=i("0b2d"),s=i("7361");function o(e){return e?{origin:Object(a["d"])(e.origin),direction:Object(a["d"])(e.direction)}:{origin:Object(a["f"])(),direction:Object(a["f"])()}}function c(e,t){const i=f.get();return i.origin=e,i.direction=t,i}function l(e,t=o()){return d(e.origin,e.direction,t)}function h(e,t,i=o()){return Object(n["g"])(i.origin,e),Object(n["f"])(i.direction,t,e),i}function d(e,t,i=o()){return Object(n["g"])(i.origin,e),Object(n["g"])(i.direction,t),i}function u(e,t){const i=Object(n["j"])(s["d"].get(),Object(n["r"])(s["d"].get(),e.direction),Object(n["f"])(s["d"].get(),t,e.origin));return Object(n["i"])(i,i)}function p(e,t,i){const r=Object(n["i"])(e.direction,Object(n["f"])(i,t,e.origin));return Object(n["e"])(i,e.origin,Object(n["k"])(i,e.direction,r)),i}function b(){return{origin:null,direction:null}}const f=new r["a"](b)},d245:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("8188"),n=i("f694");function a(e){const t=Object(n["g"])(e),i=t===n["a"]?n["d"]:t;return Object(r["b"])(e,i)?i:e}},d272:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var r=i("b2b2"),n=i("d791"),a=i("afe1"),s=i("e431"),o=i("0b2d"),c=i("35f0"),l=(i("ea32"),i("3886"));l["a"];function h(e,t){d(e,t,[new c["a"]("slicePlaneOrigin",(e,i)=>f(t,e,i)),new c["a"]("slicePlaneBasis1",(e,i)=>{var n;return g(t,e,i,null==(n=Object(r["r"])(i.slicePlane))?void 0:n.basis1)}),new c["a"]("slicePlaneBasis2",(e,i)=>{var n;return g(t,e,i,null==(n=Object(r["r"])(i.slicePlane))?void 0:n.basis2)})])}function d(e,t,i){if(!t.hasSlicePlane){const i=l["b"]`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(i),void e.fragment.code.add(i)}e.extensions.add("GL_OES_standard_derivatives"),t.hasSliceInVertexProgram&&e.vertex.uniforms.add(i),e.fragment.uniforms.add(i);const r=l["b"]`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,n=l["b"]`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,a=t.hasSliceHighlight?l["b"]`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:l["b"]`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(r),e.fragment.code.add(r),e.fragment.code.add(a)}function u(e,t,i){return e.instancedDoublePrecision?Object(s["w"])(O,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function p(e,t){return Object(r["k"])(e)?Object(s["f"])(m,t.origin,e):t.origin}function b(e,t,i){return e.hasSliceTranslatedView?Object(r["k"])(t)?Object(n["j"])(_,i.camera.viewMatrix,t):i.camera.viewMatrix:null}function f(e,t,i){if(Object(r["j"])(i.slicePlane))return o["c"];const n=u(e,t,i),a=p(n,i.slicePlane),c=b(e,n,i);return Object(r["k"])(c)?Object(s["q"])(m,a,c):a}function g(e,t,i,n){if(Object(r["j"])(n)||Object(r["j"])(i.slicePlane))return o["c"];const a=u(e,t,i),c=p(a,i.slicePlane),l=b(e,a,i);return Object(r["k"])(l)?(Object(s["e"])(v,n,c),Object(s["q"])(m,c,l),Object(s["q"])(v,v,l),Object(s["f"])(v,v,m)):n}const O=Object(o["f"])(),m=Object(o["f"])(),v=Object(o["f"])(),_=Object(a["d"])()},d359:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return g})),i.d(t,"c",(function(){return b})),i.d(t,"d",(function(){return O})),i.d(t,"e",(function(){return _})),i.d(t,"f",(function(){return v}));var r,n,a=i("2119"),s=i("d791"),o=i("e431"),c=i("0b2d"),l=i("7577"),h=i("0fc4"),d=i("4f8b"),u=i("7289"),p=i("7361");function b(e){return e?[Object(u["d"])(e[0]),Object(u["d"])(e[1]),Object(u["d"])(e[2]),Object(u["d"])(e[3]),Object(u["d"])(e[4]),Object(u["d"])(e[5])]:[Object(u["d"])(),Object(u["d"])(),Object(u["d"])(),Object(u["d"])(),Object(u["d"])(),Object(u["d"])()]}function f(){return[Object(c["f"])(),Object(c["f"])(),Object(c["f"])(),Object(c["f"])(),Object(c["f"])(),Object(c["f"])(),Object(c["f"])(),Object(c["f"])()]}function g(e,t){for(let i=0;i<j.NUM;i++)Object(u["c"])(e[i],t[i])}function O(e,t,i,r=S){const n=Object(s["m"])(p["a"].get(),t,e);Object(s["a"])(n,n);for(let a=0;a<y.NUM;++a){const e=Object(l["m"])(p["e"].get(),x[a],n);Object(o["w"])(r[a],e[0]/e[3],e[1]/e[3],e[2]/e[3])}m(i,r)}function m(e,t){Object(u["f"])(t[n.FAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_TOP_LEFT],e[r.LEFT]),Object(u["f"])(t[n.NEAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_RIGHT],t[n.FAR_TOP_RIGHT],e[r.RIGHT]),Object(u["f"])(t[n.FAR_BOTTOM_LEFT],t[n.FAR_BOTTOM_RIGHT],t[n.NEAR_BOTTOM_RIGHT],e[r.BOTTOM]),Object(u["f"])(t[n.NEAR_TOP_LEFT],t[n.NEAR_TOP_RIGHT],t[n.FAR_TOP_RIGHT],e[r.TOP]),Object(u["f"])(t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_RIGHT],t[n.NEAR_TOP_RIGHT],e[r.NEAR]),Object(u["f"])(t[n.FAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_LEFT],t[n.FAR_TOP_LEFT],e[r.FAR])}function v(e,t){for(let i=0;i<j.NUM;i++){const r=e[i];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function _(e,t){for(let i=0;i<j.NUM;i++){const r=e[i];if(!Object(u["b"])(r,t))return!1}return!0}!function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"}(r||(r={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(n||(n={}));n.FAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_LEFT,n.FAR_BOTTOM_LEFT,n.NEAR_BOTTOM_LEFT,n.NEAR_BOTTOM_RIGHT,n.NEAR_TOP_RIGHT,n.NEAR_TOP_LEFT,n.FAR_BOTTOM_RIGHT,n.FAR_BOTTOM_LEFT,n.FAR_TOP_LEFT,n.FAR_TOP_RIGHT,n.NEAR_BOTTOM_RIGHT,n.FAR_BOTTOM_RIGHT,n.FAR_TOP_RIGHT,n.NEAR_TOP_RIGHT,n.FAR_BOTTOM_LEFT,n.NEAR_BOTTOM_LEFT,n.NEAR_TOP_LEFT,n.FAR_TOP_LEFT,n.FAR_TOP_LEFT,n.NEAR_TOP_LEFT,n.NEAR_TOP_RIGHT,n.FAR_TOP_RIGHT;var j,y;!function(e){e[e.NUM=6]="NUM"}(j||(j={})),function(e){e[e.NUM=8]="NUM"}(y||(y={}));const x=[Object(h["g"])(-1,-1,-1,1),Object(h["g"])(1,-1,-1,1),Object(h["g"])(1,1,-1,1),Object(h["g"])(-1,1,-1,1),Object(h["g"])(-1,-1,1,1),Object(h["g"])(1,-1,1,1),Object(h["g"])(1,1,1,1),Object(h["g"])(-1,1,1,1)],S=(new a["a"](d["a"]),f())},d36e:function(e,t,i){"use strict";i.d(t,"a",(function(){return w}));var r=i("0fc4"),n=i("a05b"),a=i("b7c2"),s=i("d7f7"),o=i("b061"),c=i("35b3"),l=i("7438"),h=i("badc"),d=i("8675"),u=i("7c51"),p=i("c3a4"),b=i("ca98"),f=i("fa1e"),g=i("c829"),O=i("87b7"),m=i("1962"),v=i("189c");class _ extends b["a"]{initializeProgram(e){const t=_.shader.get().build(this.configuration);return new g["a"](e.rctx,t,f["a"])}_createPipeline(e,t){const i=this.configuration,r=e===a["i"].NONE,s=e===a["i"].FrontFace;return Object(v["f"])({blending:i.output!==n["a"].Color&&i.output!==n["a"].Alpha||!i.transparent?null:r?l["d"]:Object(l["f"])(e),culling:Object(v["b"])(i.cullFace),depthTest:{func:Object(l["g"])(e)},depthWrite:r||s?i.writeDepth&&v["d"]:null,colorWrite:v["c"],stencilWrite:i.hasOccludees?O["h"]:null,stencilTest:i.hasOccludees?t?O["d"]:O["c"]:null,polygonOffset:r||s?i.polygonOffset&&j:Object(l["e"])(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}_.shader=new p["a"](m["a"],()=>i.e("chunk-2d0de726").then(i.bind(null,"864f")));const j={factor:1,units:1};var y=i("a4ee"),x=i("da35"),S=i("6d35");class T extends S["a"]{constructor(){super(...arguments),this.output=n["a"].Color,this.cullFace=a["b"].None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=a["i"].NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}Object(y["a"])([Object(x["b"])({count:n["a"].COUNT})],T.prototype,"output",void 0),Object(y["a"])([Object(x["b"])({count:a["b"].COUNT})],T.prototype,"cullFace",void 0),Object(y["a"])([Object(x["b"])()],T.prototype,"hasSlicePlane",void 0),Object(y["a"])([Object(x["b"])()],T.prototype,"hasVertexColors",void 0),Object(y["a"])([Object(x["b"])()],T.prototype,"transparent",void 0),Object(y["a"])([Object(x["b"])()],T.prototype,"polygonOffset",void 0),Object(y["a"])([Object(x["b"])()],T.prototype,"enableOffset",void 0),Object(y["a"])([Object(x["b"])()],T.prototype,"writeDepth",void 0),Object(y["a"])([Object(x["b"])()],T.prototype,"hasOccludees",void 0),Object(y["a"])([Object(x["b"])({count:a["i"].COUNT})],T.prototype,"transparencyPassType",void 0),Object(y["a"])([Object(x["b"])()],T.prototype,"hasMultipassTerrain",void 0),Object(y["a"])([Object(x["b"])()],T.prototype,"cullAboveGround",void 0);class w extends c["a"]{constructor(e){super(e,new A),this.supportsEdges=!0,this._configuration=new T}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<l["b"],this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,i,r,n,a,s){Object(u["e"])(e,t,r,n,a,void 0,s)}requiresSlot(e,t){return e===h["a"].DRAPED_MATERIAL||(Object(o["b"])(t)===n["a"].Highlight?e===h["a"].OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?h["a"].TRANSPARENT_MATERIAL:h["a"].TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:h["a"].OPAQUE_MATERIAL))}createGLMaterial(e){return e.output===n["a"].Color||e.output===n["a"].Alpha||e.output===n["a"].Highlight||e.output===n["a"].Depth&&this.parameters.writeLinearDepth?new M(e):null}createBufferWriter(){return new d["a"](d["b"])}}class M extends s["a"]{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==n["a"].Color&&this._output!==n["a"].Alpha||this._updateOccludeeState(e),this.ensureTechnique(_,e)}}class A extends c["b"]{constructor(){super(...arguments),this.color=r["b"],this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=a["b"].None,this.hasOccludees=!1}}},d3cf:function(e,t,i){"use strict";i.d(t,"a",(function(){return v})),i.d(t,"b",(function(){return p})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return l}));var r=i("8d60"),n=(i("c120"),i("7ffa")),a=i("b2b2"),s=i("a21b"),o=i("a9ab"),c=i("1a54");function l(e){return"declaredClass"in e}function h(e){return"declaredClass"in e}function d(e){return"declaredClass"in e}function u(e,t){if(!e)return null;if(d(e))return e;const i=new r["a"]({layer:t,sourceLayer:t});return i.visible=e.visible,i.symbol=Object(n["a"])(e.symbol),i.attributes=Object(n["a"])(e.attributes),i.geometry=p(e.geometry),i}function p(e){return Object(a["j"])(e)?null:l(e)?e:Object(o["a"])(b(e))}function b(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:i,y:r,z:n,m:a}=e;return{x:i,y:r,z:n,m:a,spatialReference:t}}case"polygon":{const{rings:i,hasZ:r,hasM:n}=e;return{rings:f(i),hasZ:r,hasM:n,spatialReference:t}}case"polyline":{const{paths:i,hasZ:r,hasM:n}=e;return{paths:f(i),hasZ:r,hasM:n,spatialReference:t}}case"extent":{const{xmin:i,xmax:r,ymin:n,ymax:a,zmin:s,zmax:o,mmin:c,mmax:l,hasZ:h,hasM:d}=e;return{xmin:i,xmax:r,ymin:n,ymax:a,zmin:s,zmax:o,mmin:c,mmax:l,hasZ:h,hasM:d,spatialReference:t}}case"multipoint":{const{points:i,hasZ:r,hasM:n}=e;return{points:m(i)?g(i):i,hasZ:r,hasM:n,spatialReference:t}}default:return}}function f(e){return O(e)?e.map(e=>g(e)):e}function g(e){return e.map(e=>Object(s["n"])(e))}function O(e){for(const t of e)if(0!==t.length)return m(t);return!1}function m(e){return e.length&&(Object(s["d"])(e[0])||Object(s["e"])(e[0]))}function v(e,t){if(!e)return null;let i;if(h(e)){if(null==t)return e.clone();if(h(t))return t.copy(e)}return null!=t?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=null,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=Object(c["g"])(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}},d408:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return _})),i.d(t,"c",(function(){return j})),i.d(t,"d",(function(){return x})),i.d(t,"e",(function(){return L}));i("c120");var r,n=i("b2b2"),a=i("a21b"),s=i("3349"),o=i("e431"),c=i("0b2d"),l=i("8188"),h=i("f694"),d=i("1666"),u=i("3c9c"),p=i("ed70"),b=i("2e0f"),f=i("7585"),g=i("b7c2"),O=i("0278"),m=i("b7bd"),v=i("a6b6");function _(e){const t=[],i=[];S(e,i,t);const r=i[0][1].data,n=t[0][1].length,a=new Uint16Array(n);return T(e,i,t),w(e,i,t,a),A(e,i,t,a),M(e,i,t,a),E(e,i,t,a),R(e,i,t,a),P(e,i,t,r),new O["a"](i,t,g["f"].Line)}function j(e,t,i,r){const n="polygon"===e.type?d["a"].CCW_IS_HOLE:d["a"].NONE,a="polygon"===e.type?e.rings:e.paths,{position:s,outlines:o}=Object(d["b"])(a,e.hasZ,n),c=new Float64Array(s.length),l=Object(b["d"])(s,e.spatialReference,0,c,0,s,0,s.length/3,t,i,r),h=null!=l;return{lines:h?y(o,s,c):[],projectionSuccess:h,sampledElevation:l}}function y(e,t,i){const r=new Array;for(const{index:n,count:a}of e){if(a<=1)continue;const e=3*n,s=e+3*a;r.push({position:t.subarray(e,s),mapPosition:i?i.subarray(e,s):void 0})}return r}function x(e,t){const i="polygon"===e.type?d["a"].CCW_IS_HOLE:d["a"].NONE,r="polygon"===e.type?e.rings:e.paths,{position:n,outlines:a}=Object(d["b"])(r,!1,i),s=Object(l["l"])(n,e.spatialReference,0,n,t,0,n.length/3);for(let o=2;o<n.length;o+=3)n[o]=f["a"];return{lines:s?y(a,n):[],projectionSuccess:s}}function S(e,t,i){const{attributeData:{position:n},removeDuplicateStartEnd:s}=e,o=C(n)&&s===r.REMOVE,c=n.length/3-(o?1:0),l=new Uint32Array(2*(c-1)),h=o?Object(a["m"])(n,0,n.length-3):n;let d=0;for(let r=0;r<c-1;r++)l[d++]=r,l[d++]=r+1;t.push([m["a"].POSITION,{size:3,data:h,exclusive:o}]),i.push([m["a"].POSITION,l])}function T(e,t,i){const r=e.attributeData.mapPosition;Object(n["j"])(r)||(i.push([m["a"].MAPPOS,i[0][1]]),t.push([m["a"].MAPPOS,{size:3,data:r}]))}function w(e,t,i,r){if(Object(n["k"])(e.attributeData.colorFeature))return;const a=e.attributeData.color;t.push([m["a"].COLOR,{size:4,data:Object(n["s"])(a,p["c"])}]),i.push([m["a"].COLOR,r])}function M(e,t,i,r){const a=e.attributeData.colorFeature;Object(n["j"])(a)||(t.push([m["a"].COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([a])}]),i.push([m["a"].COLOR,r]))}function A(e,t,i,r){if(Object(n["k"])(e.attributeData.sizeFeature))return;const a=e.attributeData.size;t.push([m["a"].SIZE,{size:1,data:[Object(n["s"])(a,1)]}]),i.push([m["a"].SIZE,r])}function E(e,t,i,r){const a=e.attributeData.sizeFeature;Object(n["j"])(a)||(t.push([m["a"].SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([a])}]),i.push([m["a"].SIZEFEATUREATTRIBUTE,r]))}function R(e,t,i,r){const a=e.attributeData.opacityFeature;Object(n["j"])(a)||(t.push([m["a"].OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([a])}]),i.push([m["a"].OPACITYFEATUREATTRIBUTE,r]))}function P(e,t,i,r){if(Object(n["j"])(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==u["a"].Global||!e.overlayInfo.spatialReference.isGeographic)return;const a=new Float64Array(r.length),c=Object(h["e"])(e.overlayInfo.spatialReference);for(let n=0;n<a.length;n+=3)Object(l["i"])(r,n,a,n,c);const d=r.length/3,p=new Float32Array(d+1);let b=D,f=I,g=0,O=0;Object(o["w"])(b,a[O++],a[O++],a[O++]),p[0]=0;for(let n=1;n<d+1;++n)n===d&&(O=0),Object(o["w"])(f,a[O++],a[O++],a[O++]),g+=Object(s["d"])(b,f),p[n]=g,[b,f]=[f,b];t.push([m["a"].DISTANCETOSTART,{size:1,data:p}]),i.push([m["a"].DISTANCETOSTART,i[0][1]])}function C(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}!function(e){e[e.KEEP=0]="KEEP",e[e.REMOVE=1]="REMOVE"}(r||(r={}));const D=Object(c["f"])(),I=Object(c["f"])();function L(e){switch(e){case"butt":return v["a"].BUTT;case"square":return v["a"].SQUARE;case"round":return v["a"].ROUND;default:return null}}},d5f7:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return u}));var r=i("fa1e"),n=i("b7bd"),a=i("d17d"),s=i("3f3e");new s["a"](n["a"].POSITION,3,a["k"].FLOAT,0,12),new s["a"](n["a"].POSITION,3,a["k"].FLOAT,0,20),new s["a"](n["a"].UV0,2,a["k"].FLOAT,12,20),new s["a"](n["a"].POSITION,3,a["k"].FLOAT,0,32),new s["a"](n["a"].NORMAL,3,a["k"].FLOAT,12,32),new s["a"](n["a"].UV0,2,a["k"].FLOAT,24,32),new s["a"](n["a"].POSITION,3,a["k"].FLOAT,0,16),new s["a"](n["a"].COLOR,4,a["k"].UNSIGNED_BYTE,12,16);const o=[new s["a"](n["a"].POSITION,2,a["k"].FLOAT,0,8)],c=[new s["a"](n["a"].POSITION,2,a["k"].FLOAT,0,16),new s["a"](n["a"].UV0,2,a["k"].FLOAT,8,16)];var l=i("7ce4"),h=i("a1ff"),d=i("0fa6");function u(e,t=o,i=r["a"],n=-1,s=1){let h=null;return h=t===c?new Float32Array([n,n,0,0,s,n,1,0,n,s,0,1,s,s,1,1]):new Float32Array([n,n,s,n,n,s,s,s]),new d["a"](e,i,{geometry:t},{geometry:l["a"].createVertex(e,a["D"].STATIC_DRAW,h)})}function p(e){return new h["a"](e,{target:a["A"].TEXTURE_2D,pixelFormat:a["p"].RGBA,dataType:a["q"].UNSIGNED_BYTE,samplingMode:a["z"].NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}},d7f7:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("b7c2");class n{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}ensureTechnique(e,t,i=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(i,t),this._technique),this._technique}ensureResources(e){return r["g"].LOADED}}},d8a4:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("62ae"),n=i("52b2");class a extends r["a"]{constructor(e,t){super(e,"vec2",n["a"].Pass,(i,r,n)=>i.setUniform2fv(e,t(r,n)))}}},d981:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));var r=i("3886");function n(e){e.fragment.code.add(r["b"]`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function a(e){e.fragment.code.add(r["b"]`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},da1c:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return d}));var r=i("38a4");i("3c9c");function n(e){return Math.abs(e*e*e)}function a(e,t,i){const r=i.parameters,a=i.paddingPixelsOverride;return u.scale=Math.min(r.divisor/(t-r.offset),1),u.factor=n(e),u.minPixelSize=r.minPixelSize,u.paddingPixels=a,u}function s(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function o(e,t){return Math.max(Object(r["l"])(e*t.scale,e,t.factor),s(e,t))}function c(e,t,i){const r=a(e,t,i);return r.minPixelSize=0,r.paddingPixels=0,o(1,r)}function l(e,t,i,r){r.scale=c(e,t,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function h(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,s(e[1],t)/Math.max(1e-5,e[1])),1);return i[0]=e[0]*r,i[1]=e[1]*r,i}function d(e,t,i,r){return o(e,a(t,i,r))}Object(r["g"])(10),Object(r["g"])(12),Object(r["g"])(70),Object(r["g"])(40);const u={scale:0,factor:0,minPixelSize:0,paddingPixels:0}},da35:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));class r{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,t={key:this.key};for(const i of e)t[i]=this[i];return t}}function n(e={}){return(t,i)=>{var r;if(t._parameterNames=null!=(r=t._parameterNames)?r:[],t._parameterNames.push(i),null!=e.constValue)Object.defineProperty(t,i,{get:()=>e.constValue});else{var n;const r=t._parameterNames.length-1,a=e.count||2,s=Math.ceil(Math.log2(a)),o=null!=(n=t._parameterBits)?n:[0];let c=0;for(;o[c]+s>16;)c++,c>=o.length&&o.push(0);t._parameterBits=o;const l=o[c],h=(1<<s)-1<<l;o[c]+=s,Object.defineProperty(t,i,{get(){return this[r]},set(e){if(this[r]!==e&&(this[r]=e,this._keyDirty=!0,this._parameterBits[c]=this._parameterBits[c]&~h|+e<<l&h,"number"!=typeof e&&"boolean"!=typeof e))throw"Configuration value for "+i+" must be boolean or number, got "+typeof e}})}}}},dae5:function(e,t,i){"use strict";function r(){return[1,0,0,0,1,0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function a(e,t,i,r,n,a,s,o,c){return[e,t,i,r,n,a,s,o,c]}function s(e,t){return new Float64Array(e,t,9)}i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return r}));Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:n,fromValues:a,createView:s},Symbol.toStringTag,{value:"Module"}))},db7b:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("62ae");class n extends r["a"]{constructor(e){super(e,"vec4")}}},df77:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return h}));var r=i("afe1"),n=i("d047"),a=i("d8a4"),s=i("1fe9"),o=i("3886"),c=i("85b3"),l=i("6a3c");function h(e,t){const i=e.fragment.uniforms;i.add(new a["a"]("nearFar",(e,t)=>t.camera.nearFar)),i.add(new l["a"]("depthMap",(e,t)=>t.linearDepthTexture)),i.add(new c["a"]("view",(e,t)=>t.ssr.camera.viewMatrix)),i.add(new c["a"]("proj",(e,t)=>t.ssr.camera.projectionMatrix)),i.add(new s["a"]("invResolutionHeight",(e,t)=>1/t.ssr.camera.height)),i.add(new l["a"]("lastFrameColorMap",(e,t)=>t.ssr.lastFrameColorTexture)),i.add(new c["a"]("reprojectionMatrix",(e,t)=>t.ssr.reprojectionMatrix)),e.fragment.include(n["a"]),e.fragment.code.add(o["b"]`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class d{constructor(){this.reprojectionMatrix=Object(r["d"])()}}},dfaf:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return r}));var r,n=i("6c97"),a=i("3886"),s=i("b7bd");function o(e,t){switch(t.textureCoordinateType){case r.Default:return e.attributes.add(s["a"].UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(a["b"]`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case r.Atlas:return e.attributes.add(s["a"].UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(s["a"].UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(a["b"]`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);case r.None:return void e.vertex.code.add(a["b"]`void forwardTextureCoordinates() {}`);default:Object(n["a"])(t.textureCoordinateType);case r.COUNT:return}}!function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.COUNT=3]="COUNT"}(r||(r={}))},e047:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r,n=i("2c4f"),a=i("b2b2");!function(e){e[e.WhenToolEditable=0]="WhenToolEditable",e[e.WhenToolNotEditable=1]="WhenToolNotEditable",e[e.Always=2]="Always"}(r||(r={}));class s{constructor(){this._isToolEditable=!0,this._manipulators=new n["a"],this._nextManipulatorId=0,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=r.WhenToolEditable){return this.addMany([e],t)[0]}addMany(e,t=r.WhenToolEditable){return e.map(e=>{const i=this._nextManipulatorId++,r={id:i,manipulator:e,visibilityPredicate:t,attached:!1};return this._manipulators.add(r),this._attached&&this._updateManipulatorAttachment(r),i})}remove(e){if("number"==typeof e){const t=e;for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.getItemAt(e).id===t){const t=this._manipulators.splice(e,1)[0];return this._detachManipulator(t),t.id}return null}const t=e;for(let i=0;i<this._manipulators.length;i++)if(this._manipulators.getItemAt(i).manipulator===t){const e=this._manipulators.splice(i,1)[0];return this._detachManipulator(e),e.id}return null}removeAll(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(e=>{this._updateManipulatorAttachment(e)}),this._attached=!0}detach(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._attached=!1}destroy(){this._manipulators.forEach(({manipulator:e})=>{e.destroy&&e.destroy()}),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,e=>{t(e)})}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach(t=>e.push(t.manipulator)),e}intersect(e,t){let i=null,r=Number.MAX_VALUE;return this._manipulators.forEach(({id:n,manipulator:s,attached:o})=>{if(!o||!s.interactive)return;const c=s.intersectionDistance(e,t);Object(a["k"])(c)&&c<r&&(r=c,i={id:n,manipulator:s})}),i}findById(e){if(Object(a["j"])(e))return null;for(const t of this._manipulators.items)if(e===t.id)return t.manipulator;return null}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===r.Always||(this._isToolEditable?e.visibilityPredicate===r.WhenToolEditable:e.visibilityPredicate===r.WhenToolNotEditable)}}},e1e0:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("b50f"),n=i("3349"),a=i("34f2");class s{constructor(e,t,i=a["a"].CUMULATIVE){this.origin=e,this.angle=t,this.accumulationType=i}_rotate(e,t){Object(n["r"])(e.pos,e.pos,this.origin,t)}apply(e){this._rotate(e,this.angle)}undo(e){this._rotate(e,-this.angle)}canAccumulate(e){return e instanceof s&&Object(r["d"])(this.origin,e.origin)}accumulate(e,t){const i=t.accumulationType===a["a"].REPLACE;this._rotate(e,i?t.angle-this.angle:t.angle)}accumulateParams(e){const t=e.accumulationType===a["a"].REPLACE;this.angle=t?e.angle:this.angle+e.angle}}},e550:function(e,t,i){"use strict";i.d(t,"a",(function(){return S}));var r=i("d981"),n=i("3886");function a(e){e.fragment.code.add(n["b"]`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var s=i("5d5f"),o=i("df77"),c=i("38a4"),l=i("b2b2"),h=i("3349"),d=i("02f1"),u=i("2255"),p=i("7bf3"),b=i("2ca8"),f=i("d8a4"),g=i("ea32"),O=i("1fe9"),m=i("85b3"),v=i("62ae"),_=i("52b2");class j extends v["a"]{constructor(e,t){super(e,"samplerCube",_["a"].Pass,(i,r,n)=>i.bindTexture(e,t(r,n)))}}function y(e){const t=e.fragment;t.uniforms.add([new m["a"]("rotationMatrixClouds",(e,t)=>t.clouds.parallax.transform),new m["a"]("rotationMatrixCloudsCrossFade",(e,t)=>t.clouds.parallaxNew.transform),new g["a"]("anchorPosition",(e,t)=>t.clouds.parallax.anchorPointClouds),new g["a"]("anchorPositionCrossFade",(e,t)=>t.clouds.parallaxNew.anchorPointClouds),new f["a"]("cloudVariables",(e,t)=>Object(l["k"])(t.clouds.data)?Object(h["a"])(x,t.clouds.data.coverage,t.clouds.data.absorption):d["b"]),new O["a"]("cloudsHeight",(e,t)=>t.clouds.parallax.cloudsHeight),new O["a"]("radiusCurvatureCorrectionFactor",(e,t)=>t.clouds.parallax.radiusCurvatureCorrectionFactor),new O["a"]("totalFadeInOut",(e,t)=>t.clouds.fadeInOut.stage===p["b"].FINISHED?t.clouds.fadeInOutHeight.factor+Math.max(Object(c["e"])(t.clouds.fadeIn.factor,0,1)):t.clouds.fadeInOutHeight.factor+Math.max(Object(c["e"])(t.clouds.fadeInOut.factor,0,1))),new O["a"]("crossFadeAnchorFactor",(e,t)=>Object(c["e"])(t.clouds.crossFade.factor,0,1)),new j("cubeMap",(e,t)=>Object(l["k"])(t.clouds.data)?t.clouds.data.cubeMap.colorTexture:null),new b["a"]("crossFade",(e,t)=>t.clouds.crossFade.enabled)]),t.constants.add("planetRadius","float",u["a"].radius),t.code.add(n["b"]`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(n["b"]`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(n["b"]`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),t.uniforms.add([new g["a"]("lightingMainDirection",(e,t)=>t.lighting.lightingMainDirection),new g["a"]("lightingMainIntensity",(e,t)=>t.lighting.mainLight.intensity)]),t.code.add(n["b"]`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(n["b"]`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),t.code.add(n["b"]`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(n["b"]`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(n["b"]`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}const x=Object(d["c"])();function S(e,t){e.include(s["a"],t),e.include(a),e.include(r["a"]),t.hasCloudsReflections&&e.include(y,t),t.hasScreenSpaceReflections&&e.include(o["b"],t);const i=e.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(n["b"]`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add([new O["a"]("lightingSpecularStrength",(e,t)=>t.lighting.mainLight.specularStrength),new O["a"]("lightingEnvironmentStrength",(e,t)=>t.lighting.mainLight.environmentStrength)]),i.code.add(n["b"]`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&i.code.add(n["b"]`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?i.code.add(n["b"]`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):i.code.add(n["b"]`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?i.code.add(n["b"]`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(n["b"]`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(n["b"]`return waterRenderedColor;
}`)}},e6aa:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i("ea32"),n=i("76a8"),a=i("1fe9"),s=i("955a"),o=i("3886"),c=i("b7bd"),l=i("02a0");const h=8;function d(e,t){const i=e.vertex;i.uniforms.add(new a["a"]("intrinsicWidth",e=>e.width)),t.vvSize?(e.attributes.add(c["a"].SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new r["a"]("vvSizeMinSize",e=>e.vvSizeMinSize)),i.uniforms.add(new r["a"]("vvSizeMaxSize",e=>e.vvSizeMaxSize)),i.uniforms.add(new r["a"]("vvSizeOffset",e=>e.vvSizeOffset)),i.uniforms.add(new r["a"]("vvSizeFactor",e=>e.vvSizeFactor)),i.code.add(o["b"]`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(c["a"].SIZE,"float"),i.code.add(o["b"]`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(c["a"].OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add([new s["a"]("vvOpacityValues",e=>e.vvOpacityValues,h),new s["a"]("vvOpacityOpacities",e=>e.vvOpacityOpacities,h)]),i.code.add(o["b"]`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(o["b"]`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(c["a"].COLORFEATUREATTRIBUTE,"float"),i.constants.add("vvColorNumber","int",l["b"]),i.uniforms.add(new s["a"]("vvColorValues",e=>e.vvColorValues,l["b"])),i.uniforms.add(new n["a"]("vvColorColors",e=>e.vvColorColors,l["b"])),i.code.add(o["b"]`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(c["a"].COLOR,"vec4"),i.code.add(o["b"]`vec4 getColor(){
return applyOpacity(color);
}`))}},e7e3:function(e,t,i){"use strict";i.d(t,"a",(function(){return k}));var r=i("a4ee"),n=i("ce6d"),a=i("9096"),s=i("7ffa"),o=i("b2b2"),c=i("f4cc"),l=i("f315"),h=i("477c"),d=i("a915"),u=i("8048"),p=i("59b2"),b=(i("cea0"),i("d386")),f=i("3563"),g=i("f408"),O=i("3c9c"),m=i("4aea");class v{constructor({grabbableForEvent:e}){this.events=new n["a"],this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=e}intersectionDistance(e,t){return 0}attach(){}detach(){}}var _=i("8b1a"),j=i("c20d"),y=i("6ae9"),x=i("2c8f"),S=i("bd72"),T=i("5aed"),w=i("1f1c"),M=i("8a19"),A=i("94a9"),E=i("cfb5");let R=class extends E["a"]{constructor(e){super(e),this.type="draw-point"}};Object(r["a"])([Object(p["b"])()],R.prototype,"type",void 0),Object(r["a"])([Object(p["b"])()],R.prototype,"elevation",void 0),R=Object(r["a"])([Object(b["a"])("esri.views.interactive.tooltip.DrawPointTooltipInfo")],R);let P=class extends E["a"]{constructor(e){super(e),this.type="draw-polyline"}};Object(r["a"])([Object(p["b"])()],P.prototype,"type",void 0),Object(r["a"])([Object(p["b"])()],P.prototype,"elevation",void 0),Object(r["a"])([Object(p["b"])()],P.prototype,"totalLength",void 0),P=Object(r["a"])([Object(b["a"])("esri.views.interactive.tooltip.DrawPolylineTooltipInfo")],P);let C=class extends E["a"]{constructor(e){super(e),this.type="draw-polygon"}};Object(r["a"])([Object(p["b"])()],C.prototype,"type",void 0),Object(r["a"])([Object(p["b"])()],C.prototype,"elevation",void 0),Object(r["a"])([Object(p["b"])()],C.prototype,"area",void 0),C=Object(r["a"])([Object(b["a"])("esri.views.interactive.tooltip.DrawPolygonTooltipInfo")],C);var D=i("4492"),I=i("0b2d"),L=i("0f2e"),N=i("be4a"),z=i("b66e");function V(e,t){var i,r,n;const a=e=>Object(N["d"])(e,t),s=(e,i,r)=>Object(N["a"])(e,i,r,t),c=a(e),h=null!=(i=null==(r=e.paths[0])?void 0:r[(null==(n=e.paths[0])?void 0:n.length)-1])?i:null,{hasZ:d,spatialReference:u}=e,p=h?Object(I["h"])(h[0],h[1],d?h[2]:0):null;return e=>{if(Object(o["j"])(e)||Object(o["j"])(c)||Object(o["j"])(p))return c;G[0]=e.x,G[1]=e.y,G[2]=d?e.z:0;const t=s(p,G,u);return Object(o["j"])(t)?c:Object(l["c"])(c.value+t.value,c.unit)}}function F(e,t){const i=Object(z["a"])(),r=e=>Object(L["a"])(e,t,i);return t=>{if(Object(o["j"])(t)||e.rings.length<1||e.rings[0].length<2)return r(e);const i=e.clone();return i.rings[0].push([t.x,t.y]),r(i)}}const G=Object(I["f"])();let k=class extends(n["a"].EventedMixin(a["a"])){constructor(e){super(e),this._createOperationCompleted=!1,this._pointerDownStates=new Set,this._snappingPipeline=new M["a"],this._tooltip=null,this._tooltipContext={calculateElevation:null,calculateTotalLength:null,calculateArea:null},this.isDraped=!0,this.labelOptions=new S["a"],this.tooltipOptions=new T["a"],this.snapToSceneEnabled=null,Object(o["j"])(e.elevationInfo)&&(this.elevationInfo={mode:e.hasZ?"absolute-height":"on-the-ground",offset:0})}initialize(){const{geometryType:e,view:t}=this,{spatialReference:i}=t,r="viewingMode"in t.state?t.state.viewingMode:O["a"].Local,n="segment"===e||"multipoint"===e?"polyline":e;this.coordinateHelper=Object(_["a"])(this.hasZ,this.hasM,i),this._editGeometryOperations=new x["a"](new y["c"](n,this.coordinateHelper)),this._snappingOperation=new A["a"]({view:t}),this.handles.add(Object(h["f"])(()=>this.stagedVertex,(e,t)=>{Object(o["k"])(this._tooltip)&&(Object(o["k"])(t)!==Object(o["k"])(e)?this._tooltip.info=this._getTooltipInfo():this._updateTooltipInfo()),Object(o["j"])(e)||this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(e)}],operation:"apply",type:"vertex-update"})},{sync:!0,equals:(e,t)=>Object(o["f"])(e,t,f["a"])})),this._activeComponent=new y["a"](i,r),this._editGeometryOperations.data.components.push(this._activeComponent);const a=this.segmentLabels;Object(o["k"])(a)&&(a.context={view:t,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.handles.add([Object(h["f"])(()=>this.labelOptions.enabled,e=>{a.visible=e},h["e"]),this.on("cursor-update",()=>{const e=this.stagedVertex;a.stagedVertex=Object(o["k"])(e)?this.coordinateHelper.pointToVector(e):null})])),this.handles.add(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],e=>{const t=e.vertices.map(e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.vectorToArray(e.pos)})),i=t.map(e=>e.coordinates);switch(e.type){case"vertex-add":this.emit(e.type,{...e,added:i,vertices:t});break;case"vertex-update":this.emit(e.type,{...e,updated:i,vertices:t});break;case"vertex-remove":this.emit(e.type,{...e,removed:i,vertices:t})}})),this._manipulator=new v({grabbableForEvent:e=>"click"!==this.drawingMode||"touch"===e.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size}),this.manipulators.add(this._manipulator),this._manipulator.grabbable="point"!==e,this.handles.add([this._createManipulatorDragPipeline(this._manipulator),this._manipulator.events.on("immediate-click",e=>this._onImmediateClick(e)),this._manipulator.events.on("immediate-double-click",e=>this._onImmediateDoubleClick(e)),Object(h["f"])(()=>this.tooltipOptions.enabled,e=>{this._tooltip=e?new D["a"]({view:t,info:this._getTooltipInfo()}):Object(o["d"])(this._tooltip)},h["a"]),this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],()=>Object(o["b"])(this._tooltip,e=>{e.info=this._getTooltipInfo()}))])}destroy(){Object(o["d"])(this.segmentLabels),Object(o["d"])(this._snappingOperation),this._tooltip=Object(o["d"])(this._tooltip),this._editGeometryOperations=Object(o["d"])(this._editGeometryOperations)}get _snappingEnabled(){return Object(o["k"])(this.snappingManager)&&this.snappingManager.options.effectiveEnabled}get _defaultElevation(){return Object(l["c"])(this.defaultZ,"meters")}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(e=>this.coordinateHelper.vectorToArray(e.pos))}set drawingMode(e){this._set("drawingMode",null!=e?e:m["a"])}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get numVertices(){return Object(o["k"])(this.stagedVertex)?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get stagedVertex(){return this._snappingOperation.stagedPoint}set stagedVertex(e){this._snappingOperation.stagedPoint=Object(s["a"])(e)}get updating(){return this.updatingHandles.updating}get vertices(){const e=this.committedVertices;return Object(o["k"])(this.stagedVertex)&&e.push(this.coordinateHelper.pointToArray(this.stagedVertex)),e}get stagedOrLastVertex(){if(Object(o["k"])(this.stagedVertex))return this.stagedVertex;const e=this._activeComponent.getLastVertex();return Object(o["j"])(e)?null:this._editGeometryOperations.data.coordinateHelper.vectorToDehydratedPoint(e.pos)}cancel(){this.complete({aborted:!0})}commitStagedVertex(){if(this._snappingOperation.abort(),Object(o["k"])(this.stagedVertex)){const{stagedVertex:e}=this;this.stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}}complete(e){const t=e&&e.aborted||!1;this._snappingOperation.abort(),Object(o["k"])(this.snappingManager)&&this.snappingManager.doneSnapping(),"segment"===this.geometryType||"point"===this.geometryType?this.commitStagedVertex():this.stagedVertex=null;const i="multipoint"===this.geometryType&&0===this.numVertices||"polyline"===this.geometryType&&this.numVertices<2||"polygon"===this.geometryType&&this.numVertices<3;this._createOperationCompleted=!i,(this.isCompleted||t)&&this.emit("complete",{vertices:this.vertices.map((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e})),aborted:t,type:"complete"})}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){Object(o["k"])(this.snappingManager)&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_closeOnClickVertexIndex(e){const t=this._activeComponent;if("polygon"===this.geometryType&&t.vertices.length>2){if(this._vertexWithinPointerDistance(t.vertices[0].pos,e))return 0;if(this._vertexWithinPointerDistance(t.vertices[t.vertices.length-1].pos,e))return t.vertices.length-1}return null}_createManipulatorDragPipeline(e){switch(Object(o["r"])(this.drawingMode)){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return Object(j["e"])(e,(e,t,i,r)=>{const n="touch"===r&&this._snappingEnabled;!this.isCompleted&&n&&(t.next(this._screenToMapDragEventStep()).next(e=>("start"===e.action&&(this.stagedVertex=e.mapStart,("segment"===this.geometryType||n&&0===this.numVertices)&&this.commitStagedVertex()),e)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>n,cancel:i,snappingManager:this.snappingManager,snappingContext:new w["a"]({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:r,visualizer:this.snappingVisualizer}),updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next(e=>(n&&(this.stagedVertex=e.mapEnd,"end"===e.action&&this.commitStagedVertex()),e)).next(e=>("end"===e.action&&("segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),e)),i.next(()=>{n&&Object(o["k"])(this.snappingManager)&&this.snappingManager.doneSnapping()}))})}_createManipulatorDragPipelineFreehand(e){return Object(j["e"])(e,(e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next(e=>("start"===e.action&&(Object(o["j"])(this.stagedVertex)&&(this.stagedVertex=e.mapStart),"segment"===this.geometryType&&this.commitStagedVertex()),e)).next(e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return e})})}_createManipulatorDragPipelineHybrid(e){return Object(j["e"])(e,(e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next(e=>("start"===e.action&&(Object(o["j"])(this.stagedVertex)&&(this.stagedVertex=e.mapStart),this.commitStagedVertex()),e)).next(e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return e})})}_getDrawSurface(){if(Object(o["j"])(this.elevationDrawSurface))return this.drawSurface;if(!this.coordinateHelper.hasZ)return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;let e=this.defaultZ,t=!1;Object(o["k"])(this.elevationInfo)&&"absolute-height"===this.elevationInfo.mode&&(t=!0),Object(o["k"])(this.snapToSceneEnabled)&&(t=this.snapToSceneEnabled),Object(o["k"])(this.elevationInfo)&&"on-the-ground"===this.elevationInfo.mode&&(t=!1);const i=this._activeComponent.vertices.length;return("segment"===this.geometryType||"polygon"===this.geometryType)&&i>0&&(e=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),t=!1),t?this.drawSurface:(this.elevationDrawSurface.defaultZ=e,this.elevationDrawSurface)}_mapToScreen(e){return this._getDrawSurface().mapToScreen(e)}_onHold(e){this._snappingOperation.abort(),"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&(this.stagedVertex=e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if("mouse"===e.pointerType&&2===e.button||this._manipulator.dragging)return;const t=this._activeComponent,i=this._closeOnClickVertexIndex(e.screenPoint);if(Object(o["k"])(i))return e.stopPropagation(),void this.complete();const r=this._screenToMap(e.screenPoint);if(Object(o["k"])(r))switch(this.drawingMode){case"freehand":"point"===this.geometryType&&(Object(o["k"])(this.stagedVertex)?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(r)),this.complete());break;case"click":case"hybrid":this._snappingOperation.abort(),Object(o["k"])(this.stagedVertex)?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(r)),("point"===this.geometryType||"segment"===this.geometryType&&2===t.vertices.length||"segment"===this.geometryType&&"hybrid"===this.drawingMode&&1===t.vertices.length)&&this.complete()}e.stopPropagation()}_onImmediateDoubleClick(e){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),e.stopPropagation())}_onPointerMove(e){const t=Object(d["e"])(e.x,e.y);if(this._manipulator.dragging||this._pointerDownStates.has(e.pointerId)||this._manipulator.grabbing||!this._manipulator.interactive)return void this._snappingOperation.abort();e.stopPropagation();const i=this._closeOnClickVertexIndex(t);if(Object(o["k"])(i))return this._closeOnVertex(i),void this._snappingOperation.abort();const r=this._screenToMap(t);if(this._manipulator.cursor=Object(o["k"])(r)?"crosshair":null,Object(o["j"])(r))return void this._snappingOperation.abort();if(Object(o["j"])(this.snappingManager))return this.stagedVertex=r,void this._snappingOperation.abort();const n=this.snappingManager,a=new w["a"]({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e.pointerType,visualizer:this.snappingVisualizer});this.updatingHandles.addPromise(Object(c["i"])(this._snappingOperation.snap(r,n,a)))}_closeOnVertex(e){this.stagedVertex=null;const t={componentIndex:0,vertexIndex:e,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[e].pos)};this.emit("cursor-update",{updated:null,vertices:[t],operation:"apply",type:"vertex-update"})}_screenToMap(e){return this._getDrawSurface().screenToMap(e)}_screenToMapDragEventStep(){let e=null;return t=>{if("start"===t.action&&(e=this._screenToMap(t.screenStart)),Object(o["j"])(e))return null;const i=this._screenToMap(t.screenEnd);return Object(o["k"])(i)?{...t,mapStart:e,mapEnd:i}:null}}_vertexWithinPointerDistance(e,t){const i=25,r=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return!!Object(o["k"])(r)&&U(r,t,i)}_calculateVertexTooltipElevation(e){const{tooltipOptions:t,view:i}=this;if(Object(o["j"])(e)||"2d"===i.type)return this._defaultElevation;const r=this.elevationInfo,n=t.elevation.mode,{spatialReference:a}=e,s=Object(u["g"])(a),c=Object(g["a"])(i,e,r,{mode:n,offset:0});return Object(l["c"])(c*s,"meters")}_getTooltipInfo(){const{tooltipOptions:e,stagedOrLastVertex:t}=this;if(Object(o["j"])(t))return null;this._tooltipContext.calculateElevation=e=>this._calculateVertexTooltipElevation(e);const i=this._elevationTooltipDetail(t);switch(this.geometryType){case"point":return new R({tooltipOptions:e,elevation:i});case"polyline":return this._tooltipContext.calculateTotalLength=V(this._editGeometryOperations.data.geometry,this.isDraped?"on-the-ground":"absolute-height"),new P({tooltipOptions:e,elevation:i,totalLength:this._totalLengthTooltipDetail(t)});case"polygon":return this._tooltipContext.calculateArea=F(this._editGeometryOperations.data.geometry,this.isDraped),new C({tooltipOptions:e,elevation:i,area:this._areaTooltipDetail(t)});default:return null}}_elevationTooltipDetail(e){return{mode:this.elevationInfo.mode,...Object(o["r"])(this._tooltipContext.calculateElevation)(e)}}_totalLengthTooltipDetail(e){return{...Object(o["s"])(Object(o["r"])(this._tooltipContext.calculateTotalLength)(e),Object(l["c"])(0,"meters"))}}_areaTooltipDetail(e){return{...Object(o["s"])(Object(o["r"])(this._tooltipContext.calculateArea)(e),Object(l["b"])(0,"square-meters"))}}_updateTooltipInfo(){const e=this._tooltip;if(Object(o["j"])(e))return;const{stagedOrLastVertex:t}=this,i=this._elevationTooltipDetail(t);switch(this.geometryType){case"point":e.info.elevation=i;break;case"polyline":{const r=e.info;r.elevation=i,r.totalLength=this._totalLengthTooltipDetail(t);break}case"polygon":{const r=e.info;r.elevation=i,r.area=this._areaTooltipDetail(t);break}}}get test(){return{tooltip:this._tooltip}}};function U(e,t,i){const r=e.x-t.x,n=e.y-t.y;return r*r+n*n<=i}Object(r["a"])([Object(p["b"])()],k.prototype,"_defaultElevation",null),Object(r["a"])([Object(p["b"])()],k.prototype,"defaultZ",void 0),Object(r["a"])([Object(p["b"])()],k.prototype,"isDraped",void 0),Object(r["a"])([Object(p["b"])({value:m["a"]})],k.prototype,"drawingMode",null),Object(r["a"])([Object(p["b"])({constructOnly:!0})],k.prototype,"elevationDrawSurface",void 0),Object(r["a"])([Object(p["b"])({constructOnly:!0})],k.prototype,"elevationInfo",void 0),Object(r["a"])([Object(p["b"])({constructOnly:!0,type:S["a"]})],k.prototype,"labelOptions",void 0),Object(r["a"])([Object(p["b"])({constructOnly:!0,type:T["a"]})],k.prototype,"tooltipOptions",void 0),Object(r["a"])([Object(p["b"])({constructOnly:!0})],k.prototype,"geometryType",void 0),Object(r["a"])([Object(p["b"])({constructOnly:!0})],k.prototype,"hasM",void 0),Object(r["a"])([Object(p["b"])({constructOnly:!0})],k.prototype,"hasZ",void 0),Object(r["a"])([Object(p["b"])({constructOnly:!0})],k.prototype,"manipulators",void 0),Object(r["a"])([Object(p["b"])({constructOnly:!0})],k.prototype,"drawSurface",void 0),Object(r["a"])([Object(p["b"])({constructOnly:!0})],k.prototype,"segmentLabels",void 0),Object(r["a"])([Object(p["b"])({constructOnly:!0})],k.prototype,"snappingManager",void 0),Object(r["a"])([Object(p["b"])({constructOnly:!0})],k.prototype,"snappingVisualizer",void 0),Object(r["a"])([Object(p["b"])()],k.prototype,"snapToSceneEnabled",void 0),Object(r["a"])([Object(p["b"])()],k.prototype,"_snappingOperation",void 0),Object(r["a"])([Object(p["b"])()],k.prototype,"stagedVertex",null),Object(r["a"])([Object(p["b"])()],k.prototype,"updating",null),Object(r["a"])([Object(p["b"])({constructOnly:!0})],k.prototype,"view",void 0),k=Object(r["a"])([Object(b["a"])("esri.views.draw.DrawOperation")],k)},e93d:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return l}));var r=i("b2b2"),n=i("f4cc"),a=i("3886"),s=i("b7c2"),o=i("d7f7");class c extends o["a"]{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,e=>this._texture=e),this._acquire(e.normalTextureId,e=>this._textureNormal=e),this._acquire(e.emissiveTextureId,e=>this._textureEmissive=e),this._acquire(e.occlusionTextureId,e=>this._textureOcclusion=e),this._acquire(e.metallicRoughnessTextureId,e=>this._textureMetallicRoughness=e)}dispose(){this._texture=Object(r["p"])(this._texture),this._textureNormal=Object(r["p"])(this._textureNormal),this._textureEmissive=Object(r["p"])(this._textureEmissive),this._textureOcclusion=Object(r["p"])(this._textureOcclusion),this._textureMetallicRoughness=Object(r["p"])(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return 0===this._numLoading?s["g"].LOADED:s["g"].LOADING}get textureBindParameters(){return new l(Object(r["k"])(this._texture)?this._texture.glTexture:null,Object(r["k"])(this._textureNormal)?this._textureNormal.glTexture:null,Object(r["k"])(this._textureEmissive)?this._textureEmissive.glTexture:null,Object(r["k"])(this._textureOcclusion)?this._textureOcclusion.glTexture:null,Object(r["k"])(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){(Object(r["j"])(this._texture)||e!==this._texture.id)&&(this._texture=Object(r["p"])(this._texture),this._textureId=e,this._acquire(this._textureId,e=>this._texture=e))}_acquire(e,t){if(Object(r["j"])(e))return void t(null);const i=this._textureRepository.acquire(e);if(Object(n["l"])(i))return++this._numLoading,void i.then(e=>{if(this._disposed)return Object(r["p"])(e),void t(null);t(e)}).finally(()=>--this._numLoading);t(i)}}class l extends a["a"]{constructor(e=null,t=null,i=null,r=null,n=null){super(),this.texture=e,this.textureNormal=t,this.textureEmissive=i,this.textureOcclusion=r,this.textureMetallicRoughness=n}}},e94b:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c}));i("e06a");var r=i("b2b2"),n=i("8048"),a=i("536f"),s=i("3af1");function o(e,t,i,a=new s["a"]){let o;if("2d"===i.type)o=t*i.resolution;else if("3d"===i.type){const a=i.overlayPixelSizeInMapUnits(e),s=i.basemapSpatialReference;o=Object(r["k"])(s)&&!s.equals(i.spatialReference)?Object(n["f"])(s)/Object(n["f"])(i.spatialReference):t*a}const c=e.x-o,l=e.y-o,h=e.x+o,d=e.y+o,{spatialReference:u}=i;return a.xmin=Math.min(c,h),a.ymin=Math.min(l,d),a.xmax=Math.max(c,h),a.ymax=Math.max(l,d),a.spatialReference=u,a}function c(e,t,i){const n=i.toMap(e);return!Object(r["j"])(n)&&o(n,Object(a["a"])(),i,l).intersects(t)}const l=new s["a"]},e9d6:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return u})),i.d(t,"f",(function(){return h})),i.d(t,"g",(function(){return p}));var r=i("e92d"),n=i("d3cf"),a=i("82fa");const s=r["a"].getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function o(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}async function c(e,t,i){const r=e&&e.expression;if("string"!=typeof r)return null;const n=f(r);if(null!=n)return{cachedResult:n};const s=await Object(a["e"])(),o=s.arcadeUtils,c=o.createSyntaxTree(r);return o.dependsOnView(c)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(c),context:o.createExecContext(null,{sr:t}),modules:s}}}function l(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function h(e,t){if(null!=e&&!b(e)){if(!t||!e.arcade)return void s.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=Object(n["b"])(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function d(e){if(null!=e){if(b(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0}function u(e,t=!1){let i=e&&e.featureExpressionInfo;const r=i&&i.expression;return t||"0"===r||(i=null),i}const p={cachedResult:0};function b(e){return null!=e.cachedResult}function f(e){return"0"===e?0:null}},ea32:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("62ae"),n=i("52b2");class a extends r["a"]{constructor(e,t){super(e,"vec3",n["a"].Pass,(i,r,n)=>i.setUniform3fv(e,t(r,n)))}}},ea44:function(e,t,i){"use strict";i.d(t,"a",(function(){return E})),i.d(t,"b",(function(){return A}));var r=i("bd75"),n=i("a05b"),a=i("d272"),s=i("4db9"),o=i("6a07"),c=i("2906"),l=i("c76b"),h=i("c6d7"),d=i("040b"),u=i("a7d7"),p=i("d017"),b=i("e550"),f=i("33e2"),g=i("3976"),O=i("4377"),m=i("8e97"),v=i("ea32"),_=i("fd48"),j=i("db7b"),y=i("1fe9"),x=i("3886"),S=i("3853"),T=i("690a"),w=i("b7c2"),M=i("b7bd");function A(e){const t=new T["a"],{vertex:i,fragment:A}=t,E=Object(m["b"])(t,e);return t.include(s["a"]),t.attributes.add(M["a"].POSITION,"vec3"),t.attributes.add(M["a"].UV0,"vec2"),i.uniforms.add(new _["a"]("waterColor",e=>e.color)),e.output!==n["a"].Color&&e.output!==n["a"].Alpha||(t.include(d["a"],e),t.include(r["a"],e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),A.uniforms.add(E),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.code.add(x["b"]`
      void main(void) {
        if (waterColor.a < ${x["b"].float(g["b"])}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===n["a"].Color?"forwardLinearDepth();":""}
      }
    `)),t.include(h["b"],e),e.output===n["a"].Alpha&&(t.include(a["a"],e),A.uniforms.add(new j["a"]("waterColor")),A.code.add(x["b"]`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),e.output===n["a"].Color&&(t.include(l["a"],{isGround:!1}),t.include(c["a"],{pbrMode:u["a"].Disabled,lightingSphericalHarmonicsOrder:2}),t.include(f["a"]),t.include(a["a"],e),t.include(p["a"],e),t.include(b["a"],e),A.uniforms.add([new j["a"]("waterColor"),new v["a"]("lightingMainDirection",(e,t)=>t.lighting.lightingMainDirection),new v["a"]("lightingMainIntensity",(e,t)=>t.lighting.mainLight.intensity),new y["a"]("timeElapsed",e=>e.timeElapsed),new S["a"]("view")]),Object(m["a"])(A,e),A.include(O["a"]),A.code.add(x["b"]`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?x["b"]`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===w["i"].Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output===n["a"].Normal&&(t.include(d["a"],e),t.include(f["a"],e),t.include(a["a"],e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i.code.add(x["b"]`
        void main(void) {
          if (waterColor.a < ${x["b"].float(g["b"])}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),A.uniforms.add(new y["a"]("timeElapsed",e=>e.timeElapsed)),A.code.add(x["b"]`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),e.output===n["a"].Draped&&(t.varyings.add("vpos","vec3"),i.code.add(x["b"]`
        void main(void) {
          if (waterColor.a < ${x["b"].float(g["b"])}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),A.uniforms.add(new j["a"]("waterColor")),A.code.add(x["b"]`void main() {
gl_FragColor = waterColor;
}`)),e.output===n["a"].Highlight&&(t.include(o["a"]),t.varyings.add("vpos","vec3"),i.code.add(x["b"]`
      void main(void) {
        if (waterColor.a < ${x["b"].float(g["b"])}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(a["a"],e),A.code.add(x["b"]`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const E=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}))},ea51:function(e,t,i){"use strict";i.r(t),i.d(t,"buffer",(function(){return M})),i.d(t,"clip",(function(){return o})),i.d(t,"contains",(function(){return l})),i.d(t,"convexHull",(function(){return j})),i.d(t,"crosses",(function(){return h})),i.d(t,"cut",(function(){return c})),i.d(t,"densify",(function(){return z})),i.d(t,"difference",(function(){return y})),i.d(t,"disjoint",(function(){return g})),i.d(t,"distance",(function(){return d})),i.d(t,"equals",(function(){return u})),i.d(t,"extendedSpatialReferenceInfo",(function(){return s})),i.d(t,"flipHorizontal",(function(){return I})),i.d(t,"flipVertical",(function(){return L})),i.d(t,"generalize",(function(){return N})),i.d(t,"geodesicArea",(function(){return k})),i.d(t,"geodesicBuffer",(function(){return A})),i.d(t,"geodesicDensify",(function(){return V})),i.d(t,"geodesicLength",(function(){return U})),i.d(t,"intersect",(function(){return S})),i.d(t,"intersects",(function(){return p})),i.d(t,"isSimple",(function(){return v})),i.d(t,"nearestCoordinate",(function(){return E})),i.d(t,"nearestVertex",(function(){return R})),i.d(t,"nearestVertices",(function(){return P})),i.d(t,"offset",(function(){return w})),i.d(t,"overlaps",(function(){return O})),i.d(t,"planarArea",(function(){return F})),i.d(t,"planarLength",(function(){return G})),i.d(t,"relate",(function(){return m})),i.d(t,"rotate",(function(){return D})),i.d(t,"simplify",(function(){return _})),i.d(t,"symmetricDifference",(function(){return x})),i.d(t,"touches",(function(){return b})),i.d(t,"union",(function(){return T})),i.d(t,"within",(function(){return f}));var r=i("f606"),n=i("7590");function a(e){return Array.isArray(e)?e[0].spatialReference:e&&e.spatialReference}function s(e){return r["G"].extendedSpatialReferenceInfo(e)}function o(e,t){return r["G"].clip(n["hydratedAdapter"],a(e),e,t)}function c(e,t){return r["G"].cut(n["hydratedAdapter"],a(e),e,t)}function l(e,t){return r["G"].contains(n["hydratedAdapter"],a(e),e,t)}function h(e,t){return r["G"].crosses(n["hydratedAdapter"],a(e),e,t)}function d(e,t,i){return r["G"].distance(n["hydratedAdapter"],a(e),e,t,i)}function u(e,t){return r["G"].equals(n["hydratedAdapter"],a(e),e,t)}function p(e,t){return r["G"].intersects(n["hydratedAdapter"],a(e),e,t)}function b(e,t){return r["G"].touches(n["hydratedAdapter"],a(e),e,t)}function f(e,t){return r["G"].within(n["hydratedAdapter"],a(e),e,t)}function g(e,t){return r["G"].disjoint(n["hydratedAdapter"],a(e),e,t)}function O(e,t){return r["G"].overlaps(n["hydratedAdapter"],a(e),e,t)}function m(e,t,i){return r["G"].relate(n["hydratedAdapter"],a(e),e,t,i)}function v(e){return r["G"].isSimple(n["hydratedAdapter"],a(e),e)}function _(e){return r["G"].simplify(n["hydratedAdapter"],a(e),e)}function j(e,t=!1){return r["G"].convexHull(n["hydratedAdapter"],a(e),e,t)}function y(e,t){return r["G"].difference(n["hydratedAdapter"],a(e),e,t)}function x(e,t){return r["G"].symmetricDifference(n["hydratedAdapter"],a(e),e,t)}function S(e,t){return r["G"].intersect(n["hydratedAdapter"],a(e),e,t)}function T(e,t=null){return r["G"].union(n["hydratedAdapter"],a(e),e,t)}function w(e,t,i,s,o,c){return r["G"].offset(n["hydratedAdapter"],a(e),e,t,i,s,o,c)}function M(e,t,i,s=!1){return r["G"].buffer(n["hydratedAdapter"],a(e),e,t,i,s)}function A(e,t,i,s,o,c){return r["G"].geodesicBuffer(n["hydratedAdapter"],a(e),e,t,i,s,o,c)}function E(e,t,i=!0){return r["G"].nearestCoordinate(n["hydratedAdapter"],a(e),e,t,i)}function R(e,t){return r["G"].nearestVertex(n["hydratedAdapter"],a(e),e,t)}function P(e,t,i,s){return r["G"].nearestVertices(n["hydratedAdapter"],a(e),e,t,i,s)}function C(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent.center:null}function D(e,t,i){var n;if(null==e)throw new Error("Illegal Argument Exception");const a=e.spatialReference;if(null==(i=null!=(n=i)?n:C(e)))throw new Error("Illegal Argument Exception");const s=e.constructor.fromJSON(r["G"].rotate(e,t,i));return s.spatialReference=a,s}function I(e,t){var i;if(null==e)throw new Error("Illegal Argument Exception");const n=e.spatialReference;if(null==(t=null!=(i=t)?i:C(e)))throw new Error("Illegal Argument Exception");const a=e.constructor.fromJSON(r["G"].flipHorizontal(e,t));return a.spatialReference=n,a}function L(e,t){var i;if(null==e)throw new Error("Illegal Argument Exception");const n=e.spatialReference;if(null==(t=null!=(i=t)?i:C(e)))throw new Error("Illegal Argument Exception");const a=e.constructor.fromJSON(r["G"].flipVertical(e,t));return a.spatialReference=n,a}function N(e,t,i,s){return r["G"].generalize(n["hydratedAdapter"],a(e),e,t,i,s)}function z(e,t,i){return r["G"].densify(n["hydratedAdapter"],a(e),e,t,i)}function V(e,t,i,s=0){return r["G"].geodesicDensify(n["hydratedAdapter"],a(e),e,t,i,s)}function F(e,t){return r["G"].planarArea(n["hydratedAdapter"],a(e),e,t)}function G(e,t){return r["G"].planarLength(n["hydratedAdapter"],a(e),e,t)}function k(e,t,i){return r["G"].geodesicArea(n["hydratedAdapter"],a(e),e,t,i)}function U(e,t,i){return r["G"].geodesicLength(n["hydratedAdapter"],a(e),e,t,i)}},ed70:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return s}));var r=i("0fc4");const n=1.2,a=r["b"],s=r["a"]},f315:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return l})),i.d(t,"f",(function(){return d}));var r=i("b2b2"),n=i("8048");function a(e,t){return{type:Object(n["y"])(t),value:e,unit:t}}function s(e,t){return{type:Object(n["y"])(t),value:e,unit:t}}function o(e,t){return{type:Object(n["y"])(t),value:e,unit:t}}function c(e,t,i="arithmetic"){return{type:Object(n["y"])(t),value:e,unit:t,rotationType:i}}function l(e,t){return a(Object(n["d"])(e.value,e.unit,t),t)}function h(e,t){return Object(r["j"])(e)?t:Object(r["j"])(t)||e.value>Object(n["d"])(t.value,t.unit,e.unit)?e:t}const d=s(0,"meters")},f3d9:function(e,t,i){"use strict";i.d(t,"a",(function(){return _})),i.d(t,"b",(function(){return v}));var r=i("b2b2"),n=i("02f1"),a=i("a05b"),s=i("d272"),o=i("4db9"),c=i("c6d7"),l=i("3976"),h=i("4377"),d=i("8e97"),u=i("d8a4"),p=i("1fe9"),b=i("3886"),f=i("690a"),g=i("6a3c"),O=i("b7c2"),m=i("b7bd");function v(e){const t=new f["a"];Object(d["b"])(t,e),t.include(o["a"]),t.attributes.add(m["a"].POSITION,"vec3"),t.attributes.add(m["a"].UV0,"vec2"),t.varyings.add("vpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float");const{vertex:i,fragment:v}=t;return i.uniforms.add(new u["a"]("textureCoordinateScaleFactor",e=>Object(r["k"])(e.texture)&&Object(r["k"])(e.texture.descriptor.textureCoordinateScaleFactor)?e.texture.descriptor.textureCoordinateScaleFactor:n["a"])),i.code.add(b["b"]`
    void main(void) {
      vpos = position;
      ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(s["a"],e),t.include(c["b"],e),v.uniforms.add([new g["a"]("tex",e=>e.texture),new p["a"]("opacity",e=>e.opacity)]),t.varyings.add("vTexCoord","vec2"),e.output===a["a"].Alpha?v.code.add(b["b"]`
    void main() {
      discardBySlice(vpos);
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${b["b"].float(l["a"])}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(v.include(h["a"]),v.code.add(b["b"]`
    void main() {
      discardBySlice(vpos);
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${b["b"].float(l["a"])}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${e.transparencyPassType===O["i"].Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),t}const _=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},f53a:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("477c");class n{constructor(e){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e,this._handle=Object(r["f"])(()=>this.view.ready,e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())})}applyProps(e){let t=!1;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}},f643:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("0b2d");class n{constructor(e,t){this.vec3=e,this.id=t}}function a(e,t,i,a){return new n(Object(r["h"])(e,t,i),a)}},f895:function(e,t,i){"use strict";i.d(t,"a",(function(){return _})),i.d(t,"b",(function(){return O})),i.d(t,"c",(function(){return g})),i.d(t,"d",(function(){return y})),i.d(t,"e",(function(){return S})),i.d(t,"f",(function(){return x})),i.d(t,"g",(function(){return E})),i.d(t,"h",(function(){return G})),i.d(t,"i",(function(){return H})),i.d(t,"j",(function(){return v}));i("c120");var r=i("e92d"),n=i("38a4"),a=i("b2b2"),s=i("d791"),o=i("e431"),c=i("0b2d"),l=i("7577"),h=i("0fc4"),d=i("3a35"),u=i("d18f"),p=i("a1b1"),b=i("7361");const f=r["a"].getLogger("esri.geometry.support.sphere");function g(){return Object(h["e"])()}function O(e,t=g()){return Object(l["c"])(t,e)}function m(e,t){return Object(h["g"])(e[0],e[1],e[2],t)}function v(e){return e}function _(e){e[0]=e[1]=e[2]=e[3]=0}function j(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function y(e){return e[3]}function x(e){return e}function S(e,t,i,r){return Object(h["g"])(e,t,i,r)}function T(e,t,i){return e!==i&&Object(o["g"])(i,e),i[3]=e[3]+t,i}function w(e,t,i){return f.error("sphere.setExtent is not yet supported"),e===i?i:O(e,i)}function M(e,t,i){if(Object(a["j"])(t))return!1;const{origin:r,direction:n}=t,s=A;s[0]=r[0]-e[0],s[1]=r[1]-e[1],s[2]=r[2]-e[2];const o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],c=2*(n[0]*s[0]+n[1]*s[1]+n[2]*s[2]),l=c*c-4*o*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-e[3]*e[3]);if(l<0)return!1;const h=Math.sqrt(l);let d=(-c-h)/(2*o);const u=(-c+h)/(2*o);return(d<0||u<d&&u>0)&&(d=u),!(d<0)&&(i&&(i[0]=r[0]+n[0]*d,i[1]=r[1]+n[1]*d,i[2]=r[2]+n[2]*d),!0)}const A=Object(c["f"])();function E(e,t){return M(e,t,null)}function R(e,t,i){if(M(e,t,i))return i;const r=P(e,t,b["d"].get());return Object(o["e"])(i,t.origin,Object(o["k"])(b["d"].get(),t.direction,Object(o["m"])(t.origin,r)/Object(o["p"])(t.direction))),i}function P(e,t,i){const r=b["d"].get(),n=b["a"].get();Object(o["j"])(r,t.origin,t.direction);const a=y(e);Object(o["j"])(i,r,t.origin),Object(o["k"])(i,i,1/Object(o["p"])(i)*a);const c=L(e,t.origin),l=Object(p["a"])(t.origin,i);return Object(s["d"])(n,l+c,r),Object(o["q"])(i,i,n),i}function C(e,t,i){return M(e,t,i)?i:(Object(u["a"])(t,x(e),i),D(e,i,i))}function D(e,t,i){const r=Object(o["f"])(b["d"].get(),t,x(e)),n=Object(o["k"])(b["d"].get(),r,e[3]/Object(o["p"])(r));return Object(o["e"])(i,n,x(e))}function I(e,t){const i=Object(o["f"])(b["d"].get(),t,x(e)),r=Object(o["t"])(i),n=e[3]*e[3];return Math.sqrt(Math.abs(r-n))}function L(e,t){const i=Object(o["f"])(b["d"].get(),t,x(e)),r=Object(o["p"])(i),a=y(e),s=a+Math.abs(a-r);return Object(n["b"])(a/s)}const N=Object(c["f"])();function z(e,t,i,r){const a=Object(o["f"])(N,t,x(e));switch(i){case d["a"].X:{const e=Object(n["d"])(a,N)[2];return Object(o["w"])(r,-Math.sin(e),Math.cos(e),0)}case d["a"].Y:{const e=Object(n["d"])(a,N),t=e[1],i=e[2],s=Math.sin(t);return Object(o["w"])(r,-s*Math.cos(i),-s*Math.sin(i),Math.cos(t))}case d["a"].Z:return Object(o["r"])(r,a);default:return}}function V(e,t){const i=Object(o["f"])(k,t,x(e));return Object(o["p"])(i)-e[3]}function F(e,t,i,r){const n=V(e,t),a=z(e,t,d["a"].Z,k),s=Object(o["k"])(k,a,i-n);return Object(o["e"])(r,t,s)}function G(e,t){const i=Object(o["h"])(x(e),t),r=y(e);return i<=r*r}const k=Object(c["f"])(),U=g(),H=Object.freeze(Object.defineProperty({__proto__:null,create:g,copy:O,fromCenterAndRadius:m,wrap:v,clear:_,fromRadius:j,getRadius:y,getCenter:x,fromValues:S,elevate:T,setExtent:w,intersectRay:M,intersectsRay:E,intersectRayClosestSilhouette:R,closestPointOnSilhouette:P,closestPoint:C,projectPoint:D,distanceToSilhouette:I,angleToSilhouette:L,axisAt:z,altitudeAt:V,setAltitudeAt:F,containsPoint:G,tmpSphere:U},Symbol.toStringTag,{value:"Module"}))},f9d0:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(e,t){var i;return null==(i=this._outer.get(e))?void 0:i.get(t)}set(e,t,i){const r=this._outer.get(e);r?r.set(t,i):this._outer.set(e,new Map([[t,i]]))}delete(e,t){const i=this._outer.get(e);i&&(i.delete(t),0===i.size&&this._outer.delete(e))}forEach(e){this._outer.forEach((t,i)=>e(t,i))}}},fa1e:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("b7bd");const n=new Map([[r["a"].POSITION,0],[r["a"].NORMAL,1],[r["a"].UV0,2],[r["a"].COLOR,3],[r["a"].SIZE,4],[r["a"].TANGENT,4],[r["a"].AUXPOS1,5],[r["a"].SYMBOLCOLOR,5],[r["a"].AUXPOS2,6],[r["a"].FEATUREATTRIBUTE,6],[r["a"].INSTANCEFEATUREATTRIBUTE,6],[r["a"].INSTANCECOLOR,7],[r["a"].MODEL,8],[r["a"].MODELNORMAL,12],[r["a"].MODELORIGINHI,11],[r["a"].MODELORIGINLO,15]])},fbd0:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("b50f"),n=i("02f1"),a=i("3349"),s=i("34f2");class o{constructor(e,t,i,r,a=s["a"].CUMULATIVE){this.origin=e,this.axis1=t,this.factor1=i,this.factor2=r,this.accumulationType=a,this.axis2=Object(n["g"])(t[1],-t[0])}_scale(e,t,i){Object(a["q"])(e.pos,e.pos,this.origin,this.axis1,t),Object(a["q"])(e.pos,e.pos,this.origin,this.axis2,i)}apply(e){this._scale(e,this.factor1,this.factor2)}undo(e){this._scale(e,1/this.factor1,1/this.factor2)}canAccumulate(e){return e instanceof o&&Object(r["d"])(this.origin,e.origin)&&Object(r["d"])(this.axis1,e.axis1)}accumulate(e,t){t.accumulationType===s["a"].REPLACE?this._scale(e,t.factor1/this.factor1,t.factor2/this.factor2):this._scale(e,t.factor1,t.factor2)}accumulateParams(e){const t=e.accumulationType===s["a"].REPLACE;this.factor1=t?e.factor1:this.factor1*e.factor1,this.factor2=t?e.factor2:this.factor2*e.factor2}}},fd48:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("62ae"),n=i("52b2");class a extends r["a"]{constructor(e,t){super(e,"vec4",n["a"].Pass,(i,r,n)=>i.setUniform4fv(e,t(r,n)))}}}}]);
//# sourceMappingURL=chunk-01ef3c89.c82696a2.js.map